<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>6 Soil physical and hydrological properties | An Open Compendium of Soil Sample and Soil Profile Datasets</title>
<meta name="author" content="Tom Hengl, Surya Gupta, Robert Minarik">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.14/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-1BH6J2NKGP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-1BH6J2NKGP');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">An Open Compendium of Soil Sample and Soil Profile Datasets</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li><a class="" href="new-to-markdown.html"><span class="header-section-number">1</span> New to markdown</a></li>
<li><a class="" href="soil-data-communities-and-mailing-lists.html"><span class="header-section-number">2</span> Soil data communities and mailing lists</a></li>
<li><a class="" href="datasets.html"><span class="header-section-number">3</span> Datasets</a></li>
<li><a class="" href="soil-variables.html"><span class="header-section-number">4</span> Soil variables</a></li>
<li><a class="" href="soil-chemical-and-physical-properties.html"><span class="header-section-number">5</span> Soil chemical and physical properties</a></li>
<li><a class="active" href="soil-physical-and-hydrological-properties.html"><span class="header-section-number">6</span> Soil physical and hydrological properties</a></li>
<li><a class="" href="wrb-soil-types.html"><span class="header-section-number">7</span> WRB soil types</a></li>
<li><a class="" href="references.html"><span class="header-section-number">8</span> References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/OpenGeoHub/SoilSamples/">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="soil-physical-and-hydrological-properties" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Soil physical and hydrological properties<a class="anchor" aria-label="anchor" href="#soil-physical-and-hydrological-properties"><i class="fas fa-link"></i></a>
</h1>
<div class="rmdnote">
<p>You are reading the work-in-progress An Open Compendium of Soil Sample and Soil Profile Datasets. This chapter is currently draft version, a peer-review publication is pending. You can find the polished first edition at <a href="https://opengeohub.github.io/SoilSamples/" class="uri">https://opengeohub.github.io/SoilSamples/</a>.</p>
</div>
<p>Last update: 2023-05-10</p>
<div id="overview-1" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-1"><i class="fas fa-link"></i></a>
</h2>
<p>This section describes import steps used to produce a global compilation of soil
laboratory data with physicals and hydraulic soil properties that can be then
used for predictive soil mapping / modeling at global and regional scales.</p>
<p>Read more about computing with soil hydraulic / physical properties in R:</p>
<ul>
<li>Gupta, S., Hengl, T., Lehmann, P., Bonetti, S., and Or, D. <a href="https://doi.org/10.5194/essd-2020-149"><strong>SoilKsatDB: global soil saturated hydraulic conductivity measurements for geoscience applications</strong></a>. Earth Syst. Sci. Data Discuss., <a href="https://doi.org/10.5194/essd-2020-149" class="uri">https://doi.org/10.5194/essd-2020-149</a>, in review, 2021.</li>
<li>de Sousa, D. F., Rodrigues, S., de Lima, H. V., &amp; Chagas, L. T. (2020). <a href="https://doi.org/10.1016/j.compag.2019.105077">R software packages as a tool for evaluating soil physical and hydraulic properties</a>. Computers and Electronics in Agriculture, 168, 105077.</li>
</ul>
</div>
<div id="alt-text-specifications-1" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> <img src="tex/R_logo.svg.png" title="Packages in use" alt="alt text"> Specifications<a class="anchor" aria-label="anchor" href="#alt-text-specifications-1"><i class="fas fa-link"></i></a>
</h2>
<div id="data-standards-1" class="section level4" number="6.2.0.1">
<h4>
<span class="header-section-number">6.2.0.1</span> Data standards<a class="anchor" aria-label="anchor" href="#data-standards-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Metadata information: <a href="https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/stelprdb1253872.pdf">“Soil Survey Investigation Report No. 42.”</a> and <a href="https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/nrcs142p2_052226.pdf">“Soil Survey Investigation Report No. 45.”</a>
</li>
<li>Model DB: <a href="https://ncsslabdatamart.sc.egov.usda.gov/">National Cooperative Soil Survey (NCSS) Soil Characterization Database</a>
</li>
</ul>
</div>
<div id="target-variables-1" class="section level4" number="6.2.0.2">
<h4>
<span class="header-section-number">6.2.0.2</span> <em>Target variables:</em><a class="anchor" aria-label="anchor" href="#target-variables-1"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">site.names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span><span class="op">)</span>
<span class="va">hor.names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"labsampnum"</span>,<span class="st">"site_key"</span>,<span class="st">"layer_sequence"</span>,<span class="st">"hzn_top"</span>,<span class="st">"hzn_bot"</span>,<span class="st">"hzn_desgn"</span>,<span class="st">"db_13b"</span>, <span class="st">"db_od"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"w3cld"</span>, <span class="st">"w15l2"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"wpg2"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>
<span class="co">## target structure:</span>
<span class="va">col.names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"db_13b"</span>, <span class="st">"db_od"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"w3cld"</span>, <span class="st">"w15l2"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"wpg2"</span>,  <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span>, <span class="st">"source_db"</span>, <span class="st">"confidence_degree"</span>, <span class="st">"project_url"</span>, <span class="st">"citation_url"</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>db_13b</code>: Bulk density (33kPa) in g/cm3 for &lt;2mm soil fraction,</li>
<li>
<code>db</code>: Bulk density (unknown method) in g/cm3 for &lt;2mm soil fraction,</li>
<li>
<code>COLEws</code>: Coefficient of Linear Extensibility (COLE) whole soil in ratio for &lt;2mm soil fraction,</li>
<li>
<code>w6clod</code>: Water Content 6 kPa &lt;2mm in % wt for &lt;2mm soil fraction,</li>
<li>
<code>w10cld</code>: Water Content 10 kPa &lt;2mm in % wt for &lt;2mm soil fraction,</li>
<li>
<code>w3cld</code>: Water Content 33 kPa &lt;2mm in % vol for &lt;2mm soil fraction (Field Capacity),</li>
<li>
<code>w15l2</code>: Water Content 1500 kPa &lt;2mm in % vol for &lt;2mm soil fraction (Permanent Wilting Point),</li>
<li>
<code>w15bfm</code>: Water Content 1500 kPa moist &lt;2mm in % wt for &lt;2mm soil fraction,</li>
<li>
<code>adod</code>: Air-Dry/Oven-Dry in ratio for &lt;2mm soil fraction,</li>
<li>
<code>wrd_ws13</code>: Water Retention Difference whole soil, 1500-kPa suction and an upper limit of usually 33-kPa in cm3 / cm-3 for &lt;2mm soil fraction,</li>
<li>
<code>cec7_cly</code>: CEC-7/Clay ratio in ratio for &lt;2mm soil fraction,</li>
<li>
<code>w15cly</code>: CEC/Clay ratio at 1500 kPa in ratio for &lt;2mm soil fraction,</li>
<li>
<code>tex_psda</code>: Texture Determined, PSDA in factor for &lt;2mm soil fraction,</li>
<li>
<code>clay_tot_psa</code>: Total Clay, &lt;0.002 mm (&lt;2 µm) in % wt for &lt;2mm soil fraction,</li>
<li>
<code>silt_tot_psa</code>: Total Silt, 0.002-0.05 mm in % wt for &lt;2mm soil fraction,</li>
<li>
<code>sand_tot_psa</code>: Total Sand, 0.05-2.0 mm in % wt for &lt;2mm soil fraction,</li>
<li>
<code>wpg2</code>: Coarse fragments &gt;2-mm weight fraction in % wt for &lt;2mm soil fraction,</li>
<li>
<code>hzn_top</code>: The top (upper) depth of the layer in centimeters. in cm for &lt;2mm soil fraction,</li>
<li>
<code>hzn_bot</code>: The bottom (lower) depth of the layer in centimeters. in cm for &lt;2mm soil fraction,</li>
<li>
<code>oc_v</code>: Organic carbon (unknown method) in % wt for &lt;2mm soil fraction,</li>
<li>
<code>ph_kcl</code>: pH, 1N KCl in ratio for &lt;2mm soil fraction,</li>
<li>
<code>ph_h2o_v</code>: pH in water (unknown method) for &lt;2mm soil fraction,</li>
<li>
<code>cec_sum</code>: Sum of Cations (CEC-8.2) in cmol(+)/kg for &lt;2mm soil fraction,</li>
<li>
<code>cec_nh4</code>: NH4OAc, pH 7 (CEC-7) in cmol(+)/kg for &lt;2mm soil fraction,</li>
<li>
<code>ksat_field</code>: Field-estimated Saturated Hydraulic Conductivity in cm/day for &lt;2mm soil fraction,</li>
<li>
<code>ksat_lab</code>: Laboratory-estimated Saturated Hydraulic Conductivity in cm/day for &lt;2mm soil fraction,</li>
</ul>
<p>Same variable names have been adjusted (e.g. <code>ph_h2o</code> to <code>ph_h2o_na</code>) to include <code>unknown method</code> so that variables from different laboratory methods can be seamlessly merged.</p>
<p>Conversion between VWC and MWC is based on the formula <span class="citation">(<a href="#ref-landon1991handbook" role="doc-biblioref"><strong>landon1991handbook?</strong></a>; <a href="#ref-benham1998field" role="doc-biblioref"><strong>benham1998field?</strong></a>; <a href="#ref-vanReeuwijk1993procedures" role="doc-biblioref"><strong>vanReeuwijk1993procedures?</strong></a>)</span>:</p>
<ul>
<li>VWC (%v/v) = MWC (% by weight ) * bulk density (kg/m3)</li>
</ul>
</div>
</div>
<div id="alt-text-data-import-1" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> <img src="tex/R_logo.svg.png" title="Data import" alt="alt text"> Data import<a class="anchor" aria-label="anchor" href="#alt-text-data-import-1"><i class="fas fa-link"></i></a>
</h2>
<div id="ncss-characterization-database" class="section level4" number="6.3.0.1">
<h4>
<span class="header-section-number">6.3.0.1</span> NCSS Characterization Database<a class="anchor" aria-label="anchor" href="#ncss-characterization-database"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>National Cooperative Soil Survey, (2020). <a href="http://ncsslabdatamart.sc.egov.usda.gov/">National Cooperative Soil Survey Characterization Database</a>. <a href="http://ncsslabdatamart.sc.egov.usda.gov/" class="uri">http://ncsslabdatamart.sc.egov.usda.gov/</a>
</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.NCSS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">ncss.site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Site_Location.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#str(ncss.site)  </span>
  <span class="co">## Location accuracy unknown but we assume 100m</span>
  <span class="va">ncss.site</span><span class="op">$</span><span class="va">location_accuracy_max</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="va">ncss.site</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">=</span> <span class="fl">100</span>
  <span class="va">ncss.layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Layer.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">ncss.bdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Bulk_Density_and_Moisture.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#summary(as.factor(ncss.bdm$prep_code))</span>
  <span class="va">ncss.bdm.0</span> <span class="op">&lt;-</span> <span class="va">ncss.bdm</span><span class="op">[</span><span class="va">ncss.bdm</span><span class="op">$</span><span class="va">prep_code</span><span class="op">==</span><span class="st">"S"</span>,<span class="op">]</span>
  <span class="co">#summary(ncss.bdm.0$db_od)</span>
  <span class="co">## 0 values --- error!</span>
  <span class="va">ncss.carb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Carbon_and_Extractions.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">ncss.organic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Organic.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">ncss.pH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_pH_and_Carbonates.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#str(ncss.pH)</span>
  <span class="co">#summary(!is.na(ncss.pH$ph_h2o))</span>
  <span class="va">ncss.PSDA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_PSDA_and_Rock_Fragments.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">ncss.CEC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_CEC_and_Bases.csv"</span><span class="op">)</span>
  <span class="va">ncss.horizons</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join_all.html">join_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">ncss.bdm.0</span>, <span class="va">ncss.layer</span>, <span class="va">ncss.carb</span>, <span class="va">ncss.organic</span>, <span class="va">ncss.pH</span>, <span class="va">ncss.PSDA</span>, <span class="va">ncss.CEC</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"left"</span>, by<span class="op">=</span><span class="st">"labsampnum"</span><span class="op">)</span>
  <span class="co">#head(ncss.horizons)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ncss.horizons</span><span class="op">)</span>
  <span class="va">ncss.horizons</span><span class="op">$</span><span class="va">ksat_lab</span> <span class="op">=</span> <span class="cn">NA</span>; <span class="va">ncss.horizons</span><span class="op">$</span><span class="va">ksat_field</span> <span class="op">=</span> <span class="cn">NA</span> 
  <span class="va">hydrosprops.NCSS</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">ncss.site</span><span class="op">[</span>,<span class="va">site.names</span><span class="op">]</span>, <span class="va">ncss.horizons</span><span class="op">[</span>,<span class="va">hor.names</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"site_key"</span><span class="op">)</span>
  <span class="co">## soil organic carbon:</span>
  <span class="co">#summary(!is.na(hydrosprops.NCSS$oc)) </span>
  <span class="co">#summary(!is.na(hydrosprops.NCSS$ph_h2o)) </span>
  <span class="co">#summary(!is.na(hydrosprops.NCSS$ph_kcl)) </span>
  <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"USDA_NCSS"</span>
  <span class="co">#str(hydrosprops.NCSS)</span>
  <span class="co">#hist(hydrosprops.NCSS$w3cld[hydrosprops.NCSS$w3cld&lt;150], breaks=45, col="gray")</span>
  <span class="co">## ERROR: MANY VALUES &gt;100%</span>
  <span class="co">## fills in missing BD values using formula from Köchy, Hiederer, and Freibauer (2015)</span>
  <span class="va">db.f</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">db_13b</span><span class="op">)</span>, <span class="op">-</span><span class="fl">0.31</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">oc</span><span class="op">)</span><span class="op">+</span><span class="fl">1.38</span>, <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">db_13b</span><span class="op">)</span>
  <span class="va">db.f</span><span class="op">[</span><span class="va">db.f</span><span class="op">&lt;</span><span class="fl">0.02</span> <span class="op">|</span> <span class="va">db.f</span><span class="op">&gt;</span><span class="fl">2.87</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="co">## Convert to volumetric % to match most of world data sets:</span>
  <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">w3cld</span> <span class="op">=</span> <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">w3cld</span> <span class="op">*</span> <span class="va">db.f</span>
  <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">w15l2</span> <span class="op">=</span> <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">w15l2</span> <span class="op">*</span> <span class="va">db.f</span>
  <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">w10cld</span> <span class="op">=</span> <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">w10cld</span> <span class="op">*</span> <span class="va">db.f</span>
  <span class="co">#summary(as.factor(hydrosprops.NCSS$tex_psda))</span>
  <span class="co">## texture classes need to be cleaned up!</span>
  <span class="co">## check WRC values for sandy soils</span>
  <span class="co">#hydrosprops.NCSS[which(!is.na(hydrosprops.NCSS$w3cld) &amp; hydrosprops.NCSS$sand_tot_psa&gt;95)[1:10],]</span>
  <span class="co">## check WRC values for ORGANIC soils</span>
  <span class="co">#hydrosprops.NCSS[which(!is.na(hydrosprops.NCSS$w3cld) &amp; hydrosprops.NCSS$oc&gt;12)[1:10],]</span>
  <span class="co">## w3cld &gt; 100?</span>
  <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://ncsslabdatamart.sc.egov.usda.gov/"</span>
  <span class="va">hydrosprops.NCSS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.2136/sssaj2016.11.0386n"</span>
  <span class="va">hydrosprops.NCSS</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.NCSS</span><span class="op">)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.NCSS</span>, <span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/hydrosprops.NCSS.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.NCSS</span><span class="op">)</span>
<span class="co">#&gt; [1] 113991     40</span></code></pre></div>
</div>
<div id="africa-soil-profiles-database-1" class="section level4" number="6.3.0.2">
<h4>
<span class="header-section-number">6.3.0.2</span> Africa soil profiles database<a class="anchor" aria-label="anchor" href="#africa-soil-profiles-database-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Leenaars, J. G., Van OOstrum, A. J. M., &amp; Ruiperez Gonzalez, M. (2014). <a href="https://www.isric.org/projects/africa-soil-profiles-database-afsp">Africa soil profiles database version 1.2. A compilation of georeferenced and standardized legacy soil profile data for Sub-Saharan Africa (with dataset)</a>. Wageningen: ISRIC Report 2014/01; 2014.</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.AfSPDB"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/foreign">foreign</a></span><span class="op">)</span>
  <span class="va">afspdb.profiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dbf.html">read.dbf</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SPDB/AfSP012Qry_Profiles.dbf"</span>, as.is<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="co">## approximate location error</span>
  <span class="va">afspdb.profiles</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">=</span> <span class="va">afspdb.profiles</span><span class="op">$</span><span class="va">XYAccur</span> <span class="op">*</span> <span class="fl">1e5</span>
  <span class="va">afspdb.profiles</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">afspdb.profiles</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">&lt;</span> <span class="fl">20</span>, <span class="cn">NA</span>, <span class="va">afspdb.profiles</span><span class="op">$</span><span class="va">location_accuracy_min</span><span class="op">)</span>
  <span class="va">afspdb.profiles</span><span class="op">$</span><span class="va">location_accuracy_max</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="va">afspdb.layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dbf.html">read.dbf</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SPDB/AfSP012Qry_Layers.dbf"</span>, as.is<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="co">## select columns of interest:</span>
  <span class="va">afspdb.s.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ProfileID"</span>, <span class="st">"usiteid"</span>, <span class="st">"T_Year"</span>, <span class="st">"X_LonDD"</span>, <span class="st">"Y_LatDD"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span><span class="op">)</span>
  <span class="co">## Convert to weight content</span>
  <span class="co">#summary(afspdb.layers$BlkDens)</span>
  <span class="co">## select layers</span>
  <span class="va">afspdb.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LayerID"</span>, <span class="st">"ProfileID"</span>, <span class="st">"LayerNr"</span>, <span class="st">"UpDpth"</span>, <span class="st">"LowDpth"</span>, <span class="st">"HorDes"</span>, <span class="st">"db_13b"</span>, <span class="st">"BlkDens"</span>, <span class="st">"COLEws"</span>, <span class="st">"VMCpF18"</span>, <span class="st">"VMCpF20"</span>, <span class="st">"VMCpF25"</span>, <span class="st">"VMCpF42"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"LabTxtr"</span>, <span class="st">"Clay"</span>, <span class="st">"Silt"</span>, <span class="st">"Sand"</span>, <span class="st">"OrgC"</span>, <span class="st">"PHKCl"</span>, <span class="st">"PHH2O"</span>, <span class="st">"CecSoil"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"CfPc"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>
  <span class="co">## add missing columns</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usiteid"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">afspdb.profiles</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">afspdb.layers</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="va">hydrosprops.AfSPDB</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">afspdb.profiles</span><span class="op">[</span>,<span class="va">afspdb.s.lst</span><span class="op">]</span>, <span class="va">afspdb.layers</span><span class="op">[</span>,<span class="va">afspdb.h.lst</span><span class="op">]</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">hydrosprops.AfSPDB</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> 
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">hydrosprops.AfSPDB</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="va">hydrosprops.AfSPDB</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">hydrosprops.AfSPDB</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">200</span>, <span class="cn">NA</span>, <span class="va">hydrosprops.AfSPDB</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">}</span>
  <span class="op">}</span>
  <span class="va">hydrosprops.AfSPDB</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"AfSPDB"</span>
  <span class="va">hydrosprops.AfSPDB</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">5</span>
  <span class="va">hydrosprops.AfSPDB</span><span class="op">$</span><span class="va">OrgC</span> <span class="op">=</span> <span class="va">hydrosprops.AfSPDB</span><span class="op">$</span><span class="va">OrgC</span><span class="op">/</span><span class="fl">10</span>
  <span class="co">#summary(hydrosprops.AfSPDB$OrgC)</span>
  <span class="va">hydrosprops.AfSPDB</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://www.isric.org/projects/africa-soil-profiles-database-afsp"</span>
  <span class="va">hydrosprops.AfSPDB</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://www.isric.org/sites/default/files/isric_report_2014_01.pdf"</span>  
  <span class="va">hydrosprops.AfSPDB</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.AfSPDB</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"VMCpF25"</span>, <span class="st">"VMCpF42"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X_LonDD"</span>, <span class="st">"Y_LatDD"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.AfSPDB</span>, <span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SPDB/hydrosprops.AfSPDB.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.AfSPDB</span><span class="op">)</span>
<span class="co">#&gt; [1] 10720    40</span></code></pre></div>
</div>
<div id="isric-isis" class="section level4" number="6.3.0.3">
<h4>
<span class="header-section-number">6.3.0.3</span> ISRIC ISIS<a class="anchor" aria-label="anchor" href="#isric-isis"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Batjes, N. H. (1995). <a href="https://www.isric.org/sites/default/files/isric_report_1995_10b.pdf">A homogenized soil data file for global environmental research: A subset of FAO, ISRIC and NRCS profiles (Version 1.0) (No. 95/10b)</a>. ISRIC.</li>
<li>Van de Ven, T., &amp; Tempel, P. (1994). ISIS 4.0: ISRIC Soil Information System: User Manual. ISRIC.</li>
</ul>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.ISIS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">isis.xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_ISIS/Sites.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#str(isis.xy)</span>
  <span class="va">isis.des</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_ISIS/SitedescriptionResults.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">isis.site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>site_key<span class="op">=</span><span class="va">isis.xy</span><span class="op">$</span><span class="va">Id</span>, usiteid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">isis.xy</span><span class="op">$</span><span class="va">CountryISO</span>, <span class="va">isis.xy</span><span class="op">$</span><span class="va">SiteNumber</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
  <span class="va">id0.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">236</span>,<span class="fl">235</span>,<span class="fl">224</span><span class="op">)</span>
  <span class="va">nm0.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"site_obsdate"</span><span class="op">)</span>
  <span class="va">isis.site.l</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join_all.html">join_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">id0.lst</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rename.html">rename</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">isis.des</span>, <span class="va">ValueId</span><span class="op">==</span><span class="va">id0.lst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SampleId"</span>,<span class="st">"Value"</span><span class="op">)</span><span class="op">]</span>, replace<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SampleId"</span><span class="op">=</span><span class="st">"site_key"</span>, <span class="st">"Value"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">nm0.lst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span>
  <span class="va">isis.site.df</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">join</a></span><span class="op">(</span><span class="va">isis.site</span>, <span class="va">isis.site.l</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">nm0.lst</span><span class="op">)</span><span class="op">{</span> <span class="va">isis.site.df</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">isis.site.df</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">}</span>
  <span class="va">isis.site.df</span><span class="op">[</span><span class="va">isis.site.df</span><span class="op">$</span><span class="va">usiteid</span><span class="op">==</span><span class="st">"CI2"</span>,<span class="st">"latitude_decimal_degrees"</span><span class="op">]</span> <span class="op">=</span> <span class="fl">5.883333</span>
  <span class="co">#str(isis.site.df)</span>
  <span class="va">isis.site.df</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">=</span> <span class="fl">100</span>
  <span class="va">isis.site.df</span><span class="op">$</span><span class="va">location_accuracy_max</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="va">isis.smp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_ISIS/AnalyticalSamples.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">isis.ana</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_ISIS/AnalyticalResults.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#str(isis.ana)</span>
  <span class="va">isis.class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_ISIS/ClassificationResults.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">isis.hor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>labsampnum<span class="op">=</span><span class="va">isis.smp</span><span class="op">$</span><span class="va">Id</span>, hzn_top<span class="op">=</span><span class="va">isis.smp</span><span class="op">$</span><span class="va">Top</span>, hzn_bot<span class="op">=</span><span class="va">isis.smp</span><span class="op">$</span><span class="va">Bottom</span>, site_key<span class="op">=</span><span class="va">isis.smp</span><span class="op">$</span><span class="va">SiteId</span><span class="op">)</span>
  <span class="va">isis.hor</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"&gt;"</span>, <span class="st">""</span>, <span class="va">isis.hor</span><span class="op">$</span><span class="va">hzn_bot</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#str(isis.hor)</span>
  <span class="va">id.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">22</span>,<span class="fl">4</span>,<span class="fl">28</span>,<span class="fl">31</span>,<span class="fl">32</span>,<span class="fl">14</span>,<span class="fl">34</span>,<span class="fl">38</span>,<span class="fl">39</span>,<span class="fl">42</span><span class="op">)</span>
  <span class="va">nm.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ph_h2o"</span>,<span class="st">"ph_kcl"</span>,<span class="st">"wpg2"</span>,<span class="st">"oc"</span>,<span class="st">"sand_tot_psa"</span>,<span class="st">"silt_tot_psa"</span>,<span class="st">"clay_tot_psa"</span>,<span class="st">"cec_sum"</span>,<span class="st">"db_od"</span>,<span class="st">"w10cld"</span>,<span class="st">"w3cld"</span>, <span class="st">"w15l2"</span><span class="op">)</span>
  <span class="co">#str(as.numeric(isis.ana$Value[isis.ana$ValueId==38]))</span>
  <span class="va">isis.hor.l</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join_all.html">join_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">id.lst</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rename.html">rename</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">isis.ana</span>, <span class="va">ValueId</span><span class="op">==</span><span class="va">id.lst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SampleId"</span>,<span class="st">"Value"</span><span class="op">)</span><span class="op">]</span>, replace<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SampleId"</span><span class="op">=</span><span class="st">"labsampnum"</span>, <span class="st">"Value"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">nm.lst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span>
  <span class="co">#summary(as.numeric(isis.hor.l$w3cld))</span>
  <span class="va">isis.hor.df</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">join</a></span><span class="op">(</span><span class="va">isis.hor</span>, <span class="va">isis.hor.l</span><span class="op">)</span>
  <span class="va">isis.hor.df</span> <span class="op">=</span> <span class="va">isis.hor.df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">isis.hor.df</span><span class="op">$</span><span class="va">labsampnum</span><span class="op">)</span>,<span class="op">]</span>
  <span class="co">#summary(as.numeric(isis.hor.df$w3cld))</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">nm.lst</span><span class="op">)</span><span class="op">{</span> <span class="va">isis.hor.df</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">isis.hor.df</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">}</span>
  <span class="co">#str(isis.hor.df)</span>
  <span class="co">## add missing columns</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"layer_sequence"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"COLEws"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"db_13b"</span>, <span class="st">"w6clod"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">isis.hor.df</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">hor.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">isis.hor.df</span><span class="op">)</span><span class="op">)</span>
  <span class="va">hydrosprops.ISIS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">join</a></span><span class="op">(</span><span class="va">isis.site.df</span><span class="op">[</span>,<span class="va">site.names</span><span class="op">]</span>, <span class="va">isis.hor.df</span><span class="op">[</span>,<span class="va">hor.names</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"left"</span><span class="op">)</span>
  <span class="va">hydrosprops.ISIS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"ISRIC_ISIS"</span>
  <span class="va">hydrosprops.ISIS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">hydrosprops.ISIS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://isis.isric.org"</span>
  <span class="va">hydrosprops.ISIS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://www.isric.org/sites/default/files/isric_report_1995_10b.pdf"</span>
  <span class="va">hydrosprops.ISIS</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.ISIS</span><span class="op">)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.ISIS</span>, <span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_ISIS/hydrosprops.ISIS.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.ISIS</span><span class="op">)</span>
<span class="co">#&gt; [1] 1176   40</span></code></pre></div>
</div>
<div id="isric-wise" class="section level4" number="6.3.0.4">
<h4>
<span class="header-section-number">6.3.0.4</span> ISRIC WISE<a class="anchor" aria-label="anchor" href="#isric-wise"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Batjes, N.H. (2019). <a href="http://dx.doi.org/10.1111/j.1475-2743.2009.00202.x">Harmonized soil profile data for applications at global and continental scales: updates to the WISE database</a>. Soil Use and Management 5:124–127.</li>
</ul>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.WISE"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">wise.SITE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_WISE/WISE3_SITE.csv"</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#summary(as.factor(wise.SITE$LONLAT_ACC))</span>
  <span class="va">wise.SITE</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">wise.SITE</span><span class="op">$</span><span class="va">LONLAT_ACC</span><span class="op">==</span><span class="st">"D"</span>, <span class="fl">1e5</span><span class="op">/</span><span class="fl">2</span>, <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">wise.SITE</span><span class="op">$</span><span class="va">LONLAT_ACC</span><span class="op">==</span><span class="st">"S"</span>, <span class="fl">30</span>, <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">wise.SITE</span><span class="op">$</span><span class="va">LONLAT_ACC</span><span class="op">==</span><span class="st">"M"</span>, <span class="fl">1800</span><span class="op">/</span><span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">wise.SITE</span><span class="op">$</span><span class="va">location_accuracy_max</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="va">wise.HORIZON</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_WISE/WISE3_HORIZON.csv"</span><span class="op">)</span>
  <span class="va">wise.s.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WISE3_id"</span>, <span class="st">"SOURCE_ID"</span>, <span class="st">"DATEYR"</span>, <span class="st">"LONDD"</span>, <span class="st">"LATDD"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span><span class="op">)</span>
  <span class="co">## Volumetric values</span>
  <span class="co">#summary(wise.HORIZON$BULKDENS)</span>
  <span class="co">#summary(wise.HORIZON$VMC1)</span>
  <span class="va">wise.HORIZON</span><span class="op">$</span><span class="va">WISE3_id</span> <span class="op">=</span> <span class="va">wise.HORIZON</span><span class="op">$</span><span class="va">WISE3_ID</span>
  <span class="va">wise.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"labsampnum"</span>, <span class="st">"WISE3_id"</span>, <span class="st">"HONU"</span>, <span class="st">"TOPDEP"</span>, <span class="st">"BOTDEP"</span>, <span class="st">"DESIG"</span>, <span class="st">"db_13b"</span>, <span class="st">"BULKDENS"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"VMC1"</span>, <span class="st">"VMC2"</span>, <span class="st">"VMC3"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"CLAY"</span>, <span class="st">"SILT"</span>, <span class="st">"SAND"</span>, <span class="st">"ORGC"</span>, <span class="st">"PHKCL"</span>, <span class="st">"PHH2O"</span>, <span class="st">"CECSOIL"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"GRAVEL"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>
  <span class="co">## add missing columns</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"labsampnum"</span>, <span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"w15bfm"</span>, <span class="st">"w6clod"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">wise.HORIZON</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="va">hydrosprops.WISE</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">wise.SITE</span><span class="op">[</span>,<span class="va">wise.s.lst</span><span class="op">]</span>, <span class="va">wise.HORIZON</span><span class="op">[</span>,<span class="va">wise.h.lst</span><span class="op">]</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">hydrosprops.WISE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> 
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">hydrosprops.WISE</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="va">hydrosprops.WISE</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">hydrosprops.WISE</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">200</span>, <span class="cn">NA</span>, <span class="va">hydrosprops.WISE</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">}</span>
  <span class="op">}</span>
  <span class="va">hydrosprops.WISE</span><span class="op">$</span><span class="va">ORGC</span> <span class="op">=</span> <span class="va">hydrosprops.WISE</span><span class="op">$</span><span class="va">ORGC</span><span class="op">/</span><span class="fl">10</span>
  <span class="va">hydrosprops.WISE</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"ISRIC_WISE"</span>
  <span class="va">hydrosprops.WISE</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://isric.org"</span>
  <span class="va">hydrosprops.WISE</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"http://dx.doi.org/10.1111/j.1475-2743.2009.00202.x"</span>
  <span class="va">hydrosprops.WISE</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.WISE</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"VMC2"</span>, <span class="st">"VMC3"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LONDD"</span>, <span class="st">"LATDD"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">hydrosprops.WISE</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">5</span>
  <span class="co">#summary(hydrosprops.WISE$VMC3)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.WISE</span>, <span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_WISE/hydrosprops.WISE.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.WISE</span><span class="op">)</span>
<span class="co">#&gt; [1] 1325   40</span></code></pre></div>
</div>
<div id="fine-root-ecology-database-fred-1" class="section level4" number="6.3.0.5">
<h4>
<span class="header-section-number">6.3.0.5</span> Fine Root Ecology Database (FRED)<a class="anchor" aria-label="anchor" href="#fine-root-ecology-database-fred-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Iversen CM, Powell AS, McCormack ML, Blackwood CB, Freschet GT, Kattge J, Roumet C, Stover DB, Soudzilovskaia NA, Valverde-Barrantes OJ, van Bodegom PM, Violle C. 2018. Fine-Root Ecology Database (FRED): A Global Collection of Root Trait Data with Coincident Site, Vegetation, Edaphic, and Climatic Data, Version 2. Oak Ridge National Laboratory, TES SFA, U.S. Department of Energy, Oak Ridge, Tennessee, U.S.A. Access on-line at: <a href="https://doi.org/10.25581/ornlsfa.012/1417481" class="uri">https://doi.org/10.25581/ornlsfa.012/1417481</a>.</li>
</ul>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.FRED"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">fred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/FRED/FRED2_20180518.csv"</span>, skip <span class="op">=</span> <span class="fl">5</span>, header<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fred</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/FRED/FRED2_20180518.csv"</span>, nrows<span class="op">=</span><span class="fl">1</span>, header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="va">fred.h.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Notes_Row.ID"</span>, <span class="st">"Data.source_DOI"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"Soil.horizon"</span>, <span class="st">"db_13b"</span>, <span class="st">"Soil.bulk.density"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"Soil.water_Volumetric.content"</span>, <span class="st">"w15l2"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"Soil.texture"</span>, <span class="st">"Soil.texture_Fraction.clay"</span>, <span class="st">"Soil.texture_Fraction.silt"</span>, <span class="st">"Soil.texture_Fraction.sand"</span>, <span class="st">"Soil.organic.C.content"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"Soil.pH_Water"</span>, <span class="st">"Soil.cation.exchange.capacity..CEC."</span>, <span class="st">"cec_nh4"</span>, <span class="st">"wpg2"</span>,  <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>
  <span class="co">#summary(fred$Soil.water_Volumetric.content)</span>
  <span class="co">#summary(fred$Soil.water_Storage.capacity)</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">fred</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample.collection_Year.ending.collection"</span>, <span class="st">"Sample.collection_Year.beginning.collection"</span><span class="op">)</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="co">#summary(fred$site_obsdate)</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fred</span><span class="op">$</span><span class="va">Longitude</span><span class="op">)</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Longitude_Estimated</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Longitude</span><span class="op">)</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fred</span><span class="op">$</span><span class="va">Latitude</span><span class="op">)</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Latitude_Estimated</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Latitude</span><span class="op">)</span>
  <span class="co">#summary(as.factor(fred$Soil.horizon))</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth_Lower.sampling.depth</span><span class="op">)</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth</span> <span class="op">-</span> <span class="fl">5</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth_Lower.sampling.depth</span><span class="op">)</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth_Upper.sampling.depth</span><span class="op">)</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth</span> <span class="op">+</span> <span class="fl">5</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth_Upper.sampling.depth</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">fred.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">fred.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fred</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">fred</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">hydrosprops.FRED</span> <span class="op">=</span> <span class="va">fred</span><span class="op">[</span>,<span class="va">fred.h.lst</span><span class="op">]</span>
  <span class="co">#plot(hydrosprops.FRED[,4:5])</span>
  <span class="va">hydrosprops.FRED</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"FRED"</span>
  <span class="va">hydrosprops.FRED</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">5</span>
  <span class="va">hydrosprops.FRED</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://roots.ornl.gov/"</span>
  <span class="va">hydrosprops.FRED</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.25581/ornlsfa.012/1417481"</span>
  <span class="va">hydrosprops.FRED</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.FRED</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Soil.water_Volumetric.content"</span>, <span class="st">"Soil.texture_Fraction.clay"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.FRED</span>, <span class="st">"/mnt/diskstation/data/Soil_points/INT/FRED/hydrosprops.FRED.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.FRED</span><span class="op">)</span>
<span class="co">#&gt; [1] 3761   40</span></code></pre></div>
</div>
<div id="egrpr-1" class="section level4" number="6.3.0.6">
<h4>
<span class="header-section-number">6.3.0.6</span> EGRPR<a class="anchor" aria-label="anchor" href="#egrpr-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<a href="http://egrpr.esoil.ru/">Russian Federation: The Unified State Register of Soil Resources (EGRPR)</a>.</li>
</ul>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.EGRPR"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">russ.HOR</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Russia/EGRPR/Russia_EGRPR_soil_pedons.csv"</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SOURCEID</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">russ.HOR</span><span class="op">$</span><span class="va">CardID</span>, <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SOIL_ID</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SNDPPT</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSAF</span> <span class="op">+</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXSCM</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SLTPPT</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSIC</span> <span class="op">+</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSIM</span> <span class="op">+</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSIF</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">CLYPPT</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTCL</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSIF</span>
  <span class="co">## Correct texture fractions:</span>
  <span class="va">sumTex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">russ.HOR</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SLTPPT"</span>,<span class="st">"CLYPPT"</span>,<span class="st">"SNDPPT"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SNDPPT</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SNDPPT</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">sumTex</span> <span class="op">-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">CLYPPT</span><span class="op">)</span> <span class="op">/</span><span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">CLYPPT</span><span class="op">)</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SLTPPT</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SLTPPT</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">sumTex</span> <span class="op">-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">CLYPPT</span><span class="op">)</span> <span class="op">/</span><span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">CLYPPT</span><span class="op">)</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">ORGMAT</span><span class="op">/</span><span class="fl">1.724</span>
  <span class="co">## add missing columns</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_obsdate"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"labsampnum"</span>, <span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"w15bfm"</span>, <span class="st">"w6clod"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"wpg2"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">russ.HOR</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="va">russ.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SOURCEID"</span>, <span class="st">"SOIL_ID"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"LONG"</span>, <span class="st">"LAT"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"labsampnum"</span>, <span class="st">"HORNMB"</span>, <span class="st">"HORTOP"</span>, <span class="st">"HORBOT"</span>, <span class="st">"HISMMN"</span>, <span class="st">"db_13b"</span>, <span class="st">"DVOL"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"WR10"</span>, <span class="st">"WR33"</span>, <span class="st">"WR1500"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"CLYPPT"</span>, <span class="st">"SLTPPT"</span>, <span class="st">"SNDPPT"</span>, <span class="st">"oc"</span>, <span class="st">"PHSLT"</span>, <span class="st">"PHH2O"</span>, <span class="st">"CECST"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"wpg2"</span>,<span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>
  <span class="va">hydrosprops.EGRPR</span> <span class="op">=</span> <span class="va">russ.HOR</span><span class="op">[</span>,<span class="va">russ.sel.h</span><span class="op">]</span>
  <span class="va">hydrosprops.EGRPR</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Russia_EGRPR"</span>
  <span class="va">hydrosprops.EGRPR</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">hydrosprops.EGRPR</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://egrpr.esoil.ru/"</span>
  <span class="va">hydrosprops.EGRPR</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.19047/0136-1694-2016-86-115-123"</span>
  <span class="va">hydrosprops.EGRPR</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.EGRPR</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WR33"</span>, <span class="st">"WR1500"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LONG"</span>, <span class="st">"LAT"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#summary(hydrosprops.EGRPR$WR1500)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.EGRPR</span>, <span class="st">"/mnt/diskstation/data/Soil_points/Russia/EGRPR/hydrosprops.EGRPR.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.EGRPR</span><span class="op">)</span>
<span class="co">#&gt; [1] 1138   40</span></code></pre></div>
</div>
<div id="spade-2" class="section level4" number="6.3.0.7">
<h4>
<span class="header-section-number">6.3.0.7</span> SPADE-2<a class="anchor" aria-label="anchor" href="#spade-2"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Hannam J.A., Hollis, J.M., Jones, R.J.A., Bellamy, P.H., Hayes, S.E., Holden, A., Van Liedekerke, M.H. and Montanarella, L. (2009). <a href="https://esdac.jrc.ec.europa.eu/content/soil-profile-analytical-database-2">SPADE-2: The soil profile analytical database for Europe, Version 2.0 Beta Version March 2009</a>. Unpublished Report, 27pp.</li>
<li>Kristensen, J. A., Balstrøm, T., Jones, R. J. A., Jones, A., Montanarella, L., Panagos, P., and Breuning-Madsen, H.: Development of a harmonised soil profile analytical database for Europe: a resource for supporting regional soil management, SOIL, 5, 289–301, <a href="https://doi.org/10.5194/soil-5-289-2019" class="uri">https://doi.org/10.5194/soil-5-289-2019</a>, 2019.</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.SPADE2"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">spade.PLOT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/EU/SPADE/DAT_PLOT.csv"</span><span class="op">)</span>
  <span class="co">#str(spade.PLOT)</span>
  <span class="va">spade.HOR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/EU/SPADE/DAT_HOR.csv"</span><span class="op">)</span>
  <span class="va">spade.PLOT</span> <span class="op">=</span> <span class="va">spade.PLOT</span><span class="op">[</span><span class="op">!</span><span class="va">spade.PLOT</span><span class="op">$</span><span class="va">LON_COOR_V</span><span class="op">&gt;</span><span class="fl">180</span> <span class="op">&amp;</span> <span class="va">spade.PLOT</span><span class="op">$</span><span class="va">LAT_COOR_V</span><span class="op">&gt;</span><span class="fl">20</span>,<span class="op">]</span>
  <span class="co">#plot(spade.PLOT[,c("LON_COOR_V","LAT_COOR_V")])</span>
  <span class="va">spade.PLOT</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">=</span> <span class="fl">100</span>
  <span class="va">spade.PLOT</span><span class="op">$</span><span class="va">location_accuracy_max</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="co">#site.names = c("site_key", "usiteid", "site_obsdate", "longitude_decimal_degrees", "latitude_decimal_degrees")</span>
  <span class="va">spade.PLOT</span><span class="op">$</span><span class="va">ProfileID</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">spade.PLOT</span><span class="op">$</span><span class="va">CNTY_C</span>, <span class="va">spade.PLOT</span><span class="op">$</span><span class="va">PLOT_ID</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
  <span class="va">spade.PLOT</span><span class="op">$</span><span class="va">T_Year</span> <span class="op">=</span> <span class="fl">2009</span>
  <span class="va">spade.s.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PLOT_ID"</span>, <span class="st">"ProfileID"</span>, <span class="st">"T_Year"</span>, <span class="st">"LON_COOR_V"</span>, <span class="st">"LAT_COOR_V"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span><span class="op">)</span>
  <span class="co">## standardize:</span>
  <span class="va">spade.HOR</span><span class="op">$</span><span class="va">SLTPPT</span> <span class="op">&lt;-</span> <span class="va">spade.HOR</span><span class="op">$</span><span class="va">SILT1_V</span> <span class="op">+</span> <span class="va">spade.HOR</span><span class="op">$</span><span class="va">SILT2_V</span>
  <span class="va">spade.HOR</span><span class="op">$</span><span class="va">SNDPPT</span> <span class="op">&lt;-</span> <span class="va">spade.HOR</span><span class="op">$</span><span class="va">SAND1_V</span> <span class="op">+</span> <span class="va">spade.HOR</span><span class="op">$</span><span class="va">SAND2_V</span> <span class="op">+</span> <span class="va">spade.HOR</span><span class="op">$</span><span class="va">SAND3_V</span>
  <span class="va">spade.HOR</span><span class="op">$</span><span class="va">PHIKCL</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">spade.HOR</span><span class="op">$</span><span class="va">PHIKCL</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">spade.HOR</span><span class="op">$</span><span class="va">PH_M</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="st">"A14"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">spade.HOR</span><span class="op">$</span><span class="va">PH_V</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">spade.HOR</span><span class="op">$</span><span class="va">PH_M</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="st">"A14"</span><span class="op">)</span><span class="op">]</span>
  <span class="va">spade.HOR</span><span class="op">$</span><span class="va">PHIHO5</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">spade.HOR</span><span class="op">$</span><span class="va">PHIHO5</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">spade.HOR</span><span class="op">$</span><span class="va">PH_M</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="st">"A12"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">spade.HOR</span><span class="op">$</span><span class="va">PH_V</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">spade.HOR</span><span class="op">$</span><span class="va">PH_M</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="st">"A12"</span><span class="op">)</span><span class="op">]</span>
  <span class="co">#summary(spade.HOR$BD_V)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_obsdate"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"w15bfm"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"w15bfm"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">spade.HOR</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="va">spade.h.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HOR_ID"</span>,<span class="st">"PLOT_ID"</span>,<span class="st">"layer_sequence"</span>,<span class="st">"HOR_BEG_V"</span>,<span class="st">"HOR_END_V"</span>,<span class="st">"HOR_NAME"</span>,<span class="st">"db_13b"</span>, <span class="st">"BD_V"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"WCFC_V"</span>, <span class="st">"WC4_V"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"CLAY_V"</span>, <span class="st">"SLTPPT"</span>, <span class="st">"SNDPPT"</span>, <span class="st">"OC_V"</span>, <span class="st">"PHIKCL"</span>, <span class="st">"PHIHO5"</span>, <span class="st">"CEC_V"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"GRAV_C"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>
  <span class="va">hydrosprops.SPADE2</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">spade.PLOT</span><span class="op">[</span>,<span class="va">spade.s.lst</span><span class="op">]</span>, <span class="va">spade.HOR</span><span class="op">[</span>,<span class="va">spade.h.lst</span><span class="op">]</span><span class="op">)</span>
  <span class="va">hydrosprops.SPADE2</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"SPADE2"</span>
  <span class="va">hydrosprops.SPADE2</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">15</span>
  <span class="va">hydrosprops.SPADE2</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://esdac.jrc.ec.europa.eu/content/soil-profile-analytical-database-2"</span>
  <span class="va">hydrosprops.SPADE2</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1016/j.landusepol.2011.07.003"</span>
  <span class="va">hydrosprops.SPADE2</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.SPADE2</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WCFC_V"</span>, <span class="st">"WC4_V"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LON_COOR_V"</span>,<span class="st">"LAT_COOR_V"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#summary(hydrosprops.SPADE2$WC4_V)</span>
  <span class="co">#summary(is.na(hydrosprops.SPADE2$WC4_V))</span>
  <span class="co">#hist(hydrosprops.SPADE2$WC4_V, breaks=45, col="gray")</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.SPADE2</span>, <span class="st">"/mnt/diskstation/data/Soil_points/EU/SPADE/hydrosprops.SPADE2.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.SPADE2</span><span class="op">)</span>
<span class="co">#&gt; [1] 1182   40</span></code></pre></div>
</div>
<div id="canada-national-pedon-database" class="section level4" number="6.3.0.8">
<h4>
<span class="header-section-number">6.3.0.8</span> Canada National Pedon Database<a class="anchor" aria-label="anchor" href="#canada-national-pedon-database"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<a href="https://open.canada.ca/data/en/dataset/6457fad6-b6f5-47a3-9bd1-ad14aea4b9e0">Agriculture and Agri-Food Canada National Pedon Database</a>.</li>
</ul>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.NPDB"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">NPDB.nm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NPDB_V2_sum_source_info.csv"</span>,<span class="st">"NPDB_V2_sum_chemical.csv"</span>, <span class="st">"NPDB_V2_sum_horizons_raw.csv"</span>, <span class="st">"NPDB_V2_sum_physical.csv"</span><span class="op">)</span>
  <span class="va">NPDB.HOR</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join_all.html">join_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Canada/NPDB/"</span>, <span class="va">NPDB.nm</span><span class="op">)</span>, <span class="va">read.csv</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span>
  <span class="co">#str(NPDB.HOR)</span>
  <span class="co">#summary(NPDB.HOR$BULK_DEN)</span>
  <span class="co">## 0 values -&gt; ERROR!</span>
  <span class="co">## add missing columns</span>
  <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">HISMMN</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">HZN_MAS</span>, <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">HZN_SUF</span>, <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">HZN_MOD</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usiteid"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"labsampnum"</span>, <span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"w15bfm"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">NPDB.HOR</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="va">npdb.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PEDON_ID"</span>, <span class="st">"usiteid"</span>, <span class="st">"CAL_YEAR"</span>, <span class="st">"DD_LONG"</span>, <span class="st">"DD_LAT"</span>, <span class="st">"CONF_METRS"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"U_DEPTH"</span>, <span class="st">"L_DEPTH"</span>, <span class="st">"HISMMN"</span>, <span class="st">"db_13b"</span>, <span class="st">"BULK_DEN"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"RETN_33KP"</span>, <span class="st">"RETN_1500K"</span>, <span class="st">"RETN_HYGR"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"T_CLAY"</span>, <span class="st">"T_SILT"</span>, <span class="st">"T_SAND"</span>, <span class="st">"CARB_ORG"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"PH_H2O"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"VC_SAND"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>
  <span class="va">hydrosprops.NPDB</span> <span class="op">=</span> <span class="va">NPDB.HOR</span><span class="op">[</span>,<span class="va">npdb.sel.h</span><span class="op">]</span>
  <span class="va">hydrosprops.NPDB</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Canada_NPDB"</span>
  <span class="va">hydrosprops.NPDB</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">hydrosprops.NPDB</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://open.canada.ca/data/en/"</span>
  <span class="va">hydrosprops.NPDB</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://open.canada.ca/data/en/dataset/6457fad6-b6f5-47a3-9bd1-ad14aea4b9e0"</span>
  <span class="va">hydrosprops.NPDB</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.NPDB</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"RETN_33KP"</span>, <span class="st">"RETN_1500K"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DD_LONG"</span>, <span class="st">"DD_LAT"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.NPDB</span>, <span class="st">"/mnt/diskstation/data/Soil_points/Canada/NPDB/hydrosprops.NPDB.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.NPDB</span><span class="op">)</span>
<span class="co">#&gt; [1] 404  40</span></code></pre></div>
</div>
<div id="eth-imported-data-from-literature" class="section level4" number="6.3.0.9">
<h4>
<span class="header-section-number">6.3.0.9</span> ETH imported data from literature<a class="anchor" aria-label="anchor" href="#eth-imported-data-from-literature"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Digitized soil hydraulic measurements from the literature by the <a href="https://step.ethz.ch/">ETH Soil and Terrestrial Environmental Physics</a>.</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.ETH"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">xlsxFile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"Global_soil_water_tables.xlsx"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">wb</span> <span class="op">=</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/getSheetNames.html">getSheetNames</a></span><span class="op">(</span><span class="va">xlsxFile</span><span class="op">)</span>
  <span class="va">eth.tbl</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html">rbind.fill</a></span><span class="op">(</span>
    <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"ETH_imported_literature"</span><span class="op">)</span>, 
    <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"ETH_imported_literature_more"</span><span class="op">)</span>,
    <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"ETH_extra_data set"</span><span class="op">)</span>,
    <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"Tibetan_plateau"</span><span class="op">)</span>,
    <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"Belgium_Vereecken_data"</span><span class="op">)</span>,
    <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"Australia_dataset"</span><span class="op">)</span>,
    <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"Florida_Soils_Ksat"</span><span class="op">)</span>,
    <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"China_dataset"</span><span class="op">)</span>,
    <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"Sand_dunes_Siberia_database"</span><span class="op">)</span>,
    <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"New_data_4_03"</span><span class="op">)</span>
  <span class="op">)</span>
  <span class="co">#dim(eth.tbl)</span>
  <span class="co">#summary(as.factor(eth.tbl$reference_source))</span>
  <span class="co">## Data quality tables</span>
  <span class="va">lab.ql</span> <span class="op">=</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"Quality_per_site_key"</span><span class="op">)</span>
  <span class="va">lab.cd</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">eth.tbl</span><span class="op">[</span><span class="st">"site_key"</span><span class="op">]</span>, <span class="va">lab.ql</span><span class="op">)</span><span class="op">$</span><span class="va">confidence_degree</span>
  <span class="va">eth.tbl</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">eth.tbl</span><span class="op">$</span><span class="va">confidence_degree</span><span class="op">)</span>, <span class="va">lab.cd</span>, <span class="va">eth.tbl</span><span class="op">$</span><span class="va">confidence_degree</span><span class="op">)</span>
  <span class="co">#summary(as.factor(eth.tbl$confidence_degree))</span>
  <span class="co">## missing columns</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usiteid"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"w15bfm"</span>, <span class="st">"w15cly"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"wpg2"</span>, <span class="st">"project_url"</span>, <span class="st">"citation_url"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">eth.tbl</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="va">hydrosprops.ETH</span> <span class="op">=</span> <span class="va">eth.tbl</span><span class="op">[</span>,<span class="va">col.names</span><span class="op">]</span>
  <span class="va">col.names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">col.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">eth.tbl</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="va">hydrosprops.ETH</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://step.ethz.ch/"</span>
  <span class="va">hydrosprops.ETH</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.5194/essd-2020-149"</span>
  <span class="va">hydrosprops.ETH</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.ETH</span><span class="op">)</span>
  <span class="co">#hist(hydrosprops.ETH$w15l2, breaks=45, col="gray")</span>
  <span class="co">#hist(log1p(hydrosprops.ETH$ksat_lab), breaks=45, col="gray")</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.ETH</span>, <span class="st">"/mnt/diskstation/data/Soil_points/INT/hydrosprops.ETH.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.ETH</span><span class="op">)</span>
<span class="co">#&gt; [1] 9023   40</span></code></pre></div>
</div>
<div id="hybras" class="section level4" number="6.3.0.10">
<h4>
<span class="header-section-number">6.3.0.10</span> HYBRAS<a class="anchor" aria-label="anchor" href="#hybras"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Ottoni, M. V., Ottoni Filho, T. B., Schaap, M. G., Lopes-Assad, M. L. R., &amp; Rotunno Filho, O. C. (2018). <a href="http://www.cprm.gov.br/en/Hydrology/Research-and-Innovation/HYBRAS-4208.html">Hydrophysical database for Brazilian soils (HYBRAS) and pedotransfer functions for water retention</a>. Vadose Zone Journal, 17(1).</li>
</ul>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.HYBRAS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">hybras.HOR</span> <span class="op">=</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"HYBRAS.V1_integrated_tables_RAW"</span><span class="op">)</span>
  <span class="co">#str(hybras.HOR)</span>
  <span class="co">## some points had only UTM coordinates and had to be manually coorected</span>
  <span class="co">## subset to unique values:</span>
  <span class="va">hybras.HOR</span> <span class="op">=</span> <span class="va">hybras.HOR</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">hybras.HOR</span><span class="op">$</span><span class="va">site_key</span><span class="op">)</span>,<span class="op">]</span>
  <span class="co">#summary(hybras.HOR$bulk_den)</span>
  <span class="co">#hist(hybras.HOR$ksat, breaks=35, col="grey")</span>
  <span class="co">## add missing columns</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usiteid"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"labsampnum"</span>, <span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"w15bfm"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ksat_field"</span>, <span class="st">"uuid"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">hybras.HOR</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="va">hybras.HOR</span><span class="op">$</span><span class="va">w3cld</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">hybras.HOR</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta20"</span>,<span class="st">"theta50"</span><span class="op">)</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">hybras.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"usiteid"</span>, <span class="st">"year"</span>, <span class="st">"LongitudeOR"</span>, <span class="st">"LatitudeOR"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"top_depth"</span>, <span class="st">"bot_depth"</span>, <span class="st">"horizon"</span>, <span class="st">"db_13b"</span>, <span class="st">"bulk_den"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"theta10"</span>, <span class="st">"w3cld"</span>, <span class="st">"theta15000"</span>, <span class="st">"satwat"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand"</span>, <span class="st">"org_carb"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"vc_sand"</span>, <span class="st">"ksat"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>
  <span class="va">hydrosprops.HYBRAS</span> <span class="op">=</span> <span class="va">hybras.HOR</span><span class="op">[</span>,<span class="va">hybras.sel.h</span><span class="op">]</span>
  <span class="va">hydrosprops.HYBRAS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"HYBRAS"</span>
  <span class="va">hydrosprops.HYBRAS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta10"</span>, <span class="st">"w3cld"</span>, <span class="st">"theta15000"</span>, <span class="st">"satwat"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">hydrosprops.HYBRAS</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">hydrosprops.HYBRAS</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fl">100</span> <span class="op">}</span>
  <span class="co">#summary(hydrosprops.HYBRAS$theta10)</span>
  <span class="co">#summary(hydrosprops.HYBRAS$satwat)</span>
  <span class="co">#hist(hydrosprops.HYBRAS$theta10, breaks=45, col="gray")</span>
  <span class="co">#hist(log1p(hydrosprops.HYBRAS$ksat), breaks=45, col="gray")</span>
  <span class="co">#summary(!is.na(hydrosprops.HYBRAS$ksat))</span>
  <span class="va">hydrosprops.HYBRAS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://www.cprm.gov.br/en/Hydrology/Research-and-Innovation/HYBRAS-4208.html"</span>
  <span class="va">hydrosprops.HYBRAS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.2136/vzj2017.05.0095"</span>
  <span class="va">hydrosprops.HYBRAS</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.HYBRAS</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"w3cld"</span>, <span class="st">"theta15000"</span>, <span class="st">"ksat"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LongitudeOR"</span>, <span class="st">"LatitudeOR"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.HYBRAS</span>, <span class="st">"/mnt/diskstation/data/Soil_points/INT/HYBRAS/hydrosprops.HYBRAS.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.HYBRAS</span><span class="op">)</span>
<span class="co">#&gt; [1] 814  40</span></code></pre></div>
</div>
<div id="unsoda" class="section level4" number="6.3.0.11">
<h4>
<span class="header-section-number">6.3.0.11</span> UNSODA<a class="anchor" aria-label="anchor" href="#unsoda"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Nemes, Attila; Schaap, Marcel; Leij, Feike J.; Wösten, J. Henk M. (2015). <a href="https://data.nal.usda.gov/dataset/unsoda-20-unsaturated-soil-hydraulic-database-database-and-program-indirect-methods-estimating-unsaturated-hydraulic-properties">UNSODA 2.0: Unsaturated Soil Hydraulic Database</a>. Database and program for indirect methods of estimating unsaturated hydraulic properties. US Salinity Laboratory - ARS - USDA. <a href="https://doi.org/10.15482/USDA.ADC/1173246" class="uri">https://doi.org/10.15482/USDA.ADC/1173246</a>. Accessed 2020-06-08.</li>
</ul>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.UNSODA"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">unsoda.LOC</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/UNSODA/general_c.csv"</span><span class="op">)</span>
  <span class="co">#unsoda.LOC = unsoda.LOC[!unsoda.LOC$Lat==0,]</span>
  <span class="co">#plot(unsoda.LOC[,c("Long","Lat")])</span>
  <span class="va">unsoda.SOIL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/UNSODA/soil_properties.csv"</span><span class="op">)</span>
  <span class="co">#summary(unsoda.SOIL$k_sat)</span>
  <span class="co">## Soil water retention in lab:</span>
  <span class="va">tmp.hyd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/UNSODA/lab_drying_h-t.csv"</span><span class="op">)</span>
  <span class="co">#str(tmp.hyd)</span>
  <span class="va">tmp.hyd</span> <span class="op">=</span> <span class="va">tmp.hyd</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tmp.hyd</span><span class="op">$</span><span class="va">preshead</span><span class="op">)</span>,<span class="op">]</span>
  <span class="va">tmp.hyd</span><span class="op">$</span><span class="va">theta</span> <span class="op">=</span> <span class="va">tmp.hyd</span><span class="op">$</span><span class="va">theta</span><span class="op">*</span><span class="fl">100</span>
  <span class="co">#head(tmp.hyd)</span>
  <span class="va">pr.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">10</span>,<span class="fl">33</span>,<span class="fl">15000</span><span class="op">)</span>
  <span class="va">cl.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"w3cld"</span>, <span class="st">"w15l2"</span><span class="op">)</span>
  <span class="va">tmp.hyd.tbl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>code<span class="op">=</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">tmp.hyd</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>, w6clod<span class="op">=</span><span class="cn">NA</span>, w10cld<span class="op">=</span><span class="cn">NA</span>, w3cld<span class="op">=</span><span class="cn">NA</span>, w15l2<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pr.lst</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">tmp.hyd.tbl</span><span class="op">[</span>,<span class="va">cl.lst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">tmp.hyd.tbl</span>, <span class="va">tmp.hyd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tmp.hyd</span><span class="op">$</span><span class="va">preshead</span><span class="op">==</span><span class="va">pr.lst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"code"</span>,<span class="st">"theta"</span><span class="op">)</span><span class="op">]</span>, match<span class="op">=</span><span class="st">"first"</span><span class="op">)</span><span class="op">$</span><span class="va">theta</span>
  <span class="op">}</span>
  <span class="co">#head(tmp.hyd.tbl)</span>
  <span class="co">## ksat</span>
  <span class="va">kst.lev</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/UNSODA/comment_lab_sat_cond.csv"</span>, na.strings<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">"NA"</span>,<span class="st">"No comment"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">kst.met</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/UNSODA/methodology.csv"</span>, na.strings<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">"NA"</span>,<span class="st">"No comment"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">kst.met</span><span class="op">$</span><span class="va">comment_lsc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">kst.met</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"comment_lsc_ID"</span><span class="op">)</span><span class="op">]</span>, <span class="va">kst.lev</span><span class="op">)</span><span class="op">$</span><span class="va">comment_lsc</span><span class="op">)</span>
  <span class="va">kst.met</span><span class="op">$</span><span class="va">comment_lsc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">kst.met</span><span class="op">$</span><span class="va">comment_lsc</span><span class="op">==</span><span class="st">"NA"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="va">kst.fld</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/UNSODA/comment_field_sat_cond.csv"</span>, na.strings<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">"NA"</span>,<span class="st">"No comment"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">kst.met</span><span class="op">$</span><span class="va">comment_fsc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">kst.met</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"comment_fsc_ID"</span><span class="op">)</span><span class="op">]</span>, <span class="va">kst.fld</span><span class="op">)</span><span class="op">$</span><span class="va">comment_fsc</span><span class="op">)</span>
  <span class="va">kst.met</span><span class="op">$</span><span class="va">comment_fsc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">kst.met</span><span class="op">$</span><span class="va">comment_fsc</span><span class="op">==</span><span class="st">"NA"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">kst.met</span><span class="op">$</span><span class="va">comment_lsc</span><span class="op">)</span><span class="op">)</span>
  <span class="va">kst.met</span><span class="op">$</span><span class="va">comment_met</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">kst.met</span><span class="op">$</span><span class="va">comment_lsc</span><span class="op">)</span><span class="op">&amp;</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">kst.met</span><span class="op">$</span><span class="va">comment_fsc</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"field"</span>, <span class="va">kst.met</span><span class="op">$</span><span class="va">comment_fsc</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"lab"</span>, <span class="va">kst.met</span><span class="op">$</span><span class="va">comment_lsc</span><span class="op">)</span><span class="op">)</span>
  <span class="va">unsoda.SOIL</span><span class="op">$</span><span class="va">comment_met</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">unsoda.SOIL</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"code"</span><span class="op">)</span><span class="op">]</span>, <span class="va">kst.met</span><span class="op">)</span><span class="op">$</span><span class="va">comment_met</span><span class="op">)</span>
  <span class="co">#summary(as.factor(unsoda.SOIL$comment_met))</span>
  <span class="va">sel.fld</span> <span class="op">=</span> <span class="va">unsoda.SOIL</span><span class="op">$</span><span class="va">comment_met</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"field Double ring infiltrometer"</span>,<span class="st">"field Ponding"</span>, <span class="st">"field Steady infiltration"</span><span class="op">)</span>
  <span class="va">unsoda.SOIL</span><span class="op">$</span><span class="va">ksat_lab</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">sel.fld</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="va">unsoda.SOIL</span><span class="op">$</span><span class="va">k_sat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">sel.fld</span><span class="op">)</span><span class="op">]</span>
  <span class="va">unsoda.SOIL</span><span class="op">$</span><span class="va">ksat_field</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">unsoda.SOIL</span><span class="op">$</span><span class="va">ksat_lab</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="va">unsoda.SOIL</span><span class="op">$</span><span class="va">k_sat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">unsoda.SOIL</span><span class="op">$</span><span class="va">ksat_lab</span><span class="op">)</span><span class="op">]</span>
  <span class="va">unsoda.col</span> <span class="op">=</span> <span class="fu">join_all</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">unsoda.LOC</span>, <span class="va">unsoda.SOIL</span>, <span class="va">tmp.hyd.tbl</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#head(unsoda.col)</span>
  <span class="co">#summary(unsoda.col$OM_content)</span>
  <span class="va">unsoda.col</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">unsoda.col</span><span class="op">$</span><span class="va">OM_content</span><span class="op">/</span><span class="fl">1.724</span>, <span class="fl">4</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usiteid"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"labsampnum"</span>, <span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"wpg2"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">unsoda.col</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="va">unsoda.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"code"</span>, <span class="st">"usiteid"</span>, <span class="st">"date"</span>, <span class="st">"Long"</span>, <span class="st">"Lat"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"depth_upper"</span>, <span class="st">"depth_lower"</span>, <span class="st">"horizon"</span>, <span class="st">"db_13b"</span>, <span class="st">"bulk_density"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"w3cld"</span>, <span class="st">"w15l2"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"Texture"</span>, <span class="st">"Clay"</span>, <span class="st">"Silt"</span>, <span class="st">"Sand"</span>, <span class="st">"oc"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"pH"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"wpg2"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>
  <span class="va">hydrosprops.UNSODA</span> <span class="op">=</span> <span class="va">unsoda.col</span><span class="op">[</span>,<span class="va">unsoda.sel.h</span><span class="op">]</span>
  <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"UNSODA"</span>
  <span class="co">## corrected coordinates:</span>
  <span class="va">unsoda.ql</span> <span class="op">=</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"UNSODA_degree"</span><span class="op">)</span>
  <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.UNSODA</span><span class="op">[</span><span class="st">"code"</span><span class="op">]</span>, <span class="va">unsoda.ql</span><span class="op">)</span><span class="op">$</span><span class="va">confidence_degree</span>
  <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">Texture</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.UNSODA</span><span class="op">[</span><span class="st">"code"</span><span class="op">]</span>, <span class="va">unsoda.ql</span><span class="op">)</span><span class="op">$</span><span class="va">tex_psda</span>
  <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.UNSODA</span><span class="op">[</span><span class="st">"code"</span><span class="op">]</span>, <span class="va">unsoda.ql</span><span class="op">)</span><span class="op">$</span><span class="va">location_accuracy_min</span>
  <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">location_accuracy_max</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.UNSODA</span><span class="op">[</span><span class="st">"code"</span><span class="op">]</span>, <span class="va">unsoda.ql</span><span class="op">)</span><span class="op">$</span><span class="va">location_accuracy_max</span>
  <span class="co">## replace coordinates</span>
  <span class="va">unsoda.Long</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.UNSODA</span><span class="op">[</span><span class="st">"code"</span><span class="op">]</span>, <span class="va">unsoda.ql</span><span class="op">)</span><span class="op">$</span><span class="va">Improved_long</span>
  <span class="va">unsoda.Lat</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.UNSODA</span><span class="op">[</span><span class="st">"code"</span><span class="op">]</span>, <span class="va">unsoda.ql</span><span class="op">)</span><span class="op">$</span><span class="va">Improved_lat</span>
  <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">Long</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">unsoda.Long</span><span class="op">)</span>, <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">Long</span>, <span class="va">unsoda.Long</span><span class="op">)</span>
  <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">Lat</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">unsoda.Long</span><span class="op">)</span>, <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">Lat</span>, <span class="va">unsoda.Lat</span><span class="op">)</span>
  <span class="co">#hist(hydrosprops.UNSODA$w15l2, breaks=45, col="gray")</span>
  <span class="co">#hist(hydrosprops.UNSODA$ksat_lab, breaks=45, col="gray")</span>
  <span class="va">unsoda.rem</span> <span class="op">=</span> <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">unsoda.ql</span><span class="op">$</span><span class="va">code</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">unsoda.ql</span><span class="op">$</span><span class="va">additional_information</span><span class="op">)</span><span class="op">]</span>
  <span class="co">#summary(unsoda.rem)</span>
  <span class="va">hydrosprops.UNSODA</span> <span class="op">=</span> <span class="va">hydrosprops.UNSODA</span><span class="op">[</span><span class="va">unsoda.rem</span>,<span class="op">]</span>
  <span class="co">## texture fractions sometimes need to be multiplied by 100!</span>
  <span class="co">#hydrosprops.UNSODA[hydrosprops.UNSODA$code==2220,]</span>
  <span class="va">sum.tex.1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">hydrosprops.UNSODA</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Clay"</span>, <span class="st">"Silt"</span>, <span class="st">"Sand"</span><span class="op">)</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">sum.tex.r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sum.tex.1</span><span class="op">&lt;</span><span class="fl">1.2</span> <span class="op">&amp;</span> <span class="va">sum.tex.1</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Clay"</span>, <span class="st">"Silt"</span>, <span class="st">"Sand"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">hydrosprops.UNSODA</span><span class="op">[</span><span class="va">sum.tex.r</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="va">hydrosprops.UNSODA</span><span class="op">[</span><span class="va">sum.tex.r</span>,<span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="fl">100</span>
  <span class="op">}</span>
  <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://data.nal.usda.gov/dataset/unsoda-20-unsaturated-soil-hydraulic-database-database-and-program-indirect-methods-estimating-unsaturated-hydraulic-properties"</span>
  <span class="va">hydrosprops.UNSODA</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.15482/USDA.ADC/1173246"</span>
  <span class="va">hydrosprops.UNSODA</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.UNSODA</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.UNSODA</span>, <span class="st">"/mnt/diskstation/data/Soil_points/INT/UNSODA/hydrosprops.UNSODA.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.UNSODA</span><span class="op">)</span>
<span class="co">#&gt; [1] 298  40</span></code></pre></div>
</div>
<div id="hydros" class="section level4" number="6.3.0.12">
<h4>
<span class="header-section-number">6.3.0.12</span> HYDROS<a class="anchor" aria-label="anchor" href="#hydros"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Schindler, Uwe; Müller, Lothar (2015): <a href="http://dx.doi.org/10.4228/ZALF.2003.273">Soil hydraulic functions of international soils measured with the Extended Evaporation Method (EEM) and the HYPROP device</a>, Leibniz-Zentrum für Agrarlandschaftsforschung (ZALF) e.V.[doi: 10.4228/ZALF.2003.273]</li>
</ul>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.HYDROS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">hydros.tbl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/HydroS/int_rawret.csv"</span>, sep<span class="op">=</span><span class="st">"\t"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, dec <span class="op">=</span> <span class="st">","</span><span class="op">)</span>
  <span class="va">hydros.tbl</span> <span class="op">=</span> <span class="va">hydros.tbl</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">hydros.tbl</span><span class="op">$</span><span class="va">TENSION</span><span class="op">)</span>,<span class="op">]</span>
  <span class="co">#summary(hydros.tbl$TENSION)</span>
  <span class="va">hydros.tbl</span><span class="op">$</span><span class="va">TENSIONc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">hydros.tbl</span><span class="op">$</span><span class="va">TENSION</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">8</span>,<span class="fl">15</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">1000</span>,<span class="fl">15001</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#summary(hydros.tbl$TENSIONc)</span>
  <span class="va">hydros.tbl</span><span class="op">$</span><span class="va">WATER_CONTENT</span> <span class="op">=</span> <span class="va">hydros.tbl</span><span class="op">$</span><span class="va">WATER_CONTENT</span>
  <span class="co">#summary(hydros.tbl$WATER_CONTENT)</span>
  <span class="co">#head(hydros.tbl)</span>
  <span class="va">pr2.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(5,8]"</span>, <span class="st">"(8,15]"</span>,<span class="st">"(30,40]"</span>,<span class="st">"(1e+03,1.5e+04]"</span><span class="op">)</span>
  <span class="va">cl.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"w3cld"</span>, <span class="st">"w15l2"</span><span class="op">)</span>
  <span class="va">hydros.tbl.df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>SITE_ID<span class="op">=</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">hydros.tbl</span><span class="op">$</span><span class="va">SITE_ID</span><span class="op">)</span>, w6clod<span class="op">=</span><span class="cn">NA</span>, w10cld<span class="op">=</span><span class="cn">NA</span>, w3cld<span class="op">=</span><span class="cn">NA</span>, w15l2<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pr2.lst</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">hydros.tbl.df</span><span class="op">[</span>,<span class="va">cl.lst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydros.tbl.df</span>, <span class="va">hydros.tbl</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">hydros.tbl</span><span class="op">$</span><span class="va">TENSIONc</span><span class="op">==</span><span class="va">pr2.lst</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SITE_ID"</span>,<span class="st">"WATER_CONTENT"</span><span class="op">)</span><span class="op">]</span>, match<span class="op">=</span><span class="st">"first"</span><span class="op">)</span><span class="op">$</span><span class="va">WATER_CONTENT</span>
  <span class="op">}</span>
  <span class="co">#head(hydros.tbl.df)</span>
  <span class="co">## properties:</span>
  <span class="va">hydros.soil</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/HydroS/int_basicdata.csv"</span>, sep<span class="op">=</span><span class="st">"\t"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, dec <span class="op">=</span> <span class="st">","</span><span class="op">)</span>
  <span class="co">#head(hydros.soil)</span>
  <span class="co">#plot(hydros.soil[,c("H","R")])</span>
  <span class="va">hydros.col</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydros.soil</span>, <span class="va">hydros.tbl.df</span><span class="op">)</span>
  <span class="co">#summary(hydros.col$OMC)</span>
  <span class="va">hydros.col</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">hydros.col</span><span class="op">$</span><span class="va">OMC</span><span class="op">/</span><span class="fl">1.724</span>
  <span class="va">hydros.col</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">=</span> <span class="fl">100</span>
  <span class="va">hydros.col</span><span class="op">$</span><span class="va">location_accuracy_max</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"layer_sequence"</span>, <span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"wpg2"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">hydros.col</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="va">hydros.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SITE_ID"</span>, <span class="st">"SITE"</span>, <span class="st">"SAMP_DATE"</span>, <span class="st">"H"</span>, <span class="st">"R"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"SAMP_NO"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"TOP_DEPTH"</span>, <span class="st">"BOT_DEPTH"</span>, <span class="st">"HORIZON"</span>, <span class="st">"db_13b"</span>, <span class="st">"BULK_DENSITY"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"w3cld"</span>, <span class="st">"w15l2"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"wpg2"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span><span class="op">)</span>
  <span class="va">hydros.sel.h</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">hydros.sel.h</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hydros.col</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="va">hydrosprops.HYDROS</span> <span class="op">=</span> <span class="va">hydros.col</span><span class="op">[</span>,<span class="va">hydros.sel.h</span><span class="op">]</span>
  <span class="va">hydrosprops.HYDROS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"HydroS"</span>
  <span class="va">hydrosprops.HYDROS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">hydrosprops.HYDROS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://dx.doi.org/10.4228/ZALF.2003.273"</span>
  <span class="va">hydrosprops.HYDROS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.18174/odjar.v3i1.15763"</span>
  <span class="va">hydrosprops.HYDROS</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.HYDROS</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"H"</span>,<span class="st">"R"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.HYDROS</span>, <span class="st">"/mnt/diskstation/data/Soil_points/INT/HYDROS/hydrosprops.HYDROS.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.HYDROS</span><span class="op">)</span>
<span class="co">#&gt; [1] 153  40</span></code></pre></div>
</div>
<div id="swig" class="section level4" number="6.3.0.13">
<h4>
<span class="header-section-number">6.3.0.13</span> SWIG<a class="anchor" aria-label="anchor" href="#swig"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Rahmati, M., Weihermüller, L., Vanderborght, J., Pachepsky, Y. A., Mao, L., Sadeghi, S. H., … &amp; Toth, B. (2018). <a href="https://doi.org/10.5194/essd-10-1237-2018">Development and analysis of the Soil Water Infiltration Global database</a>. Earth Syst. Sci. Data, 10, 1237–1263.</li>
</ul>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.SWIG"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">meta.tbl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/SWIG/Metadata.csv"</span>, skip <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, blank.lines.skip<span class="op">=</span><span class="cn">TRUE</span>, flush<span class="op">=</span><span class="cn">TRUE</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">swig.xy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/SWIG/Locations.csv"</span>, sep<span class="op">=</span><span class="st">";"</span>, dec <span class="op">=</span> <span class="st">","</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span>, header<span class="op">=</span><span class="cn">TRUE</span>, na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-"</span>,<span class="st">""</span>,<span class="st">" "</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">swig.xy</span><span class="op">$</span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">","</span>, <span class="st">"."</span>, <span class="va">swig.xy</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="va">swig.xy</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">","</span>, <span class="st">"."</span>, <span class="va">swig.xy</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>
  <span class="va">swig.xy</span> <span class="op">=</span> <span class="va">swig.xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">swig.xy</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="st">"EndDataset"</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
  <span class="va">swig.xyf</span> <span class="op">=</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html">fill</a></span><span class="op">(</span><span class="va">swig.xy</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Dataset"</span>,<span class="st">"EndDataset"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">swig.xyf</span><span class="op">$</span><span class="va">N</span> <span class="op">=</span> <span class="va">swig.xyf</span><span class="op">$</span><span class="va">EndDataset</span> <span class="op">-</span> <span class="va">swig.xyf</span><span class="op">$</span><span class="va">Dataset</span> <span class="op">+</span> <span class="fl">1</span>
  <span class="va">swig.xyf</span><span class="op">$</span><span class="va">N</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">swig.xyf</span><span class="op">$</span><span class="va">N</span><span class="op">&lt;</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="va">swig.xyf</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>
  <span class="va">swig.xyf</span> <span class="op">=</span> <span class="va">swig.xyf</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">swig.xyf</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,<span class="op">]</span>
  <span class="co">#plot(swig.xyf[,c("x","y")])</span>
  <span class="va">swig.xyf.df</span> <span class="op">=</span> <span class="va">swig.xyf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">swig.xyf</span><span class="op">)</span><span class="op">)</span>, <span class="va">swig.xyf</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>,<span class="op">]</span>
  <span class="va">rn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">swig.xyf.df</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"\\."</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
  <span class="va">swig.xyf.df</span><span class="op">$</span><span class="va">Code</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">rn</span>, <span class="va">swig.xyf.df</span><span class="op">$</span><span class="va">Dataset</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="co">## bind together</span>
  <span class="va">swig.col</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">swig.xyf.df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Code"</span>,<span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span><span class="op">]</span>, <span class="va">meta.tbl</span><span class="op">)</span>
  <span class="co">## aditional values for ksat</span>
  <span class="va">swig2.tbl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/SWIG/Statistics.csv"</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, blank.lines.skip<span class="op">=</span><span class="cn">TRUE</span>, sep<span class="op">=</span><span class="st">";"</span>, dec <span class="op">=</span> <span class="st">","</span>, flush<span class="op">=</span><span class="cn">TRUE</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#hist(log1p(as.numeric(swig2.tbl$Ks..cm.hr.)), breaks=45, col="gray")</span>
  <span class="va">swig.col</span><span class="op">$</span><span class="va">Ks..cm.hr.</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">swig.col</span><span class="op">[</span><span class="st">"Code"</span><span class="op">]</span>, <span class="va">swig2.tbl</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Code"</span>,<span class="st">"Ks..cm.hr."</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">Ks..cm.hr.</span><span class="op">)</span>
  <span class="va">swig.col</span><span class="op">$</span><span class="va">Ks..cm.hr.</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">swig.col</span><span class="op">$</span><span class="va">Ks..cm.hr.</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">&lt;=</span> <span class="fl">0.01</span>, <span class="cn">NA</span>, <span class="va">swig.col</span><span class="op">$</span><span class="va">Ks..cm.hr.</span><span class="op">)</span>
  <span class="va">swig.col</span><span class="op">$</span><span class="va">Ksat</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">swig.col</span><span class="op">$</span><span class="va">Ksat</span><span class="op">)</span>, <span class="va">swig.col</span><span class="op">$</span><span class="va">Ks..cm.hr.</span>, <span class="va">swig.col</span><span class="op">$</span><span class="va">Ksat</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"w15bfm"</span>, <span class="st">"w15cly"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ksat_lab"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">swig.col</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="co">## depths are missing?</span>
  <span class="va">swig.col</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="va">swig.col</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fl">20</span>
  <span class="va">swig.col</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="va">swig.col</span><span class="op">$</span><span class="va">location_accuracy_max</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="va">swig.col</span><span class="op">$</span><span class="va">w15l2</span> <span class="op">=</span> <span class="va">swig.col</span><span class="op">$</span><span class="va">PWP</span> <span class="op">*</span> <span class="fl">100</span>
  <span class="va">swig.col</span><span class="op">$</span><span class="va">w3cld</span> <span class="op">=</span> <span class="va">swig.col</span><span class="op">$</span><span class="va">FC</span> <span class="op">*</span> <span class="fl">100</span>
  <span class="va">swig.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Code"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"db_13b"</span>, <span class="st">"Db"</span>, <span class="st">"COLEws"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"w3cld"</span>, <span class="st">"w15l2"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"cec7_cly"</span>, <span class="st">"w15cly"</span>, <span class="st">"Texture.Class"</span>, <span class="st">"Clay"</span>, <span class="st">"Silt"</span>, <span class="st">"Sand"</span>, <span class="st">"OC"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"pH"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"Gravel"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"Ksat"</span><span class="op">)</span>
  <span class="va">swig.sel.h</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">swig.sel.h</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">swig.col</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="va">hydrosprops.SWIG</span> <span class="op">=</span> <span class="va">swig.col</span><span class="op">[</span>,<span class="va">swig.sel.h</span><span class="op">]</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"SWIG"</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">Ksat</span> <span class="op">=</span> <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">Ksat</span> <span class="op">*</span> <span class="fl">24</span> <span class="co">## convert to days</span>
  <span class="co">#hist(hydrosprops.SWIG$w3cld, breaks=45, col="gray")</span>
  <span class="co">#hist(log1p(hydrosprops.SWIG$Ksat), breaks=25, col="gray")</span>
  <span class="co">#summary(hydrosprops.SWIG$Ksat); summary(hydrosprops.UNSODA$ksat_lab)</span>
  <span class="co">## confidence degree</span>
  <span class="va">SWIG.ql</span> <span class="op">=</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="va">xlsxFile</span>, sheet <span class="op">=</span> <span class="st">"SWIG_database_Confidence_degree"</span><span class="op">)</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.SWIG</span><span class="op">[</span><span class="st">"Code"</span><span class="op">]</span>, <span class="va">SWIG.ql</span><span class="op">)</span><span class="op">$</span><span class="va">confidence_degree</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">location_accuracy_min</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.SWIG</span><span class="op">[</span><span class="st">"Code"</span><span class="op">]</span>, <span class="va">SWIG.ql</span><span class="op">)</span><span class="op">$</span><span class="va">location_accuracy_min</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">location_accuracy_max</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.SWIG</span><span class="op">[</span><span class="st">"Code"</span><span class="op">]</span>, <span class="va">SWIG.ql</span><span class="op">)</span><span class="op">$</span><span class="va">location_accuracy_max</span>
  <span class="co">#summary(as.factor(hydrosprops.SWIG$confidence_degree))</span>
  <span class="co">## replace coordinates</span>
  <span class="va">SWIG.Long</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.SWIG</span><span class="op">[</span><span class="st">"Code"</span><span class="op">]</span>, <span class="va">SWIG.ql</span><span class="op">)</span><span class="op">$</span><span class="va">Improved_long</span>
  <span class="va">SWIG.Lat</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.SWIG</span><span class="op">[</span><span class="st">"Code"</span><span class="op">]</span>, <span class="va">SWIG.ql</span><span class="op">)</span><span class="op">$</span><span class="va">Improved_lat</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">SWIG.Long</span><span class="op">)</span>, <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">x</span>, <span class="va">SWIG.Long</span><span class="op">)</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">SWIG.Long</span><span class="op">)</span>, <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">y</span>, <span class="va">SWIG.Lat</span><span class="op">)</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">Texture.Class</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hydrosprops.SWIG</span><span class="op">[</span><span class="st">"Code"</span><span class="op">]</span>, <span class="va">SWIG.ql</span><span class="op">)</span><span class="op">$</span><span class="va">tex_psda</span>
  <span class="va">swig.lab</span> <span class="op">=</span> <span class="va">SWIG.ql</span><span class="op">$</span><span class="va">Code</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">SWIG.ql</span><span class="op">$</span><span class="va">Ksat_Method</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Constant head method"</span>, <span class="st">"Constant Head Method"</span>, <span class="st">"Falling head method"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">ksat_lab</span><span class="op">[</span><span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">Code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">swig.lab</span><span class="op">]</span> <span class="op">=</span> <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">Ksat</span><span class="op">[</span><span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">Code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">swig.lab</span><span class="op">]</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">Ksat</span><span class="op">[</span><span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">Code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">swig.lab</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="co">## remove duplicates</span>
  <span class="va">swig.rem</span> <span class="op">=</span> <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">Code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">SWIG.ql</span><span class="op">$</span><span class="va">Code</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">SWIG.ql</span><span class="op">$</span><span class="va">additional_information</span><span class="op">)</span><span class="op">]</span>
  <span class="co">#summary(swig.rem)</span>
  <span class="co">#Mode   FALSE    TRUE </span>
  <span class="co">#logical     200    6921 </span>
  <span class="va">hydrosprops.SWIG</span> <span class="op">=</span> <span class="va">hydrosprops.SWIG</span><span class="op">[</span><span class="va">swig.rem</span>,<span class="op">]</span>
  <span class="va">hydrosprops.SWIG</span> <span class="op">=</span> <span class="va">hydrosprops.SWIG</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">Code</span><span class="op">)</span>,<span class="op">]</span>
  <span class="co">## remove all ksat values &lt; 0.01 ?</span>
  <span class="co">#summary(hydrosprops.SWIG$Ksat &lt; 0.01)</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://soil-modeling.org/resources-links/data-portal/swig"</span>
  <span class="va">hydrosprops.SWIG</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.5194/essd-10-1237-2018"</span>
  <span class="va">hydrosprops.SWIG</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">hydrosprops.SWIG</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"w15l2"</span>,<span class="st">"w3cld"</span>,<span class="st">"ksat_lab"</span>,<span class="st">"Ksat"</span><span class="op">)</span>, coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.SWIG</span>, <span class="st">"/mnt/diskstation/data/Soil_points/INT/SWIG/hydrosprops.SWIG.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.SWIG</span><span class="op">)</span>
<span class="co">#&gt; [1] 3676   40</span></code></pre></div>
</div>
<div id="pseudo-points" class="section level4" number="6.3.0.14">
<h4>
<span class="header-section-number">6.3.0.14</span> Pseudo-points<a class="anchor" aria-label="anchor" href="#pseudo-points"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Pseudo-observations using simulated points (world deserts)</li>
</ul>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"hydrosprops.SIM"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">## 0 soil organic carbon + 98% sand content (deserts)</span>
  <span class="va">sprops.SIM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/LandGIS/training_points/soil_props/sprops.SIM.rds"</span><span class="op">)</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">w10cld</span> <span class="op">=</span> <span class="fl">3.1</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">w3cld</span> <span class="op">=</span> <span class="fl">1.2</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">w15l2</span> <span class="op">=</span> <span class="fl">0.8</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">tex_psda</span> <span class="op">=</span> <span class="st">"sand"</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">usiteid</span> <span class="op">=</span> <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">lcv_admin0_fao.gaul_c_250m_s0..0cm_2015_v1.0</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">x</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">y</span>
  <span class="co">## Very approximate values for Ksat for shifting sand:</span>
  <span class="va">tax.r</span> <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span><span class="fu">raster</span><span class="op">(</span><span class="st">"/mnt/diskstation/data/LandGIS/archive/predicted250m/sol_grtgroup_usda.soiltax_c_250m_s0..0cm_1950..2017_v0.1.tif"</span><span class="op">)</span>, <span class="va">sprops.SIM</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude_decimal_degrees"</span>,<span class="st">"latitude_decimal_degrees"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
  <span class="va">tax.leg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/LandGIS/archive/predicted250m/sol_grtgroup_usda.soiltax_c_250m_s0..0cm_1950..2017_v0.1.tif.csv"</span><span class="op">)</span>
  <span class="va">tax.ksat_lab</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">eth.tbl</span><span class="op">$</span><span class="va">ksat_lab</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Group<span class="op">=</span><span class="va">eth.tbl</span><span class="op">$</span><span class="va">tax_grtgroup</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">tax.ksat_lab.sd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">eth.tbl</span><span class="op">$</span><span class="va">ksat_lab</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Group<span class="op">=</span><span class="va">eth.tbl</span><span class="op">$</span><span class="va">tax_grtgroup</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">sd</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">tax.ksat_field</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">eth.tbl</span><span class="op">$</span><span class="va">ksat_field</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Group<span class="op">=</span><span class="va">eth.tbl</span><span class="op">$</span><span class="va">tax_grtgroup</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">tax.leg</span><span class="op">$</span><span class="va">ksat_lab</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">join</a></span><span class="op">(</span><span class="va">tax.leg</span>, <span class="va">tax.ksat_lab</span><span class="op">)</span><span class="op">$</span><span class="va">x</span>
  <span class="va">tax.leg</span><span class="op">$</span><span class="va">ksat_field</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">join</a></span><span class="op">(</span><span class="va">tax.leg</span>, <span class="va">tax.ksat_field</span><span class="op">)</span><span class="op">$</span><span class="va">x</span>
  <span class="va">tax.sel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cryochrepts"</span>,<span class="st">"cryorthods"</span>,<span class="st">"torripsamments"</span>,<span class="st">"haplustolls"</span>,<span class="st">"torrifluvents"</span><span class="op">)</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">ksat_field</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>site_key<span class="op">=</span><span class="va">sprops.SIM</span><span class="op">$</span><span class="va">site_key</span>, Number<span class="op">=</span><span class="va">tax.r</span><span class="op">)</span>, <span class="va">tax.leg</span><span class="op">[</span><span class="va">tax.leg</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">tax.sel</span>,<span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">ksat_field</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">ksat_lab</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>site_key<span class="op">=</span><span class="va">sprops.SIM</span><span class="op">$</span><span class="va">site_key</span>, Number<span class="op">=</span><span class="va">tax.r</span><span class="op">)</span>, <span class="va">tax.leg</span><span class="op">[</span><span class="va">tax.leg</span><span class="op">$</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">tax.sel</span>,<span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">ksat_lab</span>
  <span class="co">#summary(sprops.SIM$ksat_lab)</span>
  <span class="co">#summary(sprops.SIM$ksat_field)</span>
  <span class="co">#View(sprops.SIM)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">col.names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">col.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sprops.SIM</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">{</span>  <span class="va">sprops.SIM</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="cn">NA</span> <span class="op">}</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://gitlab.com/openlandmap/global-layers"</span>
  <span class="va">sprops.SIM</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">""</span>
  <span class="va">hydrosprops.SIM</span> <span class="op">=</span> <span class="va">sprops.SIM</span><span class="op">[</span>,<span class="va">col.names</span><span class="op">]</span>
  <span class="va">hydrosprops.SIM</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">30</span>
  <span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">hydrosprops.SIM</span>, <span class="st">"/mnt/diskstation/data/Soil_points/INT/hydrosprops.SIM.rds"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">hydrosprops.SIM</span><span class="op">)</span>
<span class="co">#&gt; [1] 8133   40</span></code></pre></div>
</div>
</div>
<div id="alt-text-bind-all-datasets-1" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> <img src="tex/R_logo.svg.png" title="Bind points" alt="alt text"> Bind all datasets<a class="anchor" aria-label="anchor" href="#alt-text-bind-all-datasets-1"><i class="fas fa-link"></i></a>
</h2>
<div id="bind-and-clean-up-1" class="section level4" number="6.4.0.1">
<h4>
<span class="header-section-number">6.4.0.1</span> Bind and clean-up<a class="anchor" aria-label="anchor" href="#bind-and-clean-up-1"><i class="fas fa-link"></i></a>
</h4>
<p>Bind all tables / rename columns where necessary:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/glob2rx.html">glob2rx</a></span><span class="op">(</span><span class="st">"hydrosprops.*"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;  [1] "hydrosprops.AfSPDB" "hydrosprops.EGRPR"  "hydrosprops.ETH"   </span>
<span class="co">#&gt;  [4] "hydrosprops.FRED"   "hydrosprops.HYBRAS" "hydrosprops.HYDROS"</span>
<span class="co">#&gt;  [7] "hydrosprops.ISIS"   "hydrosprops.NCSS"   "hydrosprops.NPDB"  </span>
<span class="co">#&gt; [10] "hydrosprops.SIM"    "hydrosprops.SPADE2" "hydrosprops.SWIG"  </span>
<span class="co">#&gt; [13] "hydrosprops.UNSODA" "hydrosprops.WISE"</span>
<span class="va">tot_sprops</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/glob2rx.html">glob2rx</a></span><span class="op">(</span><span class="st">"hydrosprops.*"</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, <span class="va">col.names</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="co">## convert to numeric:</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"location_accuracy_min"</span>, <span class="st">"location_accuracy_max"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>,<span class="st">"hzn_bot"</span>, <span class="st">"oc"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"db_od"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>,<span class="st">"silt_tot_psa"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_13b"</span>, <span class="st">"COLEws"</span>, <span class="st">"w15cly"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"w3cld"</span>, <span class="st">"w15l2"</span>, <span class="st">"w15bfm"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>,<span class="st">"cec7_cly"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ksat_lab"</span>,<span class="st">"ksat_field"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; Warning: NAs introduced by coercion</span>

<span class="co">#&gt; Warning: NAs introduced by coercion</span>

<span class="co">#&gt; Warning: NAs introduced by coercion</span>

<span class="co">#&gt; Warning: NAs introduced by coercion</span>

<span class="co">#&gt; Warning: NAs introduced by coercion</span>
<span class="co">#head(tot_sprops)</span>
<span class="co">## rename some columns:</span>
<span class="va">tot_sprops</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rename.html">rename</a></span><span class="op">(</span><span class="va">tot_sprops</span>, replace <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"db_od"</span> <span class="op">=</span> <span class="st">"db"</span>, <span class="st">"ph_h2o"</span> <span class="op">=</span> <span class="st">"ph_h2o_v"</span>, <span class="st">"oc"</span> <span class="op">=</span> <span class="st">"oc_v"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                    AfSPDB      Australian_ksat_data         Belgian_ksat_data </span>
<span class="co">#&gt;                     10720                       118                       145 </span>
<span class="co">#&gt;               Canada_NPDB           China_ksat_data            ETH_literature </span>
<span class="co">#&gt;                       404                       209                      1954 </span>
<span class="co">#&gt;         Florida_ksat_data                      FRED                    HYBRAS </span>
<span class="co">#&gt;                      6532                      3761                       814 </span>
<span class="co">#&gt;                    HydroS                ISRIC_ISIS                ISRIC_WISE </span>
<span class="co">#&gt;                       153                      1176                      1325 </span>
<span class="co">#&gt;              Russia_EGRPR                 SIMULATED                    SPADE2 </span>
<span class="co">#&gt;                      1138                      8133                      1182 </span>
<span class="co">#&gt;                      SWIG Tibetan_plateau_ksat_data                    UNSODA </span>
<span class="co">#&gt;                      3676                        65                       298 </span>
<span class="co">#&gt;                 USDA_NCSS </span>
<span class="co">#&gt;                    113991</span></code></pre></div>
<p>Add unique row identifier</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tot_sprops</span><span class="op">$</span><span class="va">uuid</span> <span class="op">=</span> <span class="fu">uuid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/uuid/man/UUIDgenerate.html">UUIDgenerate</a></span><span class="op">(</span>use.time<span class="op">=</span><span class="cn">TRUE</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>and unique location based on the <a href="https://cran.r-project.org/web/packages/olctools/vignettes/Introduction_to_olctools.html">Open Location Code</a>:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tot_sprops</span><span class="op">$</span><span class="va">olc_id</span> <span class="op">=</span> <span class="fu">olctools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/olctools/man/encode_olc.html">encode_olc</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span>, <span class="fl">11</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">olc_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 25075</span></code></pre></div>
</div>
<div id="quality-control-spatial-locations" class="section level4" number="6.4.0.2">
<h4>
<span class="header-section-number">6.4.0.2</span> Quality-control spatial locations<a class="anchor" aria-label="anchor" href="#quality-control-spatial-locations"><i class="fas fa-link"></i></a>
</h4>
<p>Unique locations:</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tot_sprops.pnts</span> <span class="op">=</span> <span class="va">tot_sprops</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">olc_id</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"source_db"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"olc_id"</span>, <span class="st">"project_url"</span>, <span class="st">"citation_url"</span><span class="op">)</span><span class="op">]</span>
<span class="fu">coordinates</span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">longitude_decimal_degrees</span> <span class="op">+</span> <span class="va">latitude_decimal_degrees</span>
<span class="fu">proj4string</span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"+init=epsg:4326"</span></code></pre></div>
<p>Remove points falling in the sea or similar:</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"ov.sprops"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#mask = terra::rast("./layers1km/lcv_landmask_esacci.lc.l4_c_1km_s0..0cm_2000..2015_v1.0.tif")</span>
  <span class="va">mask</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/LandGIS/layers250m/lcv_landmask_esacci.lc.l4_c_250m_s0..0cm_2000..2015_v1.0.tif"</span><span class="op">)</span>
  <span class="va">ov.sprops</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html">extract</a></span><span class="op">(</span><span class="va">mask</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html">vect</a></span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rem.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">|</span> <span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">2</span> <span class="op">|</span> <span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">4</span><span class="op">)</span>
    <span class="va">rem.sp</span> <span class="op">=</span> <span class="va">tot_sprops.pnts</span><span class="op">$</span><span class="va">site_key</span><span class="op">[</span><span class="va">rem.lst</span><span class="op">]</span>
    <span class="va">tot_sprops.pnts</span> <span class="op">=</span> <span class="va">tot_sprops.pnts</span><span class="op">[</span><span class="op">-</span><span class="va">rem.lst</span>,<span class="op">]</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">rem.sp</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="co">## final number of unique spatial locations:</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">)</span>
<span class="co">#&gt; [1] 25075</span></code></pre></div>
</div>
<div id="clean-up" class="section level4" number="6.4.0.3">
<h4>
<span class="header-section-number">6.4.0.3</span> Clean-up<a class="anchor" aria-label="anchor" href="#clean-up"><i class="fas fa-link"></i></a>
</h4>
<p>Clean up typos and physically impossible values:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"clay_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"wpg2"</span>, <span class="st">"w6clod"</span>, <span class="st">"w10cld"</span>, <span class="st">"w3cld"</span>, <span class="st">"w15l2"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">100</span><span class="op">|</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ph_h2o_v"</span>,<span class="st">"ph_kcl"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">12</span><span class="op">|</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">2</span>, <span class="cn">NA</span>, <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#hist(tot_sprops$db_od)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"db"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">2.4</span><span class="op">|</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0.05</span>, <span class="cn">NA</span>, <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#summary(tot_sprops$ksat_lab)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ksat_lab"</span>,<span class="st">"ksat_field"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;=</span><span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#hist(tot_sprops$oc)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc_v"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">90</span><span class="op">|</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_depth</span> <span class="op">=</span> <span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">+</span> <span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_bot</span><span class="op">-</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>
<span class="co">#tot_sprops = tot_sprops[!is.na(tot_sprops$hzn_depth),]</span>
<span class="co">## texture fractions check:</span>
<span class="va">sum.tex.T</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span><span class="op">)</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sum.tex.T</span><span class="op">&lt;</span><span class="fl">1.2</span> <span class="op">&amp;</span> <span class="va">sum.tex.T</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt;  [1]   9334   9979  12371  22431  22441  81311  81312  81313  93971 150217</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sum.tex.T</span><span class="op">&lt;</span><span class="fl">1.2</span> <span class="op">&amp;</span> <span class="va">sum.tex.T</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">tot_sprops</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span> 
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="histogram-plots-1" class="section level4" number="6.4.0.4">
<h4>
<span class="header-section-number">6.4.0.4</span> Histogram plots<a class="anchor" aria-label="anchor" href="#histogram-plots-1"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="co">#ggplot(tot_sprops[tot_sprops$w15l2&lt;100,], aes(x=source_db, y=w15l2)) + geom_boxplot() + theme(axis.text.x = element_text(angle = 90, hjust = 1))</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">w3cld</span><span class="op">&lt;</span><span class="fl">100</span>,<span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="va">w3cld</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 68935 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="030-import_physical_data_files/figure-html/unnamed-chunk-24-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="va">db</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 69588 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="030-import_physical_data_files/figure-html/unnamed-chunk-25-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="va">ph_h2o_v</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 122423 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="030-import_physical_data_files/figure-html/unnamed-chunk-26-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">ksat_field</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 144683 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="030-import_physical_data_files/figure-html/unnamed-chunk-27-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="va">ksat_lab</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 139595 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="030-import_physical_data_files/figure-html/unnamed-chunk-28-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="convert-to-wide-format-1" class="section level4" number="6.4.0.5">
<h4>
<span class="header-section-number">6.4.0.5</span> Convert to wide format<a class="anchor" aria-label="anchor" href="#convert-to-wide-format-1"><i class="fas fa-link"></i></a>
</h4>
<p>Add <code>layer_sequence</code> where missing since this is needed to be able to convert to wide
format:</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#summary(tot_sprops$layer_sequence)</span>
<span class="va">tot_sprops</span><span class="op">$</span><span class="va">dsiteid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">site_key</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">site_obsdate</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"l.s1"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
  <span class="co">## Note: takes &gt;1 min</span>
  <span class="va">l.s1</span> <span class="op">&lt;-</span> <span class="va">tot_sprops</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"olc_id"</span>,<span class="st">"hzn_depth"</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">olc_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>layer_sequence.f <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/frank.html">frank</a></span><span class="op">(</span><span class="va">hzn_depth</span>, ties.method <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence.f</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence</span><span class="op">)</span>, <span class="va">l.s1</span><span class="op">$</span><span class="va">layer_sequence.f</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence</span><span class="op">)</span>
  <span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence.f</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence.f</span><span class="op">&gt;</span><span class="fl">6</span>, <span class="fl">6</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence.f</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Convert long table to <a href="https://ncss-tech.github.io/AQP/aqp/aqp-intro.html">wide table format</a> so that each depth gets unique column:</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"tot_sprops.w"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://r-datatable.com">data.table</a></span><span class="op">)</span>
  <span class="va">hor.names.s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"db"</span>, <span class="st">"w6clod"</span>, <span class="st">"w3cld"</span>, <span class="st">"w15l2"</span>, <span class="st">"adod"</span>, <span class="st">"wrd_ws13"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc_v"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o_v"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"wpg2"</span>, <span class="st">"ksat_lab"</span>, <span class="st">"ksat_field"</span>, <span class="st">"uuid"</span><span class="op">)</span>
  <span class="va">tot_sprops.w</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/dcast.data.table.html">dcast</a></span><span class="op">(</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">)</span>, 
                formula <span class="op">=</span> <span class="va">olc_id</span> <span class="op">~</span> <span class="va">layer_sequence.f</span>, 
                value.var <span class="op">=</span> <span class="va">hor.names.s</span>, 
                fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">}</span>,
                verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">tot_sprops_w.pnts</span> <span class="op">=</span> <span class="va">tot_sprops.pnts</span>
<span class="va">tot_sprops_w.pnts</span><span class="op">@</span><span class="va">data</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">@</span><span class="va">data</span>, <span class="va">tot_sprops.w</span><span class="op">)</span>
<span class="co">#&gt; Joining by: olc_id</span></code></pre></div>
<p>Write all soil profiles using a wide format:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sel.rm.pnts</span>  <span class="op">&lt;-</span> <span class="va">tot_sprops_w.pnts</span><span class="op">$</span><span class="va">site_key</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">rem.sp</span>
<span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="st">"./out/gpkg/sol_hydro.pnts_horizons.gpkg"</span><span class="op">)</span>
<span class="fu">writeOGR</span><span class="op">(</span><span class="va">tot_sprops_w.pnts</span><span class="op">[</span><span class="op">!</span><span class="va">sel.rm.pnts</span>,<span class="op">]</span>, <span class="st">"./out/gpkg/sol_hydro.pnts_horizons.gpkg"</span>, <span class="st">"sol_hydro.pnts_horizons"</span>, drive<span class="op">=</span><span class="st">"GPKG"</span><span class="op">)</span></code></pre></div>
</div>
<div id="ksat-dataset" class="section level4" number="6.4.0.6">
<h4>
<span class="header-section-number">6.4.0.6</span> Ksat dataset:<a class="anchor" aria-label="anchor" href="#ksat-dataset"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sel.compl</span> <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">w3cld</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">ph_h2o_v</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">clay_tot_psa</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">oc_v</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">sel.compl</span><span class="op">)</span>
<span class="co">#&gt;    Mode   FALSE    TRUE </span>
<span class="co">#&gt; logical  131042   24752</span>
<span class="co">## complete ksat_field points</span>
<span class="va">tot_sprops.pnts.C</span> <span class="op">=</span> <span class="va">tot_sprops</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">ksat_lab</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">ksat_field</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span> <span class="op">==</span> <span class="st">"SIMULATED"</span>,<span class="op">]</span>
<span class="va">sum.NA</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">tot_sprops.pnts.C</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="va">tot_sprops.pnts.C</span> <span class="op">=</span> <span class="va">tot_sprops.pnts.C</span><span class="op">[</span>,<span class="op">!</span><span class="va">sum.NA</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tot_sprops.pnts.C</span><span class="op">)</span><span class="op">]</span>
<span class="va">tot_sprops.pnts.C</span><span class="op">$</span><span class="va">w10cld</span> <span class="op">=</span> <span class="cn">NULL</span>
<span class="va">tot_sprops.pnts.C</span><span class="op">$</span><span class="va">w6clod</span> <span class="op">=</span> <span class="cn">NULL</span>
<span class="va">tot_sprops.pnts.C</span><span class="op">$</span><span class="va">w15bfm</span> <span class="op">=</span> <span class="cn">NULL</span>
<span class="va">tot_sprops.pnts.C</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="cn">NULL</span>
<span class="va">tot_sprops.pnts.C</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="cn">NULL</span>
<span class="va">tot_sprops.pnts.C</span><span class="op">$</span><span class="va">cec_sum</span> <span class="op">=</span> <span class="cn">NULL</span>
<span class="va">tot_sprops.pnts.C</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="cn">NULL</span>
<span class="va">tot_sprops.pnts.C</span><span class="op">$</span><span class="va">uuid</span> <span class="op">=</span> <span class="cn">NULL</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">tot_sprops.pnts.C</span><span class="op">)</span>
<span class="co">#&gt; [1] 13258    25</span></code></pre></div>
</div>
<div id="rds-files" class="section level4" number="6.4.0.7">
<h4>
<span class="header-section-number">6.4.0.7</span> RDS files<a class="anchor" aria-label="anchor" href="#rds-files"><i class="fas fa-link"></i></a>
</h4>
<p>Plot in Goode Homolozine projection and save final objects:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"./img/sol_hydro.pnts_sites.png"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops.pnts_sf</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="fu">plot_gh</span><span class="op">(</span><span class="va">tot_sprops.pnts_sf</span>, out.pdf<span class="op">=</span><span class="st">"./img/sol_hydro.pnts_sites.pdf"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"pdftoppm ./img/sol_hydro.pnts_sites.pdf ./img/sol_hydro.pnts_sites -png -f 1 -singlefile"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"convert -crop 1280x575+36+114 ./img/sol_hydro.pnts_sites.png ./img/sol_hydro.pnts_sites.png"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="img/sol_hydro.pnts_sites.png" alt="Soil profiles and soil samples with physical and hydraulic soil properties properties global compilation." width="100%"><p class="caption">
(#fig:sol_hydro.pnts_sites)Soil profiles and soil samples with physical and hydraulic soil properties properties global compilation.
</p>
</div>
<p>Fig. 1: Soil profiles and soil samples with physical and hydraulic soil properties properties global compilation.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"./img/sol_ksat.pnts_sites.png"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">sel.ks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">$</span><span class="va">location_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">tot_sprops.pnts.C</span><span class="op">$</span><span class="va">location_id</span><span class="op">)</span>
  <span class="va">tot_spropsC.pnts_sf</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">[</span><span class="va">sel.ks</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="fu">plot_gh</span><span class="op">(</span><span class="va">tot_spropsC.pnts_sf</span>, out.pdf<span class="op">=</span><span class="st">"./img/sol_ksat.pnts_sites.pdf"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"pdftoppm ./img/sol_ksat.pnts_sites.pdf ./img/sol_ksat.pnts_sites -png -f 1 -singlefile"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"convert -crop 1280x575+36+114 ./img/sol_ksat.pnts_sites.png ./img/sol_ksat.pnts_sites.png"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="img/sol_ksat.pnts_sites.png" alt="Soil profiles and soil samples with Ksat measurements global compilation" width="100%"><p class="caption">
(#fig:sol_ksat.pnts_sites)Soil profiles and soil samples with Ksat measurements global compilation
</p>
</div>
<p>Fig. 2: Soil profiles and soil samples with Ksat measurements global compilation.</p>
</div>
</div>
<div id="alt-text-overlay-www.openlandmap.org-layers" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> <img src="tex/R_logo.svg.png" title="Overlay www.OpenLandMap.org layers" alt="alt text"> Overlay www.OpenLandMap.org layers<a class="anchor" aria-label="anchor" href="#alt-text-overlay-www.openlandmap.org-layers"><i class="fas fa-link"></i></a>
</h2>
<p>Load the tiling system (1 degree grid representing global land mask) and run spatial overlay in parallel:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"rm.sol"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tile.pol</span> <span class="op">=</span> <span class="fu">readOGR</span><span class="op">(</span><span class="st">"./tiles/global_tiling_100km_grid.gpkg"</span><span class="op">)</span>
  <span class="co">#length(tile.pol)</span>
  <span class="va">ov.sol</span> <span class="op">&lt;-</span> <span class="fu">extract.tiled</span><span class="op">(</span>obj<span class="op">=</span><span class="va">tot_sprops.pnts</span>, tile.pol<span class="op">=</span><span class="va">tile.pol</span>, path<span class="op">=</span><span class="st">"/data/tt/LandGIS/grid250m"</span>, ID<span class="op">=</span><span class="st">"ID"</span>, cpus<span class="op">=</span><span class="fl">64</span><span class="op">)</span>
  <span class="co">## Valid predictors:</span>
  <span class="va">pr.vars</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"fapar"</span>, <span class="st">"landsat"</span>, <span class="st">"lc100"</span>, <span class="st">"mod09a1"</span>, <span class="st">"mod11a2"</span>, <span class="st">"alos.palsar"</span>, <span class="st">"sm2rain"</span>, <span class="st">"irradiation_solar.atlas"</span>, <span class="st">"usgs.ecotapestry"</span>, <span class="st">"floodmap.500y"</span>, <span class="st">"bioclim"</span>, <span class="st">"water.table.depth_deltares"</span>, <span class="st">"snow.prob_esacci"</span>, <span class="st">"water.vapor_nasa.eo"</span>, <span class="st">"wind.speed_terraclimate"</span>, <span class="st">"merit.dem_m"</span>, <span class="st">"merit.hydro_m"</span>, <span class="st">"cloud.fraction_earthenv"</span>, <span class="st">"water.occurance_jrc"</span>, <span class="st">"wetlands.cw_upmc"</span>, <span class="st">"pb2002"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ov.sol</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ov.sol</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">pr.vars</span><span class="op">)</span>
  <span class="co">## 349</span>
  <span class="co">#saveRDS.gz(ov.sol, "/mnt/diskstation/data/Soil_points/ov.sol_hydro.pnts_horizons.rds")</span>
  <span class="co">#ov.sol &lt;- readRDS.gz("/mnt/diskstation/data/Soil_points/ov.sol_hydro.pnts_horizons.rds")</span>
  <span class="co">## Final regression matrix:</span>
  <span class="va">rm.sol</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="va">ov.sol</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"olc_id"</span>, <span class="va">pr.vars</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
  <span class="co">## check that there are no duplicates</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">rm.sol</span><span class="op">$</span><span class="va">uuid</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rm.ksat</span> <span class="op">=</span> <span class="va">rm.sol</span><span class="op">[</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">rm.sol</span><span class="op">$</span><span class="va">ksat_lab</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">rm.sol</span><span class="op">$</span><span class="va">ksat_field</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">rm.sol</span><span class="op">)</span></code></pre></div>
<p>Save final analysis-ready objects:</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="st">"./out/rds/sol_hydro.pnts_horizons.rds"</span><span class="op">)</span>
<span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">tot_sprops.pnts</span>, <span class="st">"/mnt/diskstation/data/Soil_points/sol_hydro.pnts_sites.rds"</span><span class="op">)</span>
<span class="co">## reorder columns</span>
<span class="va">tot_sprops.pnts.C</span><span class="op">$</span><span class="va">ID</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tot_sprops.pnts.C</span><span class="op">)</span>
<span class="va">tot_sprops.pnts.C</span> <span class="op">=</span> <span class="va">tot_sprops.pnts.C</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tot_sprops.pnts.C</span><span class="op">)</span><span class="op">==</span><span class="st">"ID"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tot_sprops.pnts.C</span><span class="op">)</span><span class="op">==</span><span class="st">"ID"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">tot_sprops.pnts.C</span>, <span class="st">"./out/rds/sol_ksat.pnts_horizons.rds"</span><span class="op">)</span>
<span class="co">#library(farff)</span>
<span class="co">#writeARFF(tot_sprops, "./out/arff/sol_hydro.pnts_horizons.arff", overwrite = TRUE)</span>
<span class="co">#writeARFF(tot_sprops.pnts.C, "./out/arff/sol_ksat.pnts_horizons.arff", overwrite = TRUE)</span>
<span class="co">## compressed CSV</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">tot_sprops</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">gzfile</a></span><span class="op">(</span><span class="st">"./out/csv/sol_hydro.pnts_horizons.csv.gz"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">tot_sprops.pnts.C</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">gzfile</a></span><span class="op">(</span><span class="st">"./out/csv/sol_ksat.pnts_horizons.csv.gz"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">rm.sol</span>, <span class="st">"./out/rds/sol_hydro.pnts_horizons_rm.rds"</span><span class="op">)</span>
<span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">rm.ksat</span>, <span class="st">"./out/rds/sol_ksat.pnts_horizons_rm.rds"</span><span class="op">)</span></code></pre></div>
<p>Save temp object:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#rm(rm.sol); gc()</span>
<span class="fu">save.image.pigz</span><span class="op">(</span>file<span class="op">=</span><span class="st">"soilhydro.RData"</span><span class="op">)</span>
<span class="co">## rmarkdown::render("Index.rmd")</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="soil-chemical-and-physical-properties.html"><span class="header-section-number">5</span> Soil chemical and physical properties</a></div>
<div class="next"><a href="wrb-soil-types.html"><span class="header-section-number">7</span> WRB soil types</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#soil-physical-and-hydrological-properties"><span class="header-section-number">6</span> Soil physical and hydrological properties</a></li>
<li><a class="nav-link" href="#overview-1"><span class="header-section-number">6.1</span> Overview</a></li>
<li><a class="nav-link" href="#alt-text-specifications-1"><span class="header-section-number">6.2</span>  Specifications</a></li>
<li><a class="nav-link" href="#alt-text-data-import-1"><span class="header-section-number">6.3</span>  Data import</a></li>
<li><a class="nav-link" href="#alt-text-bind-all-datasets-1"><span class="header-section-number">6.4</span>  Bind all datasets</a></li>
<li><a class="nav-link" href="#alt-text-overlay-www.openlandmap.org-layers"><span class="header-section-number">6.5</span>  Overlay www.OpenLandMap.org layers</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/OpenGeoHub/SoilSamples//blob/master/030-import_physical_data.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/OpenGeoHub/SoilSamples//edit/master/030-import_physical_data.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>An Open Compendium of Soil Sample and Soil Profile Datasets</strong>" was written by Tom Hengl, Surya Gupta, Robert Minarik. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
