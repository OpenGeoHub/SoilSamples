<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>An Open Compendium of Soil Sample and Soil Profile Data sets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="An Open Compendium of Soil Sample and Soil Profile Data sets">
<meta property="og:description" content="This is a public compendium of global, regional, national and sub-national soil samples and/or soil profile datasets (points with Observations and Measurements of soil properties and characteristics). Data sets listed here, assuming compatible open license, are afterwards imported into a common library. Contributions are welcome. To discuss issues or report a bug please use the repository homepage. If you have an addition or correction, make changes to the Rmd’s and make pull-request.">
<meta property="og:site_name" content="An Open Compendium of Soil Sample and Soil Profile Data sets">
<meta name="twitter:title" content="An Open Compendium of Soil Sample and Soil Profile Data sets">
<meta name="twitter:image" content="img/sol_chem.pnts_sites.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="././img/openlandmap_v2_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">An Open Compendium of Soil Sample and Soil Profile Data sets</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://OpenLandMap.org"> 
<span class="menu-text">OpenLandMap.org</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://EarthMonitor.org"> 
<span class="menu-text">Open-Earth-Monitor</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://fosstodon.org/@opengeohub" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-mastodon"></i></a>
    <a href="https://opengeohub.medium.com/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-medium"></i></a>
    <a href="https://twitter.com/opengeohub" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/OpenGeoHub/SoilSamples">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/OpenGeoHub/SoilSamples/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./035-import_wrb_data.html">Tutorials</a></li><li class="breadcrumb-item"><a href="./035-import_wrb_data.html">WRB soil types</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Data import</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-start_here.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">New to markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./015-dataset_communities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Soil data communities and mailing lists</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./020-dataset_list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">devtools::install_github(“hadley/emo”)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./035-import_wrb_data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">WRB soil types</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#wrb-soil-types" id="toc-wrb-soil-types" class="nav-link active" data-scroll-target="#wrb-soil-types">WRB soil types</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#wosis-point-datasets" id="toc-wosis-point-datasets" class="nav-link" data-scroll-target="#wosis-point-datasets">WoSIS point datasets</a></li>
  <li><a href="#hwsdv2" id="toc-hwsdv2" class="nav-link" data-scroll-target="#hwsdv2">HWSDv2</a></li>
  <li><a href="#additional-point-datasets-with-wrb-classes" id="toc-additional-point-datasets-with-wrb-classes" class="nav-link" data-scroll-target="#additional-point-datasets-with-wrb-classes">Additional point datasets with WRB classes</a></li>
  <li><a href="#final-compilation-of-analysis-ready-points" id="toc-final-compilation-of-analysis-ready-points" class="nav-link" data-scroll-target="#final-compilation-of-analysis-ready-points">Final compilation of analysis-ready points</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/OpenGeoHub/SoilSamples/edit/main/035-import_wrb_data.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/OpenGeoHub/SoilSamples/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="wrb-soil-types" class="level1">
<h1>WRB soil types</h1>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This section describes import steps used to produce a global compilation of FAO’s IUSS’s <a href="https://www.fao.org/soils-portal/data-hub/soil-classification/world-reference-base/en/">World Reference Base (WRB)</a> observations of soil types. Classes are either used as-is or a translated from some local or international system. <a href="https://github.com/OpenGeoHub/SoilSamples/tree/main/correlation">Correlation tables</a> are available in the folder <code>./correlation</code> and is based on various literature sources. Correlation is not trivial and often not 1:1 so we typically use 2–3 options for translating soil types <span class="citation" data-cites="krasilnikov2009handbook">(<a href="#ref-krasilnikov2009handbook" role="doc-biblioref">Krasilnikov et al. 2009</a>)</span>. Output compilations are available in the <a href="https://github.com/OpenGeoHub/SoilSamples/tree/main/out">folder</a> <code>./out</code>. Please refer to the dataset version / DOI to ensure full reproducibility of your modeling.</p>
<p>This dataset is currently used to produce <a href="https://github.com/OpenGeoHub/SoilTypeMapping/">soil type maps of the world</a> at various spatial resolutions. To add new dataset please open a <a href="https://github.com/OpenGeoHub/SoilSamples/issues">new issue</a> or do a merge request.</p>
</section>
<section id="wosis-point-datasets" class="level2">
<h2 class="anchored" data-anchor-id="wosis-point-datasets">WoSIS point datasets</h2>
<p>There are currently several global datasets that reference distribution of WRB classes. For building training points for predictive soil type mapping the most comprehensive dataset seems to be World Soil Information Service (WoSIS) soil profile database (available via: https://www.isric.org/explore/wosis) <span class="citation" data-cites="batjes2020standardised">(<a href="#ref-batjes2020standardised" role="doc-biblioref">Batjes, Ribeiro, and Van Oostrum 2020</a>)</span>.</p>
<p>You can download the most up-to-date snapshot of the most up-to-date WOSIS Geopackage file directly by using the <a href="https://www.isric.org/explore/wosis/accessing-wosis-derived-datasets#Access_data">ISRIC’s Web Feature Service</a>. Below is an example of a snapshot downloaded on 10-April-2023:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>wosis <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"/mnt/landmark/HWSDv2/wosis_latest_profiles.gpkg"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.factor</span>(wosis<span class="sc">$</span>cwrb_version))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The WRB soil types can be generate by combining multiple columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>wosis<span class="sc">$</span>wrb4 <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(wosis<span class="sc">$</span>cwrb_prefix_qualifier), <span class="st">""</span>, <span class="fu">paste0</span>(wosis<span class="sc">$</span>cwrb_prefix_qualifier, <span class="st">" "</span>)), wosis<span class="sc">$</span>cwrb_reference_soil_group, <span class="fu">ifelse</span>(<span class="fu">is.na</span>(wosis<span class="sc">$</span>cwrb_suffix_qualifier), <span class="st">""</span>, <span class="fu">paste0</span>(<span class="st">" "</span>, wosis<span class="sc">$</span>cwrb_suffix_qualifier)))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.factor</span>(wosis<span class="sc">$</span>wrb4), <span class="at">maxsum=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This finally gives about 30,000 soil points with soil classification:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>wosis.wrb <span class="ot">=</span> wosis[<span class="sc">!</span>wosis<span class="sc">$</span>wrb4<span class="sc">==</span><span class="st">"NA"</span>, <span class="fu">c</span>(<span class="st">"profile_id"</span>, <span class="st">"geom_accuracy"</span>, <span class="st">"latitude"</span>, <span class="st">"longitude"</span>, <span class="st">"wrb4"</span>, <span class="st">"dataset_id"</span>)]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wosis.wrb)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(wosis.wrb[,c("longitude","latitude")])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can write the <a href="https://github.com/OpenGeoHub/SoilSamples/blob/main/correlation/wosis.wrb_summary.csv">summary distribution</a> of soil types by using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>xs0 <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">as.factor</span>(wosis.wrb<span class="sc">$</span>wrb4), <span class="at">maxsum =</span> <span class="fu">length</span>(<span class="fu">levels</span>(<span class="fu">as.factor</span>(wosis.wrb<span class="sc">$</span>wrb4))))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">data.frame</span>(<span class="at">WRB=</span><span class="fu">attr</span>(xs0, <span class="st">"names"</span>), <span class="at">count=</span>xs0), <span class="st">"./correlation/wosis.wrb_summary.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After some clean-up, we can prepare a harmonized legend that now has consistently WRB soil types up to the level of great-group + prefix and with soil points that have a location accuracy of not worse than 1 km:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>h.wosis <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"./correlation/WOSIS_WRB_legend.csv"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>h.wosis<span class="sc">$</span>wrb4 <span class="ot">=</span> h.wosis<span class="sc">$</span>WRB</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>wosis.wrb<span class="sc">$</span>h_wrb4 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(<span class="fu">as.data.frame</span>(wosis.wrb[<span class="st">"wrb4"</span>]), h.wosis)<span class="sc">$</span>h_wrb4</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="do">## copy values</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>wosis.wrb2 <span class="ot">=</span> wosis.wrb</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>wosis.wrb2<span class="sc">$</span>h_wrb4 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(<span class="fu">as.data.frame</span>(wosis.wrb2[<span class="st">"wrb4"</span>]), h.wosis)<span class="sc">$</span>h_wrb4<span class="fl">.2</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(as.factor(wosis.wrb$h_wrb4))</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#str(levels(as.factor(wosis.wrb$h_wrb4)))</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="do">## remove points with poor location accuracy</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>h.wosis.wrb <span class="ot">=</span> <span class="fu">rbind</span>(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">as.data.frame</span>(wosis.wrb[<span class="sc">!</span>(<span class="fu">is.na</span>(wosis.wrb<span class="sc">$</span>h_wrb4)<span class="sc">|</span>wosis.wrb<span class="sc">$</span>h_wrb4<span class="sc">==</span><span class="st">""</span><span class="sc">|</span>wosis.wrb<span class="sc">$</span>geom_accuracy<span class="sc">&gt;</span><span class="fl">0.08334</span>),]), </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">as.data.frame</span>(wosis.wrb2[<span class="sc">!</span>(<span class="fu">is.na</span>(wosis.wrb2<span class="sc">$</span>h_wrb4)<span class="sc">|</span>wosis.wrb2<span class="sc">$</span>h_wrb4<span class="sc">==</span><span class="st">""</span><span class="sc">|</span>wosis.wrb2<span class="sc">$</span>geom_accuracy<span class="sc">&gt;</span><span class="fl">0.08334</span>),]))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>h.wosis.wrb<span class="sc">$</span>source_db <span class="ot">=</span> h.wosis.wrb<span class="sc">$</span>dataset_id</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(h.wosis.wrb)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS.gz</span>(h.wosis.wrb, <span class="st">"./correlation/h.wosis.wrb.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which can be now considered an analysis-ready point dataset with <code>h_wrb4</code> being the harmonized value of the soil type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>h.wosis.wrb <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"./correlation/h.wosis.wrb.rds"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(h.wosis.wrb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  profile_id geom_accuracy latitude longitude      wrb4
1      47431      0.000100   6.5875    2.1525  Planosol
2      47478      0.010000   6.5875    2.1900  Planosol
3      47503      0.000100   6.5875    2.2262  Planosol
4      47596      0.000100   6.8733    2.3458   Acrisol
5      52678      0.000278   1.0700   34.9000  Vertisol
6      52686      0.000278   0.9400   34.9500 Ferralsol
                  dataset_id                  geom           h_wrb4
1  {AF-AfSP,BJSOTER,WD-WISE} POINT (2.1525 6.5875) Eutric Planosols
2  {AF-AfSP,BJSOTER,WD-WISE}   POINT (2.19 6.5875) Eutric Planosols
3  {AF-AfSP,BJSOTER,WD-WISE} POINT (2.2262 6.5875) Eutric Planosols
4  {AF-AfSP,BJSOTER,WD-WISE} POINT (2.3458 6.8733)  Haplic Acrisols
5 {AF-AfSP,KE-SOTER,WD-WISE}     POINT (34.9 1.07) Haplic Vertisols
6 {AF-AfSP,KE-SOTER,WD-WISE}    POINT (34.95 0.94) Geric Ferralsols
                   source_db
1  {AF-AfSP,BJSOTER,WD-WISE}
2  {AF-AfSP,BJSOTER,WD-WISE}
3  {AF-AfSP,BJSOTER,WD-WISE}
4  {AF-AfSP,BJSOTER,WD-WISE}
5 {AF-AfSP,KE-SOTER,WD-WISE}
6 {AF-AfSP,KE-SOTER,WD-WISE}</code></pre>
</div>
</div>
</section>
<section id="hwsdv2" class="level2">
<h2 class="anchored" data-anchor-id="hwsdv2">HWSDv2</h2>
<p>A disadvantage of using only legacy soil profiles, however, is that these are often spatially clustered i.e.&nbsp;large gaps exists where almost no data available. This applies especially for African and Asian continents. To increase spatial coverage of the training points for <a href="https://github.com/OpenGeoHub/SoilTypeMapping">global soil type mapping</a>, we can add points generated from the global soil polygon map e.g.&nbsp;<a href="https://iiasa.ac.at/models-tools-data/hwsd">Harmonized World Soil Database</a> (HWSD) <span class="citation" data-cites="hwsd2023">(<a href="#ref-hwsd2023" role="doc-biblioref">FAO &amp; IIASA 2023</a>)</span>. This can be done in three steps: first, we prepare <a href="https://github.com/OpenGeoHub/SoilSamples/blob/main/correlation/hwsd2_summary.csv">summary of all WRB soil types</a> in the HWSDv2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>hwsd <span class="ot">&lt;-</span> <span class="fu">mdb.get</span>(<span class="st">"/mnt/landmark/HWSDv2/HWSD2.mdb"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#str(hwsd)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>wrb.leg <span class="ot">=</span> hwsd<span class="sc">$</span>D_WRB4</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#str(wrb.leg)</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>wrb.leg<span class="sc">$</span>WRB4 <span class="ot">=</span> wrb.leg<span class="sc">$</span>CODE</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>layer <span class="ot">=</span> hwsd<span class="sc">$</span>HWSD2_LAYERS[,<span class="fu">c</span>(<span class="st">"HWSD2.SMU.ID"</span>, <span class="st">"WRB4"</span>)]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>layer<span class="sc">$</span>VALUE <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(layer, wrb.leg[<span class="fu">c</span>(<span class="st">"VALUE"</span>,<span class="st">"WRB4"</span>)], <span class="at">match=</span><span class="st">"first"</span>)<span class="sc">$</span>VALUE</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>xs <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">as.factor</span>(layer<span class="sc">$</span>VALUE), <span class="at">maxsum =</span> <span class="fu">nrow</span>(wrb.leg))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(<span class="fu">data.frame</span>(<span class="at">WRB4=</span><span class="fu">attr</span>(xs, <span class="st">"names"</span>), <span class="at">count=</span>xs), <span class="st">"./correlation/hwsd2_summary.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>./correlation/hwsd2_summary.csv</code> table now shows which are the most frequent soil types for the world based on the HWSDv2. Note, these are primarily expert-based and of unknown uncertainty / confidence, so should be used with caution, unlike WoSIS and other legacy soil profiles which are based on actual soil observations and fieldwork.</p>
<p>Second, we can prepare a raster layer that we can use to randomly draw training points using some probability sampling e.g.&nbsp;<a href="https://opengeohub.github.io/spatial-sampling-ml/">Simple Random Sampling</a>. Because we want to draw samples from an equal area space, a good idea is to convert the original HWSD raster to the <a href="https://epsg.io/54052">IGH projection</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>rgdal<span class="sc">::</span><span class="fu">GDALinfo</span>(<span class="st">"/mnt/landmark/HWSDv2/HWSD2.bil"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1km resolution</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>te <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20037508</span>,<span class="sc">-</span><span class="dv">6728980</span>, <span class="dv">20037508</span>, <span class="dv">8421750</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>gh.prj <span class="ot">=</span> <span class="st">"+proj=igh +ellps=WGS84 +units=m +no_defs"</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="fu">paste0</span>(<span class="st">'gdalwarp /mnt/landmark/HWSDv2/HWSD2.bil /mnt/landmark/HWSDv2/HWSD2_gh_1km.tif -r </span><span class="sc">\"</span><span class="st">near</span><span class="sc">\"</span><span class="st"> </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="st">      --config CHECK_WITH_INVERT_PROJ TRUE -t_srs </span><span class="sc">\"</span><span class="st">'</span>, gh.prj, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">'</span><span class="sc">\"</span><span class="st"> -co </span><span class="sc">\"</span><span class="st">COMPRESS=DEFLATE</span><span class="sc">\"</span><span class="st"> -tr 1000 1000 -overwrite -te '</span>, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(te, <span class="at">collapse =</span> <span class="st">" "</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can sample random points from the projected raster by using the terra package functionality <span class="citation" data-cites="hijmans2019spatial">(<a href="#ref-hijmans2019spatial" role="doc-biblioref">Hijmans 2019</a>)</span>. We generate 100,000 random points, although in principle we can later on subset the points to much less points as needed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rnd.hwsd <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">spatSample</span>(terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"/mnt/landmark/HWSDv2/HWSD2_gh_1km.tif"</span>), </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">size=</span><span class="fl">1e5</span>, <span class="at">method=</span><span class="st">"random"</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">xy=</span><span class="cn">TRUE</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="do">## merge and make WRB4 layer</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rnd.hwsd)[<span class="dv">3</span>] <span class="ot">=</span> <span class="st">"HWSD2.SMU.ID"</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>rnd.hwsd<span class="sc">$</span>WRB4 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(rnd.hwsd, layer[<span class="fu">c</span>(<span class="st">"HWSD2.SMU.ID"</span>,<span class="st">"VALUE"</span>)], <span class="at">match=</span><span class="st">"first"</span>)<span class="sc">$</span>VALUE</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>rnd.sf <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(rnd.hwsd, <span class="at">coords =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">crs=</span>gh.prj)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>rnd.ll <span class="ot">&lt;-</span> rnd.sf <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">"./correlation/sim_hwsdv2_pnts.gpkg"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">write_sf</span>(rnd.ll, <span class="st">"./correlation/sim_hwsdv2_pnts.gpkg"</span>, <span class="at">driver =</span> <span class="st">"GPKG"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(rnd.ll, <span class="st">"./correlation/sim_hwsdv2_pnts.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can further harmonize values using a correlation legend:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rnd.ll <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"./correlation/sim_hwsdv2_pnts.rds"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>h.hwsd <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"./correlation/HWSDv2_WRB_legend.csv"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>hwsd.wrb <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(rnd.ll, sf<span class="sc">::</span><span class="fu">st_coordinates</span>(rnd.ll)))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>hwsd.wrb <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(hwsd.wrb, <span class="fu">c</span>(<span class="st">"X"</span><span class="ot">=</span><span class="st">"longitude"</span>, <span class="st">"Y"</span><span class="ot">=</span><span class="st">"latitude"</span>))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>hwsd.wrb<span class="sc">$</span>h_wrb4 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(hwsd.wrb, h.hwsd)<span class="sc">$</span>h_wrb4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: WRB4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>hwsd.wrb<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"HWSDv2"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>hwsd.wrb<span class="sc">$</span>profile_id <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"SIM"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hwsd.wrb))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">## subset to complete points</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>hwsd.wrb <span class="ot">=</span> hwsd.wrb[<span class="sc">!</span><span class="fu">is.na</span>(hwsd.wrb<span class="sc">$</span>WRB4),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which now also has a harmonized column <code>h_wrb4</code> compatible to the column produced using the WoSIS points:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hwsd.wrb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  HWSD2.SMU.ID               WRB4  longitude latitude
1         1467    Ferric Lixisols   8.290244 13.93512
2        11321         Anthrosols  82.118452 41.73180
3        26612 Calcaric Cambisols  33.212770 15.03106
4        16664   Eutric Cambisols  38.366071 10.60237
5         3387    Cambic Cryosols -64.448944 55.92456
6        11805    Haplic Acrisols 118.358546 25.82881
                    geometry             h_wrb4 source_db profile_id
1  POINT (8.290244 13.93512)    Ferric Lixisols    HWSDv2       SIM1
2   POINT (82.11845 41.7318)               &lt;NA&gt;    HWSDv2       SIM2
3  POINT (33.21277 15.03106) Calcaric Cambisols    HWSDv2       SIM3
4  POINT (38.36607 10.60237)   Eutric Cambisols    HWSDv2       SIM4
5 POINT (-64.44894 55.92456)    Cambic Cryosols    HWSDv2       SIM5
6  POINT (118.3585 25.82881)    Haplic Acrisols    HWSDv2       SIM6</code></pre>
</div>
</div>
<p>So in summary we have prepared two point datasets from WoSIS and HSWDv2. WoSIS are the actual observations of soil types and should be considered ground-truth. The HWSDv2 contains the WRB 2022 version soil types per mapping unit, but these are potentially of variable accuracy and should be only used to fill gaps in training data. We had to manually adjust harmonize some classes that we either outdated (old WRB versions) or are missing prefix / suffix.</p>
<p>There are many more point datasets with WRB classification or compatible classification that could be added to the list of training points. Below we list most recent datasets with soil types that we import and add to WoSIS to produce the most up-to-date compilation of soil training data.</p>
</section>
<section id="additional-point-datasets-with-wrb-classes" class="level2">
<h2 class="anchored" data-anchor-id="additional-point-datasets-with-wrb-classes">Additional point datasets with WRB classes</h2>
<p>In addition to WoSIS and HWSDv2, we can also add some additional point datasets that are not yet included in any global compilation but potentially contain <em>ground-truth</em> observations of soil types. For example, we can use point observations coming from the land-surface observations e.g.&nbsp; to represent shifting sand and bare-rock areas. For example, global land cover validation data sets that are produced by photo-interpretation of very high resolution satellite imagery (e.g.&nbsp;20 cm spatial resolution) often contain useful observations of the shifting sand, permanent ice and bare-rocks <span class="citation" data-cites="tsendbazar2021towards">(<a href="#ref-tsendbazar2021towards" role="doc-biblioref">Tsendbazar et al. 2021</a>)</span>. These specific surface materials are often missing or are systematically under-represented in the legacy soil profile datasets. Here is an example of almost 6000 observations of bare rock and shifting sands:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lc.xy <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"./correlation/photointerpretation_leptosol.rds"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.factor</span>(lc.xy<span class="sc">$</span>h_wrb4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lithic Leptosols   Shifting sands 
            3928             2156 </code></pre>
</div>
</div>
<p>Note that we define the <code>Shifting sands</code> as an additional category of soil type as these are arbitrarily either masked out or (controversially) classified to different soil types. We consider that it is more consistent to map shifting sands as a separate category of land.</p>
<p>Another dataset interesting for soil type mapping are the legacy soil observations focused on tropical peatlands, published in the literature, then digitized manually <span class="citation" data-cites="hengl2016global gumbricht2017expert">(<a href="#ref-hengl2016global" role="doc-biblioref">Hengl 2016</a>; <a href="#ref-gumbricht2017expert" role="doc-biblioref">Gumbricht et al. 2017</a>)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>peat.xy <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/CIFOR_peatlands/SOC_literature_CIFOR_v1.csv"</span>, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>peat.xy <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(peat.xy, <span class="fu">c</span>(<span class="st">"TAXNWRB"</span><span class="ot">=</span><span class="st">"h_wrb4"</span>, <span class="st">"modelling.x"</span><span class="ot">=</span><span class="st">"longitude"</span>, <span class="st">"modelling.y"</span><span class="ot">=</span><span class="st">"latitude"</span>, <span class="st">"SOURCEID"</span><span class="ot">=</span><span class="st">"profile_id"</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>peat.xy<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"CIFOR_peatlands"</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>peat.xy <span class="ot">=</span> peat.xy[<span class="sc">!</span><span class="fu">is.na</span>(peat.xy<span class="sc">$</span>longitude) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(peat.xy<span class="sc">$</span>h_wrb4), <span class="fu">c</span>(<span class="st">"profile_id"</span>, <span class="st">"source_db"</span>,<span class="st">"longitude"</span>, <span class="st">"latitude"</span>, <span class="st">"h_wrb4"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Peatlands and inaccessible tropical soil types are often under-represented and hence this dataset helps reduce the bias in under-representing tropical soils.</p>
<p>Croatian soil profile database also contains soil types still in FAO classification system <span class="citation" data-cites="antonic2003spatial">(<a href="#ref-antonic2003spatial" role="doc-biblioref">Antonić, Pernar, and Jelaska 2003</a>)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>hr.xy <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"./correlation/hrspdb_pnts.rds"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>hr.xy2 <span class="ot">=</span> hr.xy[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(hr.xy) <span class="sc">==</span> <span class="st">"h_wrb4"</span>)]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>hr.xy2 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(hr.xy2, <span class="fu">c</span>(<span class="st">"h_wrb4.2"</span><span class="ot">=</span><span class="st">"h_wrb4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Legacy soil observations for Italy <span class="citation" data-cites="righini2001banca vecchio2002regional">(<a href="#ref-righini2001banca" role="doc-biblioref">Righini, Costantini, and Sulli 2001</a>; <a href="#ref-vecchio2002regional" role="doc-biblioref">Vecchio, Barberis, and Bourlot 2002</a>)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>it.xy <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"/mnt/landmark/HWSDv2/taxa/WRB_points_Italy.rds"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>it.xy <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(it.xy, <span class="fu">c</span>(<span class="st">"wrb2015"</span><span class="ot">=</span><span class="st">"h_wrb4"</span>, <span class="st">"id_site"</span><span class="ot">=</span><span class="st">"profile_id"</span>, <span class="st">"lat"</span><span class="ot">=</span><span class="st">"latitude"</span>, <span class="st">"long"</span><span class="ot">=</span><span class="st">"longitude"</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>it.xy<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Italian_SPDB"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>German agricultural soil inventory dataset <span class="citation" data-cites="poeplau2020stocks">(<a href="#ref-poeplau2020stocks" role="doc-biblioref">Poeplau et al. 2020</a>)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>de.xy <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"/mnt/landmark/HWSDv2/taxa/WRB_points_Germany.rds"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>de.xy <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(de.xy, <span class="fu">c</span>(<span class="st">"WRB_correlation_1"</span><span class="ot">=</span><span class="st">"h_wrb4"</span>, <span class="st">"PointID"</span><span class="ot">=</span><span class="st">"profile_id"</span>, <span class="st">"lat"</span><span class="ot">=</span><span class="st">"latitude"</span>, <span class="st">"lon"</span><span class="ot">=</span><span class="st">"longitude"</span>))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>de.xy<span class="sc">$</span>Specific.soil.subtype <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>de.xy<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"BZE_LW"</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>de.xy2 <span class="ot">=</span> de.xy[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(de.xy) <span class="sc">==</span> <span class="st">"h_wrb4"</span>)]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>de.xy2 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(de.xy2, <span class="fu">c</span>(<span class="st">"WRB_correlation_2"</span><span class="ot">=</span><span class="st">"h_wrb4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>French RMQS soil profile and monitoring dataset <span class="citation" data-cites="AIQ9WS_2020">(<a href="#ref-AIQ9WS_2020" role="doc-biblioref">Saby et al. 2020</a>)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fr.xy <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"/mnt/landmark/HWSDv2/taxa/WRB_points_France.rds"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>fr.xy <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(fr.xy, <span class="fu">c</span>(<span class="st">"WRB_correlation_1"</span><span class="ot">=</span><span class="st">"h_wrb4"</span>, <span class="st">"id_site"</span><span class="ot">=</span><span class="st">"profile_id"</span>, <span class="st">"lat"</span><span class="ot">=</span><span class="st">"latitude"</span>, <span class="st">"lon"</span><span class="ot">=</span><span class="st">"longitude"</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>fr.xy<span class="sc">$</span>signific_ger_95 <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>fr.xy<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"RMQS1"</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>fr.xy2 <span class="ot">=</span> fr.xy[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(fr.xy) <span class="sc">==</span> <span class="st">"h_wrb4"</span>)]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>fr.xy2 <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(fr.xy2, <span class="fu">c</span>(<span class="st">"WRB_correlation_2"</span><span class="ot">=</span><span class="st">"h_wrb4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="final-compilation-of-analysis-ready-points" class="level2">
<h2 class="anchored" data-anchor-id="final-compilation-of-analysis-ready-points">Final compilation of analysis-ready points</h2>
<p>Multiple imported point datasets can be finally combined into a single global consistent analysis-ready training dataset (here we limit to max 20,000 simulated points):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sel.cn <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"profile_id"</span>,<span class="st">"latitude"</span>, <span class="st">"longitude"</span>, <span class="st">"h_wrb4"</span>, <span class="st">"source_db"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>tr.pnts <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(<span class="fu">list</span>(h.wosis.wrb[, sel.cn], </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>      hwsd.wrb[<span class="fu">sample.int</span>(<span class="fl">2e4</span>, <span class="at">n =</span> <span class="fu">nrow</span>(hwsd.wrb)), sel.cn],</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>      lc.xy, hr.xy2[, sel.cn], </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      peat.xy[, sel.cn],</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      hr.xy[, sel.cn],</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      it.xy[, sel.cn], de.xy[, sel.cn], de.xy2[, sel.cn], </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>      fr.xy[, sel.cn], fr.xy2[, sel.cn]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can clean-up some systematic naming issues common in many soil DBs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tr.pnts<span class="sc">$</span>h_wrb4 <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">" "</span>, tr.pnts<span class="sc">$</span>h_wrb4)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>tr.pnts<span class="sc">$</span>h_wrb4 <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"distric"</span>, <span class="st">"dystric"</span>, tr.pnts<span class="sc">$</span>h_wrb4, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>tr.pnts<span class="sc">$</span>h_wrb4 <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"sol "</span>, <span class="st">"sols "</span>, tr.pnts<span class="sc">$</span>h_wrb4, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>tr.pnts<span class="sc">$</span>h_wrb4 <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"sol$"</span>, <span class="st">"sols"</span>, tr.pnts<span class="sc">$</span>h_wrb4, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>tr.pnts<span class="sc">$</span>h_wrb4 <span class="ot">=</span> <span class="fu">ifelse</span>(tr.pnts<span class="sc">$</span>h_wrb4<span class="sc">==</span><span class="st">""</span>, <span class="cn">NA</span>, tr.pnts<span class="sc">$</span>h_wrb4)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="do">## subset to complete points:</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>tr.pnts <span class="ot">=</span> tr.pnts[<span class="sc">!</span><span class="fu">is.na</span>(tr.pnts<span class="sc">$</span>h_wrb4)<span class="sc">&amp;!</span><span class="fu">is.na</span>(tr.pnts<span class="sc">$</span>longitude),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives a total of about 70,000 training points with WRB soil type. Note that correlation between different national systems is not trivial and hence you should always check the <a href="https://github.com/OpenGeoHub/SoilSamples/tree/main/correlation">folder</a> <code>./correlation</code> to see if some soil types are possibly incorrectly correlated. Also, IUSS and FAO are kind to maintain the <a href="https://www.fao.org/soils-portal/data-hub/soil-classification/world-reference-base/en/">World Reference Base (WRB)</a>, but a table correlating various versions of WRB is <a href="https://docs.google.com/spreadsheets/d/1GaNpiH65yiuHusNVkUrKog2FCiVUO6kz_wNdIzHbdfg/edit#gid=1418992436">often not trivial</a> and we have to somewhat improvise (or ignore the issue) that some soil types have changed over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>wrb.pnts_profiles_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(tr.pnts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>), <span class="at">crs=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"./img/sol_wrb.pnts_profiles.png"</span>)){</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_gh</span>(wrb.pnts_profiles_sf, <span class="at">out.pdf=</span><span class="st">"./img/sol_wrb.pnts_profiles.pdf"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system</span>(<span class="st">"pdftoppm ./img/sol_wrb.pnts_profiles.pdf ./img/sol_wrb.pnts_profiles -png -f 1 -singlefile"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system</span>(<span class="st">"convert -crop 1280x575+36+114 ./img/sol_wrb.pnts_profiles.png ./img/sol_wrb.pnts_profiles.png"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/sol_wrb.pnts_profiles.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>A global compilation of soil profiles with WRB soil type classification.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>wrb.pnts_profilesL_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(tr.pnts[<span class="sc">!</span>(tr.pnts<span class="sc">$</span>source_db <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"HWSDv2"</span>, <span class="st">"GlobalLCV"</span>)),], <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>), <span class="at">crs=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"./img/sol_wrb.pnts_tot.profiles.png"</span>)){</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_gh</span>(wrb.pnts_profilesL_sf, <span class="at">out.pdf=</span><span class="st">"./img/sol_wrb.pnts_tot.profiles.pdf"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system</span>(<span class="st">"pdftoppm ./img/sol_wrb.pnts_tot.profiles.pdf ./img/sol_wrb.pnts_tot.profiles -png -f 1 -singlefile"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system</span>(<span class="st">"convert -crop 1280x575+36+114 ./img/sol_wrb.pnts_tot.profiles.png ./img/sol_wrb.pnts_tot.profiles.png"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/sol_wrb.pnts_tot.profiles.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>A global compilation of soil profiles with WRB soil type classification: a subset with actual soil profiles.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can export the final training points to Geopackage file by using e.g.:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">write_sf</span>(sf<span class="sc">::</span><span class="fu">st_as_sf</span>(tr.pnts[<span class="sc">!</span>tr.pnts<span class="sc">$</span>source_db<span class="sc">==</span><span class="st">"Italian_SPDB"</span>,], </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>), <span class="at">crs=</span><span class="st">"EPSG:4326"</span>), </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"./out/gpkg/sol_wrb.pnts_profiles.gpkg"</span>), <span class="at">driver =</span> <span class="st">"GPKG"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(tr.pnts[<span class="sc">!</span>tr.pnts<span class="sc">$</span>source_db<span class="sc">==</span><span class="st">"Italian_SPDB"</span>,], <span class="st">"./out/rds/sol_wrb.pnts_profiles.rds"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#save.image.pigz(file="soilwrb.RData")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-antonic2003spatial" class="csl-entry" role="listitem">
Antonić, Oleg, Nikola Pernar, and Sven D Jelaska. 2003. <span>“Spatial Distribution of Main Forest Soil Groups in Croatia as a Function of Basic Pedogenetic Factors.”</span> <em>Ecological Modelling</em> 170 (2-3): 363–71. <a href="https://doi.org/10.1016/S0304-3800(03)00239-4">https://doi.org/10.1016/S0304-3800(03)00239-4</a>.
</div>
<div id="ref-batjes2020standardised" class="csl-entry" role="listitem">
Batjes, Niels H, Eloi Ribeiro, and Ad Van Oostrum. 2020. <span>“Standardised Soil Profile Data to Support Global Mapping and Modelling (WoSIS Snapshot 2019).”</span> <em>Earth System Science Data</em> 12 (1): 299–320. <a href="https://doi.org/10.5194/essd-12-299-2020">https://doi.org/10.5194/essd-12-299-2020</a>.
</div>
<div id="ref-hwsd2023" class="csl-entry" role="listitem">
FAO &amp; IIASA. 2023. <em><span class="nocase">Harmonized World Soil Database version 2.0</span></em>. Rome; Laxenburg: FAO. <a href="https://doi.org/10.4060/cc3823en">https://doi.org/10.4060/cc3823en</a>.
</div>
<div id="ref-gumbricht2017expert" class="csl-entry" role="listitem">
Gumbricht, Thomas, Rosa Maria Roman-Cuesta, Louis Verchot, Martin Herold, Florian Wittmann, Ethan Householder, Nadine Herold, and Daniel Murdiyarso. 2017. <span>“An Expert System Model for Mapping Tropical Wetlands and Peatlands Reveals South America as the Largest Contributor.”</span> <em>Global Change Biology</em> 23 (9): 3581–99. <a href="https://doi.org/10.1111/gcb.13689">https://doi.org/10.1111/gcb.13689</a>.
</div>
<div id="ref-hengl2016global" class="csl-entry" role="listitem">
Hengl, Tomislav. 2016. <span>“Global Assessment of Soil Organic Carbon Stocks and Spatial Distribution of Histosols: The Machine Learning Approach.”</span> In <em>EGU General Assembly Conference Abstracts</em>, EPSC2016–9447.
</div>
<div id="ref-hijmans2019spatial" class="csl-entry" role="listitem">
Hijmans, Robert J. 2019. <em><span class="nocase">Spatial data in R</span></em>. Davis, CA: United States: GFC for the Innovation Lab for Collaborative Research on Sustainable Intensification. <a href="https://rspatial.org/">https://rspatial.org/</a>.
</div>
<div id="ref-krasilnikov2009handbook" class="csl-entry" role="listitem">
Krasilnikov, P., R. Arnold, J. J. I. Marti, and S. Shoba. 2009. <em>A Handbook of Soil Terminology, Correlation and Classification</em>. Taylor &amp; Francis Group.
</div>
<div id="ref-poeplau2020stocks" class="csl-entry" role="listitem">
Poeplau, Christopher, Anna Jacobs, Axel Don, Cora Vos, Florian Schneider, Mareille Wittnebel, Bärbel Tiemeyer, Arne Heidkamp, Roland Prietz, and Heinz Flessa. 2020. <span>“Stocks of Organic Carbon in German Agricultural Soils—Key Results of the First Comprehensive Inventory.”</span> <em>Journal of Plant Nutrition and Soil Science</em> 183 (6): 665–81. <a href="https://doi.org/10.1002/jpln.202000113">https://doi.org/10.1002/jpln.202000113</a>.
</div>
<div id="ref-righini2001banca" class="csl-entry" role="listitem">
Righini, Gaia, Edoardo AC Costantini, and Lorenzo Sulli. 2001. <span>“La Banca Dati Delle Regioni Pedologiche Italiane.”</span> <em>Boll. Soc. It. Scienza Del Suolo</em> 50 (Suppl.): 261–71.
</div>
<div id="ref-AIQ9WS_2020" class="csl-entry" role="listitem">
Saby, Nicolas P. A., Jean-Philippe Chenu, Tamas Szergi, Adam Csorba, Patrick Bertuzzi, Benoît Toutain, Calypso Picaud, Laura Gay, and R. Creamer. 2020. <span>“<span class="nocase">French RMQS soil profile and monitoring dataset with related management practices data</span>.”</span> Recherche Data Gouv. <a href="https://doi.org/10.15454/AIQ9WS">https://doi.org/10.15454/AIQ9WS</a>.
</div>
<div id="ref-tsendbazar2021towards" class="csl-entry" role="listitem">
Tsendbazar, N, Martin Herold, L Li, A Tarko, S De Bruin, D Masiliunas, M Lesiv, et al. 2021. <span>“Towards Operational Validation of Annual Global Land Cover Maps.”</span> <em>Remote Sensing of Environment</em> 266: 112686. <a href="https://doi.org/10.1016/j.rse.2021.112686">https://doi.org/10.1016/j.rse.2021.112686</a>.
</div>
<div id="ref-vecchio2002regional" class="csl-entry" role="listitem">
Vecchio, A del, E Barberis, and G Bourlot. 2002. <span>“[The Regional Data Base of Agricultural Soils. An Essential Tool for the Knowledge of Territory and Planning in Agriculture [Piedmont]].”</span> <em>Agricoltura Ricerca (Italy)</em> 24: 3–14.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2024, OpenGeoHub foundation</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/OpenGeoHub/SoilSamples/edit/main/035-import_wrb_data.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/OpenGeoHub/SoilSamples/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/OpenGeoHub/SoilSamples">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@opengeohub">
      <i class="bi bi-mastodon" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/opengeohub">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/opengeohub-foundation/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/c/OpenGeoHubFoundation">
      <i class="bi bi-youtube" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>