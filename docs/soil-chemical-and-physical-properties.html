<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5 Soil chemical and physical properties | An Open Compendium of Soil Sample and Soil Profile Datasets</title>
<meta name="author" content="Tom Hengl, Surya Gupta, Robert Minarik">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.14/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-1BH6J2NKGP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-1BH6J2NKGP');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">An Open Compendium of Soil Sample and Soil Profile Datasets</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li><a class="" href="new-to-markdown.html"><span class="header-section-number">1</span> New to markdown</a></li>
<li><a class="" href="soil-data-communities-and-mailing-lists.html"><span class="header-section-number">2</span> Soil data communities and mailing lists</a></li>
<li><a class="" href="datasets.html"><span class="header-section-number">3</span> Datasets</a></li>
<li><a class="" href="soil-variables.html"><span class="header-section-number">4</span> Soil variables</a></li>
<li><a class="active" href="soil-chemical-and-physical-properties.html"><span class="header-section-number">5</span> Soil chemical and physical properties</a></li>
<li><a class="" href="soil-physical-and-hydrological-properties.html"><span class="header-section-number">6</span> Soil physical and hydrological properties</a></li>
<li><a class="" href="wrb-soil-types.html"><span class="header-section-number">7</span> WRB soil types</a></li>
<li><a class="" href="references.html"><span class="header-section-number">8</span> References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/OpenGeoHub/SoilSamples/">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="soil-chemical-and-physical-properties" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Soil chemical and physical properties<a class="anchor" aria-label="anchor" href="#soil-chemical-and-physical-properties"><i class="fas fa-link"></i></a>
</h1>
<div class="rmdnote">
<p>You are reading the work-in-progress An Open Compendium of Soil Sample and Soil Profile Datasets. This chapter is currently draft version, a peer-review publication is pending. You can find the polished first edition at <a href="https://opengeohub.github.io/SoilSamples/" class="uri">https://opengeohub.github.io/SoilSamples/</a>.</p>
</div>
<p>Last update: 2023-05-10</p>
<div id="overview" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview"><i class="fas fa-link"></i></a>
</h2>
<p>This section describes import steps used to produce a global compilation of soil
laboratory data with chemical (and physical) soil properties that can be then
used for predictive soil mapping / modeling at global and regional scales.</p>
<p>Read more about soil chemical properties, global soil profile and sample data sets and functionality:</p>
<ul>
<li>Arrouays, D., Leenaars, J. G., Richer-de-Forges, A. C., Adhikari, K., Ballabio, C., Greve, M., … &amp; Heuvelink, G. (2017). <a href="https://doi.org/10.1016/j.grj.2017.06.001">Soil legacy data rescue via GlobalSoilMap and other international and national initiatives</a>. GeoResJ, 14, 1-19.</li>
<li>Batjes, N. H., Ribeiro, E., van Oostrum, A., Leenaars, J., Hengl, T., &amp; de Jesus, J. M. (2017). <a href="http://www.earth-syst-sci-data.net/9/1/2017/">WoSIS: providing standardised soil profile data for the world</a>. Earth System Science Data, 9(1), 1.</li>
<li>Hengl, T., MacMillan, R.A., (2019). <a href="https://soilmapper.org/">Predictive Soil Mapping with R</a>. OpenGeoHub foundation, Wageningen, the Netherlands, 370 pages, www.soilmapper.org, ISBN: 978-0-359-30635-0.</li>
<li>Rossiter, D.G.,: <a href="https://www.isric.org/explore/soil-geographic-databases">Compendium of Soil Geographical Databases</a>.</li>
</ul>
</div>
<div id="alt-text-specifications" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> <img src="tex/R_logo.svg.png" title="Packages in use" alt="alt text"> Specifications<a class="anchor" aria-label="anchor" href="#alt-text-specifications"><i class="fas fa-link"></i></a>
</h2>
<div id="data-standards" class="section level4" number="5.2.0.1">
<h4>
<span class="header-section-number">5.2.0.1</span> Data standards<a class="anchor" aria-label="anchor" href="#data-standards"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Metadata information: <a href="https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/stelprdb1253872.pdf">“Soil Survey Investigation Report No. 42.”</a> and <a href="https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/nrcs142p2_052226.pdf">“Soil Survey Investigation Report No. 45.”</a>,</li>
<li>Model DB: <a href="https://ncsslabdatamart.sc.egov.usda.gov/">National Cooperative Soil Survey (NCSS) Soil Characterization Database</a>,</li>
</ul>
</div>
<div id="target-variables" class="section level4" number="5.2.0.2">
<h4>
<span class="header-section-number">5.2.0.2</span> <em>Target variables:</em><a class="anchor" aria-label="anchor" href="#target-variables"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">site.names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, 
               <span class="st">"latitude_decimal_degrees"</span><span class="op">)</span>
<span class="va">hor.names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"labsampnum"</span>,<span class="st">"site_key"</span>,<span class="st">"layer_sequence"</span>,<span class="st">"hzn_top"</span>,<span class="st">"hzn_bot"</span>, 
              <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, 
              <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, 
              <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, 
              <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
<span class="co">## target structure:</span>
<span class="va">col.names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, 
              <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, 
              <span class="st">"hzn_bot"</span>,<span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, 
              <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, 
              <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, 
              <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>, <span class="st">"source_db"</span>, 
              <span class="st">"confidence_degree"</span>, <span class="st">"project_url"</span>, <span class="st">"citation_url"</span><span class="op">)</span></code></pre></div>
<p>Targe variables listed:</p>
<ul>
<li>
<code>clay_tot_psa</code>: Clay, Total in % wt for &lt;2 mm soil fraction,</li>
<li>
<code>silt_tot_psa</code>: Silt, Total in % wt for &lt;2 mm soil fraction,</li>
<li>
<code>sand_tot_psa</code>: Sand, Total in % wt for &lt;2 mm soil fraction,</li>
<li>
<code>oc</code>: Carbon, Organic in g/kg for &lt;2 mm soil fraction,</li>
<li>
<code>oc_d</code>: Soil organic carbon density in kg/m3,</li>
<li>
<code>c_tot</code>: Carbon, Total in g/kg for &lt;2 mm soil fraction,</li>
<li>
<code>n_tot</code>: Nitrogen, Total NCS in g/kg for &lt;2 mm soil fraction,</li>
<li>
<code>ph_kcl</code>: pH, KCl Suspension for &lt;2 mm soil fraction,</li>
<li>
<code>ph_h2o</code>: pH, 1:1 Soil-Water Suspension for &lt;2 mm soil fraction,</li>
<li>
<code>ph_cacl2</code>: pH, CaCl2 Suspension for &lt;2 mm soil fraction,</li>
<li>
<code>cec_sum</code>: Cation Exchange Capacity, Summary, in cmol(+)/kg for &lt;2 mm soil fraction,</li>
<li>
<code>cec_nh4</code>: Cation Exchange Capacity, NH4 prep, in cmol(+)/kg for &lt;2 mm soil fraction,</li>
<li>
<code>ecec</code>: Cation Exchange Capacity, Effective, CMS derived value default, standa prep in cmol(+)/kg for &lt;2 mm soil fraction,</li>
<li>
<code>wpg2</code>: Coarse fragments in % wt for &gt;2 mm soil fraction,</li>
<li>
<code>db_od</code>: Bulk density (Oven Dry) in g/cm3 (4A1h),</li>
<li>
<code>ca_ext</code>: Calcium, Extractable in mg/kg for &lt;2 mm soil fraction (usually Mehlich3),</li>
<li>
<code>mg_ext</code>: Magnesium, Extractable in mg/kg for &lt;2 mm soil fraction (usually Mehlich3),</li>
<li>
<code>na_ext</code>: Sodium, Extractable in mg/kg for &lt;2 mm soil fraction (usually Mehlich3),</li>
<li>
<code>k_ext</code>: Potassium, Extractable in mg/kg for &lt;2 mm soil fraction (usually Mehlich3),</li>
<li>
<code>ec_satp</code>: Electrical Conductivity, Saturation Extract in dS/m for &lt;2 mm soil fraction,</li>
<li>
<code>ec_12pre</code>: Electrical Conductivity, Predict, 1:2 (w/w) in dS/m for &lt;2 mm soil fraction,</li>
</ul>
</div>
</div>
<div id="alt-text-data-import" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> <img src="tex/R_logo.svg.png" title="Data import" alt="alt text"> Data import<a class="anchor" aria-label="anchor" href="#alt-text-data-import"><i class="fas fa-link"></i></a>
</h2>
<div id="national-cooperative-soil-survey-characterization-database-1" class="section level4" number="5.3.0.1">
<h4>
<span class="header-section-number">5.3.0.1</span> National Cooperative Soil Survey Characterization Database<a class="anchor" aria-label="anchor" href="#national-cooperative-soil-survey-characterization-database-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>National Cooperative Soil Survey, (2020). National Cooperative Soil Survey Characterization Database. Data download URL: <a href="http://ncsslabdatamart.sc.egov.usda.gov/" class="uri">http://ncsslabdatamart.sc.egov.usda.gov/</a><br>
</li>
<li>O’Geen, A., Walkinshaw, M., &amp; Beaudette, D. (2017). SoilWeb: A multifaceted interface to soil survey information. Soil Science Society of America Journal, 81(4), 853-862. <a href="https://doi.org/10.2136/sssaj2016.11.0386n" class="uri">https://doi.org/10.2136/sssaj2016.11.0386n</a>
</li>
</ul>
<p>This data set is continuously updated.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.NCSS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">ncss.site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Site_Location.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">ncss.layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Layer.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">ncss.bdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Bulk_Density_and_Moisture.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">## multiple measurements</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">ncss.bdm</span><span class="op">$</span><span class="va">prep_code</span><span class="op">)</span><span class="op">)</span>
  <span class="va">ncss.bdm.0</span> <span class="op">&lt;-</span> <span class="va">ncss.bdm</span><span class="op">[</span><span class="va">ncss.bdm</span><span class="op">$</span><span class="va">prep_code</span><span class="op">==</span><span class="st">"S"</span>,<span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ncss.bdm.0</span><span class="op">$</span><span class="va">db_od</span><span class="op">)</span>
  <span class="co">## 0 BD values --- error!</span>
  <span class="va">ncss.carb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Carbon_and_Extractions.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">ncss.organic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Organic.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">ncss.pH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_pH_and_Carbonates.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#str(ncss.pH)</span>
  <span class="co">#summary(ncss.pH$ph_h2o)</span>
  <span class="co">#summary(!is.na(ncss.pH$ph_h2o))</span>
  <span class="va">ncss.PSDA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_PSDA_and_Rock_Fragments.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">ncss.CEC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_CEC_and_Bases.csv"</span><span class="op">)</span>
  <span class="va">ncss.salt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_Salt.csv"</span><span class="op">)</span>
  <span class="va">ncss.horizons</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join_all.html">join_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">ncss.bdm.0</span>, <span class="va">ncss.layer</span>, <span class="va">ncss.carb</span>, <span class="va">ncss.organic</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"labsampnum"</span>, <span class="st">"result_source_key"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"db_od"</span>, <span class="st">"oc"</span><span class="op">)</span><span class="op">]</span>, <span class="va">ncss.pH</span>, <span class="va">ncss.PSDA</span>, <span class="va">ncss.CEC</span>, <span class="va">ncss.salt</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"full"</span>, by<span class="op">=</span><span class="st">"labsampnum"</span><span class="op">)</span>
  <span class="co">#head(ncss.horizons)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ncss.horizons</span><span class="op">)</span>
  <span class="va">ncss.horizons</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">ncss.horizons</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">ncss.horizons</span><span class="op">$</span><span class="va">db_od</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ncss.horizons</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">ncss.horizons</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">ncss.horizons</span><span class="op">$</span><span class="va">ca_ext</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">ncss.horizons</span><span class="op">$</span><span class="va">ca_nh4</span> <span class="op">*</span> <span class="fl">200</span>, <span class="fl">4</span><span class="op">)</span>
  <span class="va">ncss.horizons</span><span class="op">$</span><span class="va">mg_ext</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">ncss.horizons</span><span class="op">$</span><span class="va">mg_nh4</span> <span class="op">*</span> <span class="fl">121</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">ncss.horizons</span><span class="op">$</span><span class="va">na_ext</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">ncss.horizons</span><span class="op">$</span><span class="va">na_nh4</span> <span class="op">*</span> <span class="fl">230</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">ncss.horizons</span><span class="op">$</span><span class="va">k_ext</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">ncss.horizons</span><span class="op">$</span><span class="va">k_nh4</span> <span class="op">*</span> <span class="fl">391</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#summary(ncss.horizons$oc_d)</span>
  <span class="co">## Values &lt;0!!</span>
  <span class="va">chemsprops.NCSS</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">ncss.site</span><span class="op">[</span>,<span class="va">site.names</span><span class="op">]</span>, <span class="va">ncss.horizons</span><span class="op">[</span>,<span class="va">hor.names</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"site_key"</span><span class="op">)</span> 
  <span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">site_obsdate</span>, format<span class="op">=</span><span class="st">"%m/%d/%Y"</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"USDA_NCSS"</span>
  <span class="co">#dim(chemsprops.NCSS)</span>
  <span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">oc</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">n_tot</span> <span class="op">=</span> <span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">n_tot</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="co">#hist(log1p(chemsprops.NCSS$oc), breaks=45, col="gray")</span>
  <span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://ncsslabdatamart.sc.egov.usda.gov/"</span>
  <span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.2136/sssaj2016.11.0386n"</span>
  <span class="va">chemsprops.NCSS</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.NCSS</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tex_psda"</span>,<span class="st">"oc"</span>,<span class="st">"clay_tot_psa"</span>,<span class="st">"ecec"</span>,<span class="st">"ph_h2o"</span>,<span class="st">"ec_12pre"</span>,<span class="st">"k_ext"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#rm(ncss.horizons)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.NCSS</span><span class="op">)</span>
<span class="co">#&gt; [1] 136011     36</span>
<span class="co">#summary(!is.na(chemsprops.NCSS$oc))</span>
<span class="co">## texture classes need to be cleaned-up</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">chemsprops.NCSS</span><span class="op">$</span><span class="va">tex_psda</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                               c               C              cl              CL </span>
<span class="co">#&gt;            2391           10908              19           10158               5 </span>
<span class="co">#&gt;             cos             CoS             COS            cosl            CoSL </span>
<span class="co">#&gt;            2424               6               4            4543               2 </span>
<span class="co">#&gt; Fine Sandy Loam              fs             fsl             FSL               l </span>
<span class="co">#&gt;               1            2357           10701              16           17038 </span>
<span class="co">#&gt;               L            lcos            LCoS             lfs              ls </span>
<span class="co">#&gt;               2            2933               3            1805            3166 </span>
<span class="co">#&gt;              LS            lvfs               s               S              sc </span>
<span class="co">#&gt;               1             152            2958               1             601 </span>
<span class="co">#&gt;             scl             SCL              si             sic             SiC </span>
<span class="co">#&gt;            5456               5             854            7123              11 </span>
<span class="co">#&gt;            sicl            SiCL             sil             SiL             SIL </span>
<span class="co">#&gt;           13718              14           22230               4              28 </span>
<span class="co">#&gt;              sl              SL             vfs            vfsl            VFSL </span>
<span class="co">#&gt;            5547              13              64            2678               3 </span>
<span class="co">#&gt;            NA's </span>
<span class="co">#&gt;            6068</span></code></pre></div>
</div>
<div id="rapid-carbon-assessment-raca-1" class="section level4" number="5.3.0.2">
<h4>
<span class="header-section-number">5.3.0.2</span> Rapid Carbon Assessment (RaCA)<a class="anchor" aria-label="anchor" href="#rapid-carbon-assessment-raca-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Soil Survey Staff. Rapid Carbon Assessment (RaCA) project. United States Department of Agriculture, Natural Resources Conservation Service. Available online. June 1, 2013 (FY2013 official release). Data download URL: <a href="https://www.nrcs.usda.gov/wps/portal/nrcs/detailfull/soils/research/?cid=nrcs142p2_054164" class="uri">https://www.nrcs.usda.gov/wps/portal/nrcs/detailfull/soils/research/?cid=nrcs142p2_054164</a>
</li>
<li>
<strong>Note</strong>: Locations of each site have been degraded due to confidentiality and only reflect the general position of each site.</li>
<li>Wills, S. et al. (2013) <a href="https://www.nrcs.usda.gov/wps/PA_NRCSConsumption/download?cid=nrcs142p2_052841&amp;ext=pdf">“Rapid carbon assessment (RaCA) methodology: Sampling and Initial Summary. United States Department of Agriculture.”</a> Natural Resources Conservation Service, National Soil Survey Center.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.RaCa"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">raca.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/USA/RaCA/RaCa_general_location.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">raca.df</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">"rcasiteid"</span>
  <span class="va">raca.layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/USA/RaCA/RaCA_samples_JULY2016.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">raca.layer</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">raca.layer</span><span class="op">[</span><span class="st">"rcasiteid"</span><span class="op">]</span>, <span class="va">raca.df</span>, match <span class="op">=</span><span class="st">"first"</span><span class="op">)</span><span class="op">$</span><span class="va">Gen_long</span>
  <span class="va">raca.layer</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">raca.layer</span><span class="op">[</span><span class="st">"rcasiteid"</span><span class="op">]</span>, <span class="va">raca.df</span>, match <span class="op">=</span><span class="st">"first"</span><span class="op">)</span><span class="op">$</span><span class="va">Gen_lat</span>
  <span class="va">raca.layer</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="st">"2013"</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">raca.layer</span><span class="op">$</span><span class="va">Calc_SOC</span><span class="op">)</span>
  <span class="co">#plot(raca.layer[!duplicated(raca.layer$rcasiteid),c("longitude_decimal_degrees", "latitude_decimal_degrees")])</span>
  <span class="co">#summary(raca.layer$SOC_pred1)</span>
  <span class="co">## some strange groupings around small values</span>
  <span class="va">raca.layer</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">raca.layer</span><span class="op">$</span><span class="va">Calc_SOC</span> <span class="op">/</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">raca.layer</span><span class="op">$</span><span class="va">Bulkdensity</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">raca.layer</span><span class="op">$</span><span class="va">fragvolc</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">raca.layer</span><span class="op">$</span><span class="va">fragvolc</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">raca.layer</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">raca.layer</span><span class="op">$</span><span class="va">Calc_SOC</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="co">#summary(raca.layer$oc_d)</span>
  <span class="va">raca.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rcasiteid"</span>, <span class="st">"lay_field_label1"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"Lab.Sample.No"</span>, <span class="st">"layer_Number"</span>, <span class="st">"TOP"</span>, <span class="st">"BOT"</span>, <span class="st">"hzname"</span>, <span class="st">"texture"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot_ncs"</span>, <span class="st">"n_tot_ncs"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"fragvolc"</span>, <span class="st">"Bulkdensity"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">raca.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">raca.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">raca.layer</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">raca.layer</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.RaCA</span> <span class="op">=</span> <span class="va">raca.layer</span><span class="op">[</span>,<span class="va">raca.h.lst</span><span class="op">]</span>
  <span class="va">chemsprops.RaCA</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"RaCA2016"</span>
  <span class="va">chemsprops.RaCA</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.RaCA</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://www.nrcs.usda.gov/survey/raca/"</span>
  <span class="va">chemsprops.RaCA</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/nrcs142p2_052841.pdf"</span>
  <span class="va">chemsprops.RaCA</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.RaCA</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"fragvolc"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; Joining by: rcasiteid</span>
<span class="co">#&gt; Joining by: rcasiteid</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.RaCA</span><span class="op">)</span>
<span class="co">#&gt; [1] 53664    36</span></code></pre></div>
</div>
<div id="national-geochemical-database-soil" class="section level4" number="5.3.0.3">
<h4>
<span class="header-section-number">5.3.0.3</span> National Geochemical Database Soil<a class="anchor" aria-label="anchor" href="#national-geochemical-database-soil"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Smith, D.B., Cannon, W.F., Woodruff, L.G., Solano, Federico, Kilburn, J.E., and Fey, D.L., (2013). <a href="http://pubs.usgs.gov/ds/801/">Geochemical and
mineralogical data for soils of the conterminous United States</a>. U.S. Geological Survey Data Series 801, 19 p., <a href="http://pubs.usgs.gov/ds/801/" class="uri">http://pubs.usgs.gov/ds/801/</a>.</li>
<li>Grossman, J. N. (2004). <a href="https://doi.org/10.3133/ofr20041001">The National Geochemical Survey-database and documentation</a>. U.S. Geological Survey Open-File Report 2004-1001. <a href="DOI:10.3133/ofr20041001" class="uri">DOI:10.3133/ofr20041001</a>.</li>
<li>
<strong>Note</strong>: NGS focuses on stream-sediment samples, but also contains many soil samples.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.USGS.NGS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">ngs.points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/USA/geochemical/ds-801-csv/site.txt"</span>, sep<span class="op">=</span><span class="st">","</span><span class="op">)</span>
  <span class="co">## 4857 pnts</span>
  <span class="va">ngs.layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"top5cm.txt"</span>, <span class="st">"ahorizon.txt"</span>, <span class="st">"chorizon.txt"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/USA/geochemical/ds-801-csv/"</span>, <span class="va">i</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
  <span class="va">ngs.layers</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html">rbind.fill</a></span><span class="op">(</span><span class="va">ngs.layers</span><span class="op">)</span>
  <span class="co">#dim(ngs.layers)</span>
  <span class="co"># 14571  126</span>
  <span class="co">#summary(ngs.layers$tot_carb_pct)</span>
  <span class="co">#lattice::xyplot(c_org_pct ~ c_tot_pct, ngs.layers, scales=list(x = list(log = 2), y = list(log = 2)))</span>
  <span class="co">#lattice::xyplot(c_org_pct ~ tot_clay_pct, ngs.layers, scales=list(y = list(log = 2)))</span>
  <span class="va">ngs.layers</span><span class="op">$</span><span class="va">c_tot</span> <span class="op">=</span> <span class="va">ngs.layers</span><span class="op">$</span><span class="va">c_tot_pct</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">ngs.layers</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">ngs.layers</span><span class="op">$</span><span class="va">c_org_pct</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">ngs.layers</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ngs.layers</span><span class="op">$</span><span class="va">depth_cm</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">}</span><span class="op">)</span>
  <span class="va">ngs.layers</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ngs.layers</span><span class="op">$</span><span class="va">depth_cm</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">}</span><span class="op">)</span>
  <span class="co">#summary(ngs.layers$tot_clay_pct)</span>
  <span class="co">#summary(ngs.layers$k_pct) ## very high numbers?</span>
  <span class="co">## question is if the geochemical element results are compatible with e.g. k_ext?</span>
  <span class="va">t.ngs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lab_id"</span>, <span class="st">"site_id"</span>, <span class="st">"horizon"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"tot_clay_pct"</span>, <span class="st">"c_tot"</span>, <span class="st">"oc"</span><span class="op">)</span>
  <span class="va">ngs.m</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">ngs.points</span>, <span class="va">ngs.layers</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ngs.layers</span><span class="op">$</span><span class="va">c_org_pct</span><span class="op">)</span>,<span class="va">t.ngs</span><span class="op">]</span><span class="op">)</span>
  <span class="va">ngs.m</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">ngs.m</span><span class="op">$</span><span class="va">colldate</span>, format<span class="op">=</span><span class="st">"%Y-%m-%d"</span><span class="op">)</span> 
  <span class="va">ngs.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>, <span class="st">"quad"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span>, <span class="st">"lab_id"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"horizon"</span>, <span class="st">"tex_psda"</span>, <span class="st">"tot_clay_pct"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">ngs.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">ngs.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ngs.m</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">ngs.m</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.USGS.NGS</span> <span class="op">=</span> <span class="va">ngs.m</span><span class="op">[</span>,<span class="va">ngs.h.lst</span><span class="op">]</span>
  <span class="va">chemsprops.USGS.NGS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"USGS.NGS"</span>
  <span class="va">chemsprops.USGS.NGS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">chemsprops.USGS.NGS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://mrdata.usgs.gov/ds-801/"</span>
  <span class="va">chemsprops.USGS.NGS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://pubs.usgs.gov/ds/801/"</span>
  <span class="va">chemsprops.USGS.NGS</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.USGS.NGS</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tot_clay_pct"</span>, <span class="st">"oc"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.USGS.NGS</span><span class="op">)</span>
<span class="co">#&gt; [1] 9446   36</span></code></pre></div>
</div>
<div id="forest-inventory-and-analysis-database-fiadb" class="section level4" number="5.3.0.4">
<h4>
<span class="header-section-number">5.3.0.4</span> Forest Inventory and Analysis Database (FIADB)<a class="anchor" aria-label="anchor" href="#forest-inventory-and-analysis-database-fiadb"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Domke, G. M., Perry, C. H., Walters, B. F., Nave, L. E., Woodall, C. W., &amp; Swanston, C. W. (2017). <a href="https://doi.org/10.1002/eap.1516">Toward inventory‐based estimates of soil organic carbon in forests of the United States</a>. Ecological Applications, 27(4), 1223-1235. <a href="https://doi.org/10.1002/eap.1516" class="uri">https://doi.org/10.1002/eap.1516</a>
</li>
<li>Forest Inventory and Analysis, (2014). The Forest Inventory and Analysis Database: Database description
and user guide version 6.0.1 for Phase 3. U.S. Department of Agriculture, Forest Service. 182 p.
[Online]. Available: <a href="https://www.fia.fs.fed.us/library/database-documentation/" class="uri">https://www.fia.fs.fed.us/library/database-documentation/</a>
</li>
<li>
<strong>Note</strong>: samples are taken only from the top-soil either 0–10.16 cm or 10.16–20.32 cm.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.FIADB"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">fia.loc</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="fu">::</span><span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/USA/FIADB/ENTIRE/PLOT.csv"</span><span class="op">)</span>
  <span class="va">fia.loc</span><span class="op">$</span><span class="va">site_id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">fia.loc</span><span class="op">$</span><span class="va">STATECD</span>, <span class="va">fia.loc</span><span class="op">$</span><span class="va">COUNTYCD</span>, <span class="va">fia.loc</span><span class="op">$</span><span class="va">PLOT</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
  <span class="va">fia.lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/USA/FIADB/ENTIRE/SOILS_LAB.csv"</span><span class="op">)</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">site_id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">STATECD</span>, <span class="va">fia.lab</span><span class="op">$</span><span class="va">COUNTYCD</span>, <span class="va">fia.lab</span><span class="op">$</span><span class="va">PLOT</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
  <span class="co">## 23,765 rows</span>
  <span class="va">fia.des</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/USA/FIADB/ENTIRE/SOILS_SAMPLE_LOC.csv"</span><span class="op">)</span>
  <span class="va">fia.des</span><span class="op">$</span><span class="va">site_id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">fia.des</span><span class="op">$</span><span class="va">STATECD</span>, <span class="va">fia.des</span><span class="op">$</span><span class="va">COUNTYCD</span>, <span class="va">fia.des</span><span class="op">$</span><span class="va">PLOT</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
  <span class="co">#fia.lab$TXTRLYR1 = plyr::join(fia.lab[c("site_id","INVYR")], fia.des[c("site_id","TXTRLYR1","INVYR")], match ="first")$TXTRLYR1</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">TXTRLYR2</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>,<span class="st">"INVYR"</span><span class="op">)</span><span class="op">]</span>, <span class="va">fia.des</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>,<span class="st">"TXTRLYR2"</span>,<span class="st">"INVYR"</span><span class="op">)</span><span class="op">]</span>, match <span class="op">=</span><span class="st">"first"</span><span class="op">)</span><span class="op">$</span><span class="va">TXTRLYR2</span>
  <span class="co">#summary(as.factor(fia.lab$TXTRLYR1))</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">tex_psda</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">TXTRLYR2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Organic"</span>, <span class="st">"Loamy"</span>, <span class="st">"Clayey"</span>, <span class="st">"Sandy"</span>, <span class="st">"Coarse sand"</span>, <span class="st">"Not measured"</span><span class="op">)</span><span class="op">)</span> 
  <span class="co">#Code Description</span>
  <span class="co"># 0 Organic.</span>
  <span class="co"># 1 Loamy.</span>
  <span class="co"># 2 Clayey.</span>
  <span class="co"># 3 Sandy.</span>
  <span class="co"># 4 Coarse sand.</span>
  <span class="co"># 9 Not measured - make plot notes</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">FORFLTHK</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>,<span class="st">"INVYR"</span><span class="op">)</span><span class="op">]</span>, <span class="va">fia.des</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>,<span class="st">"FORFLTHK"</span>,<span class="st">"INVYR"</span><span class="op">)</span><span class="op">]</span>, match <span class="op">=</span><span class="st">"first"</span><span class="op">)</span><span class="op">$</span><span class="va">FORFLTHK</span>
  <span class="co">#summary(fia.lab$FORFLTHK)</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">LTRLRTHK</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>,<span class="st">"INVYR"</span><span class="op">)</span><span class="op">]</span>, <span class="va">fia.des</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>,<span class="st">"LTRLRTHK"</span>,<span class="st">"INVYR"</span><span class="op">)</span><span class="op">]</span>, match <span class="op">=</span><span class="st">"first"</span><span class="op">)</span><span class="op">$</span><span class="va">LTRLRTHK</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">tot_thk</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FORFLTHK"</span>, <span class="st">"LTRLRTHK"</span><span class="op">)</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">DPTHSBSL</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>,<span class="st">"INVYR"</span><span class="op">)</span><span class="op">]</span>, <span class="va">fia.des</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>,<span class="st">"DPTHSBSL"</span>,<span class="st">"INVYR"</span><span class="op">)</span><span class="op">]</span>, match <span class="op">=</span><span class="st">"first"</span><span class="op">)</span><span class="op">$</span><span class="va">DPTHSBSL</span>
  <span class="co">#summary(fia.lab$DPTHSBSL)</span>
  <span class="va">sel.fia</span> <span class="op">=</span> <span class="va">fia.loc</span><span class="op">$</span><span class="va">site_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">site_id</span>
  <span class="co">#summary(sel.fia)</span>
  <span class="co"># 15,109</span>
  <span class="va">fia.loc</span> <span class="op">=</span> <span class="va">fia.loc</span><span class="op">[</span><span class="va">sel.fia</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>, <span class="st">"LON"</span>, <span class="st">"LAT"</span><span class="op">)</span><span class="op">]</span>
  <span class="co">#summary(fia.lab$BULK_DENSITY)  ## some strange values for BD!</span>
  <span class="co">#quantile(fia.lab$BULK_DENSITY, c(0.02, 0.98), na.rm=TRUE)</span>
  <span class="co">#summary(fia.lab$C_ORG_PCT)</span>
  <span class="co">#summary(as.factor(fia.lab$LAYER_TYPE))</span>
  <span class="co">#lattice::xyplot(BULK_DENSITY ~ C_ORG_PCT, fia.lab, scales=list(x = list(log = 2)))</span>
  <span class="co">#dim(fia.lab)</span>
  <span class="co"># 14571  126</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">c_tot</span> <span class="op">=</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">C_ORG_PCT</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">C_TOTAL_PCT</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">n_tot</span> <span class="op">=</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">N_TOTAL_PCT</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">db_od</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">BULK_DENSITY</span> <span class="op">&lt;</span> <span class="fl">0.001</span> <span class="op">|</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">BULK_DENSITY</span> <span class="op">&gt;</span> <span class="fl">1.8</span>, <span class="cn">NA</span>, <span class="va">fia.lab</span><span class="op">$</span><span class="va">BULK_DENSITY</span><span class="op">)</span>
  <span class="co">#lattice::xyplot(db_od ~ C_ORG_PCT, fia.lab, par.settings = list(plot.symbol = list(col=scales::alpha("black", 0.6), fill=scales::alpha("red", 0.6), pch=21, cex=0.6)), scales = list(x=list(log=TRUE, equispaced.log=FALSE)), ylab="Bulk density", xlab="SOC wpct")</span>
  <span class="co">#hist(fia.lab$db_od, breaks=45)</span>
  <span class="co">## A lot of very small BD measurements</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">db_od</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">COARSE_FRACTION_PCT</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">fia.lab</span><span class="op">$</span><span class="va">COARSE_FRACTION_PCT</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#hist(fia.lab$oc_d, breaks=45, col="grey")</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"FF_TOTAL"</span> <span class="op">|</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"L_ORG"</span>, <span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"FF_TOTAL"</span> <span class="op">|</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"L_ORG"</span>, <span class="va">fia.lab</span><span class="op">$</span><span class="va">tot_thk</span>, <span class="cn">NA</span><span class="op">)</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"MIN_2"</span> <span class="op">|</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"ORG_2"</span><span class="op">)</span>, <span class="fl">10.2</span> <span class="op">+</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">tot_thk</span>, <span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_bot</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"MIN_2"</span> <span class="op">|</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"ORG_2"</span><span class="op">)</span>, <span class="fl">20.3</span> <span class="op">+</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">tot_thk</span>, <span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_bot</span><span class="op">)</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"MIN_1"</span> <span class="op">|</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"ORG_1"</span><span class="op">)</span>, <span class="fl">0</span> <span class="op">+</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">tot_thk</span>, <span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span>
  <span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_bot</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"MIN_1"</span> <span class="op">|</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">LAYER_TYPE</span><span class="op">==</span><span class="st">"ORG_1"</span><span class="op">)</span>, <span class="fl">10.2</span> <span class="op">+</span> <span class="va">fia.lab</span><span class="op">$</span><span class="va">tot_thk</span>, <span class="va">fia.lab</span><span class="op">$</span><span class="va">hzn_bot</span><span class="op">)</span> 
  <span class="co">#summary(fia.lab$EXCHNG_K) ## Negative values!</span>
  <span class="va">fia.m</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">fia.lab</span>, <span class="va">fia.loc</span><span class="op">)</span>
  <span class="co">#fia.m = fia.m[!duplicated(as.factor(paste(fia.m$site_id, fia.m$INVYR, fia.m$LAYER_TYPE, sep="_"))),]</span>
  <span class="va">fia.m</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">fia.m</span><span class="op">$</span><span class="va">SAMPLE_DATE</span>, format<span class="op">=</span><span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">sel.d.fia</span> <span class="op">=</span> <span class="va">fia.m</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"1980-01-01"</span>, format<span class="op">=</span><span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">fia.m</span><span class="op">$</span><span class="va">site_obsdate</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sel.d.fia</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="co">#hist(fia.m$site_obsdate, breaks=25)</span>
  <span class="va">fia.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"LON"</span>, <span class="st">"LAT"</span>, <span class="st">"SAMPLE_ID"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"LAYER_TYPE"</span>, <span class="st">"tex_psda"</span>, <span class="st">"tot_clay_pct"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"PH_H2O"</span>, <span class="st">"PH_CACL2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ECEC"</span>, <span class="st">"COARSE_FRACTION_PCT"</span>, <span class="st">"db_od"</span>, <span class="st">"EXCHNG_CA"</span>, <span class="st">"EXCHNG_MG"</span>, <span class="st">"EXCHNG_NA"</span>, <span class="st">"EXCHNG_K"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">fia.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">fia.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fia.m</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">fia.m</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.FIADB</span> <span class="op">=</span> <span class="va">fia.m</span><span class="op">[</span>,<span class="va">fia.h.lst</span><span class="op">]</span>
  <span class="va">chemsprops.FIADB</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"FIADB"</span>
  <span class="va">chemsprops.FIADB</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.FIADB</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://www.fia.fs.fed.us/"</span>
  <span class="va">chemsprops.FIADB</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://www.fia.fs.fed.us/library/database-documentation/"</span>
  <span class="va">chemsprops.FIADB</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.FIADB</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PH_H2O"</span>, <span class="st">"oc"</span>, <span class="st">"EXCHNG_K"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LON"</span>, <span class="st">"LAT"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#str(unique(paste(chemsprops.FIADB$LON, chemsprops.FIADB$LAT, sep="_")))</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.FIADB</span><span class="op">)</span>
<span class="co">#&gt; [1] 23208    36</span>
<span class="co">#write.csv(chemsprops.FIADB, "/mnt/diskstation/data/Soil_points/USA/FIADB/fiadb_soil.pnts.csv")</span></code></pre></div>
</div>
<div id="africa-soil-profiles-database" class="section level4" number="5.3.0.5">
<h4>
<span class="header-section-number">5.3.0.5</span> Africa soil profiles database<a class="anchor" aria-label="anchor" href="#africa-soil-profiles-database"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Leenaars, J. G., Van Oostrum, A. J. M., &amp; Ruiperez Gonzalez, M. (2014). <a href="https://www.isric.org/projects/africa-soil-profiles-database-afsp">Africa soil profiles database version 1.2. A compilation of georeferenced and standardized legacy soil profile data for Sub-Saharan Africa (with dataset)</a>. Wageningen: ISRIC Report 2014/01; 2014. Data download URL: <a href="https://data.isric.org/" class="uri">https://data.isric.org/</a>
</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.AfSPDB"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/foreign">foreign</a></span><span class="op">)</span>
  <span class="va">afspdb.profiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dbf.html">read.dbf</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SPDB/AfSP012Qry_Profiles.dbf"</span>, as.is<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">afspdb.layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreign/man/read.dbf.html">read.dbf</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SPDB/AfSP012Qry_Layers.dbf"</span>, as.is<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">afspdb.s.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ProfileID"</span>, <span class="st">"FldMnl_ID"</span>, <span class="st">"T_Year"</span>, <span class="st">"X_LonDD"</span>, <span class="st">"Y_LatDD"</span><span class="op">)</span>
  <span class="co">#summary(afspdb.layers$BlkDens)</span>
  <span class="co">## add missing columns</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">afspdb.layers</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> 
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">afspdb.layers</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> 
      <span class="va">afspdb.layers</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">afspdb.layers</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">afspdb.layers</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span> 
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="va">afspdb.layers</span><span class="op">$</span><span class="va">ca_ext</span> <span class="op">=</span> <span class="va">afspdb.layers</span><span class="op">$</span><span class="va">ExCa</span> <span class="op">*</span> <span class="fl">200</span>
  <span class="va">afspdb.layers</span><span class="op">$</span><span class="va">mg_ext</span> <span class="op">=</span> <span class="va">afspdb.layers</span><span class="op">$</span><span class="va">ExMg</span> <span class="op">*</span> <span class="fl">121</span>
  <span class="va">afspdb.layers</span><span class="op">$</span><span class="va">na_ext</span> <span class="op">=</span> <span class="va">afspdb.layers</span><span class="op">$</span><span class="va">ExNa</span> <span class="op">*</span> <span class="fl">230</span>
  <span class="va">afspdb.layers</span><span class="op">$</span><span class="va">k_ext</span> <span class="op">=</span> <span class="va">afspdb.layers</span><span class="op">$</span><span class="va">ExK</span> <span class="op">*</span> <span class="fl">391</span>
  <span class="co">#summary(afspdb.layers$k_ext)</span>
  <span class="va">afspdb.m</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">afspdb.profiles</span><span class="op">[</span>,<span class="va">afspdb.s.lst</span><span class="op">]</span>, <span class="va">afspdb.layers</span><span class="op">)</span>
  <span class="va">afspdb.m</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">afspdb.m</span><span class="op">$</span><span class="va">OrgC</span> <span class="op">*</span> <span class="va">afspdb.m</span><span class="op">$</span><span class="va">BlkDens</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">afspdb.m</span><span class="op">$</span><span class="va">CfPc</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">afspdb.m</span><span class="op">$</span><span class="va">CfPc</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#summary(afspdb.m$T_Year)</span>
  <span class="va">afspdb.m</span><span class="op">$</span><span class="va">T_Year</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">afspdb.m</span><span class="op">$</span><span class="va">T_Year</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">afspdb.m</span><span class="op">$</span><span class="va">T_Year</span><span class="op">)</span>
  <span class="va">afspdb.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ProfileID"</span>, <span class="st">"FldMnl_ID"</span>, <span class="st">"T_Year"</span>, <span class="st">"X_LonDD"</span>, <span class="st">"Y_LatDD"</span>, <span class="st">"LayerID"</span>, <span class="st">"LayerNr"</span>, <span class="st">"UpDpth"</span>, <span class="st">"LowDpth"</span>, <span class="st">"HorDes"</span>, <span class="st">"LabTxtr"</span>, <span class="st">"Clay"</span>, <span class="st">"Silt"</span>, <span class="st">"Sand"</span>, <span class="st">"OrgC"</span>, <span class="st">"oc_d"</span>, <span class="st">"TotC"</span>, <span class="st">"TotalN"</span>, <span class="st">"PHKCl"</span>, <span class="st">"PHH2O"</span>, <span class="st">"PHCaCl2"</span>, <span class="st">"CecSoil"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"Ecec"</span>, <span class="st">"CfPc"</span> , <span class="st">"BlkDens"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"EC"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">afspdb.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">afspdb.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">afspdb.m</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">afspdb.m</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.AfSPDB</span> <span class="op">=</span> <span class="va">afspdb.m</span><span class="op">[</span>,<span class="va">afspdb.h.lst</span><span class="op">]</span>
  <span class="va">chemsprops.AfSPDB</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"AfSPDB"</span>
  <span class="va">chemsprops.AfSPDB</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">5</span>
  <span class="va">chemsprops.AfSPDB</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://www.isric.org/projects/africa-soil-profiles-database-afsp"</span>
  <span class="va">chemsprops.AfSPDB</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://www.isric.org/sites/default/files/isric_report_2014_01.pdf"</span>
  <span class="va">chemsprops.AfSPDB</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.AfSPDB</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LabTxtr"</span>,<span class="st">"OrgC"</span>,<span class="st">"Clay"</span>,<span class="st">"Ecec"</span>,<span class="st">"PHH2O"</span>,<span class="st">"EC"</span>,<span class="st">"k_ext"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X_LonDD"</span>, <span class="st">"Y_LatDD"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.AfSPDB</span><span class="op">)</span>
<span class="co">#&gt; [1] 60306    36</span></code></pre></div>
</div>
<div id="africa-soil-information-service-afsis-soil-chemistry" class="section level4" number="5.3.0.6">
<h4>
<span class="header-section-number">5.3.0.6</span> Africa Soil Information Service (AfSIS) Soil Chemistry<a class="anchor" aria-label="anchor" href="#africa-soil-information-service-afsis-soil-chemistry"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Towett, E. K., Shepherd, K. D., Tondoh, J. E., Winowiecki, L. A., Lulseged, T., Nyambura, M., … &amp; Cadisch, G. (2015). Total elemental composition of soils in Sub-Saharan Africa and relationship with soil forming factors. Geoderma Regional, 5, 157-168. <a href="https://doi.org/10.1016/j.geodrs.2015.06.002" class="uri">https://doi.org/10.1016/j.geodrs.2015.06.002</a>
</li>
<li>
<a href="https://github.com/qedsoftware/afsis-soil-chem-tutorial">AfSIS Soil Chemistry</a> produced by World Agroforestry Centre (ICRAF), Quantitative Engineering Design (QED), Center for International Earth Science Information Network (CIESIN), The International Center for Tropical Agriculture (CIAT), Crop Nutrition Laboratory Services (CROPNUTS) and Rothamsted Research (RRES). Data download URL: <a href="https://registry.opendata.aws/afsis/" class="uri">https://registry.opendata.aws/afsis/</a>
</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.AfSIS1"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">afsis1.xy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SSL/2009-2013/Georeferences/georeferences.csv"</span><span class="op">)</span>
  <span class="va">afsis1.xy</span><span class="op">$</span><span class="va">Sampling.date</span> <span class="op">=</span> <span class="fl">2011</span>
  <span class="va">afsis1.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SSL/2009-2013/Wet_Chemistry"</span>, pattern<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/glob2rx.html">glob2rx</a></span><span class="op">(</span><span class="st">"*.csv$"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">afsis1.hor</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html">rbind.fill</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">afsis1.lst</span>, <span class="va">read.csv</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tansis.xy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SSL/tansis/Georeferences/georeferences.csv"</span><span class="op">)</span>
  <span class="co">#summary(tansis.xy$Sampling.date)</span>
  <span class="va">tansis.xy</span><span class="op">$</span><span class="va">Sampling.date</span> <span class="op">=</span> <span class="fl">2018</span>
  <span class="va">tansis.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SSL/tansis/Wet_Chemistry"</span>, pattern<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/glob2rx.html">glob2rx</a></span><span class="op">(</span><span class="st">"*.csv$"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">tansis.hor</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html">rbind.fill</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tansis.lst</span>, <span class="va">read.csv</span><span class="op">)</span><span class="op">)</span>
  <span class="va">afsis1t.df</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html">rbind.fill</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">afsis1.hor</span>, <span class="va">afsis1.xy</span>, by<span class="op">=</span><span class="st">"SSN"</span><span class="op">)</span>, <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">tansis.hor</span>, <span class="va">tansis.xy</span>, by<span class="op">=</span><span class="st">"SSN"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">afsis1t.df</span><span class="op">$</span><span class="va">UpDpth</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">afsis1t.df</span><span class="op">$</span><span class="va">Depth</span><span class="op">==</span><span class="st">"sub"</span>, <span class="fl">20</span>, <span class="fl">0</span><span class="op">)</span>
  <span class="va">afsis1t.df</span><span class="op">$</span><span class="va">LowDpth</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">afsis1t.df</span><span class="op">$</span><span class="va">Depth</span><span class="op">==</span><span class="st">"sub"</span>, <span class="fl">50</span>, <span class="fl">20</span><span class="op">)</span>
  <span class="va">afsis1t.df</span><span class="op">$</span><span class="va">LayerNr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">afsis1t.df</span><span class="op">$</span><span class="va">Depth</span><span class="op">==</span><span class="st">"sub"</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="co">#summary(afsis1t.df$C...Org)</span>
  <span class="va">afsis1t.df</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">afsis1t.df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C...Org"</span>, <span class="st">"X.C"</span><span class="op">)</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">afsis1t.df</span><span class="op">$</span><span class="va">c_tot</span> <span class="op">=</span> <span class="va">afsis1t.df</span><span class="op">$</span><span class="va">Total.carbon</span>
  <span class="va">afsis1t.df</span><span class="op">$</span><span class="va">n_tot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">afsis1t.df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Total.nitrogen"</span>, <span class="st">"X.N"</span><span class="op">)</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">afsis1t.df</span><span class="op">$</span><span class="va">ph_h2o</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">afsis1t.df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PH"</span>, <span class="st">"pH"</span><span class="op">)</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="co">## multiple texture fractons - which one is the total clay, sand, silt?</span>
  <span class="co">## Clay content for water dispersed particles-recorded after 4 minutes of ultrasonication</span>
  <span class="co">#summary(afsis1t.df$Psa.w4clay)</span>
  <span class="co">#plot(afsis1t.df[,c("Longitude", "Latitude")])</span>
  <span class="va">afsis1.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SSN"</span>, <span class="st">"Site"</span>, <span class="st">"Sampling.date"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"Soil.material"</span>, <span class="st">"LayerNr"</span>, <span class="st">"UpDpth"</span>, <span class="st">"LowDpth"</span>, <span class="st">"HorDes"</span>, <span class="st">"LabTxtr"</span>, <span class="st">"Psa.w4clay"</span>, <span class="st">"Psa.w4silt"</span>, <span class="st">"Psa.w4sand"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"PHKCl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"PHCaCl2"</span>, <span class="st">"CecSoil"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"Ecec"</span>, <span class="st">"CfPc"</span> , <span class="st">"BlkDens"</span>, <span class="st">"ca_ext"</span>, <span class="st">"M3.Mg"</span>, <span class="st">"M3.Na"</span>, <span class="st">"M3.K"</span>, <span class="st">"EC"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">afspdb.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">afsis1.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">afsis1t.df</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">afsis1t.df</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.AfSIS1</span> <span class="op">=</span> <span class="va">afsis1t.df</span><span class="op">[</span>,<span class="va">afsis1.h.lst</span><span class="op">]</span>
  <span class="va">chemsprops.AfSIS1</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"AfSIS1"</span>
  <span class="va">chemsprops.AfSIS1</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.AfSIS1</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://registry.opendata.aws/afsis/"</span>
  <span class="va">chemsprops.AfSIS1</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1016/j.geodrs.2015.06.002"</span>
  <span class="va">chemsprops.AfSIS1</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.AfSIS1</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Psa.w4clay"</span>,<span class="st">"oc"</span>,<span class="st">"ph_h2o"</span>,<span class="st">"M3.K"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.AfSIS1</span><span class="op">)</span>
<span class="co">#&gt; [1] 4162   36</span></code></pre></div>
</div>
<div id="fine-root-ecology-database-fred" class="section level4" number="5.3.0.7">
<h4>
<span class="header-section-number">5.3.0.7</span> Fine Root Ecology Database (FRED)<a class="anchor" aria-label="anchor" href="#fine-root-ecology-database-fred"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Iversen CM, McCormack ML, Baer JK, Powell AS, Chen W, Collins C, Fan Y, Fanin N, Freschet GT, Guo D, Hogan JA, Kou L, Laughlin DC, Lavely E, Liese R, Lin D, Meier IC, Montagnoli A, Roumet C, See CR, Soper F, Terzaghi M, Valverde-Barrantes OJ, Wang C, Wright SJ, Wurzburger N, Zadworny M. (2021). <a href="https://roots.ornl.gov/">Fine-Root Ecology Database (FRED): A Global Collection of Root Trait Data with Coincident Site, Vegetation, Edaphic, and Climatic Data, Version 3</a>. Oak Ridge National Laboratory, TES SFA, U.S. Department of Energy, Oak Ridge, Tennessee, U.S.A. Access on-line at: <a href="https://doi.org/10.25581/ornlsfa.014/1459186" class="uri">https://doi.org/10.25581/ornlsfa.014/1459186</a>.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.FRED"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span><span class="st">"VROOM_CONNECTION_SIZE"</span> <span class="op">=</span> <span class="fl">131072</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span>
  <span class="va">fred</span> <span class="op">=</span> <span class="fu">vroom</span><span class="fu">::</span><span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/FRED/FRED3_Entire_Database_2021.csv"</span>, skip <span class="op">=</span> <span class="fl">10</span>, col_names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">## 57,190 x 1,164</span>
  <span class="co">#nm.fred = read.csv("/mnt/diskstation/data/Soil_points/INT/FRED/FRED3_Column_Definitions_20210423-091040.csv", header=TRUE)</span>
  <span class="va">nm.fred0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/FRED/FRED3_Entire_Database_2021.csv"</span>, nrows<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fred</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">nm.fred0</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="co">## 1164 columns!</span>
  <span class="va">fred.h.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Notes_Row.ID"</span>, <span class="st">"Data.source_DOI"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"Soil.horizon"</span>, <span class="st">"Soil.texture"</span>, <span class="st">"Soil.texture_Fraction.clay"</span>, <span class="st">"Soil.texture_Fraction.silt"</span>, <span class="st">"Soil.texture_Fraction.sand"</span>, <span class="st">"Soil.organic.C.content"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"Soil.N.content"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"Soil.pH_Water"</span>, <span class="st">"Soil.pH_Salt"</span>, <span class="st">"Soil.cation.exchange.capacity..CEC."</span>, <span class="st">"cec_nh4"</span>, <span class="st">"Soil.effective.cation.exchange.capacity..ECEC."</span>, <span class="st">"wpg2"</span>, <span class="st">"Soil.bulk.density"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>, <span class="st">"source_db"</span>, <span class="st">"confidence_degree"</span><span class="op">)</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">fred</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample.collection_Year.ending.collection"</span>, <span class="st">"Sample.collection_Year.beginning.collection"</span><span class="op">)</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#summary(fred$site_obsdate)</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fred</span><span class="op">$</span><span class="va">Longitude</span><span class="op">)</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Longitude_Estimated</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Longitude</span><span class="op">)</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fred</span><span class="op">$</span><span class="va">Latitude</span><span class="op">)</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Latitude_Estimated</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Latitude</span><span class="op">)</span>
  <span class="co">#names(fred)[grep("Notes_Row", names(fred))]</span>
  <span class="co">#summary(fred[,grep("clay", names(fred))])</span>
  <span class="co">#summary(fred[,grep("cation.exchange", names(fred))])</span>
  <span class="co">#summary(fred[,grep("organic.C", names(fred))])</span>
  <span class="co">#summary(fred$Soil.organic.C.content)</span>
  <span class="co">#summary(fred$Soil.bulk.density)</span>
  <span class="co">#summary(as.factor(fred$Soil.horizon))</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth_Lower.sampling.depth</span><span class="op">)</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth</span> <span class="op">-</span> <span class="fl">5</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth_Lower.sampling.depth</span><span class="op">)</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth_Upper.sampling.depth</span><span class="op">)</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth</span> <span class="op">+</span> <span class="fl">5</span>, <span class="va">fred</span><span class="op">$</span><span class="va">Soil.depth_Upper.sampling.depth</span><span class="op">)</span>
  <span class="va">fred</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">fred</span><span class="op">$</span><span class="va">Soil.organic.C.content</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">fred</span><span class="op">$</span><span class="va">Soil.bulk.density</span> <span class="op">*</span> <span class="fl">1000</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#summary(fred$oc_d)  </span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">fred.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">fred.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fred</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">fred</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.FRED</span> <span class="op">=</span> <span class="va">fred</span><span class="op">[</span>,<span class="va">fred.h.lst</span><span class="op">]</span>
  <span class="co">#plot(chemsprops.FRED[,4:5])</span>
  <span class="va">chemsprops.FRED</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"FRED"</span>
  <span class="va">chemsprops.FRED</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">5</span>
  <span class="va">chemsprops.FRED</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://roots.ornl.gov/"</span>
  <span class="va">chemsprops.FRED</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.25581/ornlsfa.014/1459186"</span>
  <span class="va">chemsprops.FRED</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.FRED</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Soil.organic.C.content"</span>, <span class="st">"Soil.texture_Fraction.clay"</span>, <span class="st">"Soil.pH_Water"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">## many duplicates</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.FRED</span><span class="op">)</span>
<span class="co">#&gt; [1] 858  36</span></code></pre></div>
</div>
<div id="global-root-traits-groot-database-compilation" class="section level4" number="5.3.0.8">
<h4>
<span class="header-section-number">5.3.0.8</span> Global root traits (GRooT) database (compilation)<a class="anchor" aria-label="anchor" href="#global-root-traits-groot-database-compilation"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Guerrero‐Ramírez, N. R., Mommer, L., Freschet, G. T., Iversen, C. M., McCormack, M. L., Kattge, J., … &amp; Weigelt, A. (2021). <a href="https://dx.doi.org/10.1111/geb.13179">Global root traits (GRooT) database</a>. Global ecology and biogeography, 30(1), 25-37. <a href="https://dx.doi.org/10.1111/geb.13179" class="uri">https://dx.doi.org/10.1111/geb.13179</a>
</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.GROOT"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#Sys.setenv("VROOM_CONNECTION_SIZE" = 131072 * 2)</span>
  <span class="va">GROOT</span> <span class="op">=</span> <span class="fu">vroom</span><span class="fu">::</span><span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/GRooT/GRooTFullVersion.csv"</span><span class="op">)</span>
  <span class="co">## 114,222 x 73</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"locationID"</span>, <span class="st">"GRooTID"</span>, <span class="st">"originalID"</span>, <span class="st">"source"</span>, <span class="st">"year"</span>, <span class="st">"decimalLatitude"</span>, <span class="st">"decimalLongitud"</span>, <span class="st">"soilpH"</span>, <span class="st">"soilTexture"</span>, <span class="st">"soilCarbon"</span>, <span class="st">"soilNitrogen"</span>, <span class="st">"soilPhosphorus"</span>, <span class="st">"soilCarbonToNitrogen"</span>, <span class="st">"soilBaseCationSaturation"</span>, <span class="st">"soilCationExchangeCapacity"</span>, <span class="st">"soilOrganicMatter"</span>, <span class="st">"soilWaterGravimetric"</span>, <span class="st">"soilWaterVolumetric"</span><span class="op">)</span>
  <span class="co">#summary(GROOT$soilCarbon)</span>
  <span class="co">#summary(!is.na(GROOT$soilCarbon))</span>
  <span class="co">#summary(GROOT$soilOrganicMatter)</span>
  <span class="co">#summary(GROOT$soilNitrogen)</span>
  <span class="co">#summary(GROOT$soilpH)</span>
  <span class="co">#summary(as.factor(GROOT$soilTexture))</span>
  <span class="co">#lattice::xyplot(soilCarbon ~ soilpH, GROOT, par.settings = list(plot.symbol = list(col=scales::alpha("black", 0.6), fill=scales::alpha("red", 0.6), pch=21, cex=0.6)), scales = list(y=list(log=TRUE, equispaced.log=FALSE)), ylab="SOC", xlab="pH")</span>
  <span class="va">GROOT</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">GROOT</span><span class="op">$</span><span class="va">year</span>, <span class="st">"-01-01"</span><span class="op">)</span>, format<span class="op">=</span><span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">GROOT</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="va">GROOT</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fl">30</span>
  <span class="va">GROOT.h.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"locationID"</span>, <span class="st">"originalID"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"decimalLongitud"</span>, <span class="st">"decimalLatitude"</span>, <span class="st">"GRooTID"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"soilTexture"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"soilCarbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"soilNitrogen"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"soilpH"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"soilCationExchangeCapacity"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">GROOT.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">GROOT.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">GROOT</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">GROOT</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.GROOT</span> <span class="op">=</span> <span class="va">GROOT</span><span class="op">[</span>,<span class="va">GROOT.h.lst</span><span class="op">]</span>
  <span class="va">chemsprops.GROOT</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"GROOT"</span>
  <span class="va">chemsprops.GROOT</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">8</span>
  <span class="va">chemsprops.GROOT</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://groot-database.github.io/GRooT/"</span>
  <span class="va">chemsprops.GROOT</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://dx.doi.org/10.1111/geb.13179"</span>
  <span class="va">chemsprops.GROOT</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.GROOT</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"soilCarbon"</span>, <span class="st">"soilpH"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"decimalLongitud"</span>, <span class="st">"decimalLatitude"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.GROOT</span><span class="op">)</span>
<span class="co">#&gt; [1] 718  36</span></code></pre></div>
</div>
<div id="global-soil-respiration-db" class="section level4" number="5.3.0.9">
<h4>
<span class="header-section-number">5.3.0.9</span> Global Soil Respiration DB<a class="anchor" aria-label="anchor" href="#global-soil-respiration-db"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Bond-Lamberty, B. and Thomson, A. (2010). A global database of soil respiration data, Biogeosciences, 7, 1915–1926, <a href="https://doi.org/10.5194/bg-7-1915-2010" class="uri">https://doi.org/10.5194/bg-7-1915-2010</a>
</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.SRDB"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">srdb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/SRDB/srdb-data.csv"</span><span class="op">)</span>
  <span class="co">## 10366 x 85</span>
  <span class="va">srdb.h.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Site_ID"</span>, <span class="st">"Notes"</span>, <span class="st">"Study_midyear"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psd"</span>, <span class="st">"Soil_clay"</span>, <span class="st">"Soil_silt"</span>, <span class="st">"Soil_sand"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"Soil_BD"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>, <span class="st">"source_db"</span>, <span class="st">"confidence_degree"</span><span class="op">)</span>
  <span class="co">#summary(srdb$Study_midyear)</span>
  <span class="va">srdb</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">srdb</span><span class="op">$</span><span class="va">C_soildepth</span><span class="op">)</span>, <span class="fl">100</span>, <span class="va">srdb</span><span class="op">$</span><span class="va">C_soildepth</span><span class="op">)</span>
  <span class="va">srdb</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="co">#summary(srdb$Soil_clay)</span>
  <span class="co">#summary(srdb$C_soilmineral)</span>
  <span class="va">srdb</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">srdb</span><span class="op">$</span><span class="va">C_soilmineral</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">/</span> <span class="op">(</span><span class="va">srdb</span><span class="op">$</span><span class="va">hzn_bot</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#summary(srdb$oc_d) </span>
  <span class="co">#summary(srdb$Soil_BD)</span>
  <span class="va">srdb</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">srdb</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">/</span> <span class="va">srdb</span><span class="op">$</span><span class="va">Soil_BD</span>
  <span class="co">#summary(srdb$oc)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">srdb.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">srdb.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">srdb</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">srdb</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.SRDB</span> <span class="op">=</span> <span class="va">srdb</span><span class="op">[</span>,<span class="va">srdb.h.lst</span><span class="op">]</span>
  <span class="co">#plot(chemsprops.SRDB[,4:5])</span>
  <span class="va">chemsprops.SRDB</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"SRDB"</span>
  <span class="va">chemsprops.SRDB</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">5</span>
  <span class="va">chemsprops.SRDB</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://github.com/bpbond/srdb/"</span>
  <span class="va">chemsprops.SRDB</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.5194/bg-7-1915-2010"</span>
  <span class="va">chemsprops.SRDB</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.SRDB</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"Soil_clay"</span>, <span class="st">"Soil_BD"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.SRDB</span><span class="op">)</span>
<span class="co">#&gt; [1] 1596   36</span></code></pre></div>
</div>
<div id="soils-data-harmonization-database-sodah" class="section level4" number="5.3.0.10">
<h4>
<span class="header-section-number">5.3.0.10</span> SOils DAta Harmonization database (SoDaH)<a class="anchor" aria-label="anchor" href="#soils-data-harmonization-database-sodah"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Wieder, W. R., Pierson, D., Earl, S., Lajtha, K., Baer, S., Ballantyne, F., … &amp; Weintraub, S. (2020). <a href="https://doi.org/10.5194/essd-2020-195">SoDaH: the SOils DAta Harmonization database, an open-source synthesis of soil data from research networks, version 1.0</a>. Earth System Science Data Discussions, 1-19. <a href="https://doi.org/10.5194/essd-2020-195" class="uri">https://doi.org/10.5194/essd-2020-195</a>. Data download URL: <a href="https://doi.org/10.6073/pasta/9733f6b6d2ffd12bf126dc36a763e0b4" class="uri">https://doi.org/10.6073/pasta/9733f6b6d2ffd12bf126dc36a763e0b4</a>
</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.SoDaH"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">sodah.hor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/SoDaH/521_soils_data_harmonization_6e8416fa0c9a2c2872f21ba208e6a919.csv"</span><span class="op">)</span>
  <span class="co">#head(sodah.hor)</span>
  <span class="co">#summary(sodah.hor$coarse_frac)</span>
  <span class="co">#summary(sodah.hor$lyr_soc)</span>
  <span class="co">#summary(sodah.hor$lyr_som_WalkleyBlack/1.724)</span>
  <span class="co">#summary(as.factor(sodah.hor$observation_date))</span>
  <span class="va">sodah.hor</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">sodah.hor</span><span class="op">$</span><span class="va">observation_date</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
  <span class="va">sodah.hor</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sodah.hor</span><span class="op">$</span><span class="va">lyr_soc</span><span class="op">)</span>, <span class="va">sodah.hor</span><span class="op">$</span><span class="va">lyr_som_WalkleyBlack</span><span class="op">/</span><span class="fl">1.724</span>, <span class="va">sodah.hor</span><span class="op">$</span><span class="va">lyr_soc</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">sodah.hor</span><span class="op">$</span><span class="va">n_tot</span> <span class="op">=</span> <span class="va">sodah.hor</span><span class="op">$</span><span class="va">lyr_n_tot</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">sodah.hor</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">sodah.hor</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">sodah.hor</span><span class="op">$</span><span class="va">bd_samp</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sodah.hor</span><span class="op">$</span><span class="va">coarse_frac</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">sodah.hor</span><span class="op">$</span><span class="va">coarse_frac</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">sodah.hor</span><span class="op">$</span><span class="va">site_key</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">sodah.hor</span><span class="op">$</span><span class="va">network</span>, <span class="va">sodah.hor</span><span class="op">$</span><span class="va">location_name</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
  <span class="va">sodah.hor</span><span class="op">$</span><span class="va">labsampnum</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/make.unique.html">make.unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">sodah.hor</span><span class="op">$</span><span class="va">network</span>, <span class="va">sodah.hor</span><span class="op">$</span><span class="va">location_name</span>, <span class="va">sodah.hor</span><span class="op">$</span><span class="va">L1</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#summary(sodah.hor$oc_d)</span>
  <span class="va">sodah.h.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"data_file"</span>, <span class="st">"observation_date"</span>, <span class="st">"long"</span>, <span class="st">"lat"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"layer_top"</span>, <span class="st">"layer_bot"</span>, <span class="st">"hzn"</span>, <span class="st">"profile_texture_class"</span>, <span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"coarse_frac"</span>, <span class="st">"bd_samp"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>, <span class="st">"source_db"</span>, <span class="st">"confidence_degree"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">sodah.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">sodah.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sodah.hor</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">sodah.hor</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.SoDaH</span> <span class="op">=</span> <span class="va">sodah.hor</span><span class="op">[</span>,<span class="va">sodah.h.lst</span><span class="op">]</span>
  <span class="co">#plot(chemsprops.SoDaH[,4:5])</span>
  <span class="va">chemsprops.SoDaH</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"SoDaH"</span>
  <span class="va">chemsprops.SoDaH</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">3</span>
  <span class="va">chemsprops.SoDaH</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://lter.github.io/som-website"</span>
  <span class="va">chemsprops.SoDaH</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.5194/essd-2020-195"</span>
  <span class="va">chemsprops.SoDaH</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.SoDaH</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"clay"</span>, <span class="st">"ph_h2o"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.SoDaH</span><span class="op">)</span>
<span class="co">#&gt; [1] 20383    36</span></code></pre></div>
</div>
<div id="isric-wise-harmonized-soil-profile-data" class="section level4" number="5.3.0.11">
<h4>
<span class="header-section-number">5.3.0.11</span> ISRIC WISE harmonized soil profile data<a class="anchor" aria-label="anchor" href="#isric-wise-harmonized-soil-profile-data"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Batjes, N.H. (2019). <a href="http://dx.doi.org/10.1111/j.1475-2743.2009.00202.x">Harmonized soil profile data for applications at global and continental scales: updates to the WISE database</a>. Soil Use and Management 5:124–127. Data download URL: <a href="https://files.isric.org/public/wise/WD-WISE.zip" class="uri">https://files.isric.org/public/wise/WD-WISE.zip</a>
</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.WISE"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">wise.site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_WISE/WISE3_SITE.csv"</span>, sep<span class="op">=</span><span class="st">","</span>, header<span class="op">=</span><span class="cn">TRUE</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, fill<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">wise.s.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WISE3_id"</span>, <span class="st">"PITREF"</span>, <span class="st">"DATEYR"</span>, <span class="st">"LONDD"</span>, <span class="st">"LATDD"</span><span class="op">)</span>
  <span class="va">wise.site</span><span class="op">$</span><span class="va">LONDD</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">wise.site</span><span class="op">$</span><span class="va">LONDD</span><span class="op">)</span>
  <span class="va">wise.site</span><span class="op">$</span><span class="va">LATDD</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">wise.site</span><span class="op">$</span><span class="va">LATDD</span><span class="op">)</span>
  <span class="va">wise.layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_WISE/WISE3_HORIZON.csv"</span>, sep<span class="op">=</span><span class="st">","</span>, header<span class="op">=</span><span class="cn">TRUE</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, fill<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">wise.layer</span><span class="op">$</span><span class="va">ca_ext</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">wise.layer</span><span class="op">$</span><span class="va">EXCA</span> <span class="op">*</span> <span class="fl">200</span>, <span class="fl">4</span><span class="op">)</span>
  <span class="va">wise.layer</span><span class="op">$</span><span class="va">mg_ext</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">wise.layer</span><span class="op">$</span><span class="va">EXMG</span> <span class="op">*</span> <span class="fl">121</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">wise.layer</span><span class="op">$</span><span class="va">na_ext</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">wise.layer</span><span class="op">$</span><span class="va">EXNA</span> <span class="op">*</span> <span class="fl">230</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">wise.layer</span><span class="op">$</span><span class="va">k_ext</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">wise.layer</span><span class="op">$</span><span class="va">EXK</span> <span class="op">*</span> <span class="fl">391</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">wise.layer</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">wise.layer</span><span class="op">$</span><span class="va">ORGC</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">wise.layer</span><span class="op">$</span><span class="va">BULKDENS</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">wise.layer</span><span class="op">$</span><span class="va">GRAVEL</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">wise.layer</span><span class="op">$</span><span class="va">GRAVEL</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">wise.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"WISE3_ID"</span>, <span class="st">"labsampnum"</span>, <span class="st">"HONU"</span>, <span class="st">"TOPDEP"</span>, <span class="st">"BOTDEP"</span>, <span class="st">"DESIG"</span>, <span class="st">"tex_psda"</span>, <span class="st">"CLAY"</span>, <span class="st">"SILT"</span>, <span class="st">"SAND"</span>, <span class="st">"ORGC"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"TOTN"</span>, <span class="st">"PHKCL"</span>, <span class="st">"PHH2O"</span>, <span class="st">"PHCACL2"</span>, <span class="st">"CECSOIL"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"GRAVEL"</span> , <span class="st">"BULKDENS"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ECE"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">wise.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">wise.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">wise.layer</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">wise.layer</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.WISE</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">wise.site</span><span class="op">[</span>,<span class="va">wise.s.lst</span><span class="op">]</span>, <span class="va">wise.layer</span><span class="op">[</span>,<span class="va">wise.h.lst</span><span class="op">]</span>, by.x<span class="op">=</span><span class="st">"WISE3_id"</span>, by.y<span class="op">=</span><span class="st">"WISE3_ID"</span><span class="op">)</span>
  <span class="va">chemsprops.WISE</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"ISRIC_WISE"</span>
  <span class="va">chemsprops.WISE</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.WISE</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://isric.org"</span>
  <span class="va">chemsprops.WISE</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"http://dx.doi.org/10.1111/j.1475-2743.2009.00202.x"</span>
  <span class="va">chemsprops.WISE</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.WISE</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ORGC"</span>,<span class="st">"CLAY"</span>,<span class="st">"PHH2O"</span>,<span class="st">"CECSOIL"</span>,<span class="st">"k_ext"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LONDD"</span>, <span class="st">"LATDD"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.WISE</span><span class="op">)</span>
<span class="co">#&gt; [1] 23278    36</span></code></pre></div>
</div>
<div id="gemas" class="section level4" number="5.3.0.12">
<h4>
<span class="header-section-number">5.3.0.12</span> GEMAS<a class="anchor" aria-label="anchor" href="#gemas"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Reimann, C., Fabian, K., Birke, M., Filzmoser, P., Demetriades, A., Négrel, P., … &amp; Anderson, M. (2018). <a href="https://doi.org/10.1016/j.apgeochem.2017.01.021">GEMAS: Establishing geochemical background and threshold for 53 chemical elements in European agricultural soil</a>. Applied Geochemistry, 88, 302-318. Data download URL: <a href="http://gemas.geolba.ac.at/" class="uri">http://gemas.geolba.ac.at/</a>
</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.GEMAS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">gemas.samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/EU/GEMAS/GEMAS.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">## GEMAS, agricultural soil, 0-20 cm, air dried, &lt;2 mm, aqua regia Data from ACME, total C, TOC, CEC, ph_CaCl2</span>
  <span class="va">gemas.samples</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="va">gemas.samples</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fl">20</span>
  <span class="va">gemas.samples</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">gemas.samples</span><span class="op">$</span><span class="va">TOC</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="co">#summary(gemas.samples$oc)</span>
  <span class="va">gemas.samples</span><span class="op">$</span><span class="va">c_tot</span> <span class="op">=</span> <span class="va">gemas.samples</span><span class="op">$</span><span class="va">C_tot</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">gemas.samples</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fl">2009</span>
  <span class="va">gemas.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"COUNRTY"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"XCOO"</span>, <span class="st">"YCOO"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"TYPE"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"pH_CaCl2"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">gemas.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">gemas.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">gemas.samples</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">gemas.samples</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.GEMAS</span> <span class="op">&lt;-</span> <span class="va">gemas.samples</span><span class="op">[</span>,<span class="va">gemas.h.lst</span><span class="op">]</span>
  <span class="va">chemsprops.GEMAS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"GEMAS_2009"</span>
  <span class="va">chemsprops.GEMAS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.GEMAS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://gemas.geolba.ac.at/"</span>
  <span class="va">chemsprops.GEMAS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1016/j.apgeochem.2017.01.021"</span>
  <span class="va">chemsprops.GEMAS</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.GEMAS</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"clay"</span>,<span class="st">"pH_CaCl2"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"XCOO"</span>, <span class="st">"YCOO"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.GEMAS</span><span class="op">)</span>
<span class="co">#&gt; [1] 4131   36</span></code></pre></div>
</div>
<div id="lucas-soil" class="section level4" number="5.3.0.13">
<h4>
<span class="header-section-number">5.3.0.13</span> LUCAS soil<a class="anchor" aria-label="anchor" href="#lucas-soil"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Orgiazzi, A., Ballabio, C., Panagos, P., Jones, A., &amp; Fernández‐Ugalde, O. (2018). <a href="https://doi.org/10.1111/ejss.12499">LUCAS Soil, the largest expandable soil dataset for Europe: a review</a>. European Journal of Soil Science, 69(1), 140-153. Data download URL: <a href="https://esdac.jrc.ec.europa.eu/content/lucas-2009-topsoil-data" class="uri">https://esdac.jrc.ec.europa.eu/content/lucas-2009-topsoil-data</a>
</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.LUCAS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">lucas.samples</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/LUCAS_TOPSOIL_v1.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">lucas.samples</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">&lt;-</span> <span class="st">"2009"</span>
  <span class="co">#summary(lucas.samples$N)</span>
  <span class="va">lucas.ro</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/Romania.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">lucas.ro</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">&lt;-</span> <span class="st">"2012"</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lucas.samples</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lucas.samples</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lucas.ro</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="va">lucas.ro</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rename.html">rename</a></span><span class="op">(</span><span class="va">lucas.ro</span>, replace<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Soil.ID"</span><span class="op">=</span><span class="st">"sample_ID"</span>, <span class="st">"GPS_X_LONG"</span><span class="op">=</span><span class="st">"GPS_LONG"</span>, <span class="st">"GPS_Y_LAT"</span><span class="op">=</span><span class="st">"GPS_LAT"</span>, <span class="st">"pHinH2O"</span><span class="op">=</span><span class="st">"pH_in_H2O"</span>, <span class="st">"pHinCaCl2"</span><span class="op">=</span><span class="st">"pH_in_CaCl"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">lucas.bu</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/Bulgaria.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">lucas.bu</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">&lt;-</span> <span class="st">"2012"</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lucas.samples</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lucas.samples</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lucas.bu</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="co">#lucas.ch &lt;- openxlsx::read.xlsx("/mnt/diskstation/data/Soil_points/EU/LUCAS/LUCAS_2015_Topsoil_data_of_Switzerland-with-coordinates.xlsx_.xlsx", sheet = 1, startRow = 2)</span>
  <span class="co">#lucas.ch = plyr::rename(lucas.ch, replace=c("Soil_ID"="sample_ID", "GPS_.LAT"="GPS_LAT", "pH.in.H2O"="pH_in_H2O", "pH.in.CaCl2"="pH_in_CaCl", "Calcium.carbonate/.g.kg–1"="CaCO3", "Silt/.g.kg–1"="silt", "Sand/.g.kg–1"="sand", "Clay/.g.kg–1"="clay", "Organic.carbon/.g.kg–1"="OC"))</span>
  <span class="co">## Double readings?</span>
  <span class="va">lucas.t</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html">rbind.fill</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">lucas.samples</span>, <span class="va">lucas.ro</span>, <span class="va">lucas.bu</span><span class="op">)</span><span class="op">)</span>
  <span class="va">lucas.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"POINT_ID"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"GPS_LONG"</span>, <span class="st">"GPS_LAT"</span>, <span class="st">"sample_ID"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand"</span>, <span class="st">"OC"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"N"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"pH_in_H2O"</span>, <span class="st">"pH_in_CaCl"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"coarse"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"K"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">lucas.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">lucas.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lucas.t</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">lucas.t</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.LUCAS</span> <span class="op">&lt;-</span> <span class="va">lucas.t</span><span class="op">[</span>,<span class="va">lucas.h.lst</span><span class="op">]</span>
  <span class="va">chemsprops.LUCAS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"LUCAS_2009"</span>
  <span class="va">chemsprops.LUCAS</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="va">chemsprops.LUCAS</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">&lt;-</span> <span class="fl">20</span>
  <span class="va">chemsprops.LUCAS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.LUCAS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://esdac.jrc.ec.europa.eu/"</span>
  <span class="va">chemsprops.LUCAS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1111/ejss.12499"</span>
  <span class="va">chemsprops.LUCAS</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.LUCAS</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OC"</span>,<span class="st">"clay"</span>,<span class="st">"pH_in_H2O"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GPS_LONG"</span>, <span class="st">"GPS_LAT"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.LUCAS</span><span class="op">)</span>
<span class="co">#&gt; [1] 21272    36</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.LUCAS2"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#lucas2015.samples &lt;- openxlsx::read.xlsx("/mnt/diskstation/data/Soil_points/EU/LUCAS/LUCAS_Topsoil_2015_20200323.xlsx", sheet = 1)</span>
  <span class="va">lucas2015.xy</span> <span class="op">=</span> <span class="fu">readOGR</span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/LUCAS_Topsoil_2015_20200323.shp"</span><span class="op">)</span>
  <span class="co">#head(as.data.frame(lucas2015.xy))</span>
  <span class="va">lucas2015.xy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">lucas2015.xy</span><span class="op">)</span>
  <span class="co">## https://www.aqion.de/site/130</span>
  <span class="co">## 1 mS/m = 100 mS/cm | 1 dS/m = 1 mS/cm = 1 mS/m / 100</span>
  <span class="va">lucas2015.xy</span><span class="op">$</span><span class="va">ec_satp</span> <span class="op">=</span> <span class="va">lucas2015.xy</span><span class="op">$</span><span class="va">EC</span> <span class="op">/</span> <span class="fl">100</span>
  <span class="va">lucas2015.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Point_ID"</span>, <span class="st">"LC0_Desc"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"coords.x1"</span>, <span class="st">"coords.x2"</span>, <span class="st">"sample_ID"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"Clay"</span>, <span class="st">"Silt"</span>, <span class="st">"Sand"</span>, <span class="st">"OC"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"N"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"pH_H20"</span>, <span class="st">"pH_CaCl2"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"coarse"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"K"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">lucas2015.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">lucas2015.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lucas2015.xy</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">lucas2015.xy</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.LUCAS2</span> <span class="op">&lt;-</span> <span class="va">lucas2015.xy</span><span class="op">[</span>,<span class="va">lucas2015.h.lst</span><span class="op">]</span>
  <span class="va">chemsprops.LUCAS2</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"LUCAS_2015"</span>
  <span class="va">chemsprops.LUCAS2</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="va">chemsprops.LUCAS2</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">&lt;-</span> <span class="fl">20</span>
  <span class="va">chemsprops.LUCAS2</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">&lt;-</span> <span class="st">"2015"</span>
  <span class="va">chemsprops.LUCAS2</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.LUCAS2</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://esdac.jrc.ec.europa.eu/"</span>
  <span class="va">chemsprops.LUCAS2</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1111/ejss.12499"</span>
  <span class="va">chemsprops.LUCAS2</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.LUCAS2</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OC"</span>,<span class="st">"Clay"</span>,<span class="st">"pH_H20"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"coords.x1"</span>, <span class="st">"coords.x2"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.LUCAS2</span><span class="op">)</span>
<span class="co">#&gt; [1] 21859    36</span></code></pre></div>
</div>
<div id="mangrove-forest-soil-db" class="section level4" number="5.3.0.14">
<h4>
<span class="header-section-number">5.3.0.14</span> Mangrove forest soil DB<a class="anchor" aria-label="anchor" href="#mangrove-forest-soil-db"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Sanderman, J., Hengl, T., Fiske, G., Solvik, K., Adame, M. F., Benson, L., … &amp; Duncan, C. (2018). <a href="https://doi.org/10.1088/1748-9326/aabe1c">A global map of mangrove forest soil carbon at 30 m spatial resolution</a>. Environmental Research Letters, 13(5), 055002. Data download URL: <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/OCYUIT" class="uri">https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/OCYUIT</a>
</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.Mangroves"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">mng.profs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/TNC_mangroves/mangrove_soc_database_v10_sites.csv"</span>, skip<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
  <span class="va">mng.hors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/TNC_mangroves/mangrove_soc_database_v10_horizons.csv"</span>, skip<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
  <span class="va">mngALL</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">mng.hors</span>, <span class="va">mng.profs</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Site.name"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">mngALL</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">mngALL</span><span class="op">$</span><span class="va">OC_final</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">mngALL</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="va">mngALL</span><span class="op">$</span><span class="va">CD_calc</span> <span class="op">*</span> <span class="fl">1000</span>
  <span class="va">mngALL</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="va">mngALL</span><span class="op">$</span><span class="va">U_depth</span> <span class="op">*</span> <span class="fl">100</span>
  <span class="va">mngALL</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="va">mngALL</span><span class="op">$</span><span class="va">L_depth</span> <span class="op">*</span> <span class="fl">100</span>
  <span class="va">mngALL</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="co">#summary(mngALL$BD_reported) ## some very high values 3.26 t/m3</span>
  <span class="va">mngALL</span><span class="op">$</span><span class="va">Year</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">mngALL</span><span class="op">$</span><span class="va">Year_sampled</span><span class="op">)</span>, <span class="va">mngALL</span><span class="op">$</span><span class="va">Years_collected</span>, <span class="va">mngALL</span><span class="op">$</span><span class="va">Year_sampled</span><span class="op">)</span>
  <span class="va">mng.col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Site.name"</span>, <span class="st">"Site.."</span>, <span class="st">"Year"</span>, <span class="st">"Longitude_Adjusted"</span>, <span class="st">"Latitude_Adjusted"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>,<span class="st">"hzn_top"</span>,<span class="st">"hzn_bot"</span>,<span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"BD_reported"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>  
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">mng.col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">mng.col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mngALL</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">mngALL</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.Mangroves</span> <span class="op">=</span> <span class="va">mngALL</span><span class="op">[</span>,<span class="va">mng.col</span><span class="op">]</span>
  <span class="va">chemsprops.Mangroves</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"MangrovesDB"</span>
  <span class="va">chemsprops.Mangroves</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.Mangroves</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://maps.oceanwealth.org/mangrove-restoration/"</span>
  <span class="va">chemsprops.Mangroves</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1088/1748-9326/aabe1c"</span>
  <span class="va">chemsprops.Mangroves</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.Mangroves</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"BD_reported"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Longitude_Adjusted"</span>, <span class="st">"Latitude_Adjusted"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#head(chemsprops.Mangroves)</span>
  <span class="co">#levels(as.factor(mngALL$OK.to.release.))</span>
  <span class="va">mng.rm</span> <span class="op">=</span> <span class="va">chemsprops.Mangroves</span><span class="op">$</span><span class="va">Site.name</span><span class="op">[</span><span class="va">chemsprops.Mangroves</span><span class="op">$</span><span class="va">Site.name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">mngALL</span><span class="op">$</span><span class="va">Site.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="va">mngALL</span><span class="op">$</span><span class="va">OK.to.release.</span>, ignore.case <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.Mangroves</span><span class="op">)</span>
<span class="co">#&gt; [1] 7734   36</span></code></pre></div>
</div>
<div id="cifor-peatland-points" class="section level4" number="5.3.0.15">
<h4>
<span class="header-section-number">5.3.0.15</span> CIFOR peatland points<a class="anchor" aria-label="anchor" href="#cifor-peatland-points"><i class="fas fa-link"></i></a>
</h4>
<p>Peatland soil measurements (points) from the literature described in:</p>
<ul>
<li>Murdiyarso, D., Roman-Cuesta, R. M., Verchot, L. V., Herold, M., Gumbricht, T., Herold, N., &amp; Martius, C. (2017). New map reveals more peat in the tropics (Vol. 189). CIFOR. <a href="https://doi.org/10.17528/cifor/006452" class="uri">https://doi.org/10.17528/cifor/006452</a>
</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.Peatlands"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">cif.hors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/CIFOR_peatlands/SOC_literature_CIFOR.csv"</span><span class="op">)</span>
  <span class="co">#summary(cif.hors$BD..g.cm..)</span>
  <span class="co">#summary(cif.hors$SOC)</span>
  <span class="va">cif.hors</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">cif.hors</span><span class="op">$</span><span class="va">SOC</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">cif.hors</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="va">cif.hors</span><span class="op">$</span><span class="va">c_tot</span> <span class="op">=</span> <span class="va">cif.hors</span><span class="op">$</span><span class="va">TOC.content....</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">cif.hors</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="va">cif.hors</span><span class="op">$</span><span class="va">C.density..kg.C.m..</span>
  <span class="va">cif.hors</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">cif.hors</span><span class="op">$</span><span class="va">year</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>
  <span class="va">cif.col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SOURCEID"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"modelling.x"</span>, <span class="st">"modelling.y"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"Upper"</span>, <span class="st">"Lower"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"BD..g.cm.."</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">cif.col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">cif.col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cif.hors</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">cif.hors</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.Peatlands</span> <span class="op">=</span> <span class="va">cif.hors</span><span class="op">[</span>,<span class="va">cif.col</span><span class="op">]</span>
  <span class="va">chemsprops.Peatlands</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"CIFOR"</span>
  <span class="va">chemsprops.Peatlands</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.Peatlands</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://www.cifor.org/"</span>
  <span class="va">chemsprops.Peatlands</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.17528/cifor/006452"</span>
  <span class="va">chemsprops.Peatlands</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.Peatlands</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"BD..g.cm.."</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"modelling.x"</span>, <span class="st">"modelling.y"</span><span class="op">)</span><span class="op">)</span>  
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.Peatlands</span><span class="op">)</span>
<span class="co">#&gt; [1] 756  36</span></code></pre></div>
</div>
<div id="landpks-observations-1" class="section level4" number="5.3.0.16">
<h4>
<span class="header-section-number">5.3.0.16</span> LandPKS observations<a class="anchor" aria-label="anchor" href="#landpks-observations-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Herrick, J. E., Urama, K. C., Karl, J. W., Boos, J., Johnson, M. V. V., Shepherd, K. D., … &amp; Kosnik, C. (2013). <a href="https://doi.org/10.2489/jswc.68.1.5A">The Global Land-Potential Knowledge System (LandPKS): Supporting Evidence-based, Site-specific Land Use and Management through Cloud Computing, Mobile Applications, and Crowdsourcing</a>. Journal of Soil and Water Conservation, 68(1), 5A-12A. Data download URL: <a href="http://portal.landpotential.org/#/landpksmap" class="uri">http://portal.landpotential.org/#/landpksmap</a>
</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.LandPKS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">pks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/LandPKS/Export_LandInfo_Data.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#str(pks)</span>
  <span class="va">pks.hor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>rock_fragments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pks</span><span class="op">$</span><span class="va">rock_fragments_layer_0_1cm</span>,
                                          <span class="va">pks</span><span class="op">$</span><span class="va">rock_fragments_layer_1_10cm</span>,
                                          <span class="va">pks</span><span class="op">$</span><span class="va">rock_fragments_layer_10_20cm</span>,
                                          <span class="va">pks</span><span class="op">$</span><span class="va">rock_fragments_layer_20_50cm</span>,
                                          <span class="va">pks</span><span class="op">$</span><span class="va">rock_fragments_layer_50_70cm</span>,
                                          <span class="va">pks</span><span class="op">$</span><span class="va">rock_fragments_layer_70_100cm</span>,
                                          <span class="va">pks</span><span class="op">$</span><span class="va">rock_fragments_layer_100_120cm</span><span class="op">)</span>, 
                       tex_field <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pks</span><span class="op">$</span><span class="va">texture_layer_0_1cm</span>, 
                                     <span class="va">pks</span><span class="op">$</span><span class="va">texture_layer_1_10cm</span>, 
                                     <span class="va">pks</span><span class="op">$</span><span class="va">texture_layer_10_20cm</span>, 
                                     <span class="va">pks</span><span class="op">$</span><span class="va">texture_layer_20_50cm</span>, 
                                     <span class="va">pks</span><span class="op">$</span><span class="va">texture_layer_50_70cm</span>, 
                                     <span class="va">pks</span><span class="op">$</span><span class="va">texture_layer_70_100cm</span>, 
                                     <span class="va">pks</span><span class="op">$</span><span class="va">texture_layer_100_120cm</span><span class="op">)</span><span class="op">)</span>
  <span class="va">pks.hor</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">70</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">pks.hor</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">70</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">pks.hor</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">pks</span><span class="op">$</span><span class="va">longitude</span>, <span class="fl">7</span><span class="op">)</span>
  <span class="va">pks.hor</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">pks</span><span class="op">$</span><span class="va">latitude</span>, <span class="fl">7</span><span class="op">)</span>
  <span class="va">pks.hor</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">pks</span><span class="op">$</span><span class="va">modified_date</span>, <span class="fl">7</span><span class="op">)</span>
  <span class="va">pks.hor</span><span class="op">$</span><span class="va">site_key</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">pks</span><span class="op">$</span><span class="va">id</span>, <span class="fl">7</span><span class="op">)</span>
  <span class="co">#summary(as.factor(pks.hor$tex_field))</span>
  <span class="va">tex.tr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>tex_field<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CLAY"</span>, <span class="st">"CLAY LOAM"</span>, <span class="st">"LOAM"</span>, <span class="st">"LOAMY SAND"</span>, <span class="st">"SAND"</span>, <span class="st">"SANDY CLAY"</span>, <span class="st">"SANDY CLAY LOAM"</span>, <span class="st">"SANDY LOAM"</span>, <span class="st">"SILT LOAM"</span>, <span class="st">"SILTY CLAY"</span>, <span class="st">"SILTY CLAY LOAM"</span><span class="op">)</span>, 
                      clay_tot_psa<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">62.4</span>, <span class="fl">34.0</span>, <span class="fl">19.0</span>, <span class="fl">5.8</span>, <span class="fl">3.3</span>, <span class="fl">41.7</span>, <span class="fl">27.0</span>, <span class="fl">10.0</span>, <span class="fl">13.1</span>, <span class="fl">46.7</span>, <span class="fl">34.0</span><span class="op">)</span>, 
                      silt_tot_psa<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">17.8</span>, <span class="fl">34.0</span>, <span class="fl">40.0</span>, <span class="fl">12.0</span>, <span class="fl">5.0</span>, <span class="fl">6.7</span>, <span class="fl">13.0</span>, <span class="fl">25.0</span>, <span class="fl">65.7</span>, <span class="fl">46.7</span>, <span class="fl">56.0</span><span class="op">)</span>, 
                      sand_tot_psa<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19.8</span>, <span class="fl">32.0</span>, <span class="fl">41.0</span>, <span class="fl">82.2</span>, <span class="fl">91.7</span>, <span class="fl">51.6</span>, <span class="fl">60.0</span>, <span class="fl">65.0</span>, <span class="fl">21.2</span>, <span class="fl">6.7</span>, <span class="fl">10.0</span><span class="op">)</span><span class="op">)</span>
  <span class="va">pks.hor</span><span class="op">$</span><span class="va">clay_tot_psa</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">pks.hor</span><span class="op">[</span><span class="st">"tex_field"</span><span class="op">]</span>, <span class="va">tex.tr</span><span class="op">)</span><span class="op">$</span><span class="va">clay_tot_psa</span>
  <span class="va">pks.hor</span><span class="op">$</span><span class="va">silt_tot_psa</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">pks.hor</span><span class="op">[</span><span class="st">"tex_field"</span><span class="op">]</span>, <span class="va">tex.tr</span><span class="op">)</span><span class="op">$</span><span class="va">silt_tot_psa</span>
  <span class="va">pks.hor</span><span class="op">$</span><span class="va">sand_tot_psa</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">pks.hor</span><span class="op">[</span><span class="st">"tex_field"</span><span class="op">]</span>, <span class="va">tex.tr</span><span class="op">)</span><span class="op">$</span><span class="va">sand_tot_psa</span>
  <span class="co">#summary(as.factor(pks.hor$rock_fragments))</span>
  <span class="va">pks.hor</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">pks.hor</span><span class="op">$</span><span class="va">rock_fragments</span><span class="op">==</span><span class="st">"&gt;60%"</span>, <span class="fl">65</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">pks.hor</span><span class="op">$</span><span class="va">rock_fragments</span><span class="op">==</span><span class="st">"35-60%"</span>, <span class="fl">47.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">pks.hor</span><span class="op">$</span><span class="va">rock_fragments</span><span class="op">==</span><span class="st">"15-35%"</span>, <span class="fl">25</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">pks.hor</span><span class="op">$</span><span class="va">rock_fragments</span><span class="op">==</span><span class="st">"1-15%"</span> <span class="op">|</span> <span class="va">pks.hor</span><span class="op">$</span><span class="va">rock_fragments</span><span class="op">==</span><span class="st">"0-15%"</span>, <span class="fl">7.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">pks.hor</span><span class="op">$</span><span class="va">rock_fragments</span><span class="op">==</span><span class="st">"0-1%"</span>, <span class="fl">0.5</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#head(pks.hor)</span>
  <span class="co">#plot(pks.hor[,c("longitude_decimal_degrees","latitude_decimal_degrees")])</span>
  <span class="va">pks.col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>,<span class="st">"hzn_top"</span>,<span class="st">"hzn_bot"</span>,<span class="st">"hzn_desgn"</span>, <span class="st">"tex_field"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">pks.col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">pks.col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pks.hor</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">pks.hor</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.LandPKS</span> <span class="op">=</span> <span class="va">pks.hor</span><span class="op">[</span>,<span class="va">pks.col</span><span class="op">]</span>
  <span class="va">chemsprops.LandPKS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"LandPKS"</span>
  <span class="va">chemsprops.LandPKS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">8</span>
  <span class="va">chemsprops.LandPKS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://portal.landpotential.org"</span>
  <span class="va">chemsprops.LandPKS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.2489/jswc.68.1.5A"</span>
  <span class="va">chemsprops.LandPKS</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.LandPKS</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"clay_tot_psa"</span>,<span class="st">"wpg2"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.LandPKS</span><span class="op">)</span>
<span class="co">#&gt; [1] 41644    36</span></code></pre></div>
</div>
<div id="egrpr" class="section level4" number="5.3.0.17">
<h4>
<span class="header-section-number">5.3.0.17</span> EGRPR<a class="anchor" aria-label="anchor" href="#egrpr"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<a href="http://egrpr.esoil.ru/">Russian Federation: The Unified State Register of Soil Resources (EGRPR)</a>. Data download URL: <a href="http://egrpr.esoil.ru/content/1DB.html" class="uri">http://egrpr.esoil.ru/content/1DB.html</a>
</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.EGRPR"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">russ.HOR</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Russia/EGRPR/Russia_EGRPR_soil_pedons.csv"</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SOURCEID</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">russ.HOR</span><span class="op">$</span><span class="va">CardID</span>, <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SOIL_ID</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSTNS</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SNDPPT</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSAF</span> <span class="op">+</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXSCM</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SLTPPT</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSIC</span> <span class="op">+</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSIM</span> <span class="op">+</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSIF</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSIF</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">CLYPPT</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTCL</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSIF</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">russ.HOR</span><span class="op">$</span><span class="va">TEXTSIF</span><span class="op">)</span>
  <span class="co">## Correct texture fractions:</span>
  <span class="va">sumTex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">russ.HOR</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SLTPPT"</span>,<span class="st">"CLYPPT"</span>,<span class="st">"SNDPPT"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SNDPPT</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SNDPPT</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">sumTex</span> <span class="op">-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">CLYPPT</span><span class="op">)</span> <span class="op">/</span><span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">CLYPPT</span><span class="op">)</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SLTPPT</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">SLTPPT</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">sumTex</span> <span class="op">-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">CLYPPT</span><span class="op">)</span> <span class="op">/</span><span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">CLYPPT</span><span class="op">)</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x1<span class="op">=</span><span class="va">russ.HOR</span><span class="op">$</span><span class="va">CORG</span> <span class="op">*</span> <span class="fl">10</span>, x2<span class="op">=</span><span class="va">russ.HOR</span><span class="op">$</span><span class="va">ORGMAT</span><span class="op">/</span><span class="fl">1.724</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">russ.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">DVOL</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">russ.HOR</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">russ.HOR</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">n_tot</span> <span class="op">&lt;-</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">NTOT</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">ca_ext</span> <span class="op">=</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">EXCA</span> <span class="op">*</span> <span class="fl">200</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">mg_ext</span> <span class="op">=</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">EXMG</span> <span class="op">*</span> <span class="fl">121</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">na_ext</span> <span class="op">=</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">EXNA</span> <span class="op">*</span> <span class="fl">230</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">k_ext</span> <span class="op">=</span> <span class="va">russ.HOR</span><span class="op">$</span><span class="va">EXK</span> <span class="op">*</span> <span class="fl">391</span>
  <span class="co">## Sampling year not available but with high confidence &lt;2000</span>
  <span class="va">russ.HOR</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="st">"1982"</span>
  <span class="va">russ.sel.h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SOURCEID"</span>, <span class="st">"SOIL_ID"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"LONG"</span>, <span class="st">"LAT"</span>, <span class="st">"labsampnum"</span>, <span class="st">"HORNMB"</span>, <span class="st">"HORTOP"</span>, <span class="st">"HORBOT"</span>, <span class="st">"HISMMN"</span>, <span class="st">"tex_psda"</span>, <span class="st">"CLYPPT"</span>, <span class="st">"SLTPPT"</span>, <span class="st">"SNDPPT"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"NTOT"</span>, <span class="st">"PHSLT"</span>, <span class="st">"PHH2O"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"CECST"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"DVOL"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">russ.sel.h</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">russ.sel.h</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">russ.HOR</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">russ.HOR</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.EGRPR</span> <span class="op">=</span> <span class="va">russ.HOR</span><span class="op">[</span>,<span class="va">russ.sel.h</span><span class="op">]</span>
  <span class="va">chemsprops.EGRPR</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Russia_EGRPR"</span>
  <span class="va">chemsprops.EGRPR</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.EGRPR</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://egrpr.esoil.ru/"</span>
  <span class="va">chemsprops.EGRPR</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.19047/0136-1694-2016-86-115-123"</span>
  <span class="va">chemsprops.EGRPR</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.EGRPR</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"CLYPPT"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LONG"</span>, <span class="st">"LAT"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.EGRPR</span><span class="op">)</span>
<span class="co">#&gt; [1] 4437   36</span></code></pre></div>
</div>
<div id="canada-national-pedon-db" class="section level4" number="5.3.0.18">
<h4>
<span class="header-section-number">5.3.0.18</span> Canada National Pedon DB<a class="anchor" aria-label="anchor" href="#canada-national-pedon-db"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>
<a href="https://open.canada.ca/data/en/dataset/6457fad6-b6f5-47a3-9bd1-ad14aea4b9e0">Agriculture and Agri-Food Canada National Pedon Database</a>. Data download URL: <a href="https://open.canada.ca/data/en/" class="uri">https://open.canada.ca/data/en/</a>
</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.NPDB"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">NPDB.nm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NPDB_V2_sum_source_info.csv"</span>,<span class="st">"NPDB_V2_sum_chemical.csv"</span>, <span class="st">"NPDB_V2_sum_horizons_raw.csv"</span>, <span class="st">"NPDB_V2_sum_physical.csv"</span><span class="op">)</span>
  <span class="va">NPDB.HOR</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join_all.html">join_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Canada/NPDB/"</span>, <span class="va">NPDB.nm</span><span class="op">)</span>, <span class="va">read.csv</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span>
  <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">HISMMN</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">HZN_MAS</span>, <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">HZN_SUF</span>, <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">HZN_MOD</span><span class="op">)</span>
  <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">CARB_ORG</span><span class="op">[</span><span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">CARB_ORG</span><span class="op">==</span><span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">N_TOTAL</span><span class="op">[</span><span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">N_TOTAL</span><span class="op">==</span><span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">CARB_ORG</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">BULK_DEN</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">VC_SAND</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">VC_SAND</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">ca_ext</span> <span class="op">=</span> <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">EXCH_CA</span> <span class="op">*</span> <span class="fl">200</span>
  <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">mg_ext</span> <span class="op">=</span> <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">EXCH_MG</span> <span class="op">*</span> <span class="fl">121</span>
  <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">na_ext</span> <span class="op">=</span> <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">EXCH_NA</span> <span class="op">*</span> <span class="fl">230</span>
  <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">k_ext</span> <span class="op">=</span> <span class="va">NPDB.HOR</span><span class="op">$</span><span class="va">EXCH_K</span> <span class="op">*</span> <span class="fl">391</span>
  <span class="va">npdb.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PEDON_ID"</span>, <span class="st">"usiteid"</span>, <span class="st">"CAL_YEAR"</span>, <span class="st">"DD_LONG"</span>, <span class="st">"DD_LAT"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"U_DEPTH"</span>, <span class="st">"L_DEPTH"</span>, <span class="st">"HISMMN"</span>, <span class="st">"tex_psda"</span>, <span class="st">"T_CLAY"</span>, <span class="st">"T_SILT"</span>, <span class="st">"T_SAND"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"N_TOTAL"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"PH_H2O"</span>, <span class="st">"PH_CACL2"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"VC_SAND"</span>, <span class="st">"BULK_DEN"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">npdb.sel.h</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">npdb.sel.h</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">NPDB.HOR</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">NPDB.HOR</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.NPDB</span> <span class="op">=</span> <span class="va">NPDB.HOR</span><span class="op">[</span>,<span class="va">npdb.sel.h</span><span class="op">]</span>
  <span class="va">chemsprops.NPDB</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Canada_NPDB"</span>
  <span class="va">chemsprops.NPDB</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.NPDB</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://open.canada.ca/data/en/"</span>
  <span class="va">chemsprops.NPDB</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://open.canada.ca/data/en/dataset/6457fad6-b6f5-47a3-9bd1-ad14aea4b9e0"</span>
  <span class="va">chemsprops.NPDB</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.NPDB</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"PH_H2O"</span>, <span class="st">"T_CLAY"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DD_LONG"</span>, <span class="st">"DD_LAT"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.NPDB</span><span class="op">)</span>
<span class="co">#&gt; [1] 15946    36</span></code></pre></div>
</div>
<div id="canadian-upland-forest-soil-profile-and-carbon-stocks-database-1" class="section level4" number="5.3.0.19">
<h4>
<span class="header-section-number">5.3.0.19</span> Canadian upland forest soil profile and carbon stocks database<a class="anchor" aria-label="anchor" href="#canadian-upland-forest-soil-profile-and-carbon-stocks-database-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Shaw, C., Hilger, A., Filiatrault, M., &amp; Kurz, W. (2018). <a href="https://doi.org/10.1002/ecy.2159">A Canadian upland forest soil profile and carbon stocks database</a>. Ecology, 99(4), 989-989. Data download URL: <a href="https://esajournals.onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fecy.2159&amp;file=ecy2159-sup-0001-DataS1.zip" class="uri">https://esajournals.onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fecy.2159&amp;file=ecy2159-sup-0001-DataS1.zip</a>
</li>
</ul>
<p>*Organic horizons have negative values, the first mineral soil horizon has a value of 0 cm, and other mineral soil horizons have positive values. This needs to be corrected before the values can be bind with other international sets.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.CUFS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">## Reading of the .dat file was tricky </span>
  <span class="va">cufs.HOR</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Canada/CUFSDB/PROFILES.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">LOWER_HZN_LIMIT</span> <span class="op">=</span><span class="va">cufs.HOR</span><span class="op">$</span><span class="va">UPPER_HZN_LIMIT</span> <span class="op">+</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">HZN_THICKNESS</span>
  <span class="co">## Correct depth (Canadian data can have negative depths for soil horizons):</span>
  <span class="va">z.min.cufs</span> <span class="op">&lt;-</span> <span class="fu">ddply</span><span class="op">(</span><span class="va">cufs.HOR</span>, <span class="fu">.</span><span class="op">(</span><span class="va">LOCATION_ID</span><span class="op">)</span>, <span class="va">summarize</span>, aggregated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">UPPER_HZN_LIMIT</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="va">z.shift.cufs</span> <span class="op">&lt;-</span> <span class="fu">join</span><span class="op">(</span><span class="va">cufs.HOR</span><span class="op">[</span><span class="st">"LOCATION_ID"</span><span class="op">]</span>, <span class="va">z.min.cufs</span>, type<span class="op">=</span><span class="st">"left"</span><span class="op">)</span><span class="op">$</span><span class="va">aggregated</span>
  <span class="co">## fixed shift</span>
  <span class="va">z.shift.cufs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">z.shift.cufs</span><span class="op">&gt;</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="va">z.shift.cufs</span><span class="op">)</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">&lt;-</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">UPPER_HZN_LIMIT</span> <span class="op">-</span> <span class="va">z.shift.cufs</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">&lt;-</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">LOWER_HZN_LIMIT</span> <span class="op">-</span> <span class="va">z.shift.cufs</span>
  <span class="va">cufs.SITE</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Canada/CUFSDB/SITES.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">cufs.HOR</span><span class="op">[</span><span class="st">"LOCATION_ID"</span><span class="op">]</span>, <span class="va">cufs.SITE</span><span class="op">)</span><span class="op">$</span><span class="va">LONGITUDE</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">cufs.HOR</span><span class="op">[</span><span class="st">"LOCATION_ID"</span><span class="op">]</span>, <span class="va">cufs.SITE</span><span class="op">)</span><span class="op">$</span><span class="va">LATITUDE</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">cufs.HOR</span><span class="op">[</span><span class="st">"LOCATION_ID"</span><span class="op">]</span>, <span class="va">cufs.SITE</span><span class="op">)</span><span class="op">$</span><span class="va">YEAR_SAMPLED</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">usiteid</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">cufs.HOR</span><span class="op">[</span><span class="st">"LOCATION_ID"</span><span class="op">]</span>, <span class="va">cufs.SITE</span><span class="op">)</span><span class="op">$</span><span class="va">RELEASE_SOURCE_SITEID</span>
  <span class="co">#summary(cufs.HOR$ORG_CARB_PCT)</span>
  <span class="co">#hist(cufs.HOR$ORG_CARB_PCT, breaks=45)</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">ORG_CARB_PCT</span><span class="op">*</span><span class="fl">10</span>
  <span class="co">#cufs.HOR$c_tot = cufs.HOR$oc + ifelse(is.na(cufs.HOR$CARBONATE_CARB_PCT), 0, cufs.HOR$CARBONATE_CARB_PCT*10)</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">n_tot</span> <span class="op">=</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">TOT_NITRO_PCT</span><span class="op">*</span><span class="fl">10</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">ca_ext</span> <span class="op">=</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">EXCH_Ca</span> <span class="op">*</span> <span class="fl">200</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">mg_ext</span> <span class="op">=</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">EXCH_Mg</span> <span class="op">*</span> <span class="fl">121</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">na_ext</span> <span class="op">=</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">EXCH_Na</span> <span class="op">*</span> <span class="fl">230</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">k_ext</span> <span class="op">=</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">EXCH_K</span> <span class="op">*</span> <span class="fl">391</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">ph_cacl2</span> <span class="op">=</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">pH</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">ph_cacl2</span><span class="op">[</span><span class="op">!</span><span class="va">cufs.HOR</span><span class="op">$</span><span class="va">pH_H2O_CACL2</span><span class="op">==</span><span class="st">"CACL2"</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">ph_h2o</span> <span class="op">=</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">pH</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">ph_h2o</span><span class="op">[</span><span class="op">!</span><span class="va">cufs.HOR</span><span class="op">$</span><span class="va">pH_H2O_CACL2</span><span class="op">==</span><span class="st">"H2O"</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="co">#summary(cufs.HOR$CF_VOL_PCT) ## is NA == 0??</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">cufs.HOR</span><span class="op">$</span><span class="va">CF_CORR_FACTOR</span><span class="op">==</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">CF_VOL_PCT</span><span class="op">)</span>
  <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">cufs.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">BULK_DENSITY</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">cufs.HOR</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">cufs.HOR</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">cufs.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LOCATION_ID"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"labsampnum"</span>, <span class="st">"HZN_SEQ_NO"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"HORIZON"</span>, <span class="st">"TEXT_CLASS"</span>, <span class="st">"CLAY_PCT"</span>, <span class="st">"SILT_PCT"</span>, <span class="st">"SAND_PCT"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"CEC_CALCULATED"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"BULK_DENSITY"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ELEC_COND"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">cufs.sel.h</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">cufs.sel.h</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cufs.HOR</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">cufs.HOR</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.CUFS</span> <span class="op">=</span> <span class="va">cufs.HOR</span><span class="op">[</span>,<span class="va">cufs.sel.h</span><span class="op">]</span>
  <span class="va">chemsprops.CUFS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Canada_CUFS"</span>
  <span class="va">chemsprops.CUFS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">chemsprops.CUFS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://cfs.nrcan.gc.ca/publications/centre/nofc"</span>
  <span class="va">chemsprops.CUFS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1002/ecy.2159"</span>
  <span class="va">chemsprops.CUFS</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.CUFS</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"CLAY_PCT"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.CUFS</span><span class="op">)</span>
<span class="co">#&gt; [1] 15162    36</span></code></pre></div>
</div>
<div id="permafrost-in-subarctic-canada-1" class="section level4" number="5.3.0.20">
<h4>
<span class="header-section-number">5.3.0.20</span> Permafrost in subarctic Canada<a class="anchor" aria-label="anchor" href="#permafrost-in-subarctic-canada-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Estop-Aragones, C.; Fisher, J.P.; Cooper, M.A.; Thierry, A.; Treharne, R.; Murton, J.B.; Phoenix, G.K.; Charman, D.J.; Williams, M.; Hartley, I.P. (2016). Bulk density, carbon and nitrogen content in soil profiles from permafrost in subarctic Canada. NERC Environmental Information Data Centre. <a href="https://doi.org/10.5285/efa2a84b-3505-4221-a7da-12af3cdc1952" class="uri">https://doi.org/10.5285/efa2a84b-3505-4221-a7da-12af3cdc1952</a>. Data download URL:</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.CAPERM"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">caperm.HOR</span> <span class="op">=</span> <span class="fu">vroom</span><span class="fu">::</span><span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Canada/NorthCanada/Bulk_density_CandNcontent_profiles_all_sites.csv"</span><span class="op">)</span>
  <span class="co">#measurements::conv_unit("-99 36 15.7", from = "deg_min_sec", to = "dec_deg")</span>
  <span class="co">#caperm.HOR$longitude_decimal_degrees = as.numeric(measurements::conv_unit(paste0("-", gsub('\"W', '', gsub("'", ' ', iconv(caperm.HOR$Coordinates_West, "UTF-8", "UTF-8", sub=' ')), fixed = TRUE)), from = "deg_min_sec", to = "dec_deg"))</span>
  <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">measurements</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/measurements/man/conv_unit.html">conv_unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">Cordinates_West</span><span class="op">)</span>, from <span class="op">=</span> <span class="st">"deg_min_sec"</span>, to <span class="op">=</span> <span class="st">"dec_deg"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#caperm.HOR$latitude_decimal_degrees = as.numeric(measurements::conv_unit(gsub('\"N', '', gsub('o', '', gsub("'", ' ', iconv(caperm.HOR$Coordinates_North, "UTF-8", "UTF-8", sub=' '))), fixed = TRUE), from = "deg_min_sec", to = "dec_deg"))</span>
  <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">measurements</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/measurements/man/conv_unit.html">conv_unit</a></span><span class="op">(</span><span class="va">caperm.HOR</span><span class="op">$</span><span class="va">Cordinates_North</span>, from <span class="op">=</span> <span class="st">"deg_min_sec"</span>, to <span class="op">=</span> <span class="st">"dec_deg"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#plot(caperm.HOR[,c("longitude_decimal_degrees","latitude_decimal_degrees")])</span>
  <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="st">"2013"</span>
  <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">site_key</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/make.unique.html">make.unique</a></span><span class="op">(</span><span class="va">caperm.HOR</span><span class="op">$</span><span class="va">Soil.core</span><span class="op">)</span>
  <span class="co">#summary(as.factor(caperm.HOR$Soil_depth_cm))</span>
  <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">Soil_depth_cm</span><span class="op">-</span><span class="fl">1</span>
  <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">Soil_depth_cm</span><span class="op">+</span><span class="fl">1</span>
  <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">db_od</span> <span class="op">=</span> <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">Bulk_density_gdrysoil_cm3wetsoil</span>
  <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">Ccontent_percentage_on_drymass</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">n_tot</span> <span class="op">=</span> <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">Ncontent_percentage_on_drymass</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">caperm.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">caperm.HOR</span><span class="op">$</span><span class="va">db_od</span> <span class="op">*</span> <span class="fl">1000</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">col.names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">col.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">caperm.HOR</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">caperm.HOR</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.CAPERM</span> <span class="op">=</span> <span class="va">caperm.HOR</span><span class="op">[</span>,<span class="va">col.names</span><span class="op">]</span>
  <span class="va">chemsprops.CAPERM</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Canada_subarctic"</span>
  <span class="va">chemsprops.CAPERM</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.CAPERM</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://arp.arctic.ac.uk/projects/carbon-cycling-linkages-permafrost-systems-cyclops/"</span>
  <span class="va">chemsprops.CAPERM</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.5285/efa2a84b-3505-4221-a7da-12af3cdc1952"</span>
  <span class="va">chemsprops.CAPERM</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.CAPERM</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"n_tot"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.CAPERM</span><span class="op">)</span>
<span class="co">#&gt; [1] 1180   36</span></code></pre></div>
</div>
<div id="soter-china-soil-profiles" class="section level4" number="5.3.0.21">
<h4>
<span class="header-section-number">5.3.0.21</span> SOTER China soil profiles<a class="anchor" aria-label="anchor" href="#soter-china-soil-profiles"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Dijkshoorn, K., van Engelen, V., &amp; Huting, J. (2008). <a href="https://isric.org/sites/default/files/isric_report_2008_06.pdf">Soil and landform properties for LADA partner countries</a>. ISRIC report 2008/06 and GLADA report 2008/03, ISRIC – World Soil Information and FAO, Wageningen. Data download URL: <a href="https://files.isric.org/public/soter/CN-SOTER.zip" class="uri">https://files.isric.org/public/soter/CN-SOTER.zip</a>
</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.CNSOTER"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">sot.sites</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/China/China_SOTERv1/CHINA_SOTERv1_Profile.csv"</span><span class="op">)</span>
  <span class="va">sot.horizons</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/China/China_SOTERv1/CHINA_SOTERv1_Horizon.csv"</span><span class="op">)</span>
  <span class="va">sot.HOR</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join_all.html">join_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">sot.sites</span>, <span class="va">sot.horizons</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span>
  <span class="va">sot.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">sot.HOR</span><span class="op">$</span><span class="va">SOCA</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">sot.HOR</span><span class="op">$</span><span class="va">ca_ext</span> <span class="op">=</span> <span class="va">sot.HOR</span><span class="op">$</span><span class="va">EXCA</span> <span class="op">*</span> <span class="fl">200</span>
  <span class="va">sot.HOR</span><span class="op">$</span><span class="va">mg_ext</span> <span class="op">=</span> <span class="va">sot.HOR</span><span class="op">$</span><span class="va">EXMG</span> <span class="op">*</span> <span class="fl">121</span>
  <span class="va">sot.HOR</span><span class="op">$</span><span class="va">na_ext</span> <span class="op">=</span> <span class="va">sot.HOR</span><span class="op">$</span><span class="va">EXNA</span> <span class="op">*</span> <span class="fl">230</span>
  <span class="va">sot.HOR</span><span class="op">$</span><span class="va">k_ext</span> <span class="op">=</span> <span class="va">sot.HOR</span><span class="op">$</span><span class="va">EXCK</span> <span class="op">*</span> <span class="fl">391</span>
  <span class="co">## upper depth missing needs to be derived manually</span>
  <span class="va">sot.HOR</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="va">sot.HOR</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sot.HOR</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sot.HOR</span><span class="op">$</span><span class="va">HBDE</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sot.HOR</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>
  <span class="va">sot.HOR</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">sot.HOR</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">&gt;</span> <span class="va">sot.HOR</span><span class="op">$</span><span class="va">HBDE</span>, <span class="fl">0</span>, <span class="va">sot.HOR</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span>
  <span class="va">sot.HOR</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">sot.HOR</span><span class="op">$</span><span class="va">HONU</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sot.HOR</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">sot.HOR</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span>
  <span class="va">sot.HOR</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">sot.HOR</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">sot.HOR</span><span class="op">$</span><span class="va">BULK</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sot.HOR</span><span class="op">$</span><span class="va">SDVC</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">sot.HOR</span><span class="op">$</span><span class="va">SDVC</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">sot.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PRID"</span>, <span class="st">"PDID"</span>, <span class="st">"SAYR"</span>, <span class="st">"LNGI"</span>, <span class="st">"LATI"</span>, <span class="st">"labsampnum"</span>, <span class="st">"HONU"</span>, <span class="st">"hzn_top"</span>,<span class="st">"HBDE"</span>,<span class="st">"HODE"</span>, <span class="st">"PSCL"</span>, <span class="st">"CLPC"</span>, <span class="st">"STPC"</span>, <span class="st">"SDTO"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"TOTC"</span>, <span class="st">"TOTN"</span>, <span class="st">"PHKC"</span>, <span class="st">"PHAQ"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"CECS"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"SDVC"</span>, <span class="st">"BULK"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">sot.sel.h</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">sot.sel.h</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sot.HOR</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">sot.HOR</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.CNSOT</span> <span class="op">=</span> <span class="va">sot.HOR</span><span class="op">[</span>,<span class="va">sot.sel.h</span><span class="op">]</span>
  <span class="va">chemsprops.CNSOT</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"China_SOTER"</span>
  <span class="va">chemsprops.CNSOT</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">8</span>
  <span class="va">chemsprops.CNSOT</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://www.isric.org/explore/soter"</span>
  <span class="va">chemsprops.CNSOT</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://isric.org/sites/default/files/isric_report_2008_06.pdf"</span>
  <span class="va">chemsprops.CNSOT</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.CNSOT</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TOTC"</span>, <span class="st">"PHAQ"</span>, <span class="st">"CLPC"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LNGI"</span>, <span class="st">"LATI"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; Joining by: PRID, INFR</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.CNSOT</span><span class="op">)</span>
<span class="co">#&gt; [1] 5105   36</span></code></pre></div>
</div>
<div id="sislac" class="section level4" number="5.3.0.22">
<h4>
<span class="header-section-number">5.3.0.22</span> SISLAC<a class="anchor" aria-label="anchor" href="#sislac"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Sistema de Información de Suelos de Latinoamérica (SISLAC), Data download URL: <a href="http://54.229.242.119/sislac/es" class="uri">http://54.229.242.119/sislac/es</a>
</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.SISLAC"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">sis.hor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/SA/SISLAC/sislac_profiles_es.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#str(sis.hor)</span>
  <span class="co">## SOC for Urugvay do not match the original soil profile data (see e.g. http://www.mgap.gub.uy/sites/default/files/multimedia/skmbt_c45111090914030.pdf)</span>
  <span class="co">## compare with:</span>
  <span class="co">#sis.hor[sis.hor$perfil_id=="23861",]</span>
  <span class="co">## Subset to SISINTA/WOSIS points:</span>
  <span class="va">cor.sel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"WoSIS"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">sis.hor</span><span class="op">$</span><span class="va">perfil_numero</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"SISINTA"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">sis.hor</span><span class="op">$</span><span class="va">perfil_numero</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#length(cor.sel)</span>
  <span class="va">sis.hor</span> <span class="op">=</span> <span class="va">sis.hor</span><span class="op">[</span><span class="va">cor.sel</span>,<span class="op">]</span>
  <span class="co">#summary(sis.hor$analitico_carbono_organico_c)</span>
  <span class="va">sis.hor</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">sis.hor</span><span class="op">$</span><span class="va">analitico_carbono_organico_c</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">sis.hor</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">sis.hor</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">sis.hor</span><span class="op">$</span><span class="va">analitico_densidad_aparente</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sis.hor</span><span class="op">$</span><span class="va">analitico_gravas</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">sis.hor</span><span class="op">$</span><span class="va">analitico_gravas</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#summary(sis.hor$analitico_base_k)</span>
  <span class="co">#summary(as.factor(sis.hor$perfil_fecha))</span>
  <span class="va">sis.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"perfil_id"</span>, <span class="st">"perfil_numero"</span>, <span class="st">"perfil_fecha"</span>, <span class="st">"perfil_ubicacion_longitud"</span>, <span class="st">"perfil_ubicacion_latitud"</span>, <span class="st">"id"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"profundidad_superior"</span>, <span class="st">"profundidad_inferior"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"analitico_arcilla"</span>, <span class="st">"analitico_limo_2_50"</span>, <span class="st">"analitico_arena_total"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"analitico_ph_kcl"</span>, <span class="st">"analitico_ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"analitico_gravas"</span>, <span class="st">"analitico_densidad_aparente"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"analitico_conductividad"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">sis.sel.h</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">sis.sel.h</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sis.hor</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">sis.hor</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.SISLAC</span> <span class="op">=</span> <span class="va">sis.hor</span><span class="op">[</span>,<span class="va">sis.sel.h</span><span class="op">]</span>
  <span class="va">chemsprops.SISLAC</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"SISLAC"</span>
  <span class="va">chemsprops.SISLAC</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.SISLAC</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://54.229.242.119/sislac/es"</span>
  <span class="va">chemsprops.SISLAC</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://hdl.handle.net/10568/49611"</span>
  <span class="va">chemsprops.SISLAC</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.SISLAC</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"analitico_ph_kcl"</span>,<span class="st">"analitico_arcilla"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"perfil_ubicacion_longitud"</span>, <span class="st">"perfil_ubicacion_latitud"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.SISLAC</span><span class="op">)</span>
<span class="co">#&gt; [1] 49994    36</span></code></pre></div>
</div>
<div id="febr" class="section level4" number="5.3.0.23">
<h4>
<span class="header-section-number">5.3.0.23</span> FEBR<a class="anchor" aria-label="anchor" href="#febr"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Samuel-Rosa, A., Dalmolin, R. S. D., Moura-Bueno, J. M., Teixeira, W. G., &amp; Alba, J. M. F. (2020). Open legacy soil survey data in Brazil: geospatial data quality and how to improve it. Scientia Agricola, 77(1). <a href="https://doi.org/10.1590/1678-992x-2017-0430" class="uri">https://doi.org/10.1590/1678-992x-2017-0430</a>
</li>
<li>Free Brazilian Repository for Open Soil Data – febr. Data download URL: <a href="http://www.ufsm.br/febr/" class="uri">http://www.ufsm.br/febr/</a>
</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.FEBR"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#library(febr)</span>
  <span class="co">## download up-to-date copy of data</span>
  <span class="co">#febr.lab = febr::layer(dataset = "all", variable="all")</span>
  <span class="co">#febr.lab = febr::observation(dataset = "all")</span>
  <span class="va">febr.hor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Brasil/FEBR/febr-superconjunto.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, dec <span class="op">=</span> <span class="st">","</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span>
  <span class="co">#head(febr.hor)</span>
  <span class="co">#summary(febr.hor$carbono)</span>
  <span class="co">#summary(febr.hor$ph)</span>
  <span class="co">#summary(febr.hor$dsi) ## bulk density of total soil</span>
  <span class="va">febr.hor</span><span class="op">$</span><span class="va">clay_tot_psa</span> <span class="op">=</span> <span class="va">febr.hor</span><span class="op">$</span><span class="va">argila</span> <span class="op">/</span><span class="fl">10</span>
  <span class="va">febr.hor</span><span class="op">$</span><span class="va">sand_tot_psa</span> <span class="op">=</span> <span class="va">febr.hor</span><span class="op">$</span><span class="va">areia</span> <span class="op">/</span><span class="fl">10</span>
  <span class="va">febr.hor</span><span class="op">$</span><span class="va">silt_tot_psa</span> <span class="op">=</span> <span class="va">febr.hor</span><span class="op">$</span><span class="va">silte</span> <span class="op">/</span><span class="fl">10</span>
  <span class="va">febr.hor</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1000</span><span class="op">-</span><span class="va">febr.hor</span><span class="op">$</span><span class="va">terrafina</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span>
  <span class="va">febr.hor</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">febr.hor</span><span class="op">$</span><span class="va">carbono</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">febr.hor</span><span class="op">$</span><span class="va">dsi</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">febr.hor</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">febr.hor</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">febr.sel.h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"observacao_id"</span>, <span class="st">"usiteid"</span>, <span class="st">"observacao_data"</span>, <span class="st">"coord_x"</span>, <span class="st">"coord_y"</span>, <span class="st">"sisb_id"</span>, <span class="st">"camada_id"</span>, <span class="st">"profund_sup"</span>, <span class="st">"profund_inf"</span>, <span class="st">"camada_nome"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"carbono"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"nitrogenio"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"dsi"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ce"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">febr.sel.h</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">febr.sel.h</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">febr.hor</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">febr.hor</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.FEBR</span> <span class="op">=</span> <span class="va">febr.hor</span><span class="op">[</span>,<span class="va">febr.sel.h</span><span class="op">]</span>
  <span class="va">chemsprops.FEBR</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"FEBR"</span>
  <span class="va">chemsprops.FEBR</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.FEBR</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://www.ufsm.br/febr/"</span>
  <span class="va">chemsprops.FEBR</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1590/1678-992x-2017-0430"</span>
  <span class="va">chemsprops.FEBR</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.FEBR</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"carbono"</span>,<span class="st">"ph"</span>,<span class="st">"clay_tot_psa"</span>,<span class="st">"dsi"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"coord_x"</span>, <span class="st">"coord_y"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.FEBR</span><span class="op">)</span>
<span class="co">#&gt; [1] 7842   36</span></code></pre></div>
</div>
<div id="pronasolos" class="section level4" number="5.3.0.24">
<h4>
<span class="header-section-number">5.3.0.24</span> PRONASOLOS<a class="anchor" aria-label="anchor" href="#pronasolos"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>POLIDORO, J., COELHO, M., CARVALHO FILHO, A. D., LUMBRERAS, J., de OLIVEIRA, A. P., VASQUES, G. D. M., … &amp; BREFIN, M. (2021). <a href="https://www.infoteca.cnptia.embrapa.br/infoteca/handle/doc/1135056">Programa Nacional de Levantamento e Interpretação de Solos do Brasil (PronaSolos): diretrizes para implementação</a>. Embrapa Solos-Documentos (INFOTECA-E).</li>
<li>Download URL: <a href="http://geoinfo.cnps.embrapa.br/documents/3013/download" class="uri">http://geoinfo.cnps.embrapa.br/documents/3013/download</a>
</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.PRONASOLOS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">pronas.hor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Brasil/Pronasolos/Perfis_PronaSolos_20201202v2.shp"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">## 34,464 rows</span>
  <span class="co">#head(pronas.hor)</span>
  <span class="co">#summary(as.numeric(pronas.hor$carbono_or))</span>
  <span class="co">#summary(as.numeric(pronas.hor$densidade_))</span>
  <span class="co">#summary(as.numeric(pronas.hor$argila))</span>
  <span class="co">#summary(as.numeric(pronas.hor$cascalho))</span>
  <span class="co">#summary(as.numeric(pronas.hor$ph_h2o))</span>
  <span class="co">#summary(as.numeric(pronas.hor$complexo_2))</span>
  <span class="co">## A lot of errors / typos e.g. very high values and 0 values!!</span>
  <span class="co">#pronas.hor$data_colet[1:50]</span>
  <span class="va">pronas.in.name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sigla"</span>, <span class="st">"codigo_pon"</span>, <span class="st">"data_colet"</span>, <span class="st">"gcs_latitu"</span>, <span class="st">"gcs_longit"</span>, <span class="st">"simbolo_ho"</span>, <span class="st">"profundida"</span>, 
                     <span class="st">"profundi_1"</span>, <span class="st">"cascalho"</span>, <span class="st">"areia_tota"</span>, <span class="st">"silte"</span>, <span class="st">"argila"</span>, <span class="st">"densidade_"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_kcl"</span>, 
                     <span class="st">"complexo_s"</span>, <span class="st">"complexo_1"</span>, <span class="st">"complexo_2"</span>, <span class="st">"complexo_3"</span>, <span class="st">"valor_s"</span>, <span class="st">"carbono_or"</span>, <span class="st">"nitrogenio"</span>,
                     <span class="st">"condutivid"</span>, <span class="st">"classe_tex"</span><span class="op">)</span>
  <span class="co">#pronas.in.name[which(!pronas.in.name %in% names(pronas.hor))]</span>
  <span class="va">pronas.x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">pronas.hor</span><span class="op">[</span>,<span class="va">pronas.in.name</span><span class="op">]</span><span class="op">)</span>
  <span class="va">pronas.out.name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"longitude_decimal_degrees"</span>,
                      <span class="st">"hzn_desgn"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_top"</span>, <span class="st">"wpg2"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, 
                      <span class="st">"clay_tot_psa"</span>, <span class="st">"db_od"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ca_ext"</span>,
                      <span class="st">"mg_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"cec_sum"</span>, <span class="st">"oc"</span>, <span class="st">"n_tot"</span>, <span class="st">"ec_satp"</span>, <span class="st">"tex_psda"</span><span class="op">)</span>
  <span class="co">## translate values</span>
  <span class="va">pronas.fun.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"as.numeric(x)*1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"sigla"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"paste(x)"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"codigo_pon"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"paste(x)"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"data_colet"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"paste(x)"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"simbolo_ho"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"paste(x)"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"classe_tex"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"paste(x)"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"complexo_s"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"as.numeric(x)*200"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"complexo_1"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"as.numeric(x)*121"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"complexo_2"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"as.numeric(x)*391"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"complexo_3"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"as.numeric(x)*230"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"areia_tota"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"round(as.numeric(x)/10, 1)"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"silte"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"round(as.numeric(x)/10, 1)"</span>
  <span class="va">pronas.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pronas.in.name</span><span class="op">==</span><span class="st">"argila"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"round(as.numeric(x)/10, 1)"</span>
  <span class="co">## save translation rules:</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">pronas.in.name</span>, <span class="va">pronas.out.name</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">pronas.fun.lst</span><span class="op">)</span><span class="op">)</span>, <span class="st">"pronas_soilab_transvalues.csv"</span><span class="op">)</span>
  <span class="va">pronas.soil</span> <span class="op">=</span> <span class="fu">transvalues</span><span class="op">(</span><span class="va">pronas.x</span>, <span class="va">pronas.out.name</span>, <span class="va">pronas.in.name</span>, <span class="va">pronas.fun.lst</span><span class="op">)</span>
  <span class="va">pronas.soil</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">pronas.soil</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">pronas.soil</span><span class="op">$</span><span class="va">db_od</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">pronas.soil</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">pronas.soil</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">col.names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">col.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pronas.soil</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">pronas.soil</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.PRONASOLOS</span> <span class="op">=</span> <span class="va">pronas.soil</span><span class="op">[</span>,<span class="va">col.names</span><span class="op">]</span>
  <span class="va">chemsprops.PRONASOLOS</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"PRONASOLOS"</span>
  <span class="va">chemsprops.PRONASOLOS</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.PRONASOLOS</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://geoportal.cprm.gov.br/pronasolos/"</span>
  <span class="va">chemsprops.PRONASOLOS</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://www.infoteca.cnptia.embrapa.br/infoteca/handle/doc/1135056"</span>
  <span class="va">chemsprops.PRONASOLOS</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.PRONASOLOS</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"ph_h2o"</span>,<span class="st">"clay_tot_psa"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.PRONASOLOS</span><span class="op">)</span>
<span class="co">#&gt; [1] 31747    36</span></code></pre></div>
</div>
<div id="soil-profile-db-for-costa-rica-1" class="section level4" number="5.3.0.25">
<h4>
<span class="header-section-number">5.3.0.25</span> Soil Profile DB for Costa Rica<a class="anchor" aria-label="anchor" href="#soil-profile-db-for-costa-rica-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Mata, R., Vázquez, A., Rosales, A., &amp; Salazar, D. (2012). <a href="http://www.cia.ucr.ac.cr/?page_id=139">Mapa digital de suelos de Costa Rica</a>. Asociación Costarricense de la Ciencia del Suelo, San José, CRC. Escala, 1, 200000. Data download URL: <a href="http://www.cia.ucr.ac.cr/wp-content/recursosnaturales/Base%20perfiles%20de%20suelos%20v1.1.rar" class="uri">http://www.cia.ucr.ac.cr/wp-content/recursosnaturales/Base%20perfiles%20de%20suelos%20v1.1.rar</a>
</li>
<li>Mata-Chinchilla, R., &amp; Castro-Chinchilla, J. (2019). Geoportal de suelos de Costa Rica como Bien Público al servicio del país. Revista Tecnología En Marcha, 32(7), Pág. 51-56. <a href="https://doi.org/10.18845/tm.v32i7.4259" class="uri">https://doi.org/10.18845/tm.v32i7.4259</a>
</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.CostaRica"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">cr.hor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Costa_Rica/Base_de_datos_version_1.2.3.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#plot(cr.hor[,c("X","Y")], pch="+", asp=1)</span>
  <span class="va">cr.hor</span><span class="op">$</span><span class="va">usiteid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">cr.hor</span><span class="op">$</span><span class="va">Provincia</span>, <span class="va">cr.hor</span><span class="op">$</span><span class="va">Cantón</span>, <span class="va">cr.hor</span><span class="op">$</span><span class="va">Id</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
  <span class="co">#summary(cr.hor$Corg.)</span>
  <span class="va">cr.hor</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">cr.hor</span><span class="op">$</span><span class="va">Corg.</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">cr.hor</span><span class="op">$</span><span class="va">Densidad.Aparente</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">cr.hor</span><span class="op">$</span><span class="va">Densidad.Aparente</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#summary(cr.hor$K)</span>
  <span class="va">cr.hor</span><span class="op">$</span><span class="va">ca_ext</span> <span class="op">=</span> <span class="va">cr.hor</span><span class="op">$</span><span class="va">Ca</span> <span class="op">*</span> <span class="fl">200</span>
  <span class="va">cr.hor</span><span class="op">$</span><span class="va">mg_ext</span> <span class="op">=</span> <span class="va">cr.hor</span><span class="op">$</span><span class="va">Mg</span> <span class="op">*</span> <span class="fl">121</span>
  <span class="co">#cr.hor$na_ext = cr.hor$Na * 230</span>
  <span class="va">cr.hor</span><span class="op">$</span><span class="va">k_ext</span> <span class="op">=</span> <span class="va">cr.hor</span><span class="op">$</span><span class="va">K</span> <span class="op">*</span> <span class="fl">391</span>
  <span class="va">cr.hor</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="va">cr.hor</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">cr.hor</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">cr.hor</span><span class="op">$</span><span class="va">Densidad.Aparente</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">cr.hor</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">cr.hor</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">cr.sel.h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Id"</span>, <span class="st">"usiteid"</span>, <span class="st">"Fecha"</span>, <span class="st">"X"</span>, <span class="st">"Y"</span>, <span class="st">"labsampnum"</span>, <span class="st">"horizonte"</span>, <span class="st">"prof_inicio"</span>, <span class="st">"prof_final"</span>, <span class="st">"id_hz"</span>, <span class="st">"Clase.Textural"</span>, <span class="st">"ARCILLA"</span>, <span class="st">"LIMO"</span>, <span class="st">"ARENA"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"pHKCl"</span>, <span class="st">"pH_H2O"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"Densidad.Aparente"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">cr.sel.h</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">cr.sel.h</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cr.hor</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">cr.hor</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.CostaRica</span> <span class="op">=</span> <span class="va">cr.hor</span><span class="op">[</span>,<span class="va">cr.sel.h</span><span class="op">]</span>
  <span class="va">chemsprops.CostaRica</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"CostaRica"</span>
  <span class="va">chemsprops.CostaRica</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.CostaRica</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://www.cia.ucr.ac.cr"</span>
  <span class="va">chemsprops.CostaRica</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.18845/tm.v32i7.42"</span>
  <span class="va">chemsprops.CostaRica</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.CostaRica</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"pH_H2O"</span>,<span class="st">"ARCILLA"</span>,<span class="st">"Densidad.Aparente"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.CostaRica</span><span class="op">)</span>
<span class="co">#&gt; [1] 2042   36</span></code></pre></div>
</div>
<div id="iran-soil-profile-db-1" class="section level4" number="5.3.0.26">
<h4>
<span class="header-section-number">5.3.0.26</span> Iran soil profile DB<a class="anchor" aria-label="anchor" href="#iran-soil-profile-db-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Dewan, M. L., &amp; Famouri, J. (1964). The soils of Iran. Food and Agriculture Organization of the United Nations.</li>
<li>Hengl, T., Toomanian, N., Reuter, H. I., &amp; Malakouti, M. J. (2007). <a href="https://doi.org/10.1016/j.geoderma.2007.04.022">Methods to interpolate soil categorical variables from profile observations: Lessons from Iran</a>. Geoderma, 140(4), 417-427.</li>
<li>Mohammad, H. B. (2000). Soil resources and use potentiality map of Iran. Soil and Water Research Institute, Teheran, Iran.</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.IRANSPDB"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">na.s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"?"</span>,<span class="st">""</span>,<span class="st">"?."</span>,<span class="st">"??"</span>, <span class="op">-</span><span class="fl">2147483647</span>, <span class="op">-</span><span class="fl">1.00e+308</span>, <span class="st">"&lt;NA&gt;"</span><span class="op">)</span>
  <span class="va">iran.hor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Iran/iran_sdbana.txt"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, na.strings <span class="op">=</span> <span class="va">na.s</span>, header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">iran.hor</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ec_satp"</span>, <span class="st">"oc"</span>, <span class="st">"CACO"</span>, <span class="st">"PBS"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"clay_tot_psa"</span><span class="op">)</span>
  <span class="va">iran.hor</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">iran.hor</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">iran.hor</span><span class="op">$</span><span class="va">hzn_desgn</span><span class="op">==</span><span class="st">"A"</span>, <span class="fl">0</span>, <span class="va">iran.hor</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span>
  <span class="va">iran.hor2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Iran/iran_sdbhor.txt"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, na.strings <span class="op">=</span> <span class="va">na.s</span>, header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">iran.hor2</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"DESI"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"M_colour"</span>, <span class="st">"tex_psda"</span>, <span class="st">"hzn_desgn"</span><span class="op">)</span>
  <span class="va">iran.site</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Iran/iran_sgdb.txt"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, na.strings <span class="op">=</span> <span class="va">na.s</span>, header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">iran.site</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usiteid"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"FAO"</span>, <span class="st">"Tax"</span>, <span class="st">"site_key"</span><span class="op">)</span>
  <span class="va">iran.db</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join_all.html">join_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">iran.site</span>, <span class="va">iran.hor</span>, <span class="va">iran.hor2</span><span class="op">)</span><span class="op">)</span>
  <span class="va">iran.db</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">iran.db</span><span class="op">$</span><span class="va">oc</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="co">#summary(iran.db$oc)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">col.names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">col.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">iran.db</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">iran.db</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.IRANSPDB</span> <span class="op">=</span> <span class="va">iran.db</span><span class="op">[</span>,<span class="va">col.names</span><span class="op">]</span>
  <span class="va">chemsprops.IRANSPDB</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Iran_SPDB"</span>
  <span class="va">chemsprops.IRANSPDB</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.IRANSPDB</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">""</span>
  <span class="va">chemsprops.IRANSPDB</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1016/j.geoderma.2007.04.022"</span>
  <span class="va">chemsprops.IRANSPDB</span> <span class="op">&lt;-</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.IRANSPDB</span>, sel<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"ph_h2o"</span>,<span class="st">"clay_tot_psa"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.IRANSPDB</span><span class="op">)</span>
<span class="co">#&gt; [1] 4759   36</span></code></pre></div>
</div>
<div id="northern-circumpolar-permafrost-soil-profiles" class="section level4" number="5.3.0.27">
<h4>
<span class="header-section-number">5.3.0.27</span> Northern circumpolar permafrost soil profiles<a class="anchor" aria-label="anchor" href="#northern-circumpolar-permafrost-soil-profiles"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Hugelius, G., Bockheim, J. G., Camill, P., Elberling, B., Grosse, G., Harden, J. W., … &amp; Michaelson, G. (2013). <a href="https://doi.org/10.5194/essd-5-393-2013">A new data set for estimating organic carbon storage to 3 m depth in soils of the northern circumpolar permafrost region</a>. Earth System Science Data (Online), 5(2). Data download URL: <a href="http://dx.doi.org/10.5879/ECDS/00000002" class="uri">http://dx.doi.org/10.5879/ECDS/00000002</a>
</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.NCSCD"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">ncscd.hors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/NCSCD/Harden_etal_2012_Hugelius_etal_2013_cleaned_data.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">ncscd.hors</span><span class="op">$</span><span class="va">X.C</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span>
  <span class="co">#summary(ncscd.hors$oc)</span>
  <span class="co">#hist(ncscd.hors$Layer.thickness.cm, breaks = 45)</span>
  <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">Layer.thickness.cm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">ncscd.hors</span><span class="op">$</span><span class="va">Layer.thickness.cm</span><span class="op">&lt;</span><span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">Layer.thickness.cm</span><span class="op">)</span>
  <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">Basal.Depth.cm</span> <span class="op">+</span> <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">Layer.thickness.cm</span>
  <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">db_od</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">ncscd.hors</span><span class="op">$</span><span class="va">bulk.density.g.cm.3</span><span class="op">)</span>
  <span class="co">## Can we assume no coarse fragments?</span>
  <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">ncscd.hors</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">db_od</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ncscd.hors</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">## very high values &gt;40 kg/m3</span>
  <span class="va">ncscd.hors</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">ncscd.hors</span><span class="op">$</span><span class="va">Sample.date</span>, format<span class="op">=</span><span class="st">"%d-%m-%Y"</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="co">#summary(ncscd.hors$db_od)</span>
  <span class="va">ncscd.col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Profile.ID"</span>, <span class="st">"citation"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"Long"</span>, <span class="st">"Lat"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"Basal.Depth.cm"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"Horizon.type"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">ncscd.col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">ncscd.col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ncscd.hors</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">ncscd.hors</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.NCSCD</span> <span class="op">=</span> <span class="va">ncscd.hors</span><span class="op">[</span>,<span class="va">ncscd.col</span><span class="op">]</span>
  <span class="va">chemsprops.NCSCD</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"NCSCD"</span>
  <span class="va">chemsprops.NCSCD</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">10</span>
  <span class="va">chemsprops.NCSCD</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://bolin.su.se/data/ncscd/"</span>
  <span class="va">chemsprops.NCSCD</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.5194/essd-5-393-2013"</span>
  <span class="va">chemsprops.NCSCD</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.NCSCD</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"db_od"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span><span class="op">)</span>  
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.NCSCD</span><span class="op">)</span>
<span class="co">#&gt; [1] 7104   36</span></code></pre></div>
</div>
<div id="csiro-national-soil-site-database" class="section level4" number="5.3.0.28">
<h4>
<span class="header-section-number">5.3.0.28</span> CSIRO National Soil Site Database<a class="anchor" aria-label="anchor" href="#csiro-national-soil-site-database"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>CSIRO (2020). CSIRO National Soil Site Database. v4. CSIRO. Data Collection. <a href="https://data.csiro.au/collections/collection/CIcsiro:7526v004" class="uri">https://data.csiro.au/collections/collection/CIcsiro:7526v004</a>. Data download URL: <a href="https://doi.org/10.25919/5eeb2a56eac12" class="uri">https://doi.org/10.25919/5eeb2a56eac12</a> (available upon request)</li>
<li>Searle, R. (2014). The Australian site data collation to support the GlobalSoilMap. GlobalSoilMap: Basis of the global spatial soil information system, 127.</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.NatSoil"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://biostat.mc.vanderbilt.edu/Hmisc">Hmisc</a></span><span class="op">)</span> 
  <span class="va">cmdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/mdb.get.html">mdb.get</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Australia/CSIRO/NatSoil_v2_20200612.mdb"</span><span class="op">)</span>
  <span class="co">#str(cmdb$SITES)</span>
  <span class="va">au.obs</span> <span class="op">=</span> <span class="va">cmdb</span><span class="op">$</span><span class="va">OBSERVATIONS</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"s.id"</span>, <span class="st">"o.location.notes"</span>, <span class="st">"o.date.desc"</span>, <span class="st">"o.latitude.GDA94"</span>, <span class="st">"o.longitude.GDA94"</span><span class="op">)</span><span class="op">]</span>
  <span class="va">au.obs</span> <span class="op">=</span> <span class="va">au.obs</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">au.obs</span><span class="op">$</span><span class="va">o.longitude.GDA94</span><span class="op">)</span>,<span class="op">]</span>
  <span class="fu">coordinates</span><span class="op">(</span><span class="va">au.obs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">o.longitude.GDA94</span><span class="op">+</span><span class="va">o.latitude.GDA94</span>
  <span class="fu">proj4string</span><span class="op">(</span><span class="va">au.obs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +ellps=GRS80 +no_defs"</span><span class="op">)</span>
  <span class="va">au.xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">spTransform</span><span class="op">(</span><span class="va">au.obs</span>, <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#plot(au.xy[,c("o.longitude.GDA94", "o.latitude.GDA94")])</span>
  <span class="co">## all variables in one column and need to be sorted based on the lab method</span>
  <span class="co">#summary(cmdb$LAB_METHODS$LABM.SHORT.NAME)</span>
  <span class="co">#write.csv(cmdb$LAB_METHODS, "/mnt/diskstation/data/Soil_points/Australia/CSIRO/NatSoil_v2_20200612_lab_methods.csv")</span>
  <span class="va">lab.tbl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"6_DC"</span>, <span class="st">"6A1"</span>, <span class="st">"6A1_UC"</span>, <span class="st">"6B1"</span>, <span class="st">"6B2"</span>, <span class="st">"6B2a"</span>, <span class="st">"6B2b"</span>, <span class="st">"6B3"</span>, <span class="st">"6B4"</span>, <span class="st">"6B4a"</span>, <span class="st">"6B4b"</span>, <span class="st">"6Z"</span><span class="op">)</span>, <span class="co"># %</span>
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"6B3a"</span><span class="op">)</span>, <span class="co"># g/kg</span>
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"6H4"</span>, <span class="st">"6H4_SCaRP"</span><span class="op">)</span>, <span class="co"># %</span>
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"7_C_B"</span>, <span class="st">"7_NR"</span>, <span class="st">"7A1"</span>, <span class="st">"7A2"</span>, <span class="st">"7A2a"</span>, <span class="st">"7A2b"</span>, <span class="st">"7A3"</span>, <span class="st">"7A4"</span>, <span class="st">"7A5"</span>, <span class="st">"7A6"</span>, <span class="st">"7A6a"</span>, <span class="st">"7A6b"</span>, <span class="st">"7A6b_MCLW"</span><span class="op">)</span>,  <span class="co"># g/kg</span>
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"4A1"</span>, <span class="st">"4_NR"</span>, <span class="st">"4A_C_2.5"</span>, <span class="st">"4A_C_1"</span>, <span class="st">"4G1"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"4C_C_1"</span>, <span class="st">"4C1"</span>, <span class="st">"4C2"</span>, <span class="st">"23A"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"4B_C_2.5"</span>, <span class="st">"4B1"</span>, <span class="st">"4B2"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P10_NR_C"</span>, <span class="st">"P10_HYD_C"</span>, <span class="st">"P10_PB_C"</span>, <span class="st">"P10_PB1_C"</span>, <span class="st">"P10_CF_C"</span>, <span class="st">"P10_I_C"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P10_NR_Z"</span>, <span class="st">"P10_HYD_Z"</span>, <span class="st">"P10_PB_Z"</span>, <span class="st">"P10_PB1_Z"</span>, <span class="st">"P10_CF_Z"</span>, <span class="st">"P10_I_Z"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P10_NR_S"</span>, <span class="st">"P10_HYD_S"</span>, <span class="st">"P10_PB_S"</span>, <span class="st">"P10_PB1_S"</span>, <span class="st">"P10_CF_S"</span>, <span class="st">"P10_I_S"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"15C1modCEC"</span>, <span class="st">"15_HSK_CEC"</span>, <span class="st">"15J_CEC"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"15I1"</span>, <span class="st">"15I2"</span>, <span class="st">"15I3"</span>, <span class="st">"15I4"</span>, <span class="st">"15D3_CEC"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"15_BASES"</span>, <span class="st">"15_NR"</span>, <span class="st">"15J_H"</span>, <span class="st">"15J1"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2Z2_Grav"</span>, <span class="st">"P10_GRAV"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"503.08a"</span>, <span class="st">"P3A_NR"</span>, <span class="st">"P3A1"</span>, <span class="st">"P3A1_C4"</span>, <span class="st">"P3A1_CLOD"</span>, <span class="st">"P3A1_e"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"18F1_CA"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"18F1_MG"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"18F1_NA"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"18F1_K"</span>, <span class="st">"18F2"</span>, <span class="st">"18A1mod"</span>, <span class="st">"18_NR"</span>, <span class="st">"18A1"</span>, <span class="st">"18A1_NR"</span>, <span class="st">"18B1"</span>, <span class="st">"18B2"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"3_C_B"</span>, <span class="st">"3_NR"</span>, <span class="st">"3A_TSS"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"3A_C_2.5"</span>, <span class="st">"3A1"</span><span class="op">)</span>
          <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lab.tbl</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"ocP"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">val.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lab.tbl</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">cmdb</span><span class="op">$</span><span class="va">LAB_RESULTS</span><span class="op">[</span><span class="va">cmdb</span><span class="op">$</span><span class="va">LAB_RESULTS</span><span class="op">$</span><span class="va">labm.code</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">lab.tbl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"agency.code"</span>, <span class="st">"proj.code"</span>, <span class="st">"s.id"</span>, <span class="st">"o.id"</span>, <span class="st">"h.no"</span>, <span class="st">"labr.value"</span><span class="op">)</span><span class="op">]</span>; <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lab.tbl</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>; <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">val.lst</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lab.tbl</span><span class="op">)</span>
  <span class="va">val.lst</span><span class="op">$</span><span class="va">oc</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">val.lst</span><span class="op">$</span><span class="va">oc</span><span class="op">$</span><span class="va">oc</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">val.lst</span><span class="op">$</span><span class="va">ocP</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span> <span class="op">=</span> <span class="st">"oc"</span>
  <span class="va">val.lst</span><span class="op">$</span><span class="va">oc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">val.lst</span><span class="op">$</span><span class="va">oc</span>, <span class="va">val.lst</span><span class="op">$</span><span class="va">ocP</span><span class="op">)</span>
  <span class="va">val.lst</span><span class="op">$</span><span class="va">ocP</span> <span class="op">=</span> <span class="cn">NULL</span>
  <span class="co">#summary(val.lst$oc$oc)</span>
  <span class="co">#str(val.lst, max.level = 1)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">val.lst</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">val.lst</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">h.id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">val.lst</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">agency.code</span>, <span class="va">val.lst</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">proj.code</span>, <span class="va">val.lst</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">s.id</span>, <span class="va">val.lst</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">o.id</span>, <span class="va">val.lst</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">h.no</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span> <span class="op">}</span>
  <span class="va">au.hor</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join_all.html">join_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">val.lst</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">[</span>,<span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">}</span><span class="op">)</span>, match<span class="op">=</span><span class="st">"first"</span><span class="op">)</span>
  <span class="co">#str(as.factor(au.hor$h.id))</span>
  <span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">$</span><span class="va">h.id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">$</span><span class="va">agency.code</span>, <span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">$</span><span class="va">proj.code</span>, <span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">$</span><span class="va">s.id</span>, <span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">$</span><span class="va">o.id</span>, <span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">$</span><span class="va">h.no</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
  <span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">$</span><span class="va">hzn_desgn</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">$</span><span class="va">h.desig.master</span>, <span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">$</span><span class="va">h.desig.subdiv</span>, <span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">$</span><span class="va">h.desig.suffix</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
  <span class="va">au.horT</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join_all.html">join_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">cmdb</span><span class="op">$</span><span class="va">HORIZONS</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"h.id"</span>,<span class="st">"s.id"</span>,<span class="st">"h.no"</span>,<span class="st">"h.texture"</span>,<span class="st">"hzn_desgn"</span>,<span class="st">"h.upper.depth"</span>,<span class="st">"h.lower.depth"</span><span class="op">)</span><span class="op">]</span>, <span class="va">au.hor</span>, <span class="va">au.xy</span><span class="op">)</span><span class="op">)</span>
  <span class="va">au.horT</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">au.horT</span><span class="op">$</span><span class="va">o.date.desc</span>, format<span class="op">=</span><span class="st">"%d%m%Y"</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">au.horT</span><span class="op">$</span><span class="va">sand_tot_psa</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">au.horT</span><span class="op">$</span><span class="va">sand_tot_psa</span><span class="op">)</span>, <span class="fl">100</span><span class="op">-</span><span class="op">(</span><span class="va">au.horT</span><span class="op">$</span><span class="va">clay_tot_psa</span> <span class="op">+</span> <span class="va">au.horT</span><span class="op">$</span><span class="va">silt_tot_psa</span><span class="op">)</span>, <span class="va">au.horT</span><span class="op">$</span><span class="va">sand_tot_psa</span><span class="op">)</span>
  <span class="va">au.horT</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="va">au.horT</span><span class="op">$</span><span class="va">h.upper.depth</span><span class="op">*</span><span class="fl">100</span>
  <span class="va">au.horT</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="va">au.horT</span><span class="op">$</span><span class="va">h.lower.depth</span><span class="op">*</span><span class="fl">100</span>
  <span class="va">au.horT</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">au.horT</span><span class="op">$</span><span class="va">oc</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">au.horT</span><span class="op">$</span><span class="va">db_od</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">au.horT</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">au.horT</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="va">au.cols.n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"s.id"</span>, <span class="st">"o.location.notes"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"o.longitude.GDA94"</span>, <span class="st">"o.latitude.GDA94"</span>, <span class="st">"h.id"</span>, <span class="st">"h.no"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"h.texture"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">au.cols.n</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">au.cols.n</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">au.horT</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">au.horT</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.NatSoil</span> <span class="op">=</span> <span class="va">au.horT</span><span class="op">[</span>,<span class="va">au.cols.n</span><span class="op">]</span>
  <span class="va">chemsprops.NatSoil</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"CSIRO_NatSoil"</span>
  <span class="va">chemsprops.NatSoil</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.NatSoil</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://www.csiro.au/en/Do-business/Services/Enviro/Soil-archive"</span>
  <span class="va">chemsprops.NatSoil</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.25919/5eeb2a56eac12"</span>
  <span class="va">chemsprops.NatSoil</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.NatSoil</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"db_od"</span>,<span class="st">"clay_tot_psa"</span>,<span class="st">"ph_h2o"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"o.longitude.GDA94"</span>, <span class="st">"o.latitude.GDA94"</span><span class="op">)</span><span class="op">)</span>  
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.NatSoil</span><span class="op">)</span>
<span class="co">#&gt; [1] 70791    36</span></code></pre></div>
</div>
<div id="namsoter" class="section level4" number="5.3.0.29">
<h4>
<span class="header-section-number">5.3.0.29</span> NAMSOTER<a class="anchor" aria-label="anchor" href="#namsoter"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Coetzee, M. E. (2001). <a href="https://edepot.wur.nl/485173">NAMSOTER, a SOTER database for Namibia</a>. Agroecological Zoning, 458.</li>
<li>Coetzee, M. E. (2009). Chemical characterisation of the soils of East Central Namibia (Doctoral dissertation, Stellenbosch: University of Stellenbosch).</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.NAMSOTER"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">nam.profs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Namibia/NAMSOTER/Namibia_all_profiles.csv"</span>, na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-9999"</span>, <span class="st">"999"</span>, <span class="st">"9999"</span>, <span class="st">"NA"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">nam.hors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Namibia/NAMSOTER/Namibia_all_horizons.csv"</span>, na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-9999"</span>, <span class="st">"999"</span>, <span class="st">"9999"</span>, <span class="st">"NA"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#summary(nam.hors$TOTN)</span>
  <span class="co">#summary(nam.hors$TOTC)</span>
  <span class="va">nam.hors</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">nam.hors</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">nam.hors</span><span class="op">$</span><span class="va">HONU</span><span class="op">==</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">nam.hors</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span>
  <span class="va">h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam.hors</span><span class="op">$</span><span class="va">HONU</span><span class="op">==</span><span class="va">x</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">{</span>
    <span class="va">sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">nam.hors</span><span class="op">$</span><span class="va">PRID</span><span class="op">[</span><span class="va">h.lst</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>, <span class="va">nam.hors</span><span class="op">$</span><span class="va">PRID</span><span class="op">[</span><span class="va">h.lst</span><span class="op">[[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">nam.hors</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">[</span><span class="va">h.lst</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">nam.hors</span><span class="op">$</span><span class="va">HBDE</span><span class="op">[</span><span class="va">h.lst</span><span class="op">[[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span>
  <span class="op">}</span>
  <span class="va">nam.hors</span><span class="op">$</span><span class="va">HBDE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">nam.hors</span><span class="op">$</span><span class="va">HBDE</span><span class="op">)</span>, <span class="va">nam.hors</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">+</span><span class="fl">50</span>, <span class="va">nam.hors</span><span class="op">$</span><span class="va">HBDE</span><span class="op">)</span>
  <span class="co">#summary(nam.hors$HBDE)</span>
  <span class="va">namALL</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">nam.hors</span>, <span class="va">nam.profs</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PRID"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">namALL</span><span class="op">$</span><span class="va">k_ext</span> <span class="op">=</span> <span class="va">namALL</span><span class="op">$</span><span class="va">EXCK</span> <span class="op">*</span> <span class="fl">391</span>
  <span class="va">namALL</span><span class="op">$</span><span class="va">ca_ext</span> <span class="op">=</span> <span class="va">namALL</span><span class="op">$</span><span class="va">EXCA</span> <span class="op">*</span> <span class="fl">200</span>
  <span class="va">namALL</span><span class="op">$</span><span class="va">mg_ext</span> <span class="op">=</span> <span class="va">namALL</span><span class="op">$</span><span class="va">EXMG</span> <span class="op">*</span> <span class="fl">121</span>
  <span class="va">namALL</span><span class="op">$</span><span class="va">na_ext</span> <span class="op">=</span> <span class="va">namALL</span><span class="op">$</span><span class="va">EXNA</span> <span class="op">*</span> <span class="fl">230</span>
  <span class="co">#summary(namALL$MINA)</span>
  <span class="va">namALL</span><span class="op">$</span><span class="va">BULK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">BULK</span><span class="op">&gt;</span><span class="fl">2.4</span>, <span class="cn">NA</span>, <span class="va">namALL</span><span class="op">$</span><span class="va">BULK</span><span class="op">)</span>
  <span class="va">namALL</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">MINA</span><span class="op">==</span><span class="st">"D"</span>, <span class="fl">80</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">MINA</span><span class="op">==</span><span class="st">"A"</span>, <span class="fl">60</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">MINA</span><span class="op">==</span><span class="st">"M"</span>, <span class="fl">25</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">MINA</span><span class="op">==</span><span class="st">"C"</span>, <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">MINA</span><span class="op">==</span><span class="st">"V"</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">MINA</span><span class="op">==</span><span class="st">"F"</span>, <span class="fl">2.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">MINA</span><span class="op">==</span><span class="st">"M/A"</span>, <span class="fl">40</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">MINA</span><span class="op">==</span><span class="st">"C/M"</span>, <span class="fl">15</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#hist(namALL$wpg2)</span>
  <span class="va">namALL</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">TOTC</span> <span class="op">/</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">namALL</span><span class="op">$</span><span class="va">BULK</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">namALL</span><span class="op">$</span><span class="va">wpg2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#summary(namALL$oc_d)</span>
  <span class="co">#summary(namALL$PHAQ) ## very high ph</span>
  <span class="va">namALL</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fl">2000</span>
  <span class="va">nam.col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PRID"</span>, <span class="st">"SLID"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"LONG"</span>, <span class="st">"LATI"</span>, <span class="st">"labsampnum"</span>, <span class="st">"HONU"</span>, <span class="st">"hzn_top"</span>, <span class="st">"HBDE"</span>, <span class="st">"HODE"</span>, <span class="st">"PSCL"</span>, <span class="st">"CLPC"</span>, <span class="st">"STPC"</span>, <span class="st">"SDTO"</span>, <span class="st">"TOTC"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"TOTN"</span>, <span class="st">"PHKC"</span>, <span class="st">"PHAQ"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"CECS"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"BULK"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ELCO"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">nam.col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">nam.col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">namALL</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">namALL</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.NAMSOTER</span> <span class="op">=</span> <span class="va">namALL</span><span class="op">[</span>,<span class="va">nam.col</span><span class="op">]</span>
  <span class="va">chemsprops.NAMSOTER</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"NAMSOTER"</span>
  <span class="va">chemsprops.NAMSOTER</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.NAMSOTER</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">""</span>
  <span class="va">chemsprops.NAMSOTER</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://edepot.wur.nl/485173"</span>
  <span class="va">chemsprops.NAMSOTER</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.NAMSOTER</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TOTC"</span>,<span class="st">"CLPC"</span>,<span class="st">"PHAQ"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LONG"</span>, <span class="st">"LATI"</span><span class="op">)</span><span class="op">)</span>  
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.NAMSOTER</span><span class="op">)</span>
<span class="co">#&gt; [1] 2953   36</span></code></pre></div>
</div>
<div id="worldwide-organic-soil-carbon-and-nitrogen-data-1" class="section level4" number="5.3.0.30">
<h4>
<span class="header-section-number">5.3.0.30</span> Worldwide organic soil carbon and nitrogen data<a class="anchor" aria-label="anchor" href="#worldwide-organic-soil-carbon-and-nitrogen-data-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p>Zinke, P. J., Millemann, R. E., &amp; Boden, T. A. (1986). <a href="https://cdiac.ess-dive.lbl.gov/ftp/ndp018/ndp018.pdf">Worldwide organic soil carbon and nitrogen data</a>. Carbon Dioxide Information Center, Environmental Sciences Division, Oak Ridge National Laboratory. Data download URL: <a href="https://dx.doi.org/10.3334/CDIAC/lue.ndp018" class="uri">https://dx.doi.org/10.3334/CDIAC/lue.ndp018</a></p></li>
<li><p>Note: poor spatial location accuracy i.e. &lt;10 km. Bulk density for many points has been estimated not measured. Sampling year has not been but literature indicates: 1965, 1974, 1976, 1978, 1979, 1984. Most of samples come from natural vegetation (undisturbed) areas.</p></li>
</ul>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.ISCND"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">ndp.profs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/ISCND/ndp018.csv"</span>, na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-9999"</span>, <span class="st">"?"</span>, <span class="st">"NA"</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ndp.profs</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PROFILE"</span>, <span class="st">"CODE"</span>, <span class="st">"CARBON"</span>, <span class="st">"NITROGEN"</span>, <span class="st">"LAT"</span>, <span class="st">"LONG"</span>, <span class="st">"ELEV"</span>, <span class="st">"SOURCE"</span>, <span class="st">"HOLDRIGE"</span>, <span class="st">"OLSON"</span>, <span class="st">"PARENT"</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CARBON"</span>,<span class="st">"NITROGEN"</span>,<span class="st">"ELEV"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>  <span class="va">ndp.profs</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">ndp.profs</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>   <span class="op">}</span>
  <span class="co">#summary(ndp.profs$CARBON)</span>
  <span class="va">lat.s</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="va">ndp.profs</span><span class="op">$</span><span class="va">LAT</span><span class="op">)</span> <span class="co"># lat.n &lt;- grep("N", ndp.profs$LAT)</span>
  <span class="va">ndp.profs</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[^0-9.-]"</span>, <span class="st">""</span>, <span class="va">ndp.profs</span><span class="op">$</span><span class="va">LAT</span><span class="op">)</span><span class="op">)</span>
  <span class="va">ndp.profs</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span><span class="op">[</span><span class="va">lat.s</span><span class="op">]</span> <span class="op">=</span> <span class="va">ndp.profs</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span><span class="op">[</span><span class="va">lat.s</span><span class="op">]</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>
  <span class="va">lon.w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"W"</span>, <span class="va">ndp.profs</span><span class="op">$</span><span class="va">LONG</span><span class="op">)</span> <span class="co"># lon.e  &lt;- grep("E", ndp.profs$LONG, fixed = TRUE)</span>
  <span class="va">ndp.profs</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[^0-9.-]"</span>, <span class="st">""</span>, <span class="va">ndp.profs</span><span class="op">$</span><span class="va">LONG</span><span class="op">)</span><span class="op">)</span>
  <span class="va">ndp.profs</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span><span class="op">[</span><span class="va">lon.w</span><span class="op">]</span> <span class="op">=</span> <span class="va">ndp.profs</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span><span class="op">[</span><span class="va">lon.w</span><span class="op">]</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>
  <span class="co">#plot(ndp.profs[,c("longitude_decimal_degrees", "latitude_decimal_degrees")])</span>
  <span class="va">ndp.profs</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fl">0</span>; <span class="va">ndp.profs</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fl">100</span>
  <span class="co">## Sampling years from the doc: 1965, 1974, 1976, 1978, 1979, 1984 </span>
  <span class="va">ndp.profs</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="st">"1982"</span>
  <span class="va">ndp.col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PROFILE"</span>, <span class="st">"CODE"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>,<span class="st">"hzn_top"</span>,<span class="st">"hzn_bot"</span>,<span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"CARBON"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">ndp.col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">ndp.col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ndp.profs</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">ndp.profs</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.ISCND</span> <span class="op">=</span> <span class="va">ndp.profs</span><span class="op">[</span>,<span class="va">ndp.col</span><span class="op">]</span>
  <span class="va">chemsprops.ISCND</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"ISCND"</span>
  <span class="va">chemsprops.ISCND</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">8</span>
  <span class="va">chemsprops.ISCND</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://iscn.fluxdata.org/data/"</span>
  <span class="va">chemsprops.ISCND</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://dx.doi.org/10.3334/CDIAC/lue.ndp018"</span>
  <span class="va">chemsprops.ISCND</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.ISCND</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CARBON"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span><span class="op">)</span><span class="op">)</span>  
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.ISCND</span><span class="op">)</span>
<span class="co">#&gt; [1] 3977   36</span></code></pre></div>
</div>
<div id="interior-alaska-carbon-and-nitrogen-stocks" class="section level4" number="5.3.0.31">
<h4>
<span class="header-section-number">5.3.0.31</span> Interior Alaska Carbon and Nitrogen stocks<a class="anchor" aria-label="anchor" href="#interior-alaska-carbon-and-nitrogen-stocks"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Manies, K., Waldrop, M., and Harden, J. (2020): Generalized models to estimate carbon and nitrogen stocks of organic soil horizons in Interior Alaska, Earth Syst. Sci. Data, 12, 1745–1757, <a href="https://doi.org/10.5194/essd-12-1745-2020" class="uri">https://doi.org/10.5194/essd-12-1745-2020</a>, Data download URL: <a href="https://doi.org/10.5066/P960N1F9" class="uri">https://doi.org/10.5066/P960N1F9</a>
</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.Alaska"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">al.gps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/USA/Alaska_Interior/Site_GPS_coordinates_v1-1.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">## Different datums!</span>
  <span class="co">#summary(as.factor(al.gps$Datum))</span>
  <span class="va">al.gps1</span> <span class="op">=</span> <span class="va">al.gps</span><span class="op">[</span><span class="va">al.gps</span><span class="op">$</span><span class="va">Datum</span><span class="op">==</span><span class="st">"NAD83"</span>,<span class="op">]</span>
  <span class="fu">coordinates</span><span class="op">(</span><span class="va">al.gps1</span><span class="op">)</span> <span class="op">=</span> <span class="op">~</span> <span class="va">Longitude</span> <span class="op">+</span> <span class="va">Latitude</span>
  <span class="fu">proj4string</span><span class="op">(</span><span class="va">al.gps1</span><span class="op">)</span> <span class="op">=</span> <span class="st">"+proj=longlat +datum=NAD83"</span>
  <span class="va">al.gps0</span> <span class="op">=</span> <span class="fu">spTransform</span><span class="op">(</span><span class="va">al.gps1</span>, <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +datum=WGS84"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">al.gps</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">al.gps</span><span class="op">$</span><span class="va">Datum</span><span class="op">==</span><span class="st">"NAD83"</span><span class="op">)</span>,<span class="st">"Longitude"</span><span class="op">]</span> <span class="op">=</span> <span class="va">al.gps0</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
  <span class="va">al.gps</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">al.gps</span><span class="op">$</span><span class="va">Datum</span><span class="op">==</span><span class="st">"NAD83"</span><span class="op">)</span>,<span class="st">"Latitude"</span><span class="op">]</span> <span class="op">=</span> <span class="va">al.gps0</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
  <span class="va">al.gps</span><span class="op">$</span><span class="va">site</span> <span class="op">=</span> <span class="va">al.gps</span><span class="op">$</span><span class="va">Site</span>
  <span class="va">al.hor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/USA/Alaska_Interior/Generalized_models_for_CandN_Alaska_v1-1.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">al.hor</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="va">al.hor</span><span class="op">$</span><span class="va">depth</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">al.hor</span><span class="op">$</span><span class="va">thickness</span><span class="op">)</span>
  <span class="va">al.hor</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">al.hor</span><span class="op">$</span><span class="va">date</span>, format <span class="op">=</span> <span class="st">"%m/%d/%Y"</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">al.hor</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">al.hor</span><span class="op">$</span><span class="va">carbon</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">al.hor</span><span class="op">$</span><span class="va">n_tot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">al.hor</span><span class="op">$</span><span class="va">nitrogen</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">al.hor</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">al.hor</span><span class="op">$</span><span class="va">Cdensity</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1000</span>
  <span class="co">#summary(al.hor$oc_d)</span>
  <span class="va">al.horA</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">al.hor</span>, <span class="va">al.gps</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">al.col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"profile"</span>, <span class="st">"description"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"sampleID"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"depth"</span>, <span class="st">"Hcode"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"BDfine"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">al.col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">al.col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">al.horA</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">al.horA</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.Alaska</span> <span class="op">=</span> <span class="va">al.horA</span><span class="op">[</span>,<span class="va">al.col</span><span class="op">]</span>
  <span class="va">chemsprops.Alaska</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Alaska_interior"</span>
  <span class="va">chemsprops.Alaska</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">chemsprops.Alaska</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://www.usgs.gov/centers/gmeg"</span>
  <span class="va">chemsprops.Alaska</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.5194/essd-12-1745-2020"</span>
  <span class="va">chemsprops.Alaska</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.Alaska</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"oc_d"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span><span class="op">)</span>  
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.Alaska</span><span class="op">)</span>
<span class="co">#&gt; [1] 3882   36</span></code></pre></div>
</div>
<div id="croatian-soil-pedon-data-1" class="section level4" number="5.3.0.32">
<h4>
<span class="header-section-number">5.3.0.32</span> Croatian Soil Pedon data<a class="anchor" aria-label="anchor" href="#croatian-soil-pedon-data-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Martinović J., (2000) <a href="https://books.google.nl/books?id=k_a2MgAACAAJ">“Tla u Hrvatskoj”</a>, Monografija, Državna uprava za zaštitu prirode i okoliša, str. 269, Zagreb. ISBN: 9536793059</li>
<li>Bašić F., (2014) <a href="https://books.google.nl/books?id=VbJEAAAAQBAJ">“The Soils of Croatia”</a>. World Soils Book Series, Springer Science &amp; Business Media, 179 pp. ISBN: 9400758154</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.bpht"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">bpht.site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Croatia/WBSoilHR_sites_1997.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">bpht.hors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Croatia/WBSoilHR_1997.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">## filter typos</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GOR"</span>, <span class="st">"DON"</span>, <span class="st">"MKP"</span>, <span class="st">"PH1"</span>, <span class="st">"PH2"</span>, <span class="st">"MSP"</span>, <span class="st">"MP"</span>, <span class="st">"MG"</span>, <span class="st">"HUM"</span>, <span class="st">"EXTN"</span>, <span class="st">"EXTP"</span>, <span class="st">"EXTK"</span>, <span class="st">"CAR"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">bpht.hors</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">bpht.hors</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="co">## Convert to the USDA standard</span>
  <span class="va">bpht.hors</span><span class="op">$</span><span class="va">sand_tot_psa</span> <span class="op">&lt;-</span> <span class="va">bpht.hors</span><span class="op">$</span><span class="va">MSP</span> <span class="op">*</span> <span class="fl">0.8</span> <span class="op">+</span> <span class="va">bpht.hors</span><span class="op">$</span><span class="va">MKP</span>
  <span class="va">bpht.hors</span><span class="op">$</span><span class="va">silt_tot_psa</span> <span class="op">&lt;-</span> <span class="va">bpht.hors</span><span class="op">$</span><span class="va">MP</span> <span class="op">+</span> <span class="va">bpht.hors</span><span class="op">$</span><span class="va">MSP</span> <span class="op">*</span> <span class="fl">0.2</span>
  <span class="va">bpht.hors</span><span class="op">$</span><span class="va">oc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">bpht.hors</span><span class="op">$</span><span class="va">HUM</span><span class="op">/</span><span class="fl">1.724</span> <span class="op">*</span> <span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">## summary(bpht.hors$sand_tot_psa)</span>
  <span class="va">bpht.s.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"UZORAK"</span>, <span class="st">"Cro16.30_X"</span>, <span class="st">"Cro16.30_Y"</span>, <span class="st">"FITOC"</span>, <span class="st">"STIJENA"</span>, <span class="st">"HID_DREN"</span>, <span class="st">"DUBINA"</span><span class="op">)</span>
  <span class="va">bpht.hor</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">bpht.site</span><span class="op">[</span>,<span class="va">bpht.s.lst</span><span class="op">]</span>, <span class="va">bpht.hors</span><span class="op">)</span>
  <span class="va">bpht.hor</span><span class="op">$</span><span class="va">wpg2</span> <span class="op">=</span> <span class="va">bpht.hor</span><span class="op">$</span><span class="va">STIJENA</span>
  <span class="va">bpht.hor</span><span class="op">$</span><span class="va">DON</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">bpht.hor</span><span class="op">$</span><span class="va">DON</span><span class="op">)</span>, <span class="va">bpht.hor</span><span class="op">$</span><span class="va">GOR</span><span class="op">+</span><span class="fl">50</span>, <span class="va">bpht.hor</span><span class="op">$</span><span class="va">DON</span><span class="op">)</span>
  <span class="va">bpht.hor</span><span class="op">$</span><span class="va">depth</span> <span class="op">&lt;-</span> <span class="va">bpht.hor</span><span class="op">$</span><span class="va">GOR</span> <span class="op">+</span> <span class="op">(</span><span class="va">bpht.hor</span><span class="op">$</span><span class="va">DON</span> <span class="op">-</span> <span class="va">bpht.hor</span><span class="op">$</span><span class="va">GOR</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>
  <span class="va">bpht.hor</span> <span class="op">=</span> <span class="va">bpht.hor</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">bpht.hor</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span>,<span class="op">]</span>
  <span class="va">bpht.hor</span><span class="op">$</span><span class="va">wpg2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">bpht.hor</span><span class="op">$</span><span class="va">GOR</span><span class="op">&lt;</span><span class="fl">30</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">bpht.hor</span><span class="op">$</span><span class="va">wpg2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">bpht.hor</span><span class="op">$</span><span class="va">GOR</span><span class="op">&lt;</span><span class="fl">30</span><span class="op">)</span><span class="op">]</span><span class="op">*</span><span class="fl">.3</span>
  <span class="va">bpht.hor</span><span class="op">$</span><span class="va">sample_key</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/make.unique.html">make.unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">bpht.hor</span><span class="op">$</span><span class="va">PEDOL_ID</span>, <span class="va">bpht.hor</span><span class="op">$</span><span class="va">OZN</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">bpht.hor</span><span class="op">$</span><span class="va">sand_tot_psa</span><span class="op">[</span><span class="va">bpht.hor</span><span class="op">$</span><span class="va">sample_key</span><span class="op">==</span><span class="st">"805_Amo"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">bpht.hor</span><span class="op">$</span><span class="va">sand_tot_psa</span><span class="op">[</span><span class="va">bpht.hor</span><span class="op">$</span><span class="va">sample_key</span><span class="op">==</span><span class="st">"805_Amo"</span><span class="op">]</span><span class="op">/</span><span class="fl">10</span>
  <span class="co">## convert N, P, K</span>
  <span class="co">#summary(bpht.hor$EXTK) -- measurements units?</span>
  <span class="va">bpht.hor</span><span class="op">$</span><span class="va">p_ext</span> <span class="op">=</span> <span class="va">bpht.hor</span><span class="op">$</span><span class="va">EXTP</span> <span class="op">*</span> <span class="fl">4.364</span>
  <span class="va">bpht.hor</span><span class="op">$</span><span class="va">k_ext</span> <span class="op">=</span> <span class="va">bpht.hor</span><span class="op">$</span><span class="va">EXTK</span> <span class="op">*</span> <span class="fl">8.3013</span>
  <span class="va">bpht.hor</span> <span class="op">=</span> <span class="va">bpht.hor</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">bpht.hor</span><span class="op">$</span><span class="va">`Cro16.30_X`</span><span class="op">)</span>,<span class="op">]</span>
  <span class="co">## coordinates:</span>
  <span class="va">bpht.pnts</span> <span class="op">=</span> <span class="fu">SpatialPointsDataFrame</span><span class="op">(</span><span class="va">bpht.hor</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cro16.30_X"</span>,<span class="st">"Cro16.30_Y"</span><span class="op">)</span><span class="op">]</span>, <span class="va">bpht.hor</span><span class="op">[</span><span class="st">"site_key"</span><span class="op">]</span>, proj4string <span class="op">=</span> <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=tmerc +lat_0=0 +lon_0=16.5 +k=0.9999 +x_0=2500000 +y_0=0 +ellps=bessel +towgs84=550.499,164.116,475.142,5.80967,2.07902,-11.62386,0.99999445824 +units=m"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">bpht.pnts.ll</span> <span class="op">&lt;-</span> <span class="fu">spTransform</span><span class="op">(</span><span class="va">bpht.pnts</span>, <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +datum=WGS84"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">bpht.hor</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="va">bpht.pnts.ll</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
  <span class="va">bpht.hor</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="va">bpht.pnts.ll</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> 
  <span class="va">bpht.h.lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'site_key'</span>, <span class="st">'OZ_LIST_PROF'</span>, <span class="st">'UZORAK'</span>, <span class="st">'longitude_decimal_degrees'</span>, <span class="st">'latitude_decimal_degrees'</span>, <span class="st">'labsampnum'</span>, <span class="st">'layer_sequence'</span>, <span class="st">'GOR'</span>, <span class="st">'DON'</span>, <span class="st">'OZN'</span>, <span class="st">'TT'</span>, <span class="st">'MG'</span>, <span class="st">'silt_tot_psa'</span>, <span class="st">'sand_tot_psa'</span>, <span class="st">'oc'</span>, <span class="st">'oc_d'</span>, <span class="st">'c_tot'</span>, <span class="st">'EXTN'</span>, <span class="st">'PH2'</span>, <span class="st">'PH1'</span>, <span class="st">'ph_cacl2'</span>, <span class="st">'cec_sum'</span>, <span class="st">'cec_nh4'</span>, <span class="st">'ecec'</span>, <span class="st">'wpg2'</span>, <span class="st">'db_od'</span>, <span class="st">'ca_ext'</span>, <span class="st">'mg_ext'</span>, <span class="st">'na_ext'</span>, <span class="st">'k_ext'</span>, <span class="st">'ec_satp'</span>, <span class="st">'ec_12pre'</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">bpht.h.lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">bpht.h.lst</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bpht.hor</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">bpht.hor</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.bpht</span> <span class="op">=</span> <span class="va">bpht.hor</span><span class="op">[</span>,<span class="va">bpht.h.lst</span><span class="op">]</span>
  <span class="va">chemsprops.bpht</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Croatian_Soil_Pedon"</span>
  <span class="va">chemsprops.bpht</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">chemsprops.bpht</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://www.haop.hr/"</span>
  <span class="va">chemsprops.bpht</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://books.google.nl/books?id=k_a2MgAACAAJ"</span>
  <span class="va">chemsprops.bpht</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.bpht</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"MG"</span>,<span class="st">"PH1"</span>,<span class="st">"k_ext"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.bpht</span><span class="op">)</span>
<span class="co">#&gt; [1] 5746   36</span></code></pre></div>
</div>
<div id="remnant-native-soc-database" class="section level4" number="5.3.0.33">
<h4>
<span class="header-section-number">5.3.0.33</span> Remnant native SOC database<a class="anchor" aria-label="anchor" href="#remnant-native-soc-database"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Sanderman, J., (2017) “Remnant native SOC database for release.xlsx”, Soil carbon profile data from paired land use comparisons, <a href="https://doi.org/10.7910/DVN/QQQM8V/8MSBNI" class="uri">https://doi.org/10.7910/DVN/QQQM8V/8MSBNI</a>, Harvard Dataverse, V1</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.RemnantSOC"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">rem.hor</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/WHRC_remnant_SOC/remnant+native+SOC+database+for+release.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
  <span class="va">rem.site</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/WHRC_remnant_SOC/remnant+native+SOC+database+for+release.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="va">rem.ref</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/WHRC_remnant_SOC/remnant+native+SOC+database+for+release.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
  <span class="va">rem.site</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">rem.site</span>, <span class="va">rem.ref</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Source.No."</span>,<span class="st">"DOI"</span>,<span class="st">"Sample_year"</span><span class="op">)</span><span class="op">]</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Source.No."</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rem.site</span><span class="op">$</span><span class="va">Site</span> <span class="op">=</span> <span class="va">rem.site</span><span class="op">$</span><span class="va">Site.ID</span>
  <span class="va">rem.horA</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">rem.hor</span>, <span class="va">rem.site</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Site"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rem.horA</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="va">rem.horA</span><span class="op">$</span><span class="st">'U_depth.(m)'</span><span class="op">*</span><span class="fl">100</span>
  <span class="va">rem.horA</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="va">rem.horA</span><span class="op">$</span><span class="st">'L_depth.(m)'</span><span class="op">*</span><span class="fl">100</span>
  <span class="va">rem.horA</span><span class="op">$</span><span class="va">db_od</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">rem.horA</span><span class="op">$</span><span class="st">'measured.BD.(Mg/m3)'</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">rem.horA</span><span class="op">$</span><span class="st">'estimated.BD.(Mg/m3)'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">rem.horA</span><span class="op">$</span><span class="st">'measured.BD.(Mg/m3)'</span><span class="op">)</span><span class="op">)</span>
  <span class="va">rem.horA</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">rem.horA</span><span class="op">$</span><span class="st">'OC.(g/kg)'</span> <span class="op">*</span> <span class="va">rem.horA</span><span class="op">$</span><span class="va">db_od</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#summary(rem.horA$oc_d)</span>
  <span class="va">rem.col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Source.No."</span>, <span class="st">"Site"</span>, <span class="st">"Sample_year"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"OC.(g/kg)"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">rem.col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">rem.col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">rem.horA</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">rem.horA</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.RemnantSOC</span> <span class="op">=</span> <span class="va">rem.horA</span><span class="op">[</span>,<span class="va">rem.col</span><span class="op">]</span>
  <span class="va">chemsprops.RemnantSOC</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"WHRC_remnant_SOC"</span>
  <span class="va">chemsprops.RemnantSOC</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">8</span>
  <span class="va">chemsprops.RemnantSOC</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://www.woodwellclimate.org/research-area/carbon/"</span>
  <span class="va">chemsprops.RemnantSOC</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"http://dx.doi.org/10.1073/pnas.1706103114"</span>
  <span class="va">chemsprops.RemnantSOC</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.RemnantSOC</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OC.(g/kg)"</span>,<span class="st">"oc_d"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span><span class="op">)</span>  
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.RemnantSOC</span><span class="op">)</span>
<span class="co">#&gt; [1] 1604   36</span></code></pre></div>
</div>
<div id="soil-health-db" class="section level4" number="5.3.0.34">
<h4>
<span class="header-section-number">5.3.0.34</span> Soil Health DB<a class="anchor" aria-label="anchor" href="#soil-health-db"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Jian, J., Du, X., &amp; Stewart, R. D. (2020). A database for global soil health assessment. Scientific Data, 7(1), 1-8. <a href="https://doi.org/10.1038/s41597-020-0356-3" class="uri">https://doi.org/10.1038/s41597-020-0356-3</a>. Data download URL: <a href="https://github.com/jinshijian/SoilHealthDB" class="uri">https://github.com/jinshijian/SoilHealthDB</a>
</li>
</ul>
<p>Note: some information is available about column names (<a href="https://www.nature.com/articles/s41597-020-0356-3/tables/3" class="uri">https://www.nature.com/articles/s41597-020-0356-3/tables/3</a>) but detailed explanation is missing.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.SoilHealthDB"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">shdb.hor</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/SoilHealthDB/SoilHealthDB_V2.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">1</span>, na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NA"</span>, <span class="st">"NotAvailable"</span>, <span class="st">"Not-available"</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#summary(as.factor(shdb.hor$SamplingDepth))</span>
  <span class="va">shdb.hor</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">shdb.hor</span><span class="op">$</span><span class="va">SamplingDepth</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"-to-"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span>
  <span class="va">shdb.hor</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">shdb.hor</span><span class="op">$</span><span class="va">SamplingDepth</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"-to-"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span>
  <span class="va">shdb.hor</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">shdb.hor</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">shdb.hor</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span>
  <span class="va">shdb.hor</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">shdb.hor</span><span class="op">$</span><span class="va">hzn_bot</span><span class="op">)</span>, <span class="fl">15</span>, <span class="va">shdb.hor</span><span class="op">$</span><span class="va">hzn_bot</span><span class="op">)</span>
  <span class="va">shdb.hor</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">shdb.hor</span><span class="op">$</span><span class="va">BackgroundSOC</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>
  <span class="va">shdb.hor</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">shdb.hor</span><span class="op">$</span><span class="va">oc</span> <span class="op">*</span> <span class="va">shdb.hor</span><span class="op">$</span><span class="va">SoilBD</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ClayPerc"</span>, <span class="st">"SiltPerc"</span>, <span class="st">"SandPerc"</span>, <span class="st">"SoilpH"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>   <span class="va">shdb.hor</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">shdb.hor</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>   <span class="op">}</span>
  <span class="co">#summary(shdb.hor$oc_d)</span>
  <span class="va">shdb.col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"StudyID"</span>, <span class="st">"ExperimentID"</span>, <span class="st">"SamplingYear"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"Texture"</span>, <span class="st">"ClayPerc"</span>, <span class="st">"SiltPerc"</span>, <span class="st">"SandPerc"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"SoilpH"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"SoilBD"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">shdb.col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">shdb.col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">shdb.hor</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">shdb.hor</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.SoilHealthDB</span> <span class="op">=</span> <span class="va">shdb.hor</span><span class="op">[</span>,<span class="va">shdb.col</span><span class="op">]</span>
  <span class="va">chemsprops.SoilHealthDB</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"SoilHealthDB"</span>
  <span class="va">chemsprops.SoilHealthDB</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">8</span>
  <span class="va">chemsprops.SoilHealthDB</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://github.com/jinshijian/SoilHealthDB"</span>
  <span class="va">chemsprops.SoilHealthDB</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1038/s41597-020-0356-3"</span>
  <span class="va">chemsprops.SoilHealthDB</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.SoilHealthDB</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ClayPerc"</span>, <span class="st">"SoilpH"</span>, <span class="st">"oc"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span><span class="op">)</span>  
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.SoilHealthDB</span><span class="op">)</span>
<span class="co">#&gt; [1] 120  36</span></code></pre></div>
</div>
<div id="global-harmonized-dataset-of-soc-change-under-perennial-crops" class="section level4" number="5.3.0.35">
<h4>
<span class="header-section-number">5.3.0.35</span> Global Harmonized Dataset of SOC change under perennial crops<a class="anchor" aria-label="anchor" href="#global-harmonized-dataset-of-soc-change-under-perennial-crops"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Ledo, A., Hillier, J., Smith, P. et al. (2019) A global, empirical, harmonised dataset of soil organic carbon changes under perennial crops. Sci Data 6, 57. <a href="https://doi.org/10.1038/s41597-019-0062-1" class="uri">https://doi.org/10.1038/s41597-019-0062-1</a>. Data download URL: <a href="https://doi.org/10.6084/m9.figshare.7637210.v2" class="uri">https://doi.org/10.6084/m9.figshare.7637210.v2</a>
</li>
</ul>
<p>Note: Many missing years for PREVIOUS SOC AND SOIL CHARACTERISTICS.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.SOCPDB"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://readxl.tidyverse.org">"readxl"</a></span><span class="op">)</span>
  <span class="va">socpdb</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/INT/SOCPDB/SOC_perennials_DATABASE.xls"</span>, skip<span class="op">=</span><span class="fl">1</span>, sheet <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="co">#names(socpdb)</span>
  <span class="co">#summary(as.numeric(socpdb$year_measure))</span>
  <span class="va">socpdb</span><span class="op">$</span><span class="va">year_measure</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">year_measure</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">yearPpub</span><span class="op">)</span><span class="op">-</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">year_measure</span><span class="op">)</span><span class="op">)</span>
  <span class="va">socpdb</span><span class="op">$</span><span class="va">year_measure</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">year_measure</span><span class="op">&lt;</span><span class="fl">1960</span>, <span class="cn">NA</span>, <span class="va">socpdb</span><span class="op">$</span><span class="va">year_measure</span><span class="op">)</span>
  <span class="va">socpdb</span><span class="op">$</span><span class="va">depth_current</span> <span class="op">=</span> <span class="va">socpdb</span><span class="op">$</span><span class="va">soil_to_cm_current</span> <span class="op">-</span> <span class="va">socpdb</span><span class="op">$</span><span class="va">soil_from_cm_current</span>
  <span class="va">socpdb</span> <span class="op">=</span> <span class="va">socpdb</span><span class="op">[</span><span class="va">socpdb</span><span class="op">$</span><span class="va">depth_current</span><span class="op">&gt;</span><span class="fl">5</span>,<span class="op">]</span>
  <span class="va">socpdb</span><span class="op">$</span><span class="va">SOC_g_kg_current</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">SOC_g_kg_current</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">SOC_Mg_ha_current</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">depth_current</span><span class="op">/</span><span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">bulk_density_Mg_m3_current</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">SOC_g_kg_current</span><span class="op">)</span><span class="op">)</span>
  <span class="va">socpdb</span><span class="op">$</span><span class="va">depth_previous</span> <span class="op">=</span> <span class="va">socpdb</span><span class="op">$</span><span class="va">soil_to_cm_previous</span> <span class="op">-</span> <span class="va">socpdb</span><span class="op">$</span><span class="va">soil_from_cm_previous</span>
  <span class="va">socpdb</span><span class="op">$</span><span class="va">SOC_g_kg_previous</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">SOC_g_kg_previous</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">SOC_Mg_ha_previous</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">depth_previous</span><span class="op">/</span><span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">Bulkdensity_previous</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">$</span><span class="va">SOC_g_kg_previous</span><span class="op">)</span><span class="op">)</span>
  <span class="va">hor.b</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"plotID"</span>, <span class="st">"Longitud"</span>, <span class="st">"Latitud"</span>, <span class="st">"year_measure"</span>, <span class="st">"years_since_luc"</span>, <span class="st">"USDA"</span>, <span class="st">"original_source"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">socpdb1</span> <span class="op">=</span> <span class="va">socpdb</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">hor.b</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"_current"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="co">#summary(as.numeric(socpdb1$years_since_luc))</span>
  <span class="co">## 10 yrs median</span>
  <span class="va">socpdb1</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="va">socpdb1</span><span class="op">$</span><span class="va">year_measure</span>
  <span class="va">socpdb2</span> <span class="op">=</span> <span class="va">socpdb</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">hor.b</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"_previous"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">socpdb</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="va">socpdb2</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="va">socpdb2</span><span class="op">$</span><span class="va">year_measure</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb2</span><span class="op">$</span><span class="va">years_since_luc</span><span class="op">)</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdb2</span><span class="op">$</span><span class="va">years_since_luc</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">socpdb2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"_previous"</span>, <span class="st">"_current"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">socpdb2</span><span class="op">)</span><span class="op">)</span>
  <span class="va">nm.socpdb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"db_od"</span><span class="op">)</span>
  <span class="va">sel.socdpb1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"original_source"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"Longitud"</span>, <span class="st">"Latitud"</span>, <span class="st">"soil_from_cm_current"</span>, <span class="st">"soil_to_cm_current"</span>, <span class="st">"%clay_current"</span>, <span class="st">"%silt_current"</span>, <span class="st">"%sand_current"</span>, <span class="st">"SOC_g_kg_current"</span>, <span class="st">"ph_current"</span>, <span class="st">"bulk_density_Mg_m3_current"</span><span class="op">)</span>
  <span class="va">sel.socdpb2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"original_source"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"Longitud"</span>, <span class="st">"Latitud"</span>, <span class="st">"soil_from_cm_current"</span>, <span class="st">"soil_to_cm_current"</span>, <span class="st">"%clay_current"</span>, <span class="st">"%silt_current"</span>, <span class="st">"%sand_current"</span>, <span class="st">"SOC_g_kg_current"</span>, <span class="st">"ph_current"</span>, <span class="st">"Bulkdensity_current"</span><span class="op">)</span>   
  <span class="va">socpdbALL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">socpdb1</span><span class="op">[</span>,<span class="va">sel.socdpb1</span><span class="op">]</span>, <span class="va">socpdb2</span><span class="op">[</span>,<span class="va">sel.socdpb2</span><span class="op">]</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">nm.socpdb</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">socpdbALL</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">socpdbALL</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">socpdbALL</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">}</span>
  <span class="co">#summary(socpdbALL$oc) ## mean = 15</span>
  <span class="co">#summary(socpdbALL$db_od)</span>
  <span class="co">#summary(socpdbALL$ph_h2o)</span>
  <span class="va">socpdbALL</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">socpdbALL</span><span class="op">$</span><span class="va">oc</span> <span class="op">*</span> <span class="va">socpdbALL</span><span class="op">$</span><span class="va">db_od</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#summary(socpdbALL$oc_d)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">col.names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">col.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">socpdbALL</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">socpdbALL</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.SOCPDB</span> <span class="op">&lt;-</span> <span class="va">socpdbALL</span><span class="op">[</span>,<span class="va">col.names</span><span class="op">]</span>
  <span class="va">chemsprops.SOCPDB</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"SOCPDB"</span>
  <span class="va">chemsprops.SOCPDB</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">5</span>
  <span class="va">chemsprops.SOCPDB</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://africap.info/"</span>
  <span class="va">chemsprops.SOCPDB</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1038/s41597-019-0062-1"</span>
  <span class="va">chemsprops.SOCPDB</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.SOCPDB</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>,<span class="st">"ph_h2o"</span>,<span class="st">"clay_tot_psa"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.SOCPDB</span><span class="op">)</span>
<span class="co">#&gt; [1] 1526   36</span></code></pre></div>
</div>
<div id="stocks-of-organic-carbon-in-german-agricultural-soils-bze_lw-1" class="section level4" number="5.3.0.36">
<h4>
<span class="header-section-number">5.3.0.36</span> Stocks of organic carbon in German agricultural soils (BZE_LW)<a class="anchor" aria-label="anchor" href="#stocks-of-organic-carbon-in-german-agricultural-soils-bze_lw-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Poeplau, C., Jacobs, A., Don, A., Vos, C., Schneider, F., Wittnebel, M., … &amp; Flessa, H. (2020). <a href="https://doi.org/10.1002/jpln.202000113">Stocks of organic carbon in German agricultural soils—Key results of the first comprehensive inventory</a>. Journal of Plant Nutrition and Soil Science, 183(6), 665-681. <a href="https://doi.org/10.1002/jpln.202000113" class="uri">https://doi.org/10.1002/jpln.202000113</a>. Data download URL: <a href="https://doi.org/10.3220/DATA20200203151139" class="uri">https://doi.org/10.3220/DATA20200203151139</a>
</li>
</ul>
<p>Note: For protection of data privacy, the coordinate was randomly generated within a radius of 4-km around the planned sampling point. This data is hence probably not suitable for spatial analysis, predictive soil mapping.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.BZE_LW"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">site.de</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Germany/SITE.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">site.de</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"01-"</span>, <span class="va">site.de</span><span class="op">$</span><span class="va">Sampling_month</span>, <span class="st">"-"</span>, <span class="va">site.de</span><span class="op">$</span><span class="va">Sampling_year</span><span class="op">)</span>, format<span class="op">=</span><span class="st">"%d-%m-%Y"</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">site.de.xy</span> <span class="op">=</span> <span class="va">site.de</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PointID"</span>,<span class="st">"xcoord"</span>,<span class="st">"ycoord"</span><span class="op">)</span><span class="op">]</span>
  <span class="co">## 3104</span>
  <span class="fu">coordinates</span><span class="op">(</span><span class="va">site.de.xy</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">xcoord</span><span class="op">+</span><span class="va">ycoord</span>
  <span class="fu">proj4string</span><span class="op">(</span><span class="va">site.de.xy</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span><span class="op">)</span>
  <span class="va">site.de.ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">spTransform</span><span class="op">(</span><span class="va">site.de.xy</span>, <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">site.de</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="va">site.de.ll</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
  <span class="va">site.de</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="va">site.de.ll</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>
  <span class="va">hor.de</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Germany/LABORATORY_DATA.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="co">#hor.de = plyr::join(openxlsx::read.xlsx("/mnt/diskstation/data/Soil_points/Germany/LABORATORY_DATA.xlsx", sheet = 1), openxlsx::read.xlsx("/mnt/diskstation/data/Soil_points/Germany/HORIZON_DATA.xlsx", sheet = 1), by="PointID")</span>
  <span class="co">## 17,189 rows</span>
  <span class="va">horALL.de</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hor.de</span>, <span class="va">site.de</span>, by<span class="op">=</span><span class="st">"PointID"</span><span class="op">)</span>
  <span class="co">## Sand content [Mass-%]; grain size 63-2000µm (DIN ISO 11277)</span>
  <span class="va">horALL.de</span><span class="op">$</span><span class="va">sand_tot_psa</span> <span class="op">&lt;-</span> <span class="va">horALL.de</span><span class="op">$</span><span class="va">gS</span> <span class="op">+</span> <span class="va">horALL.de</span><span class="op">$</span><span class="va">mS</span> <span class="op">+</span> <span class="va">horALL.de</span><span class="op">$</span><span class="va">fS</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">horALL.de</span><span class="op">$</span><span class="va">gU</span>
  <span class="va">horALL.de</span><span class="op">$</span><span class="va">silt_tot_psa</span> <span class="op">&lt;-</span> <span class="va">horALL.de</span><span class="op">$</span><span class="va">fU</span> <span class="op">+</span> <span class="va">horALL.de</span><span class="op">$</span><span class="va">mU</span> <span class="op">+</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">horALL.de</span><span class="op">$</span><span class="va">gU</span>
  <span class="co">## Convert millisiemens/meter [mS/m] to microsiemens/centimeter [μS/cm, uS/cm]</span>
  <span class="va">horALL.de</span><span class="op">$</span><span class="va">ec_satp</span> <span class="op">=</span> <span class="va">horALL.de</span><span class="op">$</span><span class="va">EC_H2O</span> <span class="op">/</span> <span class="fl">10</span>
  <span class="va">hor.sel.de</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PointID"</span>, <span class="st">"Main.soil.type"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"Layer.upper.limit"</span>, <span class="st">"Layer.lower.limit"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"Soil.texture.class"</span>, <span class="st">"Clay"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"TOC"</span>, <span class="st">"oc_d"</span>, <span class="st">"TC"</span>, <span class="st">"TN"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"pH_H2O"</span>, <span class="st">"pH_CaCl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"Rock.fragment.fraction"</span>, <span class="st">"BD_FS"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="co">#summary(horALL.de$TOC) ## mean = 12.3</span>
  <span class="co">#summary(horALL.de$BD_FS) ## mean = 1.41</span>
  <span class="co">#summary(horALL.de$pH_H2O)</span>
  <span class="va">horALL.de</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">horALL.de</span><span class="op">$</span><span class="va">TOC</span> <span class="op">*</span> <span class="va">horALL.de</span><span class="op">$</span><span class="va">BD_FS</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">horALL.de</span><span class="op">$</span><span class="va">Rock.fragment.fraction</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#summary(horALL.de$oc_d)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">hor.sel.de</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">hor.sel.de</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">horALL.de</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">horALL.de</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.BZE_LW</span> <span class="op">&lt;-</span> <span class="va">horALL.de</span><span class="op">[</span>,<span class="va">hor.sel.de</span><span class="op">]</span>
  <span class="va">chemsprops.BZE_LW</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"BZE_LW"</span>
  <span class="va">chemsprops.BZE_LW</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">3</span>
  <span class="va">chemsprops.BZE_LW</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://www.thuenen.de/de/ak/"</span>
  <span class="va">chemsprops.BZE_LW</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1002/jpln.202000113"</span>
  <span class="va">chemsprops.BZE_LW</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.BZE_LW</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TOC"</span>, <span class="st">"pH_H2O"</span>, <span class="st">"Clay"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.BZE_LW</span><span class="op">)</span>
<span class="co">#&gt; [1] 17187    36</span></code></pre></div>
</div>
<div id="aardewerk-vlaanderen-2010-1" class="section level4" number="5.3.0.37">
<h4>
<span class="header-section-number">5.3.0.37</span> AARDEWERK-Vlaanderen-2010<a class="anchor" aria-label="anchor" href="#aardewerk-vlaanderen-2010-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Beckers, V., Jacxsens, P., Van De Vreken, Ph., Van Meirvenne, M., Van Orshoven, J. (2011). Gebruik en installatie van de bodemdatabank AARDEWERK-Vlaanderen-2010. Spatial Applications Division Leuven, Belgium. Data download URL: <a href="https://www.dov.vlaanderen.be/geonetwork/home/api/records/78e15dd4-8070-4220-afac-258ea040fb30" class="uri">https://www.dov.vlaanderen.be/geonetwork/home/api/records/78e15dd4-8070-4220-afac-258ea040fb30</a>
</li>
<li>Ottoy, S., Beckers, V., Jacxsens, P., Hermy, M., &amp; Van Orshoven, J. (2015). <a href="https://doi.org/10.1016/j.geoderma.2015.04.001">Multi-level statistical soil profiles for assessing regional soil organic carbon stocks</a>. Geoderma, 253, 12-20. <a href="https://doi.org/10.1016/j.geoderma.2015.04.001" class="uri">https://doi.org/10.1016/j.geoderma.2015.04.001</a>
</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.Vlaanderen2010"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">site.vl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Belgium/Vlaanderen/Aardewerk-Vlaanderen-2010_Profiel.csv"</span><span class="op">)</span>
  <span class="va">site.vl</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">site.vl</span><span class="op">$</span><span class="va">Profilering_Datum</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">" "</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">}</span><span class="op">)</span>, format<span class="op">=</span><span class="st">"%d-%m-%Y"</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">site.vl.xy</span> <span class="op">=</span> <span class="va">site.vl</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"Coordinaat_Lambert72_X"</span>,<span class="st">"Coordinaat_Lambert72_Y"</span><span class="op">)</span><span class="op">]</span>
  <span class="co">## 7020</span>
  <span class="va">site.vl.xy</span> <span class="op">=</span> <span class="va">site.vl.xy</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">site.vl.xy</span><span class="op">)</span>,<span class="op">]</span>
  <span class="fu">coordinates</span><span class="op">(</span><span class="va">site.vl.xy</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">Coordinaat_Lambert72_X</span><span class="op">+</span><span class="va">Coordinaat_Lambert72_Y</span>
  <span class="fu">proj4string</span><span class="op">(</span><span class="va">site.vl.xy</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">CRS</span><span class="op">(</span><span class="st">"+init=epsg:31300"</span><span class="op">)</span>
  <span class="va">site.vl.ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">spTransform</span><span class="op">(</span><span class="va">site.vl.xy</span>, <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">site.vl</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="fu">join</span><span class="op">(</span><span class="va">site.vl</span><span class="op">[</span><span class="st">"ID"</span><span class="op">]</span>, <span class="va">site.vl.ll</span>, by<span class="op">=</span><span class="st">"ID"</span><span class="op">)</span><span class="op">$</span><span class="va">Coordinaat_Lambert72_X</span>
  <span class="va">site.vl</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="fu">join</span><span class="op">(</span><span class="va">site.vl</span><span class="op">[</span><span class="st">"ID"</span><span class="op">]</span>, <span class="va">site.vl.ll</span>, by<span class="op">=</span><span class="st">"ID"</span><span class="op">)</span><span class="op">$</span><span class="va">Coordinaat_Lambert72_Y</span>
  <span class="va">site.vl</span><span class="op">$</span><span class="va">Profiel_ID</span> <span class="op">=</span> <span class="va">site.vl</span><span class="op">$</span><span class="va">ID</span>
  <span class="va">hor.vl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Belgium/Vlaanderen/Aardewerk-Vlaanderen-2010_Horizont.csv"</span><span class="op">)</span>
  <span class="co">## 42,529 rows</span>
  <span class="va">horALL.vl</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">hor.vl</span>, <span class="va">site.vl</span>, by<span class="op">=</span><span class="st">"Profiel_ID"</span><span class="op">)</span>
  <span class="va">horALL.vl</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">horALL.vl</span><span class="op">$</span><span class="va">Humus</span><span class="op">*</span><span class="fl">10</span> <span class="op">/</span><span class="fl">1.724</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">horALL.vl</span><span class="op">$</span><span class="va">oc</span><span class="op">)</span> <span class="co">## mean = 7.8</span>
  <span class="co">#summary(horALL.vl$pH_H2O)</span>
  <span class="va">horALL.vl</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">horALL.vl</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Diepte_grens_boven1"</span>, <span class="st">"Diepte_grens_boven2"</span><span class="op">)</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>
  <span class="va">horALL.vl</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">horALL.vl</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Diepte_grens_onder1"</span>,<span class="st">"Diepte_grens_onder2"</span><span class="op">)</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>
  <span class="va">horALL.vl</span><span class="op">$</span><span class="va">sand_tot_psa</span> <span class="op">&lt;-</span> <span class="va">horALL.vl</span><span class="op">$</span><span class="va">T50_100</span> <span class="op">+</span> <span class="va">horALL.vl</span><span class="op">$</span><span class="va">T100_200</span> <span class="op">+</span> <span class="va">horALL.vl</span><span class="op">$</span><span class="va">T200_500</span> <span class="op">+</span> <span class="va">horALL.vl</span><span class="op">$</span><span class="va">T500_1000</span> <span class="op">+</span> <span class="va">horALL.vl</span><span class="op">$</span><span class="va">T1000_2000</span>
  <span class="va">horALL.vl</span><span class="op">$</span><span class="va">silt_tot_psa</span> <span class="op">&lt;-</span> <span class="va">horALL.vl</span><span class="op">$</span><span class="va">T2_10</span> <span class="op">+</span> <span class="va">horALL.vl</span><span class="op">$</span><span class="va">T10_20</span> <span class="op">+</span> <span class="va">horALL.vl</span><span class="op">$</span><span class="va">T20_50</span>
  <span class="va">horALL.vl</span><span class="op">$</span><span class="va">tex_psda</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">horALL.vl</span><span class="op">$</span><span class="va">HorizontTextuur_code1</span>, <span class="va">horALL.vl</span><span class="op">$</span><span class="va">HorizontTextuur_code2</span><span class="op">)</span>
  <span class="co">## some corrupt coordinates</span>
  <span class="va">horALL.vl</span> <span class="op">&lt;-</span> <span class="va">horALL.vl</span><span class="op">[</span><span class="va">horALL.vl</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">&gt;</span> <span class="fl">50.6</span>,<span class="op">]</span>
  <span class="va">hor.sel.vl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Profiel_ID"</span>, <span class="st">"Bodemgroep"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"labsampnum"</span>, <span class="st">"Hor_nr"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"Naam"</span>, <span class="st">"tex_psda"</span>, <span class="st">"T0_2"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"pH_KCl"</span>, <span class="st">"pH_H2O"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"Sorptiecapaciteit_Totaal"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"Tgroter_dan_2000"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">hor.sel.vl</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">hor.sel.vl</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">horALL.vl</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">horALL.vl</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.Vlaanderen</span> <span class="op">&lt;-</span> <span class="va">horALL.vl</span><span class="op">[</span>,<span class="va">hor.sel.vl</span><span class="op">]</span>
  <span class="va">chemsprops.Vlaanderen</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Vlaanderen"</span>
  <span class="va">chemsprops.Vlaanderen</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.Vlaanderen</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://www.dov.vlaanderen.be"</span>
  <span class="va">chemsprops.Vlaanderen</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.1016/j.geoderma.2015.04.001"</span>
  <span class="va">chemsprops.Vlaanderen</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.Vlaanderen</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"pH_H2O"</span>, <span class="st">"T0_2"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.Vlaanderen</span><span class="op">)</span>
<span class="co">#&gt; [1] 41310    36</span></code></pre></div>
</div>
<div id="chilean-soil-organic-carbon-database-1" class="section level4" number="5.3.0.38">
<h4>
<span class="header-section-number">5.3.0.38</span> Chilean Soil Organic Carbon database<a class="anchor" aria-label="anchor" href="#chilean-soil-organic-carbon-database-1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Pfeiffer, M., Padarian, J., Osorio, R., Bustamante, N., Olmedo, G. F., Guevara, M., et al. (2020) <a href="https://doi.org/10.5194/essd-12-457-2020">CHLSOC: the Chilean Soil Organic Carbon database, a multi-institutional collaborative effort</a>. Earth Syst. Sci. Data, 12, 457–468, <a href="https://doi.org/10.5194/essd-12-457-2020" class="uri">https://doi.org/10.5194/essd-12-457-2020</a>. Data download URL: <a href="https://doi.org/10.17605/OSF.IO/NMYS3" class="uri">https://doi.org/10.17605/OSF.IO/NMYS3</a>
</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.CHLSOC"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">chl.hor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Chile/CHLSOC/CHLSOC_v1.0.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">#summary(chl.hor$oc)</span>
  <span class="va">chl.hor</span><span class="op">$</span><span class="va">oc</span> <span class="op">=</span> <span class="va">chl.hor</span><span class="op">$</span><span class="va">oc</span><span class="op">*</span><span class="fl">10</span>
  <span class="co">#summary(chl.hor$bd)</span>
  <span class="va">chl.hor</span><span class="op">$</span><span class="va">oc_d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">chl.hor</span><span class="op">$</span><span class="va">oc</span>  <span class="op">*</span> <span class="va">chl.hor</span><span class="op">$</span><span class="va">bd</span> <span class="op">*</span> <span class="op">(</span><span class="fl">100</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">chl.hor</span><span class="op">$</span><span class="va">crf</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">chl.hor</span><span class="op">$</span><span class="va">crf</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="co">#summary(chl.hor$oc_d)</span>
  <span class="va">chl.col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ProfileID"</span>, <span class="st">"usiteid"</span>, <span class="st">"year"</span>, <span class="st">"long"</span>, <span class="st">"lat"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"top"</span>, <span class="st">"bottom"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"crf"</span>, <span class="st">"bd"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">chl.col</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">chl.col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chl.hor</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">chl.hor</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.CHLSOC</span> <span class="op">=</span> <span class="va">chl.hor</span><span class="op">[</span>,<span class="va">chl.col</span><span class="op">]</span>
  <span class="va">chemsprops.CHLSOC</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Chilean_SOCDB"</span>
  <span class="va">chemsprops.CHLSOC</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.CHLSOC</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.17605/OSF.IO/NMYS3"</span>
  <span class="va">chemsprops.CHLSOC</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.5194/essd-12-457-2020"</span>
  <span class="va">chemsprops.CHLSOC</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.CHLSOC</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"bd"</span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.CHLSOC</span><span class="op">)</span>
<span class="co">#&gt; [1] 16371    36</span></code></pre></div>
</div>
<div id="scotland-nsis_1" class="section level4" number="5.3.0.39">
<h4>
<span class="header-section-number">5.3.0.39</span> Scotland (NSIS_1)<a class="anchor" aria-label="anchor" href="#scotland-nsis_1"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Lilly, A., Bell, J.S., Hudson, G., Nolan, A.J. &amp; Towers. W. (Compilers) (2010). National soil inventory of Scotland (NSIS_1); site location, sampling and profile description protocols. (1978-1988). Technical Bulletin. Macaulay Institute, Aberdeen. <a href="https://doi.org/10.5281/zenodo.4650230" class="uri">https://doi.org/10.5281/zenodo.4650230</a>. Data download URL: <a href="https://www.hutton.ac.uk/learning/natural-resource-datasets/soilshutton/soils-maps-scotland/download" class="uri">https://www.hutton.ac.uk/learning/natural-resource-datasets/soilshutton/soils-maps-scotland/download</a>
</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.ScotlandNSIS1"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">sco.xy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Scotland/NSIS_10km.csv"</span><span class="op">)</span>
  <span class="fu">coordinates</span><span class="op">(</span><span class="va">sco.xy</span><span class="op">)</span> <span class="op">=</span> <span class="op">~</span> <span class="va">easting</span> <span class="op">+</span> <span class="va">northing</span>
  <span class="fu">proj4string</span><span class="op">(</span><span class="va">sco.xy</span><span class="op">)</span> <span class="op">=</span> <span class="st">"EPSG:27700"</span>
  <span class="va">sco.ll</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">spTransform</span><span class="op">(</span><span class="va">sco.xy</span>, <span class="fu">CRS</span><span class="op">(</span><span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">sco.ll</span><span class="op">$</span><span class="va">site_obsdate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">sco.ll</span><span class="op">$</span><span class="va">profile_da</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">-</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#hist(sco.ll$site_obsdate[sco.ll$site_obsdate&gt;1000])</span>
  <span class="co">## no points after 1990!!</span>
  <span class="co">#summary(sco.ll$exch_k)</span>
  <span class="va">sco.in.name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"profile_id"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"easting"</span>, <span class="st">"northing"</span>, <span class="st">"horz_top"</span>, <span class="st">"horz_botto"</span>, 
                  <span class="st">"horz_symb"</span>, <span class="st">"sample_id"</span>, <span class="st">"texture_ps"</span>,
                  <span class="st">"sand_int"</span>, <span class="st">"silt_int"</span>, <span class="st">"clay"</span>, <span class="st">"carbon"</span>, <span class="st">"nitrogen"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"exch_ca"</span>, 
                  <span class="st">"exch_mg"</span>, <span class="st">"exch_na"</span>, <span class="st">"exch_k"</span>, <span class="st">"sum_cation"</span><span class="op">)</span>
  <span class="co">#sco.in.name[which(!sco.in.name %in% names(sco.ll))]</span>
  <span class="va">sco.x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">sco.ll</span><span class="op">[</span>,<span class="va">sco.in.name</span><span class="op">]</span><span class="op">)</span>
  <span class="co">#sco.x = sco.x[!sco.x$sample_id==0,]</span>
  <span class="co">#summary(sco.x$carbon)</span>
  <span class="va">sco.out.name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>,
                     <span class="st">"hzn_bot"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"labsampnum"</span>, <span class="st">"tex_psda"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, 
                      <span class="st">"clay_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ca_ext"</span>,
                      <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"cec_sum"</span><span class="op">)</span>
  <span class="co">## translate values</span>
  <span class="va">sco.fun.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"as.numeric(x)*1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sco.in.name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">sco.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sco.in.name</span><span class="op">==</span><span class="st">"profile_id"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"paste(x)"</span>
  <span class="va">sco.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sco.in.name</span><span class="op">==</span><span class="st">"exch_ca"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"as.numeric(x)*200"</span>
  <span class="va">sco.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sco.in.name</span><span class="op">==</span><span class="st">"exch_mg"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"as.numeric(x)*121"</span>
  <span class="va">sco.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sco.in.name</span><span class="op">==</span><span class="st">"exch_k"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"as.numeric(x)*391"</span>
  <span class="va">sco.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sco.in.name</span><span class="op">==</span><span class="st">"exch_na"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"as.numeric(x)*230"</span>
  <span class="va">sco.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sco.in.name</span><span class="op">==</span><span class="st">"carbon"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"as.numeric(x)*10"</span>
  <span class="va">sco.fun.lst</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">sco.in.name</span><span class="op">==</span><span class="st">"nitrogen"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"as.numeric(x)*10"</span>
  <span class="co">## save translation rules:</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">sco.in.name</span>, <span class="va">sco.out.name</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">sco.fun.lst</span><span class="op">)</span><span class="op">)</span>, <span class="st">"scotland_soilab_transvalues.csv"</span><span class="op">)</span>
  <span class="va">sco.soil</span> <span class="op">=</span> <span class="fu">transvalues</span><span class="op">(</span><span class="va">sco.x</span>, <span class="va">sco.out.name</span>, <span class="va">sco.in.name</span>, <span class="va">sco.fun.lst</span><span class="op">)</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">col.names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">col.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sco.soil</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">sco.soil</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.ScotlandNSIS1</span> <span class="op">=</span> <span class="va">sco.soil</span><span class="op">[</span>,<span class="va">col.names</span><span class="op">]</span>
  <span class="va">chemsprops.ScotlandNSIS1</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"ScotlandNSIS1"</span>
  <span class="va">chemsprops.ScotlandNSIS1</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">chemsprops.ScotlandNSIS1</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"http://soils.environment.gov.scot/"</span>
  <span class="va">chemsprops.ScotlandNSIS1</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.5281/zenodo.4650230"</span>
  <span class="va">chemsprops.ScotlandNSIS1</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.ScotlandNSIS1</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"clay_tot_psa"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.ScotlandNSIS1</span><span class="op">)</span>
<span class="co">#&gt; [1] 2977   36</span></code></pre></div>
</div>
<div id="ecoforest-map-of-quebec-canada" class="section level4" number="5.3.0.40">
<h4>
<span class="header-section-number">5.3.0.40</span> Ecoforest map of Quebec, Canada<a class="anchor" aria-label="anchor" href="#ecoforest-map-of-quebec-canada"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Duchesne, L., Ouimet, R., (2021). Digital mapping of soil texture in ecoforest polygons in Quebec, Canada. PeerJ 9:e11685 <a href="https://doi.org/10.7717/peerj.11685" class="uri">https://doi.org/10.7717/peerj.11685</a>. Data download URL: <a href="https://doi.org/10.7717/peerj.11685/supp-1" class="uri">https://doi.org/10.7717/peerj.11685/supp-1</a>
</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.QuebecTEX"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">que.xy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/Soil_points/Canada/Quebec/RawData.csv"</span><span class="op">)</span>
  <span class="co">#summary(as.factor(que.xy$Horizon))</span>
  <span class="co">## horizon depths were not measured - we assume 15-30 and 30-80</span>
  <span class="va">que.xy</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">que.xy</span><span class="op">$</span><span class="va">Horizon</span><span class="op">==</span><span class="st">"B"</span>, <span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span>
  <span class="va">que.xy</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">que.xy</span><span class="op">$</span><span class="va">Horizon</span><span class="op">==</span><span class="st">"B"</span>, <span class="fl">30</span>, <span class="fl">80</span><span class="op">)</span>
  <span class="va">que.xy</span><span class="op">$</span><span class="va">site_key</span> <span class="op">=</span> <span class="va">que.xy</span><span class="op">$</span><span class="va">usiteid</span>
  <span class="va">que.xy</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span> <span class="op">=</span> <span class="va">que.xy</span><span class="op">$</span><span class="va">Latitude</span>
  <span class="va">que.xy</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span> <span class="op">=</span> <span class="va">que.xy</span><span class="op">$</span><span class="va">Longitude</span>
  <span class="va">que.xy</span><span class="op">$</span><span class="va">hzn_desgn</span> <span class="op">=</span> <span class="va">que.xy</span><span class="op">$</span><span class="va">Horizon</span>
  <span class="va">que.xy</span><span class="op">$</span><span class="va">sand_tot_psa</span> <span class="op">=</span> <span class="va">que.xy</span><span class="op">$</span><span class="va">PC_Sand</span>
  <span class="va">que.xy</span><span class="op">$</span><span class="va">silt_tot_psa</span> <span class="op">=</span> <span class="va">que.xy</span><span class="op">$</span><span class="va">PC_Silt</span>
  <span class="va">que.xy</span><span class="op">$</span><span class="va">clay_tot_psa</span> <span class="op">=</span> <span class="va">que.xy</span><span class="op">$</span><span class="va">PC_Clay</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">col.names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">col.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">que.xy</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">que.xy</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.QuebecTEX</span> <span class="op">=</span> <span class="va">que.xy</span><span class="op">[</span>,<span class="va">col.names</span><span class="op">]</span>
  <span class="va">chemsprops.QuebecTEX</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"QuebecTEX"</span>
  <span class="va">chemsprops.QuebecTEX</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">4</span>
  <span class="va">chemsprops.QuebecTEX</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">""</span>
  <span class="va">chemsprops.QuebecTEX</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://doi.org/10.7717/peerj.11685"</span>
  <span class="va">chemsprops.QuebecTEX</span> <span class="op">=</span> <span class="fu">complete.vars</span><span class="op">(</span><span class="va">chemsprops.QuebecTEX</span>, sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"clay_tot_psa"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.QuebecTEX</span><span class="op">)</span>
<span class="co">#&gt; [1] 26648    36</span></code></pre></div>
</div>
<div id="pseudo-observations" class="section level4" number="5.3.0.41">
<h4>
<span class="header-section-number">5.3.0.41</span> Pseudo-observations<a class="anchor" aria-label="anchor" href="#pseudo-observations"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li>Pseudo-observations using simulated points (world deserts)</li>
</ul>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"chemsprops.SIM"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">## 0 soil organic carbon + 98% sand content (deserts)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"deserts.pnt.rda"</span><span class="op">)</span>
  <span class="va">nut.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">spTransform</span><span class="op">(</span><span class="va">deserts.pnt</span>, <span class="fu">CRS</span><span class="op">(</span><span class="st">"+proj=longlat +datum=WGS84"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">nut.sim</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="va">nut.sim</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rename.html">rename</a></span><span class="op">(</span><span class="va">nut.sim</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">=</span><span class="st">"longitude_decimal_degrees"</span>, <span class="st">"y"</span><span class="op">=</span><span class="st">"latitude_decimal_degrees"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">nr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">nut.sim</span><span class="op">)</span>
  <span class="va">nut.sim</span><span class="op">$</span><span class="va">site_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Simulated"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nr</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
  <span class="co">## insert zeros for all nutrients except for the once we are not sure:</span>
  <span class="co">## http://www.decodedscience.org/chemistry-sahara-sand-elements-dunes/45828</span>
  <span class="va">sim.vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ecec"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"mg_ext"</span>, <span class="st">"k_ext"</span><span class="op">)</span>
  <span class="va">nut.sim</span><span class="op">[</span>,<span class="va">sim.vars</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="va">nut.sim</span><span class="op">$</span><span class="va">silt_tot_psa</span> <span class="op">=</span> <span class="fl">2</span>
  <span class="va">nut.sim</span><span class="op">$</span><span class="va">sand_tot_psa</span> <span class="op">=</span> <span class="fl">98</span>
  <span class="va">nut.sim</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="va">nut.sim</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fl">30</span>
  <span class="va">nut.sim</span><span class="op">$</span><span class="va">db_od</span> <span class="op">=</span> <span class="fl">1.55</span>
  <span class="va">nut.sim2</span> <span class="op">=</span> <span class="va">nut.sim</span>
  <span class="va">nut.sim2</span><span class="op">$</span><span class="va">silt_tot_psa</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">nut.sim2</span><span class="op">$</span><span class="va">sand_tot_psa</span> <span class="op">=</span> <span class="fl">99</span>
  <span class="va">nut.sim2</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">=</span> <span class="fl">30</span>
  <span class="va">nut.sim2</span><span class="op">$</span><span class="va">hzn_bot</span> <span class="op">=</span> <span class="fl">60</span>
  <span class="va">nut.sim2</span><span class="op">$</span><span class="va">db_od</span> <span class="op">=</span> <span class="fl">1.6</span>
  <span class="va">nut.simA</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">nut.sim</span>, <span class="va">nut.sim2</span><span class="op">)</span>
  <span class="co">#str(nut.simA)</span>
  <span class="va">nut.simA</span><span class="op">$</span><span class="va">source_db</span> <span class="op">=</span> <span class="st">"Simulated"</span>
  <span class="va">nut.simA</span><span class="op">$</span><span class="va">confidence_degree</span> <span class="op">=</span> <span class="fl">10</span>
  <span class="va">x.na</span> <span class="op">=</span> <span class="va">col.names</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">col.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">nut.simA</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x.na</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">x.na</span><span class="op">)</span><span class="op">{</span> <span class="va">nut.simA</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="op">}</span> <span class="op">}</span>
  <span class="va">chemsprops.SIM</span> <span class="op">=</span> <span class="va">nut.simA</span><span class="op">[</span>,<span class="va">col.names</span><span class="op">]</span>
  <span class="va">chemsprops.SIM</span><span class="op">$</span><span class="va">project_url</span> <span class="op">=</span> <span class="st">"https://gitlab.com/openlandmap/"</span>
  <span class="va">chemsprops.SIM</span><span class="op">$</span><span class="va">citation_url</span> <span class="op">=</span> <span class="st">"https://gitlab.com/openlandmap/compiled-ess-point-data-sets/"</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">chemsprops.SIM</span><span class="op">)</span>
<span class="co">#&gt; [1] 718  36</span></code></pre></div>
<p>Other potential large soil profile DBs of interest:</p>
<ul>
<li>Shangguan, W., Dai, Y., Liu, B., Zhu, A., Duan, Q., Wu, L., … &amp; Chen, D. (2013). <a href="https://doi.org/10.1002/jame.20026">A China data set of soil properties for land surface modeling</a>. Journal of Advances in Modeling Earth Systems, 5(2), 212-224.</li>
<li>Salković, E., Djurović, I., Knežević, M., Popović-Bugarin, V., &amp; Topalović, A. (2018). Digitization and mapping of national legacy soil data of Montenegro. Soil and Water Research, 13(2), 83-89. <a href="https://doi.org/10.17221/81/2017-SWR" class="uri">https://doi.org/10.17221/81/2017-SWR</a>
</li>
</ul>
</div>
</div>
<div id="alt-text-bind-all-datasets" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> <img src="tex/R_logo.svg.png" title="Bind everything" alt="alt text"> Bind all datasets<a class="anchor" aria-label="anchor" href="#alt-text-bind-all-datasets"><i class="fas fa-link"></i></a>
</h2>
<div id="bind-and-clean-up" class="section level4" number="5.4.0.1">
<h4>
<span class="header-section-number">5.4.0.1</span> Bind and clean-up<a class="anchor" aria-label="anchor" href="#bind-and-clean-up"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/glob2rx.html">glob2rx</a></span><span class="op">(</span><span class="st">"chemsprops.*"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;  [1] "chemsprops.AfSIS1"        "chemsprops.AfSPDB"       </span>
<span class="co">#&gt;  [3] "chemsprops.Alaska"        "chemsprops.bpht"         </span>
<span class="co">#&gt;  [5] "chemsprops.BZE_LW"        "chemsprops.CAPERM"       </span>
<span class="co">#&gt;  [7] "chemsprops.CHLSOC"        "chemsprops.CNSOT"        </span>
<span class="co">#&gt;  [9] "chemsprops.CostaRica"     "chemsprops.CUFS"         </span>
<span class="co">#&gt; [11] "chemsprops.EGRPR"         "chemsprops.FEBR"         </span>
<span class="co">#&gt; [13] "chemsprops.FIADB"         "chemsprops.FRED"         </span>
<span class="co">#&gt; [15] "chemsprops.GEMAS"         "chemsprops.GROOT"        </span>
<span class="co">#&gt; [17] "chemsprops.IRANSPDB"      "chemsprops.ISCND"        </span>
<span class="co">#&gt; [19] "chemsprops.LandPKS"       "chemsprops.LUCAS"        </span>
<span class="co">#&gt; [21] "chemsprops.LUCAS2"        "chemsprops.Mangroves"    </span>
<span class="co">#&gt; [23] "chemsprops.NAMSOTER"      "chemsprops.NatSoil"      </span>
<span class="co">#&gt; [25] "chemsprops.NCSCD"         "chemsprops.NCSS"         </span>
<span class="co">#&gt; [27] "chemsprops.NPDB"          "chemsprops.Peatlands"    </span>
<span class="co">#&gt; [29] "chemsprops.PRONASOLOS"    "chemsprops.QuebecTEX"    </span>
<span class="co">#&gt; [31] "chemsprops.RaCA"          "chemsprops.RemnantSOC"   </span>
<span class="co">#&gt; [33] "chemsprops.ScotlandNSIS1" "chemsprops.SIM"          </span>
<span class="co">#&gt; [35] "chemsprops.SISLAC"        "chemsprops.SOCPDB"       </span>
<span class="co">#&gt; [37] "chemsprops.SoDaH"         "chemsprops.SoilHealthDB" </span>
<span class="co">#&gt; [39] "chemsprops.SRDB"          "chemsprops.USGS.NGS"     </span>
<span class="co">#&gt; [41] "chemsprops.Vlaanderen"    "chemsprops.WISE"</span>
<span class="va">tot_sprops</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/glob2rx.html">glob2rx</a></span><span class="op">(</span><span class="st">"chemsprops.*"</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span> <span class="fu">mutate_all</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, <span class="va">col.names</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="co">## convert to numeric:</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"layer_sequence"</span>, 
           <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, 
           <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, 
           <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, 
           <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; Warning: NAs introduced by coercion</span>

<span class="co">#&gt; Warning: NAs introduced by coercion</span>

<span class="co">#&gt; Warning: NAs introduced by coercion</span>

<span class="co">#&gt; Warning: NAs introduced by coercion</span>

<span class="co">#&gt; Warning: NAs introduced by coercion</span>
<span class="co">#head(tot_sprops)</span></code></pre></div>
<p>Clean up typos and physically impossible values:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tex.rm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"clay_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"silt_tot_psa"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">tex.rm</span><span class="op">)</span>
<span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's </span>
<span class="co">#&gt; -2997.00   100.00   100.00    99.39   100.00   500.00   274336</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"clay_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"wpg2"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">100</span><span class="op">|</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tex.rm</span><span class="op">&lt;</span><span class="fl">99</span><span class="op">|</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tex.rm</span><span class="op">)</span><span class="op">|</span><span class="va">tex.rm</span><span class="op">&gt;</span><span class="fl">101</span>, <span class="cn">NA</span>, <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ph_h2o"</span>,<span class="st">"ph_kcl"</span>,<span class="st">"ph_cacl2"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">12</span><span class="op">|</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">2</span>, <span class="cn">NA</span>, <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#hist(tot_sprops$db_od)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"db_od"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">2.4</span><span class="op">|</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0.05</span>, <span class="cn">NA</span>, <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#hist(tot_sprops$oc)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"oc"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">800</span><span class="op">|</span><span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">tot_sprops</span><span class="op">[</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Fill-in the missing depths:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## soil layer depth (middle)</span>
<span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_depth</span> <span class="op">=</span> <span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_top</span> <span class="op">+</span> <span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_bot</span><span class="op">-</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_top</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_depth</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    Mode   FALSE    TRUE </span>
<span class="co">#&gt; logical  766689    5465</span>
<span class="co">## Note: large number of horizons without a depth</span>
<span class="va">tot_sprops</span> <span class="op">=</span> <span class="va">tot_sprops</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_depth</span><span class="op">)</span>,<span class="op">]</span>
<span class="co">#quantile(tot_sprops$hzn_depth, c(0.01,0.99), na.rm=TRUE)</span>
<span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_depth</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_depth</span><span class="op">&lt;</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_depth</span><span class="op">&gt;</span><span class="fl">800</span>, <span class="fl">800</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">hzn_depth</span><span class="op">)</span><span class="op">)</span>
<span class="co">#hist(tot_sprops$hzn_depth, breaks=45)</span></code></pre></div>
<p>Summary number of points per data source:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;              AfSIS1              AfSPDB     Alaska_interior              BZE_LW </span>
<span class="co">#&gt;                4162               60277                3880               17187 </span>
<span class="co">#&gt;         Canada_CUFS         Canada_NPDB    Canada_subarctic       Chilean_SOCDB </span>
<span class="co">#&gt;               15162               14900                1180               16358 </span>
<span class="co">#&gt;         China_SOTER               CIFOR           CostaRica Croatian_Soil_Pedon </span>
<span class="co">#&gt;                5105                 561                2029                5746 </span>
<span class="co">#&gt;       CSIRO_NatSoil                FEBR               FIADB                FRED </span>
<span class="co">#&gt;               70688                7804               23208                 625 </span>
<span class="co">#&gt;          GEMAS_2009               GROOT           Iran_SPDB               ISCND </span>
<span class="co">#&gt;                4131                 718                4677                3977 </span>
<span class="co">#&gt;          ISRIC_WISE             LandPKS          LUCAS_2009          LUCAS_2015 </span>
<span class="co">#&gt;               23278               41644               21272               21859 </span>
<span class="co">#&gt;         MangrovesDB            NAMSOTER               NCSCD          PRONASOLOS </span>
<span class="co">#&gt;                7733                2941                7082               31655 </span>
<span class="co">#&gt;           QuebecTEX            RaCA2016        Russia_EGRPR       ScotlandNSIS1 </span>
<span class="co">#&gt;               26648               53663                4437                2977 </span>
<span class="co">#&gt;           Simulated              SISLAC              SOCPDB               SoDaH </span>
<span class="co">#&gt;                 718               49416                1526               17766 </span>
<span class="co">#&gt;        SoilHealthDB                SRDB           USDA_NCSS            USGS.NGS </span>
<span class="co">#&gt;                 120                1596              135671                9398 </span>
<span class="co">#&gt;          Vlaanderen    WHRC_remnant_SOC </span>
<span class="co">#&gt;               41310                1604</span></code></pre></div>
<p>Add unique row identifier</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tot_sprops</span><span class="op">$</span><span class="va">uuid</span> <span class="op">=</span> <span class="fu">openssl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openssl/man/hash.html">md5</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/make.unique.html">make.unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"OpenLandMap"</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">site_key</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>and unique location based on the <a href="https://cran.r-project.org/web/packages/olctools/vignettes/Introduction_to_olctools.html">Open Location Code</a>:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tot_sprops</span><span class="op">$</span><span class="va">olc_id</span> <span class="op">=</span> <span class="fu">olctools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/olctools/man/encode_olc.html">encode_olc</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">latitude_decimal_degrees</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">longitude_decimal_degrees</span>, <span class="fl">11</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">olc_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 205687</span>
<span class="co">## 205,620</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tot_sprops.pnts</span> <span class="op">=</span> <span class="va">tot_sprops</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">olc_id</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"source_db"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"olc_id"</span>, <span class="st">"project_url"</span>, <span class="st">"citation_url"</span><span class="op">)</span><span class="op">]</span>
<span class="fu">coordinates</span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">longitude_decimal_degrees</span> <span class="op">+</span> <span class="va">latitude_decimal_degrees</span>
<span class="fu">proj4string</span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"EPSG:4326"</span></code></pre></div>
<p>Remove points falling in the sea or similar:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"ov.sprops"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#mask = terra::rast("./layers1km/lcv_landmask_esacci.lc.l4_c_1km_s0..0cm_2000..2015_v1.0.tif")</span>
  <span class="va">mask</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="st">"/mnt/diskstation/data/LandGIS/layers250m/lcv_landmask_esacci.lc.l4_c_250m_s0..0cm_2000..2015_v1.0.tif"</span><span class="op">)</span>
  <span class="va">ov.sprops</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html">extract</a></span><span class="op">(</span><span class="va">mask</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html">vect</a></span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">)</span><span class="op">)</span> <span class="co">## TAKES 2 mins</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rem.lst</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">|</span> <span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">2</span> <span class="op">|</span> <span class="va">ov.sprops</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">4</span><span class="op">)</span>
    <span class="va">rem.sp</span> <span class="op">=</span> <span class="va">tot_sprops.pnts</span><span class="op">$</span><span class="va">site_key</span><span class="op">[</span><span class="va">rem.lst</span><span class="op">]</span>
    <span class="va">tot_sprops.pnts</span> <span class="op">=</span> <span class="va">tot_sprops.pnts</span><span class="op">[</span><span class="op">-</span><span class="va">rem.lst</span>,<span class="op">]</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="co">## final number of unique spatial locations:</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">)</span>
<span class="co">#&gt; [1] 205687</span>
<span class="co">## 203,107</span></code></pre></div>
</div>
<div id="histogram-plots" class="section level4" number="5.4.0.2">
<h4>
<span class="header-section-number">5.4.0.2</span> Histogram plots<a class="anchor" aria-label="anchor" href="#histogram-plots"><i class="fas fa-link"></i></a>
</h4>
<p>Have in mind that some datasets only represent top-soil (e.g. LUCAS) while other
cover the whole soil depth, hence higher mean values for some regions (Europe) should
be considered within the context of diverse soil depths.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="va">oc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 195328 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-54-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sel.db</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ISRIC_WISE"</span>, <span class="st">"Canada_CUFS"</span>, <span class="st">"USDA_NCSS"</span>, <span class="st">"AfSPDB"</span>, <span class="st">"Canada_NPDB"</span>, <span class="st">"FIADB"</span>, <span class="st">"PRONASOLOS"</span>, <span class="st">"CSIRO_NatSoil"</span><span class="op">)</span>
<span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openair/man/scatterPlot.html">scatterPlot</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sel.db</span>,<span class="op">]</span>, x <span class="op">=</span> <span class="st">"hzn_depth"</span>, y <span class="op">=</span> <span class="st">"oc"</span>, method <span class="op">=</span> <span class="st">"hexbin"</span>, 
                     col <span class="op">=</span> <span class="st">"increment"</span>, type <span class="op">=</span> <span class="st">"source_db"</span>, log.x <span class="op">=</span> <span class="cn">TRUE</span>, log.y<span class="op">=</span><span class="cn">TRUE</span>, ylab<span class="op">=</span><span class="st">"SOC wprm"</span>, xlab<span class="op">=</span><span class="st">"depth in cm"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-55-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Note: FIADB includes litter and the soil samples are taken at fixed depths. Canada
dataset also shows SOC content for peatlands.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="va">db_od</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 537198 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-56-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openair/man/scatterPlot.html">scatterPlot</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sel.db</span>,<span class="op">]</span>, x <span class="op">=</span> <span class="st">"oc"</span>, y <span class="op">=</span> <span class="st">"db_od"</span>, method <span class="op">=</span> <span class="st">"hexbin"</span>, 
                     col <span class="op">=</span> <span class="st">"increment"</span>, type <span class="op">=</span> <span class="st">"source_db"</span>, log.x<span class="op">=</span><span class="cn">TRUE</span>, ylab<span class="op">=</span><span class="st">"Bulk density"</span>, xlab<span class="op">=</span><span class="st">"SOC wprm"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-57-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="va">oc_d</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in log1p(oc_d): NaNs produced</span>

<span class="co">#&gt; Warning in log1p(oc_d): NaNs produced</span>
<span class="co">#&gt; Warning: Removed 561232 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-58-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sel.db0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ISRIC_WISE"</span>, <span class="st">"Canada_CUFS"</span>, <span class="st">"USDA_NCSS"</span>, <span class="st">"AfSPDB"</span>, <span class="st">"PRONASOLOS"</span>, <span class="st">"CSIRO_NatSoil"</span><span class="op">)</span>
<span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openair/man/scatterPlot.html">scatterPlot</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sel.db0</span>,<span class="op">]</span>, x <span class="op">=</span> <span class="st">"oc"</span>, y <span class="op">=</span> <span class="st">"oc_d"</span>, method <span class="op">=</span> <span class="st">"hexbin"</span>, 
                     col <span class="op">=</span> <span class="st">"increment"</span>, type <span class="op">=</span> <span class="st">"source_db"</span>, log.x<span class="op">=</span><span class="cn">TRUE</span>, log.y<span class="op">=</span><span class="cn">TRUE</span>, xlab<span class="op">=</span><span class="st">"SOC wprm"</span>, ylab<span class="op">=</span><span class="st">"SOC kg/m3"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-59-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Note: SOC (%) and SOC density (kg/m3) are almost linear relationship (curving toward fixed value),
except for organic soils (especially litter) where relationship is slightly shifted.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openair/man/scatterPlot.html">scatterPlot</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sel.db0</span>,<span class="op">]</span>, x <span class="op">=</span> <span class="st">"oc"</span>, y <span class="op">=</span> <span class="st">"n_tot"</span>, method <span class="op">=</span> <span class="st">"hexbin"</span>, 
                     col <span class="op">=</span> <span class="st">"increment"</span>, type <span class="op">=</span> <span class="st">"source_db"</span>, log.x<span class="op">=</span><span class="cn">TRUE</span>, log.y<span class="op">=</span><span class="cn">TRUE</span>, xlab<span class="op">=</span><span class="st">"SOC wprm"</span>, ylab<span class="op">=</span><span class="st">"N total wprm"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-60-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="va">ph_h2o</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 270562 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-61-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openair/man/scatterPlot.html">scatterPlot</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ISRIC_WISE"</span>, <span class="st">"USDA_NCSS"</span>, <span class="st">"AfSPDB"</span><span class="op">)</span>,<span class="op">]</span>, x <span class="op">=</span> <span class="st">"ph_kcl"</span>, y <span class="op">=</span> <span class="st">"ph_h2o"</span>, method <span class="op">=</span> <span class="st">"hexbin"</span>, 
                     col <span class="op">=</span> <span class="st">"increment"</span>, type <span class="op">=</span> <span class="st">"source_db"</span>, xlab<span class="op">=</span><span class="st">"soil pH KCl"</span>, ylab<span class="op">=</span><span class="st">"soil pH H2O"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-62-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openair/man/scatterPlot.html">scatterPlot</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sel.db0</span>,<span class="op">]</span>, x <span class="op">=</span> <span class="st">"hzn_depth"</span>, y <span class="op">=</span> <span class="st">"ph_h2o"</span>, method <span class="op">=</span> <span class="st">"hexbin"</span>, 
                     col <span class="op">=</span> <span class="st">"increment"</span>, type <span class="op">=</span> <span class="st">"source_db"</span>, log.x <span class="op">=</span> <span class="cn">TRUE</span>, log.y<span class="op">=</span><span class="cn">TRUE</span>, ylab<span class="op">=</span><span class="st">"soil pH H2O"</span>, xlab<span class="op">=</span><span class="st">"depth in cm"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-63-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Note: there seems to be no apparent correlation between soil pH and soil depth.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openair/man/scatterPlot.html">scatterPlot</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ISRIC_WISE"</span>, <span class="st">"USDA_NCSS"</span>, <span class="st">"AfSPDB"</span>, <span class="st">"PRONASOLOS"</span><span class="op">)</span>,<span class="op">]</span>, x <span class="op">=</span> <span class="st">"ph_h2o"</span>, y <span class="op">=</span> <span class="st">"cec_sum"</span>, method <span class="op">=</span> <span class="st">"hexbin"</span>, 
                     col <span class="op">=</span> <span class="st">"increment"</span>, type <span class="op">=</span> <span class="st">"source_db"</span>, log.y<span class="op">=</span><span class="cn">TRUE</span>, ylab<span class="op">=</span><span class="st">"CEC"</span>, xlab<span class="op">=</span><span class="st">"soil pH H2O"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-64-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openair/man/scatterPlot.html">scatterPlot</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sel.db0</span>,<span class="op">]</span>, x <span class="op">=</span> <span class="st">"ph_h2o"</span>, y <span class="op">=</span> <span class="st">"oc"</span>, method <span class="op">=</span> <span class="st">"hexbin"</span>,  
                     col <span class="op">=</span> <span class="st">"increment"</span>, type <span class="op">=</span> <span class="st">"source_db"</span>, log.y<span class="op">=</span><span class="cn">TRUE</span>, ylab<span class="op">=</span><span class="st">"SOC wprm"</span>, xlab<span class="op">=</span><span class="st">"soil pH H2O"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-65-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="va">clay_tot_psa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 279635 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-66-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openair/man/scatterPlot.html">scatterPlot</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">[</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sel.db0</span>,<span class="op">]</span>, y <span class="op">=</span> <span class="st">"clay_tot_psa"</span>, x <span class="op">=</span> <span class="st">"sand_tot_psa"</span>, method <span class="op">=</span> <span class="st">"hexbin"</span>,  
                     col <span class="op">=</span> <span class="st">"increment"</span>, type <span class="op">=</span> <span class="st">"source_db"</span>, ylab<span class="op">=</span><span class="st">"clay %"</span>, xlab<span class="op">=</span><span class="st">"sand %"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-67-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="va">cec_sum</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in log1p(cec_sum): NaNs produced</span>

<span class="co">#&gt; Warning in log1p(cec_sum): NaNs produced</span>
<span class="co">#&gt; Warning: Removed 514240 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-68-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="va">n_tot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in log1p(n_tot): NaNs produced</span>

<span class="co">#&gt; Warning in log1p(n_tot): NaNs produced</span>
<span class="co">#&gt; Warning: Removed 446028 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-69-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="va">k_ext</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in log1p(k_ext): NaNs produced</span>

<span class="co">#&gt; Warning in log1p(k_ext): NaNs produced</span>
<span class="co">#&gt; Warning: Removed 523010 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-70-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log1p</a></span><span class="op">(</span><span class="va">ec_satp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 608509 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-71-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sprops_yrs</span> <span class="op">=</span> <span class="va">tot_sprops</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">site_obsdate</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_obsdate"</span>, <span class="st">"source_db"</span>, <span class="st">"oc"</span><span class="op">)</span><span class="op">]</span>
<span class="va">sprops_yrs</span><span class="op">$</span><span class="va">year</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sprops_yrs</span><span class="op">$</span><span class="va">site_obsdate</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: NAs introduced by coercion</span>
<span class="va">sprops_yrs</span><span class="op">$</span><span class="va">year</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">sprops_yrs</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;</span><span class="fl">1960</span>, <span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">sprops_yrs</span><span class="op">$</span><span class="va">year</span><span class="op">&gt;</span><span class="fl">2024</span>, <span class="cn">NA</span>, <span class="va">sprops_yrs</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sprops_yrs</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">source_db</span>, y<span class="op">=</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 70644 rows containing non-finite values (stat_boxplot).</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-73-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openair/man/scatterPlot.html">scatterPlot</a></span><span class="op">(</span><span class="va">sprops_yrs</span><span class="op">[</span><span class="va">sprops_yrs</span><span class="op">$</span><span class="va">source_db</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sel.db0</span>,<span class="op">]</span>, y <span class="op">=</span> <span class="st">"oc"</span>, x <span class="op">=</span> <span class="st">"year"</span>, method <span class="op">=</span> <span class="st">"hexbin"</span>,  
                     col <span class="op">=</span> <span class="st">"increment"</span>, type <span class="op">=</span> <span class="st">"source_db"</span>, log.y<span class="op">=</span><span class="cn">TRUE</span>, ylab<span class="op">=</span><span class="st">"SOC wprm"</span>, xlab<span class="op">=</span><span class="st">"Sampling year"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-74-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="convert-to-wide-format" class="section level4" number="5.4.0.3">
<h4>
<span class="header-section-number">5.4.0.3</span> Convert to wide format<a class="anchor" aria-label="anchor" href="#convert-to-wide-format"><i class="fas fa-link"></i></a>
</h4>
<p>Add <code>layer_sequence</code> where missing since this is needed to be able to convert to wide
format:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#summary(tot_sprops$layer_sequence)</span>
<span class="va">tot_sprops</span><span class="op">$</span><span class="va">dsiteid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">site_key</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">site_obsdate</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"l.s1"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
  <span class="co">## Note: takes &gt;2 mins</span>
  <span class="va">l.s1</span> <span class="op">&lt;-</span> <span class="va">tot_sprops</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dsiteid"</span>,<span class="st">"hzn_depth"</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">dsiteid</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>layer_sequence.f <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/frank.html">frank</a></span><span class="op">(</span><span class="va">hzn_depth</span>, ties.method <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence.f</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence</span><span class="op">)</span>, <span class="va">l.s1</span><span class="op">$</span><span class="va">layer_sequence.f</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence</span><span class="op">)</span>
  <span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence.f</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence.f</span><span class="op">&gt;</span><span class="fl">6</span>, <span class="fl">6</span>, <span class="va">tot_sprops</span><span class="op">$</span><span class="va">layer_sequence.f</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Convert long table to <a href="https://ncss-tech.github.io/AQP/aqp/aqp-intro.html">wide table format</a> so that each depth gets unique column
(note: the most computational / time-consuming step usually):</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"tot_sprops.w"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://r-datatable.com">data.table</a></span><span class="op">)</span>
  <span class="va">tot_sprops.w</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/dcast.data.table.html">dcast</a></span><span class="op">(</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">tot_sprops</span><span class="op">)</span>, 
                formula <span class="op">=</span> <span class="va">olc_id</span> <span class="op">~</span> <span class="va">layer_sequence.f</span>, 
                value.var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"uuid"</span>, <span class="va">hor.names</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">hor.names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_key"</span>, <span class="st">"layer_sequence"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, 
                <span class="co">## "labsampnum", "hzn_desgn", "tex_psda" </span>
                <span class="co">#fun=function(x){ mean(x, na.rm=TRUE) }, </span>
                <span class="co">## Note: does not work for characters</span>
                fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">}</span>,
                verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="co">## remove "0" layers added automatically but containing no values</span>
  <span class="va">tot_sprops.w</span> <span class="op">=</span> <span class="va">tot_sprops.w</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"*_0$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tot_sprops.w</span><span class="op">)</span><span class="op">)</span><span class="op">:=</span><span class="cn">NULL</span><span class="op">]</span>
<span class="op">}</span>
<span class="va">tot_sprops_w.pnts</span> <span class="op">=</span> <span class="va">tot_sprops.pnts</span>
<span class="va">tot_sprops_w.pnts</span><span class="op">@</span><span class="va">data</span> <span class="op">=</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/join.html">join</a></span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">@</span><span class="va">data</span>, <span class="va">tot_sprops.w</span><span class="op">)</span>
<span class="co">#&gt; Joining by: olc_id</span></code></pre></div>
<p>Write all soil profiles using a wide format:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sel.rm.pnts</span>  <span class="op">&lt;-</span> <span class="va">tot_sprops_w.pnts</span><span class="op">$</span><span class="va">source_db</span><span class="op">==</span><span class="st">"LUCAS_2009"</span> <span class="op">|</span> <span class="va">tot_sprops_w.pnts</span><span class="op">$</span><span class="va">source_db</span><span class="op">==</span><span class="st">"LUCAS_2015"</span> <span class="op">|</span> <span class="va">tot_sprops_w.pnts</span><span class="op">$</span><span class="va">site_key</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">mng.rm</span> <span class="op">|</span> <span class="va">tot_sprops_w.pnts</span><span class="op">$</span><span class="va">site_key</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">rem.sp</span>
<span class="va">out.gpkg</span> <span class="op">=</span> <span class="st">"./out/gpkg/sol_chem.pnts_horizons.gpkg"</span>
<span class="co">#unlink(out.gpkg)</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">out.gpkg</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">writeOGR</span><span class="op">(</span><span class="va">tot_sprops_w.pnts</span><span class="op">[</span><span class="op">!</span><span class="va">sel.rm.pnts</span>,<span class="op">]</span>, <span class="st">"./out/gpkg/sol_chem.pnts_horizons.gpkg"</span>, <span class="st">"sol_chem.pnts_horizons"</span>, drive<span class="op">=</span><span class="st">"GPKG"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="save-rds-files" class="section level4" number="5.4.0.4">
<h4>
<span class="header-section-number">5.4.0.4</span> Save RDS files<a class="anchor" aria-label="anchor" href="#save-rds-files"><i class="fas fa-link"></i></a>
</h4>
<p>Remove points that are not allowed to be distributed publicly:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sel.rm</span>  <span class="op">&lt;-</span> <span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span><span class="op">==</span><span class="st">"LUCAS_2009"</span> <span class="op">|</span> <span class="va">tot_sprops</span><span class="op">$</span><span class="va">source_db</span><span class="op">==</span><span class="st">"LUCAS_2015"</span> <span class="op">|</span> <span class="va">tot_sprops</span><span class="op">$</span><span class="va">site_key</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">mng.rm</span> <span class="op">|</span> <span class="va">tot_sprops</span><span class="op">$</span><span class="va">site_key</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">rem.sp</span>
<span class="va">tot_sprops.s</span> <span class="op">=</span> <span class="va">tot_sprops</span><span class="op">[</span><span class="op">!</span><span class="va">sel.rm</span>,<span class="op">]</span> </code></pre></div>
<p>Plot in Goode Homolozine projection and save final objects:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"./img/sol_chem.pnts_sites.png"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tot_sprops.pnts_sf</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">tot_sprops.pnts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, crs<span class="op">=</span><span class="fl">4326</span><span class="op">)</span>
  <span class="fu">plot_gh</span><span class="op">(</span><span class="va">tot_sprops.pnts_sf</span>, out.pdf<span class="op">=</span><span class="st">"./img/sol_chem.pnts_sites.pdf"</span><span class="op">)</span>
  <span class="co">## extremely slow --- takes 15mins</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"pdftoppm ./img/sol_chem.pnts_sites.pdf ./img/sol_chem.pnts_sites -png -f 1 -singlefile"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"convert -crop 1280x575+36+114 ./img/sol_chem.pnts_sites.png ./img/sol_chem.pnts_sites.png"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="img/sol_chem.pnts_sites.png" alt="Soil profiles and soil samples with chemical and physical properties global compilation." width="100%"><p class="caption">
(#fig:sol_chem.pnts_sites)Soil profiles and soil samples with chemical and physical properties global compilation.
</p>
</div>
<p>Fig. 1: Soil profiles and soil samples with chemical and physical properties global compilation.</p>
</div>
</div>
<div id="save-final-analysis-ready-objects" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Save final analysis-ready objects:<a class="anchor" aria-label="anchor" href="#save-final-analysis-ready-objects"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">tot_sprops.s</span>, <span class="st">"./out/rds/sol_chem.pnts_horizons.rds"</span><span class="op">)</span>
<span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">tot_sprops</span>, <span class="st">"/mnt/diskstation/data/Soil_points/sol_chem.pnts_horizons.rds"</span><span class="op">)</span>
<span class="fu">saveRDS.gz</span><span class="op">(</span><span class="va">tot_sprops.pnts</span>, <span class="st">"/mnt/diskstation/data/Soil_points/sol_chem.pnts_sites.rds"</span><span class="op">)</span>
<span class="co">#library(farff)</span>
<span class="co">#writeARFF(tot_sprops.s, "./out/arff/sol_chem.pnts_horizons.arff", overwrite = TRUE)</span>
<span class="co">## compressed CSV</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">tot_sprops.s</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">gzfile</a></span><span class="op">(</span><span class="st">"./out/csv/sol_chem.pnts_horizons.csv.gz"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## regression matrix:</span>
<span class="co">#saveRDS.gz(rm.sol, "./out/rds/sol_chem.pnts_horizons_rm.rds")</span></code></pre></div>
<p>Save temp object:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">save.image.pigz</span><span class="op">(</span>file<span class="op">=</span><span class="st">"soilchem.RData"</span><span class="op">)</span>
<span class="co">## rmarkdown::render("Index.rmd")</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="soil-variables.html"><span class="header-section-number">4</span> Soil variables</a></div>
<div class="next"><a href="soil-physical-and-hydrological-properties.html"><span class="header-section-number">6</span> Soil physical and hydrological properties</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#soil-chemical-and-physical-properties"><span class="header-section-number">5</span> Soil chemical and physical properties</a></li>
<li><a class="nav-link" href="#overview"><span class="header-section-number">5.1</span> Overview</a></li>
<li><a class="nav-link" href="#alt-text-specifications"><span class="header-section-number">5.2</span>  Specifications</a></li>
<li><a class="nav-link" href="#alt-text-data-import"><span class="header-section-number">5.3</span>  Data import</a></li>
<li><a class="nav-link" href="#alt-text-bind-all-datasets"><span class="header-section-number">5.4</span>  Bind all datasets</a></li>
<li><a class="nav-link" href="#save-final-analysis-ready-objects"><span class="header-section-number">5.5</span> Save final analysis-ready objects:</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/OpenGeoHub/SoilSamples//blob/master/025-import_chemical_data.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/OpenGeoHub/SoilSamples//edit/master/025-import_chemical_data.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>An Open Compendium of Soil Sample and Soil Profile Datasets</strong>" was written by Tom Hengl, Surya Gupta, Robert Minarik. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
