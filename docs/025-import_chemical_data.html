<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>An open compendium of global soil samples and observations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="An open compendium of global soil samples and observations">
<meta property="og:description" content="This is a public compendium of global, regional, national and sub-national soil samples and/or soil profile datasets (points with Observations and Measurements of soil properties and characteristics). Data sets listed here, assuming compatible open license, are afterwards imported into a common library. Contributions are welcome. To discuss issues or report a bug please use the repository homepage. If you have an addition or correction, make changes to the Rmd’s and make pull-request.">
<meta property="og:site_name" content="An open compendium of global soil samples and observations">
<meta name="twitter:title" content="An open compendium of global soil samples and observations">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="img/sol_chem.pnts_sites.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="././img/openlandmap_v2_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">An open compendium of global soil samples and observations</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://OpenLandMap.org"> 
<span class="menu-text">OpenLandMap.org</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://EarthMonitor.org"> 
<span class="menu-text">Open-Earth-Monitor</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://landcarbonlab.org"> 
<span class="menu-text">Land Carbon Lab</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://fosstodon.org/@opengeohub" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-mastodon"></i></a>
    <a href="https://opengeohub.medium.com/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-medium"></i></a>
    <a href="https://twitter.com/opengeohub" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/OpenGeoHub/SoilSamples">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/OpenGeoHub/SoilSamples/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./index.html">Data import</a></li><li class="breadcrumb-item"><a href="./025-import_chemical_data.html">Soil chemical and physical properties</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Data import</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-start_here.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">New to markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./015-dataset_communities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Soil data communities and mailing lists</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./020-dataset_list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./025-import_chemical_data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Soil chemical and physical properties</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./035-import_wrb_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">WRB soil types</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./040-import_usda_soil_tax_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">USDA Soil Taxonomy training points</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#soil-chemical-and-physical-properties" id="toc-soil-chemical-and-physical-properties" class="nav-link active" data-scroll-target="#soil-chemical-and-physical-properties">Soil chemical and physical properties</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#specifications" id="toc-specifications" class="nav-link" data-scroll-target="#specifications">Specifications</a></li>
  <li><a href="#data-import" id="toc-data-import" class="nav-link" data-scroll-target="#data-import">Data import</a></li>
  <li><a href="#bind-all-datasets" id="toc-bind-all-datasets" class="nav-link" data-scroll-target="#bind-all-datasets">Bind all datasets</a></li>
  <li><a href="#save-final-analysis-ready-objects" id="toc-save-final-analysis-ready-objects" class="nav-link" data-scroll-target="#save-final-analysis-ready-objects">Save final analysis-ready objects:</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/OpenGeoHub/SoilSamples/edit/main/025-import_chemical_data.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/OpenGeoHub/SoilSamples/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="soil-chemical-and-physical-properties" class="level1">
<h1>Soil chemical and physical properties</h1>
<p>The code and data set is continuously being updated. If you notice a bug or typo, please <a href="https://github.com/OpenGeoHub/SoilSamples/issues">open an issue</a> and report.</p>
<p>Last update: 2025-02-05</p>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This section describes import steps used to produce a global compilation of soil laboratory data with chemical (and physical) soil properties that can be then used for predictive soil mapping / modeling at global and regional scales.</p>
<p>Read more about soil chemical properties, global soil profile and sample data sets and functionality:</p>
<ul>
<li>Arrouays, D., Leenaars, J. G., Richer-de-Forges, A. C., Adhikari, K., Ballabio, C., Greve, M., … &amp; Heuvelink, G. (2017). <a href="https://doi.org/10.1016/j.grj.2017.06.001">Soil legacy data rescue via GlobalSoilMap and other international and national initiatives</a>. GeoResJ, 14, 1-19.</li>
<li>Batjes, N. H., Ribeiro, E., van Oostrum, A., Leenaars, J., Hengl, T., &amp; de Jesus, J. M. (2017). <a href="http://www.earth-syst-sci-data.net/9/1/2017/">WoSIS: providing standardised soil profile data for the world</a>. Earth System Science Data, 9(1), 1.</li>
<li>Hengl, T., MacMillan, R.A., (2019). <a href="https://soilmapper.org/">Predictive Soil Mapping with R</a>. OpenGeoHub foundation, Wageningen, the Netherlands, 370 pages, www.soilmapper.org, ISBN: 978-0-359-30635-0.</li>
<li>Rossiter, D.G.,: <a href="https://www.isric.org/explore/soil-geographic-databases">Compendium of Soil Geographical Databases</a>.</li>
</ul>
</section>
<section id="specifications" class="level2">
<h2 class="anchored" data-anchor-id="specifications">Specifications</h2>
<section id="data-standards" class="level4">
<h4 class="anchored" data-anchor-id="data-standards">Data standards</h4>
<ul>
<li>Metadata information: <a href="https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/stelprdb1253872.pdf">“Soil Survey Investigation Report No.&nbsp;42.”</a> and <a href="https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/nrcs142p2_052226.pdf">“Soil Survey Investigation Report No.&nbsp;45.”</a>,</li>
<li>Model DB: <a href="https://ncsslabdatamart.sc.egov.usda.gov/">National Cooperative Soil Survey (NCSS) Soil Characterization Database</a>,</li>
</ul>
</section>
<section id="target-variables" class="level4">
<h4 class="anchored" data-anchor-id="target-variables"><em>Target variables:</em></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>site.names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"upedonid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>hor.names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"labsampnum"</span>, <span class="st">"site_key"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>,<span class="st">"hzn_bot"</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"hzn_desgn"</span>, <span class="st">"texture_description"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_total"</span>, <span class="st">"silt_total"</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sand_total"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"total_carbon_ncs"</span>, <span class="st">"total_nitrogen_ncs"</span>, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sum_of_cations_cec_pH_8_2"</span>, <span class="st">"cec_nh4_ph_7"</span>, <span class="st">"ecec_base_plus_aluminum"</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"total_frag_wt_pct_gt_2_mm_ws"</span>, <span class="st">"bulk_density_oven_dry"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">## target structure:</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>col.names <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(site.names, hor.names, <span class="st">"source_db"</span>, <span class="st">"confidence_degree"</span>, <span class="st">"project_url"</span>, <span class="st">"citation_url"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Target variables listed:</p>
<ul>
<li><code>clay_total</code>: Clay, Total in % wt for &lt;2 mm soil fraction,</li>
<li><code>silt_total</code>: Silt, Total in % wt for &lt;2 mm soil fraction,</li>
<li><code>sand_total</code>: Sand, Total in % wt for &lt;2 mm soil fraction,</li>
<li><code>organic_carbon</code>: Carbon, Organic in g/kg for &lt;2 mm soil fraction based on Dry combustion,</li>
<li><code>oc_d</code>: Soil organic carbon density in kg/m3,</li>
<li><code>total_carbon_ncs</code>: Carbon, Total in g/kg for &lt;2 mm soil fraction,</li>
<li><code>total_nitrogen_ncs</code>: Nitrogen, Total NCS in g/kg for &lt;2 mm soil fraction,</li>
<li><code>ph_kcl</code>: pH, KCl Suspension for &lt;2 mm soil fraction,</li>
<li><code>ph_h2o</code>: pH, 1:1 Soil-Water Suspension for &lt;2 mm soil fraction,</li>
<li><code>ph_cacl2</code>: pH, CaCl2 Suspension for &lt;2 mm soil fraction,</li>
<li><code>sum_of_cations_cec_pH_8_2</code>: Cation Exchange Capacity, Summary, in cmol(+)/kg for &lt;2 mm soil fraction,</li>
<li><code>cec_nh4_ph_7</code>: Cation Exchange Capacity, NH4 prep, in cmol(+)/kg for &lt;2 mm soil fraction,</li>
<li><code>ecec_base_plus_aluminum</code>: Cation Exchange Capacity, Effective, CMS derived value default, standa prep in cmol(+)/kg for &lt;2 mm soil fraction,</li>
<li><code>total_frag_wt_pct_gt_2_mm_ws</code>: Coarse fragments in % wt for &gt;2 mm soil fraction,</li>
<li><code>bulk_density_oven_dry</code>: Bulk density (Oven Dry) in g/cm3 (4A1h),</li>
<li><code>ca_ext</code>: Calcium, Extractable in mg/kg for &lt;2 mm soil fraction (usually Mehlich3),</li>
<li><code>mg_ext</code>: Magnesium, Extractable in mg/kg for &lt;2 mm soil fraction (usually Mehlich3),</li>
<li><code>na_ext</code>: Sodium, Extractable in mg/kg for &lt;2 mm soil fraction (usually Mehlich3),</li>
<li><code>k_ext</code>: Potassium, Extractable in mg/kg for &lt;2 mm soil fraction (usually Mehlich3),</li>
<li><code>ec_water_extractable</code>: Electrical Conductivity, Saturation Extract in dS/m for &lt;2 mm soil fraction,</li>
<li><code>ec_predict_one_to_two</code>: Electrical Conductivity, Predict, 1:2 (w/w) in dS/m for &lt;2 mm soil fraction,</li>
</ul>
</section>
</section>
<section id="data-import" class="level2">
<h2 class="anchored" data-anchor-id="data-import">Data import</h2>
<section id="national-cooperative-soil-survey-characterization-database" class="level4">
<h4 class="anchored" data-anchor-id="national-cooperative-soil-survey-characterization-database">National Cooperative Soil Survey Characterization Database</h4>
<p>The November 2024 version contains 67,367 sites. This is the world largest open soil laboratory database to date.</p>
<ul>
<li>National Cooperative Soil Survey, (2024). National Cooperative Soil Survey Characterization Database. Data download URL: <a href="http://ncsslabdatamart.sc.egov.usda.gov/" class="uri">http://ncsslabdatamart.sc.egov.usda.gov/</a></li>
<li>Nauman, T.W., Kienast‐Brown, S., Roecker, S.M., Brungard, C., White, D., Philippe, J., &amp; Thompson, J.A. (2024). Soil landscapes of the United States (SOLUS): Developing predictive soil property maps of the conterminous United States using hybrid training sets. Soil Sci. Soc. Am. J. <a href="https://doi.org/10.1002/saj2.20769" class="uri">https://doi.org/10.1002/saj2.20769</a></li>
</ul>
<p>This data set is continuously updated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.NCSS"</span>)){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nccs.xy = terra::vect("/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/ncss_labdata_locations.gpkg")</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ncss.site &lt;- dplyr::bind_cols(as.data.frame(nccs.xy), geom(nccs.xy))</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  ncss.site <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/ncss_labdata_locations.csv.gz"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Rows: 67367 Columns: 88</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(ncss.site[,c("longitude_decimal_degrees","latitude_decimal_degrees")])</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  ncss.chem <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_lab_chemical_properties.csv.gz"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Rows: 325740 Columns: 210</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="fu">as.factor</span>(ncss.chem<span class="sc">$</span>total_carbon_ncs_method))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ncss.chem$organic_carbon_walkley_black)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(!is.na(ncss.chem$organic_carbon_walkley_black))</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 213,940 samples with SOC</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  ncss.phys <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_lab_physical_properties.csv.gz"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Rows: 406281 Columns: 123</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  ncss.layer <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/NCSS_lab_layer.csv.gz"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Rows: 417656 Columns: 24</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Quality-controlled data prepared by NRCS:</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 'oc_wbc_final' = final Walkley Black SOC estimate that still needs to be scaled to dry combustion. This harmonizes across all reasonable organic carbon data sources in the NCSS DB</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 'bd_od_pred'  = a final oven dry bulk density estimate</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 'total_frags_pct_nopf' = volumetric rock content from NASIS</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  oc.nm <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"labsampnum.x"</span>, <span class="st">"layer_key"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"site_obsdate"</span>) <span class="do">## "hzn_top", "hzn_bot", "hzn_desgn"</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  oc_db_layers <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/tmp/oc_db_layers.txt.gz"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)[,<span class="fu">c</span>(<span class="st">"labsampnum.x"</span>, <span class="st">"layer_key"</span>, <span class="st">"oc_wbc_final"</span>, <span class="st">"bd_od_pred"</span>)]</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(!is.na(oc_db_layers$oc_wbc_final))</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  oc_db_rk_layers <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/tmp/oc_db_rk_layers.txt.gz"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)[,<span class="fu">c</span>(<span class="st">"labsampnum.x"</span>, <span class="st">"layer_key"</span>, <span class="st">"oc_wbc_final"</span>, <span class="st">"bd_od_pred"</span>, <span class="st">"total_frags_pct_nopf"</span>)]</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  oc_layers <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/tmp/oc_layers.txt.gz"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)[,<span class="fu">c</span>(oc.nm, <span class="st">"oc_wbc_final"</span>)]</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(duplicated(oc_layers$labsampnum.x))</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(!is.na(oc_layers$longitude_decimal_degrees))</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 41240 without coordinates</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(which(!oc_db_rk_layers$labsampnum.x %in% oc_layers$labsampnum.x))</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(substr(oc_layers$site_obsdate, 1, 4)))</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  oc_db <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">full_join</span>(dplyr<span class="sc">::</span><span class="fu">full_join</span>(oc_layers, oc_db_layers[,<span class="fu">c</span>(<span class="st">"labsampnum.x"</span>, <span class="st">"bd_od_pred"</span>)], </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"labsampnum.x"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>), </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                  oc_db_rk_layers[,<span class="fu">c</span>(<span class="st">"labsampnum.x"</span>, <span class="st">"total_frags_pct_nopf"</span>)], <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"labsampnum.x"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dim(oc_db)</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## [1] 303286      8</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  oc_db <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(oc_db, <span class="at">replace =</span> <span class="fu">c</span>(<span class="st">"labsampnum.x"</span> <span class="ot">=</span> <span class="st">"labsampnum"</span>))</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#View(oc_db)</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  ncss.horizons <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">full_join</span>(dplyr<span class="sc">::</span><span class="fu">full_join</span>(oc_db, ncss.chem, </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"labsampnum"</span>,<span class="st">"layer_key"</span>)),</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">full_join</span>(ncss.layer, ncss.phys, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"labsampnum"</span>,<span class="st">"layer_key"</span>)), </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>                              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"labsampnum"</span>,<span class="st">"layer_key"</span>))</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(!is.na(ncss.horizons$oc_wbc_final))</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 303,286 </span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="do">## translate to SOC DC</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="do">## https://doi.org/10.1016/j.geoderma.2021.115547</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SOC = 1.3 * WBC</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>organic_carbon <span class="ot">=</span> <span class="fu">ifelse</span>(ncss.horizons<span class="sc">$</span>oc_wbc_final <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, (ncss.horizons<span class="sc">$</span>oc_wbc_final <span class="sc">*</span> <span class="fl">1.3</span>) <span class="sc">*</span> <span class="dv">10</span>)  <span class="do">## g/kg</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot(ncss.horizons, aes(organic_carbon+1)) + geom_histogram() + scale_x_log10()</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>year <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(ncss.horizons<span class="sc">$</span>site_obsdate, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>year <span class="ot">=</span> <span class="fu">ifelse</span>(ncss.horizons<span class="sc">$</span>year<span class="sc">&gt;</span><span class="dv">2024</span><span class="sc">|</span>ncss.horizons<span class="sc">$</span>year<span class="sc">&lt;</span><span class="dv">1925</span>, <span class="cn">NA</span>, ncss.horizons<span class="sc">$</span>year)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  viri <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#440154FF"</span>, <span class="st">"#39568CFF"</span>, <span class="st">"#1F968BFF"</span>, <span class="st">"#73D055FF"</span>, <span class="st">"#FDE725FF"</span>)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  scaleFUN <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">round</span>(x,<span class="dv">0</span>)}</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  soc_year.plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>ncss.horizons, <span class="fu">aes</span>(year, organic_carbon)) <span class="sc">+</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>     <span class="fu">stat_binhex</span>(<span class="at">bins =</span> <span class="dv">30</span>)  <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="st">"log1p"</span>) <span class="sc">+</span> <span class="co">#xlim(-5,105) + ylim(-5,105) + </span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>), <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">hjust=</span><span class="fl">0.5</span>)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"SOC [g/kg]"</span>) <span class="sc">+</span> </span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradientn</span>(<span class="at">name =</span> <span class="st">"Count"</span>, <span class="at">trans =</span> <span class="st">"log"</span>, <span class="at">colours =</span> <span class="fu">rev</span>(viri), <span class="at">labels=</span>scaleFUN) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">#soc_year.plt</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ncss.horizons$organic_carbon)</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>organic_carbon <span class="ot">=</span> <span class="fu">ifelse</span>(ncss.horizons<span class="sc">$</span>organic_carbon <span class="sc">&gt;</span> <span class="dv">900</span> <span class="sc">|</span> ncss.horizons<span class="sc">$</span>organic_carbon <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">NA</span>, ncss.horizons<span class="sc">$</span>organic_carbon)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="do">## some values go &gt;100% SOC (artifacts!)</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>bulk_density_oven_dry <span class="ot">=</span> <span class="fu">ifelse</span>(ncss.horizons<span class="sc">$</span>bulk_density_oven_dry <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">|</span> ncss.horizons<span class="sc">$</span>bulk_density_oven_dry <span class="sc">&gt;</span> <span class="fl">2.4</span>, <span class="cn">NA</span>, <span class="fu">ifelse</span>(<span class="fu">is.na</span>(ncss.horizons<span class="sc">$</span>bulk_density_oven_dry), ncss.horizons<span class="sc">$</span>bd_od_pred, ncss.horizons<span class="sc">$</span>bulk_density_oven_dry))</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">#hist(ncss.horizons$bulk_density_oven_dry, col="grey", breaks=40)</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(!is.na(ncss.horizons$bulk_density_oven_dry))</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 94872</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(ncss.horizons<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws), <span class="fu">as.numeric</span>(ncss.horizons<span class="sc">$</span>total_frags_pct_nopf), <span class="fu">ifelse</span>(<span class="fu">as.numeric</span>(ncss.horizons<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws) <span class="sc">&gt;</span> <span class="dv">99</span>, <span class="cn">NA</span>, <span class="fu">as.numeric</span>(ncss.horizons<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws)))</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ncss.horizons$total_frag_wt_pct_gt_2_mm_ws)</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>( ncss.horizons<span class="sc">$</span>organic_carbon <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> ncss.horizons<span class="sc">$</span>bulk_density_oven_dry <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(ncss.horizons<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws), <span class="dv">0</span>, ncss.horizons<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>ca_ext <span class="ot">=</span> <span class="fu">signif</span>(ncss.horizons<span class="sc">$</span>ca_nh4_ph_7 <span class="sc">*</span> <span class="dv">200</span>, <span class="dv">4</span>)</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>mg_ext <span class="ot">=</span> <span class="fu">signif</span>(ncss.horizons<span class="sc">$</span>mg_nh4_ph_7 <span class="sc">*</span> <span class="dv">121</span>, <span class="dv">3</span>)</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>na_ext <span class="ot">=</span> <span class="fu">signif</span>(ncss.horizons<span class="sc">$</span>na_nh4_ph_7 <span class="sc">*</span> <span class="dv">230</span>, <span class="dv">3</span>)</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>k_ext <span class="ot">=</span> <span class="fu">signif</span>(ncss.horizons<span class="sc">$</span>k_nh4_ph_7 <span class="sc">*</span> <span class="dv">391</span>, <span class="dv">3</span>)</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  ncss.horizons<span class="sc">$</span>total_nitrogen_ncs <span class="ot">=</span> ncss.horizons<span class="sc">$</span>total_nitrogen_ncs <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="do">## bind into single table</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(which(!ncss.horizons$site_key %in% ncss.site$site_key))</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSS <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(ncss.horizons[,hor.names], ncss.site[,site.names], <span class="at">multiple =</span> <span class="st">"first"</span>)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Joining with `by = join_by(site_key)`Warning: Detected an unexpected many-to-many relationship between `x` and `y`.</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSS<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(chemsprops.NCSS<span class="sc">$</span>site_obsdate, <span class="at">format=</span><span class="st">"%Y/%m/%d"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.Date(chemsprops.NCSS$site_obsdate))</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      Min.      1st Qu.       Median         Mean      3rd Qu.         Max.         NA's </span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  <span class="co">#"1925-11-01" "1981-02-01" "1992-10-27" "1991-08-27" "2006-04-09" "9863-06-01"      "14175" </span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(substr(chemsprops.NCSS$site_obsdate, 1, 4))&gt;1999 &amp; !is.na(chemsprops.NCSS$oc_d))</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 21,672 records with 'oc_d' after year 1999</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSS<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"USDA_NCSS"</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dim(chemsprops.NCSS)</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 417656      36</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSS<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSS<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://ncsslabdatamart.sc.egov.usda.gov/"</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSS<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"http://ncsslabdatamart.sc.egov.usda.gov/"</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSS <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.NCSS, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"clay_total"</span>, <span class="st">"ecec_base_plus_aluminum"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ec_predict_one_to_two"</span>, <span class="st">"k_ext"</span>), <span class="at">remove.duplicates =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(chemsprops.NCSS$oc_d)</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>  <span class="do">## mean = 16.3; median = 8.0</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(chemsprops.NCSS$organic_carbon)</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>  <span class="do">## mean = 21.7; median = 5.5</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSS <span class="ot">=</span> chemsprops.NCSS[,col.names]</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.NCSS, <span class="st">"/mnt/diskstation/data/Soil_points/INT/USDA_NCSS/chemsprops.NCSS.rds"</span>)</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 67367 Columns: 88
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (58): pedlabsampnum, upedonid, priority, priority2, samp_name, samp_clas...
dbl (24): ...1, OBJECTID, objectid_1, pedon_key, site_key, peiid, labdatades...
lgl  (6): SSL_taxpartsizemod, SSL_taxother, SSL_osdtypelocflag, samp_taxfamh...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 325740 Columns: 210
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (52): labsampnum, prep_code, ca_nh4_ph_7_method, mg_nh4_ph_7_method, na_...
dbl (74): OBJECTID, objectid_1, layer_key, result_source_key, ca_nh4_ph_7, m...
lgl (84): iron_kcl_extractable, iron_kcl_extractable_method, ph_oxidized, ph...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 406281 Columns: 123
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (20): labsampnum, prep_code, texture_lab, particle_size_method, bulk_den...
dbl (57): OBJECTID, objectid_1, layer_key, result_source_key, clay_total, si...
lgl (46): bulk_density_tenth_bar, bulk_density_tenth_bar_method, bulk_densit...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 417656 Columns: 24
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (10): labsampnum, layer_type, layer_field_label_1, layer_field_label_2, ...
dbl (12): OBJECTID, objectid_1, layer_key, project_key, site_key, pedon_key,...
lgl  (2): hzn_prime, hzn_desgn_other

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Joining with `by = join_by(site_key)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.NCSS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 346203     39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 346203     39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/fig_NCSS_soc_over_time.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption>SOC measurements based on the National Cooperative Soil Survey Characterization Database over time.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="national-geochemical-database-soil" class="level4">
<h4 class="anchored" data-anchor-id="national-geochemical-database-soil">National Geochemical Database Soil</h4>
<ul>
<li>Smith, D.B., Cannon, W.F., Woodruff, L.G., Solano, Federico, Kilburn, J.E., and Fey, D.L., (2013). <a href="http://pubs.usgs.gov/ds/801/">Geochemical and mineralogical data for soils of the conterminous United States</a>. U.S. Geological Survey Data Series 801, 19 p., <a href="http://pubs.usgs.gov/ds/801/" class="uri">http://pubs.usgs.gov/ds/801/</a>.</li>
<li>Grossman, J. N. (2004). <a href="https://doi.org/10.3133/ofr20041001">The National Geochemical Survey-database and documentation</a>. U.S. Geological Survey Open-File Report 2004-1001. DOI:10.3133/ofr20041001.</li>
<li><strong>Note</strong>: NGS focuses on stream-sediment samples, but also contains many soil samples.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.USGS.NGS"</span>)){</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  ngs.points <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/USA/geochemical/ds-801-csv/site.txt"</span>, <span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4857 pnts</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  ngs.layers <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="st">"top5cm.txt"</span>, <span class="st">"ahorizon.txt"</span>, <span class="st">"chorizon.txt"</span>), <span class="cf">function</span>(i){<span class="fu">read.csv</span>(<span class="fu">paste0</span>(<span class="st">"/mnt/diskstation/data/Soil_points/USA/geochemical/ds-801-csv/"</span>, i), <span class="at">sep=</span><span class="st">","</span>)})</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  ngs.layers <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(ngs.layers)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dim(ngs.layers)</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 14571  126</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ngs.layers$tot_carb_pct)</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lattice::xyplot(c_org_pct ~ c_tot_pct, ngs.layers, scales=list(x = list(log = 2), y = list(log = 2)))</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lattice::xyplot(c_org_pct ~ tot_clay_pct, ngs.layers, scales=list(y = list(log = 2)))</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  ngs.layers<span class="sc">$</span>total_carbon_ncs <span class="ot">=</span> ngs.layers<span class="sc">$</span>c_tot_pct <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## "The sample was combusted in an oxygen atmosphere at 1,370 ºC to oxidize C to carbon dioxide (CO2)"</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  ngs.layers<span class="sc">$</span>organic_carbon <span class="ot">=</span> ngs.layers<span class="sc">$</span>c_org_pct <span class="sc">*</span> <span class="dv">10</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  ngs.layers<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="fu">sapply</span>(ngs.layers<span class="sc">$</span>depth_cm, <span class="cf">function</span>(i){<span class="fu">strsplit</span>(i, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]})</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  ngs.layers<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="fu">sapply</span>(ngs.layers<span class="sc">$</span>depth_cm, <span class="cf">function</span>(i){<span class="fu">strsplit</span>(i, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>]})</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ngs.layers$tot_clay_pct)</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ngs.layers$k_pct) ## very high numbers?</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## question is if the geochemical element results are compatible with e.g. k_ext?</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  t.ngs <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"lab_id"</span>, <span class="st">"site_id"</span>, <span class="st">"horizon"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"tot_clay_pct"</span>, <span class="st">"total_carbon_ncs"</span>, <span class="st">"organic_carbon"</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  ngs.m <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(ngs.points, ngs.layers[<span class="sc">!</span><span class="fu">is.na</span>(ngs.layers<span class="sc">$</span>c_org_pct),t.ngs])</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  ngs.m<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">as.Date</span>(ngs.m<span class="sc">$</span>colldate, <span class="at">format=</span><span class="st">"%Y-%m-%d"</span>) </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(substr(ngs.m$site_obsdate, 1, 4)&gt;1999)</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  ngs.h.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"site_id"</span>, <span class="st">"quad"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"lab_id"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"horizon"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"tot_clay_pct"</span>, <span class="st">"silt_total"</span>, </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sand_total"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"total_carbon_ncs"</span>, <span class="st">"total_nitrogen_ncs"</span>, </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>              <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sum_of_cations_cec_pH_8_2"</span>, <span class="st">"cec_nh4_ph_7"</span>, <span class="st">"ecec_base_plus_aluminum"</span>, </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>              <span class="st">"total_frag_wt_pct_gt_2_mm_ws"</span>, <span class="st">"bulk_density_oven_dry"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>              <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> ngs.h.lst[<span class="fu">which</span>(<span class="sc">!</span>ngs.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(ngs.m))]</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ ngs.m[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  chemsprops.USGS.NGS <span class="ot">=</span> ngs.m[,ngs.h.lst]</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  chemsprops.USGS.NGS<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"USGS.NGS"</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  chemsprops.USGS.NGS<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  chemsprops.USGS.NGS<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://mrdata.usgs.gov/ds-801/"</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  chemsprops.USGS.NGS<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://pubs.usgs.gov/ds/801/"</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  chemsprops.USGS.NGS <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.USGS.NGS, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"tot_clay_pct"</span>, <span class="st">"organic_carbon"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>))</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(chemsprops.USGS.NGS$organic_carbon)</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.USGS.NGS, <span class="st">"/mnt/diskstation/data/Soil_points/USA/geochemical/ds-801-csv/chemsprops.USGS.NGS.rds"</span>)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: site_id</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.USGS.NGS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9447   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 9447   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="africa-soil-profiles-database" class="level4">
<h4 class="anchored" data-anchor-id="africa-soil-profiles-database">Africa soil profiles database</h4>
<ul>
<li>Leenaars, J. G., Van Oostrum, A. J. M., &amp; Ruiperez Gonzalez, M. (2014). <a href="https://www.isric.org/projects/africa-soil-profiles-database-afsp">Africa soil profiles database version 1.2. A compilation of georeferenced and standardized legacy soil profile data for Sub-Saharan Africa (with dataset)</a>. Wageningen: ISRIC Report 2014/01; 2014. Data download URL: <a href="https://data.isric.org/" class="uri">https://data.isric.org/</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.AfSPDB"</span>)){</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(foreign)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  afspdb.profiles <span class="ot">&lt;-</span> <span class="fu">read.dbf</span>(<span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SPDB/AfSP012Qry_Profiles.dbf"</span>, <span class="at">as.is=</span><span class="cn">TRUE</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  afspdb.layers <span class="ot">&lt;-</span> <span class="fu">read.dbf</span>(<span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SPDB/AfSP012Qry_Layers.dbf"</span>, <span class="at">as.is=</span><span class="cn">TRUE</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  afspdb.s.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ProfileID"</span>, <span class="st">"FldMnl_ID"</span>, <span class="st">"T_Year"</span>, <span class="st">"X_LonDD"</span>, <span class="st">"Y_LatDD"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(afspdb.layers$BlkDens)</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add missing columns</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(afspdb.layers)){ </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.numeric</span>(afspdb.layers[,j])) { </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>      afspdb.layers[,j] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(afspdb.layers[,j] <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">NA</span>, afspdb.layers[,j]) </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  afspdb.layers<span class="sc">$</span>ca_ext <span class="ot">=</span> afspdb.layers<span class="sc">$</span>ExCa <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  afspdb.layers<span class="sc">$</span>mg_ext <span class="ot">=</span> afspdb.layers<span class="sc">$</span>ExMg <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  afspdb.layers<span class="sc">$</span>na_ext <span class="ot">=</span> afspdb.layers<span class="sc">$</span>ExNa <span class="sc">*</span> <span class="dv">230</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  afspdb.layers<span class="sc">$</span>k_ext <span class="ot">=</span> afspdb.layers<span class="sc">$</span>ExK <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(afspdb.layers$k_ext)</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  afspdb.m <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(afspdb.profiles[,afspdb.s.lst], afspdb.layers)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(afspdb.m$OrgC)</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  afspdb.m<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(afspdb.m<span class="sc">$</span>OrgC <span class="sc">*</span> afspdb.m<span class="sc">$</span>BlkDens <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(afspdb.m<span class="sc">$</span>CfPc), <span class="dv">0</span>, afspdb.m<span class="sc">$</span>CfPc))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(afspdb.m$oc_d)</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(afspdb.m$T_Year)</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  afspdb.m<span class="sc">$</span>T_Year <span class="ot">=</span> <span class="fu">ifelse</span>(afspdb.m<span class="sc">$</span>T_Year <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">NA</span>, afspdb.m<span class="sc">$</span>T_Year)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  afspdb.h.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ProfileID"</span>, <span class="st">"FldMnl_ID"</span>, <span class="st">"T_Year"</span>, <span class="st">"X_LonDD"</span>, <span class="st">"Y_LatDD"</span>, <span class="st">"USDA"</span>, <span class="st">"LayerID"</span>, <span class="st">"LyrObj"</span>, <span class="st">"LayerNr"</span>, <span class="st">"UpDpth"</span>, <span class="st">"LowDpth"</span>, <span class="st">"HorDes"</span>, <span class="st">"texture_description"</span>, <span class="st">"LabTxtr"</span>, <span class="st">"Clay"</span>, <span class="st">"Silt"</span>, <span class="st">"Sand"</span>, <span class="st">"OrgC"</span>, <span class="st">"oc_d"</span>, <span class="st">"TotC"</span>, <span class="st">"TotalN"</span>, <span class="st">"PHKCl"</span>, <span class="st">"PHH2O"</span>, <span class="st">"PHCaCl2"</span>, <span class="st">"CecSoil"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"Ecec"</span>, <span class="st">"CfPc"</span> , <span class="st">"BlkDens"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"EC"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> afspdb.h.lst[<span class="fu">which</span>(<span class="sc">!</span>afspdb.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(afspdb.m))]</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ afspdb.m[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSPDB <span class="ot">=</span> afspdb.m[,afspdb.h.lst]</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSPDB<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"AfSPDB"</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSPDB<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSPDB<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://www.isric.org/projects/africa-soil-profiles-database-afsp"</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSPDB<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://www.isric.org/sites/default/files/isric_report_2014_01.pdf"</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSPDB <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.AfSPDB, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"LabTxtr"</span>,<span class="st">"OrgC"</span>,<span class="st">"Clay"</span>,<span class="st">"Ecec"</span>,<span class="st">"PHH2O"</span>,<span class="st">"EC"</span>,<span class="st">"k_ext"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"X_LonDD"</span>, <span class="st">"Y_LatDD"</span>))</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.AfSPDB, <span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SPDB/chemsprops.AfSPDB.rds"</span>)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: ProfileID</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.AfSPDB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 68833    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 68833    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="africa-soil-information-service-afsis-soil-chemistry" class="level4">
<h4 class="anchored" data-anchor-id="africa-soil-information-service-afsis-soil-chemistry">Africa Soil Information Service (AfSIS) Soil Chemistry</h4>
<ul>
<li>Towett, E. K., Shepherd, K. D., Tondoh, J. E., Winowiecki, L. A., Lulseged, T., Nyambura, M., … &amp; Cadisch, G. (2015). Total elemental composition of soils in Sub-Saharan Africa and relationship with soil forming factors. Geoderma Regional, 5, 157-168. <a href="https://doi.org/10.1016/j.geodrs.2015.06.002" class="uri">https://doi.org/10.1016/j.geodrs.2015.06.002</a></li>
<li><a href="https://github.com/qedsoftware/afsis-soil-chem-tutorial">AfSIS Soil Chemistry</a> produced by World Agroforestry Centre (ICRAF), Quantitative Engineering Design (QED), Center for International Earth Science Information Network (CIESIN), The International Center for Tropical Agriculture (CIAT), Crop Nutrition Laboratory Services (CROPNUTS) and Rothamsted Research (RRES). Data download URL: <a href="https://registry.opendata.aws/afsis/" class="uri">https://registry.opendata.aws/afsis/</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.AfSIS1"</span>)){</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  afsis1.xy <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SSL/2009-2013/Georeferences/georeferences.csv"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  afsis1.xy<span class="sc">$</span>Sampling.date <span class="ot">=</span> <span class="dv">2011</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  afsis1.lst <span class="ot">=</span> <span class="fu">list.files</span>(<span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SSL/2009-2013/Wet_Chemistry"</span>, <span class="at">pattern=</span><span class="fu">glob2rx</span>(<span class="st">"*.csv$"</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  afsis1.hor <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(<span class="fu">lapply</span>(afsis1.lst, read.csv))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  tansis.xy <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SSL/tansis/Georeferences/georeferences.csv"</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(tansis.xy$Sampling.date)</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  tansis.xy<span class="sc">$</span>Sampling.date <span class="ot">=</span> <span class="dv">2018</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  tansis.lst <span class="ot">=</span> <span class="fu">list.files</span>(<span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SSL/tansis/Wet_Chemistry"</span>, <span class="at">pattern=</span><span class="fu">glob2rx</span>(<span class="st">"*.csv$"</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  tansis.hor <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(<span class="fu">lapply</span>(tansis.lst, read.csv))</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  afsis1t.df <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(<span class="fu">list</span>(plyr<span class="sc">::</span><span class="fu">join</span>(afsis1.hor, afsis1.xy, <span class="at">by=</span><span class="st">"SSN"</span>), plyr<span class="sc">::</span><span class="fu">join</span>(tansis.hor, tansis.xy, <span class="at">by=</span><span class="st">"SSN"</span>)))</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  afsis1t.df<span class="sc">$</span>UpDpth <span class="ot">=</span> <span class="fu">ifelse</span>(afsis1t.df<span class="sc">$</span>Depth<span class="sc">==</span><span class="st">"sub"</span>, <span class="dv">20</span>, <span class="dv">0</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  afsis1t.df<span class="sc">$</span>LowDpth <span class="ot">=</span> <span class="fu">ifelse</span>(afsis1t.df<span class="sc">$</span>Depth<span class="sc">==</span><span class="st">"sub"</span>, <span class="dv">50</span>, <span class="dv">20</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  afsis1t.df<span class="sc">$</span>LayerNr <span class="ot">=</span> <span class="fu">ifelse</span>(afsis1t.df<span class="sc">$</span>Depth<span class="sc">==</span><span class="st">"sub"</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(afsis1t.df$C...Org)</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  afsis1t.df<span class="sc">$</span>oc <span class="ot">=</span> <span class="fu">rowMeans</span>(afsis1t.df[,<span class="fu">c</span>(<span class="st">"C...Org"</span>, <span class="st">"X.C"</span>)], <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  afsis1t.df<span class="sc">$</span>c_tot <span class="ot">=</span> afsis1t.df<span class="sc">$</span>Total.carbon</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  afsis1t.df<span class="sc">$</span>n_tot <span class="ot">=</span> <span class="fu">rowMeans</span>(afsis1t.df[,<span class="fu">c</span>(<span class="st">"Total.nitrogen"</span>, <span class="st">"X.N"</span>)], <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  afsis1t.df<span class="sc">$</span>ph_h2o <span class="ot">=</span> <span class="fu">rowMeans</span>(afsis1t.df[,<span class="fu">c</span>(<span class="st">"PH"</span>, <span class="st">"pH"</span>)], <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## multiple texture fractions - which one is the total clay, sand, silt?</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Clay content for water dispersed particles-recorded after 4 minutes of ultrasonication</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(afsis1t.df$Psa.w4clay)</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(afsis1t.df[,c("Longitude", "Latitude")])</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  afsis1.h.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SSN"</span>, <span class="st">"Site"</span>, <span class="st">"Sampling.date"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"Soil.material"</span>, <span class="st">"layer_key"</span>, <span class="st">"LayerNr"</span>, <span class="st">"UpDpth"</span>, <span class="st">"LowDpth"</span>, <span class="st">"HorDes"</span>, <span class="st">"texture_description"</span>, <span class="st">"LabTxtr"</span>, <span class="st">"Psa.w4clay"</span>, <span class="st">"Psa.w4silt"</span>, <span class="st">"Psa.w4sand"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"PHKCl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"PHCaCl2"</span>, <span class="st">"CecSoil"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"Ecec"</span>, <span class="st">"CfPc"</span> , <span class="st">"BlkDens"</span>, <span class="st">"ca_ext"</span>, <span class="st">"M3.Mg"</span>, <span class="st">"M3.Na"</span>, <span class="st">"M3.K"</span>, <span class="st">"EC"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> afsis1.h.lst[<span class="fu">which</span>(<span class="sc">!</span>afsis1.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(afsis1t.df))]</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ afsis1t.df[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSIS1 <span class="ot">=</span> afsis1t.df[,afsis1.h.lst]</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSIS1<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"AfSIS1"</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSIS1<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSIS1<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://registry.opendata.aws/afsis/"</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSIS1<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1016/j.geodrs.2015.06.002"</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  chemsprops.AfSIS1 <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.AfSIS1, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"Psa.w4clay"</span>,<span class="st">"oc"</span>,<span class="st">"ph_h2o"</span>,<span class="st">"M3.K"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>))</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.AfSIS1, <span class="st">"/mnt/diskstation/data/Soil_points/AF/AfSIS_SSL/chemsprops.AfSIS1.rds"</span>)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.AfSIS1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4369   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4369   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="innovative-solutions-for-decision-agriculture-ltd-isda" class="level4">
<h4 class="anchored" data-anchor-id="innovative-solutions-for-decision-agriculture-ltd-isda">Innovative Solutions for Decision Agriculture Ltd (ISDA)</h4>
<ul>
<li>ISDA’s repository contains open soil analysis data for the African continent: <a href="https://doi.org/10.17605/OSF.IO/A69R5" class="uri">https://doi.org/10.17605/OSF.IO/A69R5</a></li>
</ul>
<p>Note: Year of sampling is not specified, hence of limited use for spatiotemporal modeling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.isda"</span>)){</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  isda.xy <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/AF/ISDA/iSDA_soil_data.csv"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.Date(isda.xy$end_date, format="%d/%m/%Y"))</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(isda.xy$source))</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#library("ggplot2")</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#library("scales")</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggplot(isda.xy, aes(as.POSIXct(Sampling.date), ..count..)) + </span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   geom_histogram() +</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   theme_bw() + xlab(NULL) +</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   scale_x_datetime(breaks = date_breaks("3 months"),</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    labels = date_format("%Y-%b"),</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    limits = c(as.POSIXct("2008-01-01"), </span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               as.POSIXct("2020-12-31")) )</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#head(isda.xy)</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(isda.xy[,c("longitude", "latitude")])</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  isda.xy<span class="sc">$</span>labsampnum <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"ISDA."</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(isda.xy))</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  isda.h.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"upedonid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude"</span>, </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">"latitude"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"horizon_upper"</span>, </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">"horizon_lower"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"texture_description"</span>,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>              <span class="st">"texture_lab"</span>, <span class="st">"clay_total"</span>, <span class="st">"silt_total"</span>, <span class="st">"sand_total"</span>,</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>              <span class="st">"carbon_organic"</span>, <span class="st">"oc_d"</span>, <span class="st">"carbon_total"</span>, <span class="st">"nitrogen_total"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph"</span>,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>              <span class="st">"ph_cacl2"</span>, <span class="st">"sum_of_cations_cec_pH_8_2"</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">"cec_nh4_ph_7"</span>, <span class="st">"ecec_base_plus_aluminum"</span>, <span class="st">"total_frag_wt_pct_gt_2_mm_ws"</span>,</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>              <span class="st">"bulk_density_oven_dry"</span>, <span class="st">"calcium_extractable"</span>, <span class="st">"magnesium_extractable"</span>, <span class="st">"sodium_extractable"</span>,</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>              <span class="st">"potassium_extractable"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> isda.h.lst[<span class="fu">which</span>(<span class="sc">!</span>isda.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(isda.xy))]</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ isda.xy[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  chemsprops.isda <span class="ot">=</span> isda.xy[,isda.h.lst]</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>  chemsprops.isda<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"ISDA"</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>  chemsprops.isda<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  chemsprops.isda<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://www.isda-africa.com/"</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  chemsprops.isda<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.17605/OSF.IO/A69R5"</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>  chemsprops.isda <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.isda, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"carbon_organic"</span>,<span class="st">"ph"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>))</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.isda, <span class="st">"/mnt/diskstation/data/Soil_points/AF/ISDA/chemsprops.isda.rds"</span>)</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.isda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 49225    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 49225    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fine-root-ecology-database-fred" class="level4">
<h4 class="anchored" data-anchor-id="fine-root-ecology-database-fred">Fine Root Ecology Database (FRED)</h4>
<ul>
<li>Iversen CM, McCormack ML, Baer JK, Powell AS, Chen W, Collins C, Fan Y, Fanin N, Freschet GT, Guo D, Hogan JA, Kou L, Laughlin DC, Lavely E, Liese R, Lin D, Meier IC, Montagnoli A, Roumet C, See CR, Soper F, Terzaghi M, Valverde-Barrantes OJ, Wang C, Wright SJ, Wurzburger N, Zadworny M. (2021). <a href="https://roots.ornl.gov/">Fine-Root Ecology Database (FRED): A Global Collection of Root Trait Data with Coincident Site, Vegetation, Edaphic, and Climatic Data, Version 3</a>. Oak Ridge National Laboratory, TES SFA, U.S. Department of Energy, Oak Ridge, Tennessee, U.S.A. Access on-line at: <a href="https://doi.org/10.25581/ornlsfa.014/1459186" class="uri">https://doi.org/10.25581/ornlsfa.014/1459186</a>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.FRED"</span>)){</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.setenv</span>(<span class="st">"VROOM_CONNECTION_SIZE"</span> <span class="ot">=</span> <span class="dv">131072</span> <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  fred <span class="ot">=</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/FRED/FRED3_Entire_Database_2021.csv"</span>, <span class="at">skip =</span> <span class="dv">10</span>, <span class="at">col_names=</span><span class="cn">FALSE</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 57,190 x 1,164</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nm.fred = read.csv("/mnt/diskstation/data/Soil_points/INT/FRED/FRED3_Column_Definitions_20210423-091040.csv", header=TRUE)</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  nm.fred0 <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/FRED/FRED3_Entire_Database_2021.csv"</span>, <span class="at">nrows=</span><span class="dv">2</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(fred) <span class="ot">=</span> <span class="fu">make.names</span>(<span class="fu">t</span>(nm.fred0)[,<span class="dv">1</span>])</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1164 columns!</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(fred$Soil.organic.C.content)</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  fred.h.lst <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Notes_Row.ID"</span>, <span class="st">"Data.source_DOI"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"Soil.horizon"</span>, <span class="st">"Soil.texture"</span>, <span class="st">"texture_lab"</span>, <span class="st">"Soil.texture_Fraction.clay"</span>, <span class="st">"Soil.texture_Fraction.silt"</span>, <span class="st">"Soil.texture_Fraction.sand"</span>, <span class="st">"Soil.organic.C.content"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"Soil.N.content"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"Soil.pH_Water"</span>, <span class="st">"Soil.pH_Salt"</span>, <span class="st">"Soil.cation.exchange.capacity..CEC."</span>, <span class="st">"cec_nh4"</span>, <span class="st">"Soil.effective.cation.exchange.capacity..ECEC."</span>, <span class="st">"wpg2"</span>, <span class="st">"Soil.bulk.density"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>, <span class="st">"source_db"</span>, <span class="st">"confidence_degree"</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  fred<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">rowMeans</span>(fred[,<span class="fu">c</span>(<span class="st">"Sample.collection_Year.ending.collection"</span>, <span class="st">"Sample.collection_Year.beginning.collection"</span>)], <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(fred$site_obsdate)</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  fred<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(fred<span class="sc">$</span>Longitude), fred<span class="sc">$</span>Longitude_Estimated, fred<span class="sc">$</span>Longitude)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  fred<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(fred<span class="sc">$</span>Latitude), fred<span class="sc">$</span>Latitude_Estimated, fred<span class="sc">$</span>Latitude)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#names(fred)[grep("Notes_Row", names(fred))]</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(fred[,grep("clay", names(fred))])</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(fred[,grep("cation.exchange", names(fred))])</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(fred[,grep("organic.C", names(fred))])</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(fred$Soil.organic.C.content)</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(fred$Soil.bulk.density)</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(fred$Soil.horizon))</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  fred<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(fred<span class="sc">$</span>Soil.depth_Lower.sampling.depth), fred<span class="sc">$</span>Soil.depth <span class="sc">-</span> <span class="dv">5</span>, fred<span class="sc">$</span>Soil.depth_Lower.sampling.depth)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  fred<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(fred<span class="sc">$</span>Soil.depth_Upper.sampling.depth), fred<span class="sc">$</span>Soil.depth <span class="sc">+</span> <span class="dv">5</span>, fred<span class="sc">$</span>Soil.depth_Upper.sampling.depth)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  fred<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(fred<span class="sc">$</span>Soil.organic.C.content <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> fred<span class="sc">$</span>Soil.bulk.density <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">3</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(fred$oc_d)  </span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> fred.h.lst[<span class="fu">which</span>(<span class="sc">!</span>fred.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(fred))]</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ fred[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  chemsprops.FRED <span class="ot">=</span> fred[,fred.h.lst]</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(chemsprops.FRED[,4:5])</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  chemsprops.FRED<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"FRED"</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  chemsprops.FRED<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  chemsprops.FRED<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://roots.ornl.gov/"</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  chemsprops.FRED<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.25581/ornlsfa.014/1459186"</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  chemsprops.FRED <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.FRED, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"Soil.organic.C.content"</span>, <span class="st">"Soil.texture_Fraction.clay"</span>, <span class="st">"Soil.pH_Water"</span>))</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## many duplicates</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.FRED, <span class="st">"/mnt/diskstation/data/Soil_points/INT/FRED/chemsprops.FRED.rds"</span>)  </span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 57190 Columns: 1164
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (54): X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, X17, X1...
dbl (271): X1, X2, X30, X31, X32, X35, X36, X43, X44, X45, X46, X47, X48, X4...
lgl (839): X16, X20, X37, X38, X39, X42, X52, X53, X54, X55, X56, X57, X58, ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.FRED)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14537    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 14537  39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="global-root-traits-groot-database-compilation" class="level4">
<h4 class="anchored" data-anchor-id="global-root-traits-groot-database-compilation">Global root traits (GRooT) database (compilation)</h4>
<ul>
<li>Guerrero‐Ramírez, N. R., Mommer, L., Freschet, G. T., Iversen, C. M., McCormack, M. L., Kattge, J., … &amp; Weigelt, A. (2021). <a href="https://dx.doi.org/10.1111/geb.13179">Global root traits (GRooT) database</a>. Global ecology and biogeography, 30(1), 25-37. <a href="https://dx.doi.org/10.1111/geb.13179" class="uri">https://dx.doi.org/10.1111/geb.13179</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.GROOT"</span>)){</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Sys.setenv("VROOM_CONNECTION_SIZE" = 131072 * 2)</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  GROOT <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/GRooT/GRooTFullVersion.csv"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 114,222 x 73</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(GROOT$soilCarbon)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(!is.na(GROOT$soilCarbon))</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(GROOT$soilOrganicMatter)</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(GROOT$soilNitrogen)</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(GROOT$soilpH)</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(GROOT$soilTexture))</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lattice::xyplot(soilCarbon ~ soilpH, GROOT, par.settings = list(plot.symbol = list(col=scales::alpha("black", 0.6), fill=scales::alpha("red", 0.6), pch=21, cex=0.6)), scales = list(y=list(log=TRUE, equispaced.log=FALSE)), ylab="SOC", xlab="pH")</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  GROOT<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(GROOT<span class="sc">$</span>year, <span class="st">"-01-01"</span>), <span class="at">format=</span><span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  GROOT<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  GROOT<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  GROOT.h.lst <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"locationID"</span>, <span class="st">"originalID"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"decimalLongitud"</span>, <span class="st">"decimalLatitude"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"GRooTID"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"soilTexture"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"soilCarbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"soilNitrogen"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"soilpH"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"soilCationExchangeCapacity"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> GROOT.h.lst[<span class="fu">which</span>(<span class="sc">!</span>GROOT.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(GROOT))]</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ GROOT[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  chemsprops.GROOT <span class="ot">=</span> GROOT[,GROOT.h.lst]</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.GROOT<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"GROOT"</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.GROOT<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.GROOT<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://groot-database.github.io/GRooT/"</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.GROOT<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://dx.doi.org/10.1111/geb.13179"</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.GROOT <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.GROOT, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"soilCarbon"</span>, <span class="st">"soilpH"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"decimalLongitud"</span>, <span class="st">"decimalLatitude"</span>))</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.GROOT, <span class="st">"/mnt/diskstation/data/Soil_points/INT/GRooT/chemsprops.GROOT.rds"</span>)</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.GROOT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16271    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 16271  39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="global-soil-respiration-db" class="level4">
<h4 class="anchored" data-anchor-id="global-soil-respiration-db">Global Soil Respiration DB</h4>
<ul>
<li>Bond-Lamberty, B. and Thomson, A. (2010). A global database of soil respiration data, Biogeosciences, 7, 1915–1926, <a href="https://doi.org/10.5194/bg-7-1915-2010" class="uri">https://doi.org/10.5194/bg-7-1915-2010</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.SRDB"</span>)){</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  srdb <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/SRDB/srdb-data.csv"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 10366 x 85</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  srdb.h.lst <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Site_ID"</span>, <span class="st">"Notes"</span>, <span class="st">"Study_midyear"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>,  <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psd"</span>, <span class="st">"texture_lab"</span>, <span class="st">"Soil_clay"</span>, <span class="st">"Soil_silt"</span>, <span class="st">"Soil_sand"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"Soil_BD"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>, <span class="st">"source_db"</span>, <span class="st">"confidence_degree"</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(srdb$Study_midyear)</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  srdb<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(srdb<span class="sc">$</span>C_soildepth), <span class="dv">100</span>, srdb<span class="sc">$</span>C_soildepth)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  srdb<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(srdb$Soil_clay)</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(srdb$C_soilmineral)</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  srdb<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(srdb<span class="sc">$</span>C_soilmineral <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">/</span> (srdb<span class="sc">$</span>hzn_bot<span class="sc">/</span><span class="dv">100</span>), <span class="dv">3</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(srdb$oc_d) </span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(srdb$Soil_BD)</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  srdb<span class="sc">$</span>oc <span class="ot">=</span> srdb<span class="sc">$</span>oc_d <span class="sc">/</span> srdb<span class="sc">$</span>Soil_BD</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(srdb$oc)</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> srdb.h.lst[<span class="fu">which</span>(<span class="sc">!</span>srdb.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(srdb))]</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ srdb[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  chemsprops.SRDB <span class="ot">=</span> srdb[,srdb.h.lst]</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(chemsprops.SRDB[,4:5])</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.SRDB<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"SRDB"</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.SRDB<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.SRDB<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://github.com/bpbond/srdb/"</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.SRDB<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.5194/bg-7-1915-2010"</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.SRDB <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.SRDB, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>, <span class="st">"Soil_clay"</span>, <span class="st">"Soil_BD"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>))</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.SRDB, <span class="st">"/mnt/diskstation/data/Soil_points/INT/SRDB/chemsprops.SRDB.rds"</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.SRDB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3337   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3337   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="soils-data-harmonization-database-sodah" class="level4">
<h4 class="anchored" data-anchor-id="soils-data-harmonization-database-sodah">SOils DAta Harmonization database (SoDaH)</h4>
<ul>
<li>Wieder, W. R., Pierson, D., Earl, S., Lajtha, K., Baer, S., Ballantyne, F., … &amp; Weintraub, S. (2020). <a href="https://doi.org/10.5194/essd-2020-195">SoDaH: the SOils DAta Harmonization database, an open-source synthesis of soil data from research networks, version 1.0</a>. Earth System Science Data Discussions, 1-19. <a href="https://doi.org/10.5194/essd-2020-195" class="uri">https://doi.org/10.5194/essd-2020-195</a>. Data download URL: <a href="https://doi.org/10.6073/pasta/9733f6b6d2ffd12bf126dc36a763e0b4" class="uri">https://doi.org/10.6073/pasta/9733f6b6d2ffd12bf126dc36a763e0b4</a></li>
<li>Wieder, W.R., D. Pierson, S.R. Earl, K. … et al, (2020). SOils DAta Harmonization database (SoDaH): an open-source synthesis of soil data from research networks ver 1. Environmental Data Initiative. <a href="https://doi.org/10.6073/pasta/9733f6b6d2ffd12bf126dc36a763e0b4" class="uri">https://doi.org/10.6073/pasta/9733f6b6d2ffd12bf126dc36a763e0b4</a> (Accessed 2024-11-19).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.SoDaH"</span>)){</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  sodah.hor <span class="ot">=</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/SoDaH/521_soils_data_harmonization_6e8416fa0c9a2c2872f21ba208e6a919.csv.gz"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#head(sodah.hor)</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sodah.hor$coarse_frac)</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sodah.hor$lyr_soc)</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## A critical review of the conventional SOC to SOM conversion factor</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## https://doi.org/10.1016/j.geoderma.2010.02.003</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sodah.hor$lyr_som_WalkleyBlack/2)</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(sodah.hor$observation_date))</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  sodah.hor<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(sodah.hor<span class="sc">$</span>observation_date, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  sodah.hor<span class="sc">$</span>oc <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(sodah.hor<span class="sc">$</span>lyr_soc), sodah.hor<span class="sc">$</span>lyr_som_WalkleyBlack<span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> <span class="fl">1.3</span>, sodah.hor<span class="sc">$</span>lyr_soc) <span class="sc">*</span> <span class="dv">10</span> </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  sodah.hor<span class="sc">$</span>n_tot <span class="ot">=</span> sodah.hor<span class="sc">$</span>lyr_n_tot <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  sodah.hor<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(sodah.hor<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> sodah.hor<span class="sc">$</span>bd_samp <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(sodah.hor<span class="sc">$</span>coarse_frac), <span class="dv">0</span>, sodah.hor<span class="sc">$</span>coarse_frac))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  sodah.hor<span class="sc">$</span>site_key <span class="ot">=</span> <span class="fu">paste</span>(sodah.hor<span class="sc">$</span>network, sodah.hor<span class="sc">$</span>location_name, <span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  sodah.hor<span class="sc">$</span>labsampnum <span class="ot">=</span> <span class="fu">make.unique</span>(<span class="fu">paste</span>(sodah.hor<span class="sc">$</span>network, sodah.hor<span class="sc">$</span>location_name, sodah.hor<span class="sc">$</span>L1, <span class="at">sep=</span><span class="st">"_"</span>))</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sodah.hor$oc_d)</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  sodah.h.lst <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"data_file"</span>, <span class="st">"observation_date"</span>, <span class="st">"long"</span>, <span class="st">"lat"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"layer_top"</span>, <span class="st">"layer_bot"</span>, <span class="st">"hzn"</span>, <span class="st">"profile_texture_class"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"coarse_frac"</span>, <span class="st">"bd_samp"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>, <span class="st">"source_db"</span>, <span class="st">"confidence_degree"</span>)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> sodah.h.lst[<span class="fu">which</span>(<span class="sc">!</span>sodah.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(sodah.hor))]</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ sodah.hor[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoDaH <span class="ot">=</span> sodah.hor[,sodah.h.lst]</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(chemsprops.SoDaH[,4:5])</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoDaH<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"SoDaH"</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoDaH<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoDaH<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://lter.github.io/som-website"</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoDaH<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.5194/essd-2020-195"</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoDaH <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.SoDaH, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>, <span class="st">"clay"</span>, <span class="st">"ph_h2o"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>))</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.SoDaH, <span class="st">"/mnt/diskstation/data/Soil_points/INT/SoDaH/chemsprops.SoDaH.rds"</span>)</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 293592 Columns: 157
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (62): google_dir, data_file, curator_PersonName, curator_organization, ...
dbl  (63): lat, long, elevation, map, mat, tx_start, aspect_deg, slope, npp,...
lgl  (31): depth_water, lit_c, lit_n, lit_p, lit_cn, lit_lig, bnpp_notes, L5...
date  (1): modification_date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.SoDaH)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 55760    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 55760    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="isric-wise-harmonized-soil-profile-data" class="level4">
<h4 class="anchored" data-anchor-id="isric-wise-harmonized-soil-profile-data">ISRIC WISE harmonized soil profile data</h4>
<ul>
<li>Batjes, N.H. (2019). <a href="http://dx.doi.org/10.1111/j.1475-2743.2009.00202.x">Harmonized soil profile data for applications at global and continental scales: updates to the WISE database</a>. Soil Use and Management 5:124–127. Data download URL: <a href="https://files.isric.org/public/wise/WD-WISE.zip" class="uri">https://files.isric.org/public/wise/WD-WISE.zip</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.WISE"</span>)){</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  wise.site <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_WISE/WISE3_SITE.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#fao.90.lst = lapply(levels(as.factor(wise.site$FAO_90)), function(i){sumcor(wise.site, "FAO_90", "USCL", i)})</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#fao.90.uscl = do.call(rbind, fao.90.lst)</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write.csv(fao.90.uscl, "/mnt/diskstation/data/Soil_points/INT/ISRIC_WISE/correlation_FAO.90_USCL.csv")</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  wise.s.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"WISE3_id"</span>, <span class="st">"PITREF"</span>, <span class="st">"DATEYR"</span>, <span class="st">"LONDD"</span>, <span class="st">"LATDD"</span>, <span class="st">"USCL"</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  wise.site<span class="sc">$</span>LONDD <span class="ot">=</span> <span class="fu">as.numeric</span>(wise.site<span class="sc">$</span>LONDD)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  wise.site<span class="sc">$</span>LATDD <span class="ot">=</span> <span class="fu">as.numeric</span>(wise.site<span class="sc">$</span>LATDD)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  wise.layer <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_WISE/WISE3_HORIZON.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  wise.layer<span class="sc">$</span>ca_ext <span class="ot">=</span> <span class="fu">signif</span>(wise.layer<span class="sc">$</span>EXCA <span class="sc">*</span> <span class="dv">200</span>, <span class="dv">4</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  wise.layer<span class="sc">$</span>mg_ext <span class="ot">=</span> <span class="fu">signif</span>(wise.layer<span class="sc">$</span>EXMG <span class="sc">*</span> <span class="dv">121</span>, <span class="dv">3</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  wise.layer<span class="sc">$</span>na_ext <span class="ot">=</span> <span class="fu">signif</span>(wise.layer<span class="sc">$</span>EXNA <span class="sc">*</span> <span class="dv">230</span>, <span class="dv">3</span>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  wise.layer<span class="sc">$</span>k_ext <span class="ot">=</span> <span class="fu">signif</span>(wise.layer<span class="sc">$</span>EXK <span class="sc">*</span> <span class="dv">391</span>, <span class="dv">3</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  wise.layer<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(wise.layer<span class="sc">$</span>ORGC <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> wise.layer<span class="sc">$</span>BULKDENS <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(wise.layer<span class="sc">$</span>GRAVEL), <span class="dv">0</span>, wise.layer<span class="sc">$</span>GRAVEL))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  wise.h.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"WISE3_ID"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"HONU"</span>, <span class="st">"TOPDEP"</span>, <span class="st">"BOTDEP"</span>, <span class="st">"DESIG"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"CLAY"</span>, <span class="st">"SILT"</span>, <span class="st">"SAND"</span>, <span class="st">"ORGC"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"TOTN"</span>, <span class="st">"PHKCL"</span>, <span class="st">"PHH2O"</span>, <span class="st">"PHCACL2"</span>, <span class="st">"CECSOIL"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"GRAVEL"</span> , <span class="st">"BULKDENS"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ECE"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> wise.h.lst[<span class="fu">which</span>(<span class="sc">!</span>wise.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(wise.layer))]</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ wise.layer[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  chemsprops.WISE <span class="ot">=</span> <span class="fu">merge</span>(wise.site[,wise.s.lst], wise.layer[,wise.h.lst], <span class="at">by.x=</span><span class="st">"WISE3_id"</span>, <span class="at">by.y=</span><span class="st">"WISE3_ID"</span>)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.WISE<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"ISRIC_WISE"</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.WISE<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.WISE<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://dx.doi.org/10.1111/j.1475-2743.2009.00202.x"</span>  </span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.WISE<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"http://dx.doi.org/10.1111/j.1475-2743.2009.00202.x"</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.WISE <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.WISE, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"ORGC"</span>,<span class="st">"CLAY"</span>,<span class="st">"PHH2O"</span>,<span class="st">"CECSOIL"</span>,<span class="st">"k_ext"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONDD"</span>, <span class="st">"LATDD"</span>))</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.WISE, <span class="st">"/mnt/diskstation/data/Soil_points/INT/ISRIC_WISE/chemsprops.WISE.rds"</span>)</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.WISE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37443    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 37443    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="international-soil-carbon-network-compilation" class="level4">
<h4 class="anchored" data-anchor-id="international-soil-carbon-network-compilation">International Soil Carbon Network (compilation)</h4>
<ul>
<li>Nave, L., K. Johnson, C. van Ingen, D. Agarwal, M. Humphrey, and N. Beekwilder. 2022. International Soil Carbon Network version 3 Database (ISCN3) ver 1. Environmental Data Initiative. <a href="https://doi.org/10.6073/pasta/cc751923c5576b95a6d6a227d5afe8ba" class="uri">https://doi.org/10.6073/pasta/cc751923c5576b95a6d6a227d5afe8ba</a> (Accessed 2025-02-03). Data download URL: <a href="https://portal.edirepository.org/nis/mapbrowse?packageid=edi.1160.1" class="uri">https://portal.edirepository.org/nis/mapbrowse?packageid=edi.1160.1</a><br>
</li>
<li>Malhotra, A., Todd-Brown, K., Nave, L. E., Batjes, N. H., Holmquist, J. R., Hoyt, A. M., … &amp; Harden, J. (2019). The landscape of soil carbon data: emerging questions, synergies and databases. Progress in Physical Geography: Earth and Environment, 43(5), 707-719. <a href="https://doi.org/10.1177/0309133319873309" class="uri">https://doi.org/10.1177/0309133319873309</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.ISCN"</span>)){</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  path.iscn <span class="ot">=</span> <span class="st">"/mnt/diskstation/data/Soil_points/INT/ISCNData/"</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  iscn.hor <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(path.iscn, <span class="st">"ISCN3_layer.csv.gz"</span>), <span class="at">delim=</span><span class="st">";"</span>, <span class="at">col_types =</span> <span class="fu">strrep</span>(<span class="st">'c'</span>, <span class="at">times =</span> <span class="dv">95</span>)), vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="fu">paste0</span>(path.iscn, <span class="st">"ISCN3_profile.csv.gz"</span>), <span class="at">delim=</span><span class="st">";"</span>, <span class="at">col_types =</span> <span class="fu">strrep</span>(<span class="st">'c'</span>, <span class="at">times =</span> <span class="dv">44</span>)), <span class="at">by=</span><span class="fu">c</span>(<span class="st">"site_name"</span>,<span class="st">"profile_name"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Rows: 445829 Columns: 95</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(iscn.hor$dataset_name_sub.x))</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For citations see: 'ISCN3_citation.csv'</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Some data sets already imported via original data!</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  iscn.rm <span class="ot">=</span> <span class="fu">which</span>(iscn.hor<span class="sc">$</span>dataset_name_sub.x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"NRCS Sept/2014"</span>, <span class="st">"Worldwide soil carbon and nitrogen data"</span>, <span class="st">"Northern Circumpolar Soil Carbon Database (NCSCD)"</span>))</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  iscn.hor <span class="ot">=</span> iscn.hor[<span class="sc">-</span>iscn.rm,]</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  iscn.hor <span class="ot">=</span> iscn.hor[<span class="sc">!</span><span class="fu">is.na</span>(iscn.hor<span class="sc">$</span><span class="st">`</span><span class="at">long (dec. deg).x</span><span class="st">`</span>),]</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dim(iscn.hor)</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 35650   137</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(iscn.hor$soil_taxon.x)</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(iscn.hor$`datum (datum).x`))</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## NAD27 NAD83 WGS84  NA's </span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    976  8433 26241 11099</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  iscn.hor<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> <span class="fu">as.numeric</span>(iscn.hor<span class="sc">$</span><span class="st">`</span><span class="at">long (dec. deg).x</span><span class="st">`</span>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>  iscn.hor<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> <span class="fu">as.numeric</span>(iscn.hor<span class="sc">$</span><span class="st">`</span><span class="at">lat (dec. deg).x</span><span class="st">`</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"NAD27"</span>,<span class="st">"NAD83"</span>)){</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>    sel <span class="ot">&lt;-</span> <span class="fu">which</span>(iscn.hor<span class="sc">$</span><span class="st">`</span><span class="at">datum (datum).x</span><span class="st">`</span><span class="sc">==</span>j)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>    xy <span class="ot">&lt;-</span> iscn.hor[sel,<span class="fu">c</span>(<span class="st">"longitude_decimal_degrees"</span>,<span class="st">"latitude_decimal_degrees"</span>,<span class="st">"profile_name"</span>)]</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(j<span class="sc">==</span><span class="st">"NAD 83"</span><span class="sc">|</span>j<span class="sc">==</span><span class="st">"NAD83"</span><span class="sc">|</span>j<span class="sc">==</span><span class="st">"NAD83?"</span>){</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>      xy.v <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">vect</span>(xy, <span class="at">geom=</span><span class="fu">c</span>(<span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>), <span class="at">crs=</span><span class="st">"+proj=longlat +datum=NAD83"</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(j<span class="sc">==</span><span class="st">"NAD27"</span>){</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>      xy.v <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">vect</span>(xy, <span class="at">geom=</span><span class="fu">c</span>(<span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>), <span class="at">crs=</span><span class="st">"+proj=longlat +datum=NAD27"</span>)</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>    xy.t <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">project</span>(xy.v, <span class="st">"EPSG:4326"</span>)</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>    iscn.hor[sel,<span class="st">"longitude_decimal_degrees"</span>] <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">geom</span>(xy.t)[,<span class="st">"x"</span>]</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    iscn.hor[sel,<span class="st">"latitude_decimal_degrees"</span>] <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">geom</span>(xy.t)[,<span class="st">"y"</span>]</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(iscn.hor[,c("longitude_decimal_degrees","latitude_decimal_degrees")], pch="+")</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>  iscn.hor<span class="sc">$</span>SSL_classification_name <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(iscn.hor<span class="sc">$</span>soil_taxon.x), <span class="fu">paste</span>(iscn.hor<span class="sc">$</span>soil_series.x), <span class="fu">paste</span>(iscn.hor<span class="sc">$</span>soil_taxon.x))</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(iscn.hor$SSL_classification_name))</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Strange Date format - https://github.com/ISCN/SOCDRaHR2/blob/master/R/ISCN3_3.R</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>  iscn.hor<span class="sc">$</span>site_obsdate <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">as_date</span>(<span class="fu">as.numeric</span>(iscn.hor<span class="sc">$</span><span class="st">`</span><span class="at">observation_date (YYYY-MM-DD).x</span><span class="st">`</span>), <span class="at">origin =</span> lubridate<span class="sc">::</span><span class="fu">ymd</span>(<span class="st">'1899-12-31'</span>))</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(iscn.hor$site_obsdate)</span></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(iscn.hor$c_method))</span></span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>  <span class="do">## some 5+ methods, mainly Dry combustion</span></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>  iscn.hor<span class="sc">$</span>organic_carbon <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(iscn.hor<span class="sc">$</span><span class="st">`</span><span class="at">oc (percent)</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">10</span> </span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>  iscn.hor<span class="sc">$</span>total_carbon_ncs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(iscn.hor<span class="sc">$</span><span class="st">`</span><span class="at">c_tot (percent)</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>  iscn.hor<span class="sc">$</span>total_nitrogen_ncs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(iscn.hor<span class="sc">$</span><span class="st">`</span><span class="at">n_tot (percent)</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>  iscn.hor<span class="sc">$</span>bulk_density_oven_dry <span class="ot">=</span> <span class="fu">rowMeans</span>( <span class="fu">sapply</span>(iscn.hor[,<span class="fu">c</span>(<span class="st">"bd_samp (g cm-3)"</span>, <span class="st">"bd_other (g cm-3)"</span>, <span class="st">"bd_whole (g cm-3)"</span>)], as.numeric), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>  iscn.hor<span class="sc">$</span>bulk_density_oven_dry <span class="ot">=</span> <span class="fu">ifelse</span>(iscn.hor<span class="sc">$</span>bulk_density_oven_dry <span class="sc">&lt;</span> <span class="fl">0.02</span> <span class="sc">|</span> iscn.hor<span class="sc">$</span>bulk_density_oven_dry <span class="sc">&gt;</span> <span class="fl">2.6</span>, <span class="cn">NA</span>, iscn.hor<span class="sc">$</span>bulk_density_oven_dry)</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(iscn.hor$bulk_density_oven_dry)</span></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#iscn.hor$oc_d &lt;- iscn.hor$`soc (g cm-2).x` / ((iscn.hor$`layer_bot (cm).x` - iscn.hor$`layer_top (cm).x`)/100)</span></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>  iscn.hor<span class="sc">$</span>oc_d <span class="ot">&lt;-</span> iscn.hor<span class="sc">$</span>organic_carbon <span class="sc">*</span> iscn.hor<span class="sc">$</span>bulk_density_oven_dry <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(iscn.hor<span class="sc">$</span><span class="st">`</span><span class="at">wpg2 (percent)</span><span class="st">`</span>), <span class="dv">0</span>, <span class="fu">as.numeric</span>(iscn.hor<span class="sc">$</span><span class="st">`</span><span class="at">wpg2 (percent)</span><span class="st">`</span>))<span class="sc">/</span><span class="dv">100</span>))</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(iscn.hor$oc_d)</span></span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>  iscn.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"site_name"</span>, <span class="st">"profile_name"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, </span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>      <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>, </span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>      <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"layer_top (cm).x"</span>, <span class="st">"layer_bot (cm).x"</span>, </span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>      <span class="st">"hzn_desgn"</span>, <span class="st">"texture_description"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa (percent)"</span>, <span class="st">"silt_tot_psa (percent)"</span>, </span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sand_tot_psa (percent)"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"total_carbon_ncs"</span>, <span class="st">"total_nitrogen_ncs"</span>, </span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>      <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"sum_of_cations_cec_pH_8_2"</span>, <span class="st">"cec_nh4_ph_7"</span>, <span class="st">"ecec_base_plus_aluminum"</span>, </span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a>      <span class="st">"wpg2 (percent)"</span>, <span class="st">"bulk_density_oven_dry"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, </span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>      <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)</span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> iscn.lst[<span class="fu">which</span>(<span class="sc">!</span>iscn.lst <span class="sc">%in%</span> <span class="fu">names</span>(iscn.hor))]</span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ iscn.hor[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCN <span class="ot">=</span> iscn.hor[,iscn.lst]</span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCN<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"ISCN"</span></span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCN<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCN<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://iscn.fluxdata.org/"</span>  </span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCN<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.6073/pasta/cc751923c5576b95a6d6a227d5afe8ba"</span></span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCN <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.ISCN, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"organic_carbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"clay_tot_psa (percent)"</span>, <span class="st">"SSL_classification_name"</span>))</span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.ISCN, <span class="st">"/mnt/diskstation/data/Soil_points/INT/ISCNData/chemsprops.ISCN.rds"</span>)</span>
<span id="cb53-66"><a href="#cb53-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-67"><a href="#cb53-67" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.ISCN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35650    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 35650    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gemas" class="level4">
<h4 class="anchored" data-anchor-id="gemas">GEMAS</h4>
<ul>
<li>Reimann, C., Fabian, K., Birke, M., Filzmoser, P., Demetriades, A., Négrel, P., … &amp; Anderson, M. (2018). <a href="https://doi.org/10.1016/j.apgeochem.2017.01.021">GEMAS: Establishing geochemical background and threshold for 53 chemical elements in European agricultural soil</a>. Applied Geochemistry, 88, 302-318. Data download URL: <a href="http://gemas.geolba.ac.at/" class="uri">http://gemas.geolba.ac.at/</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.GEMAS"</span>)){</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  gemas.samples <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/EU/GEMAS/GEMAS.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## GEMAS, agricultural soil, 0-20 cm, air dried, &lt;2 mm, aqua regia Data from ACME, total C, TOC, CEC, ph_CaCl2</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  gemas.samples<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  gemas.samples<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  gemas.samples<span class="sc">$</span>oc <span class="ot">=</span> gemas.samples<span class="sc">$</span>TOC <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(gemas.samples$oc)</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  gemas.samples<span class="sc">$</span>c_tot <span class="ot">=</span> gemas.samples<span class="sc">$</span>C_tot <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  gemas.samples<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="dv">2009</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  gemas.h.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"COUNRTY"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"XCOO"</span>, <span class="st">"YCOO"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"TYPE"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"pH_CaCl2"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> gemas.h.lst[<span class="fu">which</span>(<span class="sc">!</span>gemas.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(gemas.samples))]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ gemas.samples[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  chemsprops.GEMAS <span class="ot">&lt;-</span> gemas.samples[,gemas.h.lst]</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  chemsprops.GEMAS<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"GEMAS_2009"</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  chemsprops.GEMAS<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  chemsprops.GEMAS<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://gemas.geolba.ac.at/"</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  chemsprops.GEMAS<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1016/j.apgeochem.2017.01.021"</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  chemsprops.GEMAS <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.GEMAS, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"clay"</span>,<span class="st">"pH_CaCl2"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"XCOO"</span>, <span class="st">"YCOO"</span>))</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.GEMAS, <span class="st">"/mnt/diskstation/data/Soil_points/EU/GEMAS/chemsprops.GEMAS.rds"</span>)</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.GEMAS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4131   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4131   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lucas-soil" class="level4">
<h4 class="anchored" data-anchor-id="lucas-soil">LUCAS soil</h4>
<ul>
<li>Orgiazzi, A., Ballabio, C., Panagos, P., Jones, A., &amp; Fernández‐Ugalde, O. (2018). <a href="https://doi.org/10.1111/ejss.12499">LUCAS Soil, the largest expandable soil dataset for Europe: a review</a>. European Journal of Soil Science, 69(1), 140-153. Data download URL: <a href="https://esdac.jrc.ec.europa.eu/content/lucas-2009-topsoil-data" class="uri">https://esdac.jrc.ec.europa.eu/content/lucas-2009-topsoil-data</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.LUCAS"</span>)){</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  lucas.samples <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/LUCAS_TOPSOIL_v1.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  lucas.samples<span class="sc">$</span>site_obsdate <span class="ot">&lt;-</span> <span class="st">"2009"</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(lucas.samples$N)</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  lucas.ro <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/Romania.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  lucas.ro<span class="sc">$</span>site_obsdate <span class="ot">&lt;-</span> <span class="st">"2012"</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(lucas.samples)[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">names</span>(lucas.samples) <span class="sc">%in%</span> <span class="fu">names</span>(lucas.ro))]</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  lucas.ro <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(lucas.ro, <span class="at">replace=</span><span class="fu">c</span>(<span class="st">"Soil.ID"</span><span class="ot">=</span><span class="st">"sample_ID"</span>, <span class="st">"GPS_X_LONG"</span><span class="ot">=</span><span class="st">"GPS_LONG"</span>, <span class="st">"GPS_Y_LAT"</span><span class="ot">=</span><span class="st">"GPS_LAT"</span>, <span class="st">"pHinH2O"</span><span class="ot">=</span><span class="st">"pH_in_H2O"</span>, <span class="st">"pHinCaCl2"</span><span class="ot">=</span><span class="st">"pH_in_CaCl"</span>))</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  lucas.bu <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/Bulgaria.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  lucas.bu<span class="sc">$</span>site_obsdate <span class="ot">&lt;-</span> <span class="st">"2012"</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(lucas.samples)[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">names</span>(lucas.samples) <span class="sc">%in%</span> <span class="fu">names</span>(lucas.bu))]</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lucas.ch &lt;- openxlsx::read.xlsx("/mnt/diskstation/data/Soil_points/EU/LUCAS/LUCAS_2015_Topsoil_data_of_Switzerland-with-coordinates.xlsx_.xlsx", sheet = 1, startRow = 2)</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lucas.ch = plyr::rename(lucas.ch, replace=c("Soil_ID"="sample_ID", "GPS_.LAT"="GPS_LAT", "pH.in.H2O"="pH_in_H2O", "pH.in.CaCl2"="pH_in_CaCl", "Calcium.carbonate/.g.kg–1"="CaCO3", "Silt/.g.kg–1"="silt", "Sand/.g.kg–1"="sand", "Clay/.g.kg–1"="clay", "Organic.carbon/.g.kg–1"="OC"))</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Double readings?</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  lucas.t <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(<span class="fu">list</span>(lucas.samples, lucas.ro, lucas.bu))</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  lucas.h.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"POINT_ID"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"GPS_LONG"</span>, <span class="st">"GPS_LAT"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"sample_ID"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand"</span>, <span class="st">"OC"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"N"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"pH_in_H2O"</span>, <span class="st">"pH_in_CaCl"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"coarse"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"K"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> lucas.h.lst[<span class="fu">which</span>(<span class="sc">!</span>lucas.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(lucas.t))]</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ lucas.t[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS <span class="ot">&lt;-</span> lucas.t[,lucas.h.lst]</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"LUCAS_2009"</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS<span class="sc">$</span>hzn_top <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS<span class="sc">$</span>hzn_bot <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS<span class="sc">$</span>OC <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">as.numeric</span>(chemsprops.LUCAS<span class="sc">$</span>OC)<span class="sc">&lt;</span><span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">as.numeric</span>(chemsprops.LUCAS<span class="sc">$</span>OC))</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://esdac.jrc.ec.europa.eu/"</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1111/ejss.12499"</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.LUCAS, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"OC"</span>,<span class="st">"clay"</span>,<span class="st">"pH_in_H2O"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"GPS_LONG"</span>, <span class="st">"GPS_LAT"</span>))</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.LUCAS, <span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/chemsprops.LUCAS.rds"</span>)</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ifelse(as.numeric(chemsprops.LUCAS$OC) &lt; 0, 0,
as.numeric(chemsprops.LUCAS$OC)): NAs introduced by coercion
Warning in ifelse(as.numeric(chemsprops.LUCAS$OC) &lt; 0, 0,
as.numeric(chemsprops.LUCAS$OC)): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.LUCAS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21272    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 21272    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.LUCAS2"</span>)){</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lucas2015.samples &lt;- openxlsx::read.xlsx("/mnt/diskstation/data/Soil_points/EU/LUCAS/LUCAS_Topsoil_2015_20200323.xlsx", sheet = 1)</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  lucas2015.v <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">vect</span>(<span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/LUCAS_Topsoil_2015_20200323.shp"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#head(as.data.frame(lucas2015.xy))</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  lucas2015.xy <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(<span class="fu">as.data.frame</span>(lucas2015.v), <span class="fu">geom</span>(lucas2015.v))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## https://www.aqion.de/site/130</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 mS/m = 100 mS/cm | 1 dS/m = 1 mS/cm = 1 mS/m / 100</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  lucas2015.xy<span class="sc">$</span>ec_satp <span class="ot">=</span> lucas2015.xy<span class="sc">$</span>EC <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  lucas2015.h.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Point_ID"</span>, <span class="st">"LC0_Desc"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"sample_ID"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"Clay"</span>, <span class="st">"Silt"</span>, <span class="st">"Sand"</span>, <span class="st">"OC"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"N"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"pH_H20"</span>, <span class="st">"pH_CaCl2"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"coarse"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"K"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> lucas2015.h.lst[<span class="fu">which</span>(<span class="sc">!</span>lucas2015.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(lucas2015.xy))]</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ lucas2015.xy[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS2 <span class="ot">&lt;-</span> lucas2015.xy[,lucas2015.h.lst]</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS2<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"LUCAS_2015"</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS2<span class="sc">$</span>hzn_top <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS2<span class="sc">$</span>hzn_bot <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS2<span class="sc">$</span>site_obsdate <span class="ot">&lt;-</span> <span class="st">"2015"</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS2<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS2<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://esdac.jrc.ec.europa.eu/"</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS2<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1111/ejss.12499"</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS2 <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.LUCAS2, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"OC"</span>,<span class="st">"Clay"</span>,<span class="st">"pH_H20"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>))</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.LUCAS2, <span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/chemsprops.LUCAS2.rds"</span>)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.LUCAS2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21859    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 21859    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.LUCAS3"</span>)){</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  lucas2018.xy <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/LUCAS-SOIL-2018.xls"</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  rem.LOD <span class="ot">=</span> <span class="cf">function</span>(x){ <span class="fu">as.numeric</span>(<span class="fu">ifelse</span>(x<span class="sc">==</span><span class="st">"&lt; LOD"</span>, <span class="dv">0</span>, <span class="fu">as.numeric</span>(x)))}</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  lucas2018.bd <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/BulkDensity_2018_final-2.csv"</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  lucas2018.xy<span class="sc">$</span>BD <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(lucas2018.xy, lucas2018.bd, <span class="fu">join_by</span>(POINTID <span class="sc">==</span> POINT_ID))<span class="sc">$</span>BD.<span class="fl">0.20</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  lucas2018.xy<span class="sc">$</span>BD <span class="ot">=</span> <span class="fu">ifelse</span>(lucas2018.xy<span class="sc">$</span>BD <span class="sc">&lt;</span> <span class="fl">0.04</span> <span class="sc">|</span> lucas2018.xy<span class="sc">$</span>BD <span class="sc">&gt;</span> <span class="fl">2.4</span>, <span class="cn">NA</span>, lucas2018.xy<span class="sc">$</span>BD)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 mS/m = 100 mS/cm | 1 dS/m = 1 mS/cm = 1 mS/m / 100</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(!is.na(lucas2018.xy$`OC (20-30 cm)`))</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  lucas2018.xy<span class="sc">$</span>pH_H2O <span class="ot">=</span> <span class="fu">as.numeric</span>(lucas2018.xy<span class="sc">$</span>pH_H2O)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  lucas2018.xy<span class="sc">$</span>OC <span class="ot">=</span> <span class="fu">rem.LOD</span>(lucas2018.xy<span class="sc">$</span>OC)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(lucas2018.xy$OC)</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  lucas2018.xy<span class="sc">$</span>K <span class="ot">=</span> <span class="fu">rem.LOD</span>(lucas2018.xy<span class="sc">$</span>K)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  lucas2018.xy<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(lucas2018.xy<span class="sc">$</span>OC<span class="sc">/</span><span class="dv">1000</span> <span class="sc">*</span> lucas2018.xy<span class="sc">$</span>BD<span class="sc">*</span><span class="dv">1000</span>, <span class="dv">3</span>)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(lucas2018.xy$oc_d)</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  lucas2018.xy<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">as.Date</span>(lucas2018.xy<span class="sc">$</span>SURVEY_DATE, <span class="at">format =</span> <span class="st">"%d/%m/%y"</span>)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  lucas2018.xy<span class="sc">$</span>ec_satp <span class="ot">=</span> <span class="fu">as.numeric</span>(lucas2018.xy<span class="sc">$</span>EC) <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  lucas2018.h.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Point_ID"</span>, <span class="st">"LC0_Desc"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"TH_LONG"</span>, <span class="st">"TH_LAT"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"sample_ID"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"Clay"</span>, <span class="st">"Silt"</span>, <span class="st">"Sand"</span>, <span class="st">"OC"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"N"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"pH_H20"</span>, <span class="st">"pH_CaCl2"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"coarse"</span>, <span class="st">"BD"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"K"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> lucas2018.h.lst[<span class="fu">which</span>(<span class="sc">!</span>lucas2018.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(lucas2018.xy))]</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ lucas2018.xy[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS3 <span class="ot">&lt;-</span> lucas2018.xy[,lucas2018.h.lst]</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS3<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"LUCAS_2018"</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS3<span class="sc">$</span>hzn_top <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS3<span class="sc">$</span>hzn_bot <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS3<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS3<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://esdac.jrc.ec.europa.eu/"</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS3<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1111/ejss.12499"</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.LUCAS3 <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.LUCAS3, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"OC"</span>,<span class="st">"pH_H20"</span>,<span class="st">"BD"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"TH_LONG"</span>, <span class="st">"TH_LAT"</span>))</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.LUCAS3, <span class="st">"/mnt/diskstation/data/Soil_points/EU/LUCAS/chemsprops.LUCAS3.rds"</span>)</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in K15399 / R15399C11: got '&lt; LOD'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ifelse(x == "&lt; LOD", 0, as.numeric(x)): NAs introduced by coercion
Warning in ifelse(x == "&lt; LOD", 0, as.numeric(x)): NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.LUCAS3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18982    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 18982    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mangrove-forest-soil-db" class="level4">
<h4 class="anchored" data-anchor-id="mangrove-forest-soil-db">Mangrove forest soil DB</h4>
<ul>
<li>Sanderman, J., Hengl, T., Fiske, G., Solvik, K., Adame, M. F., Benson, L., … &amp; Duncan, C. (2018). <a href="https://doi.org/10.1088/1748-9326/aabe1c">A global map of mangrove forest soil carbon at 30 m spatial resolution</a>. Environmental Research Letters, 13(5), 055002. Data download URL: <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/OCYUIT" class="uri">https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/OCYUIT</a></li>
<li>Maxwell, T. L., Hengl, T., Parente, L. L., Minarik, R., Worthington, T. A., Bunting, P., … &amp; Landis, E. (2023). Global mangrove soil organic carbon stocks dataset at 30 m resolution for the year 2020 based on spatiotemporal predictive machine learning. Data in Brief, 50, 109621. <a href="https://doi.org/10.1016/j.dib.2023.109621" class="uri">https://doi.org/10.1016/j.dib.2023.109621</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.Mangroves"</span>)){</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  mng.profs <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/TNC_mangroves/mangrove_soc_database_v10_sites.csv"</span>, <span class="at">skip=</span><span class="dv">1</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  mng.hors <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/TNC_mangroves/mangrove_soc_database_v10_horizons.csv"</span>, <span class="at">skip=</span><span class="dv">1</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  mng<span class="fl">.2022</span> <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/TNC_mangroves/mangrove_C_2022_update.csv"</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  mng<span class="fl">.2022</span><span class="sc">$</span>CD_calc <span class="ot">=</span> mng<span class="fl">.2022</span><span class="sc">$</span>OC <span class="sc">/</span><span class="dv">100</span> <span class="sc">*</span> <span class="fu">as.numeric</span>(mng<span class="fl">.2022</span><span class="sc">$</span>BD_reported)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  mng.<span class="fl">2022.</span>f <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rename</span>(mng<span class="fl">.2022</span>, <span class="at">replace =</span> <span class="fu">list</span>(<span class="st">"Year_collected"</span><span class="ot">=</span><span class="st">"Year_sampled"</span>, <span class="st">"Longitude"</span><span class="ot">=</span><span class="st">"Longitude_Adjusted"</span>, <span class="st">"Latitude"</span><span class="ot">=</span><span class="st">"Latitude_Adjusted"</span>, <span class="st">"BD_reported"</span><span class="ot">=</span><span class="st">"BD_final"</span>, <span class="st">"OC"</span><span class="ot">=</span><span class="st">"OC_final"</span>))</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  mngALL <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(mng.hors, mng.profs, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Site.name"</span>))</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  mngALL <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(mngALL, mng<span class="fl">.2022</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  mngALL<span class="sc">$</span>oc <span class="ot">=</span> mngALL<span class="sc">$</span>OC_final <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  mngALL<span class="sc">$</span>oc_d <span class="ot">=</span> mngALL<span class="sc">$</span>CD_calc <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  mngALL<span class="sc">$</span>hzn_top <span class="ot">=</span> mngALL<span class="sc">$</span>U_depth <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  mngALL<span class="sc">$</span>hzn_bot <span class="ot">=</span> mngALL<span class="sc">$</span>L_depth <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  mngALL<span class="sc">$</span>wpg2 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(mngALL$BD_reported) ## some very high values 3.26 t/m3</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  mngALL<span class="sc">$</span>Year <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(mngALL<span class="sc">$</span>Year_sampled), mngALL<span class="sc">$</span>Years_collected, mngALL<span class="sc">$</span>Year_sampled)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  mng.col <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Site.name"</span>, <span class="st">"Site.."</span>, <span class="st">"Year"</span>, <span class="st">"Longitude_Adjusted"</span>, <span class="st">"Latitude_Adjusted"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>,<span class="st">"hzn_top"</span>,<span class="st">"hzn_bot"</span>,<span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"BD_reported"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)  </span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> mng.col[<span class="fu">which</span>(<span class="sc">!</span>mng.col <span class="sc">%in%</span> <span class="fu">names</span>(mngALL))]</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ mngALL[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.Mangroves <span class="ot">=</span> mngALL[,mng.col]</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.Mangroves<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"MangrovesDB"</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.Mangroves<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.Mangroves<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://maps.oceanwealth.org/mangrove-restoration/"</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.Mangroves<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1088/1748-9326/aabe1c"</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.Mangroves <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.Mangroves, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"BD_reported"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude_Adjusted"</span>, <span class="st">"Latitude_Adjusted"</span>))</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#head(chemsprops.Mangroves)</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>  mng.rm <span class="ot">=</span> chemsprops.Mangroves<span class="sc">$</span>Site.name[chemsprops.Mangroves<span class="sc">$</span>Site.name <span class="sc">%in%</span> mngALL<span class="sc">$</span>Site.name[<span class="fu">grep</span>(<span class="st">"N"</span>, mngALL<span class="sc">$</span>OK.to.release., <span class="at">ignore.case =</span> <span class="cn">FALSE</span>)]]</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.Mangroves, <span class="st">"/mnt/diskstation/data/Soil_points/INT/TNC_mangroves/chemsprops.Mangroves.rds"</span>)</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.Mangroves)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7987   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 7987   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cifor-peatland-points" class="level4">
<h4 class="anchored" data-anchor-id="cifor-peatland-points">CIFOR peatland points</h4>
<p>Peatland soil measurements (points) from the literature described in:</p>
<ul>
<li>Murdiyarso, D., Roman-Cuesta, R. M., Verchot, L. V., Herold, M., Gumbricht, T., Herold, N., &amp; Martius, C. (2017). New map reveals more peat in the tropics (Vol. 189). CIFOR. <a href="https://doi.org/10.17528/cifor/006452" class="uri">https://doi.org/10.17528/cifor/006452</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.Peatlands"</span>)){</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  cif.hors <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/CIFOR_peatlands/SOC_literature_CIFOR_v1.csv"</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(cif.hors$BD..g.cm..)</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(cif.hors$SOC)</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(cif.hors$TOC.content....)</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(!is.na(cif.hors$modelling.x))</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  cif.hors<span class="sc">$</span>oc <span class="ot">=</span> cif.hors<span class="sc">$</span>SOC <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  cif.hors<span class="sc">$</span>wpg2 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  cif.hors<span class="sc">$</span>c_tot <span class="ot">=</span> cif.hors<span class="sc">$</span>TOC.content.... <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  cif.hors<span class="sc">$</span>oc_d <span class="ot">=</span> cif.hors<span class="sc">$</span>C.density..kg.C.m..</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  cif.hors<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(cif.hors<span class="sc">$</span>year, <span class="dv">1</span>, <span class="dv">4</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  cif.hors<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> <span class="fu">ifelse</span>(cif.hors<span class="sc">$</span>TAXNUSDA<span class="sc">==</span><span class="st">""</span>, <span class="fu">paste</span>(cif.hors<span class="sc">$</span>TAXOUSDA), <span class="fu">paste</span>(cif.hors<span class="sc">$</span>TAXNUSDA))</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(cif.hors$SSL_classification_name))</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  cif.col <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"SOURCEID"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"modelling.x"</span>, <span class="st">"modelling.y"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"Upper"</span>, <span class="st">"Lower"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"BD..g.cm.."</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> cif.col[<span class="fu">which</span>(<span class="sc">!</span>cif.col <span class="sc">%in%</span> <span class="fu">names</span>(cif.hors))]</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ cif.hors[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>  chemsprops.Peatlands <span class="ot">=</span> cif.hors[,cif.col]</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>  chemsprops.Peatlands<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"CIFOR"</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.Peatlands<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.Peatlands<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://www.cifor.org/"</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.Peatlands<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.17528/cifor/006452"</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.Peatlands <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.Peatlands, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>, <span class="st">"BD..g.cm.."</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"c_tot"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"modelling.x"</span>, <span class="st">"modelling.y"</span>))</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.Peatlands, <span class="st">"/mnt/diskstation/data/Soil_points/INT/CIFOR_peatlands/chemsprops.Peatlands.rds"</span>)</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.Peatlands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2968   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2968  39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="landpks-observations" class="level4">
<h4 class="anchored" data-anchor-id="landpks-observations">LandPKS observations</h4>
<ul>
<li>Herrick, J. E., Urama, K. C., Karl, J. W., Boos, J., Johnson, M. V. V., Shepherd, K. D., … &amp; Kosnik, C. (2013). <a href="https://doi.org/10.2489/jswc.68.1.5A">The Global Land-Potential Knowledge System (LandPKS): Supporting Evidence-based, Site-specific Land Use and Management through Cloud Computing, Mobile Applications, and Crowdsourcing</a>. Journal of Soil and Water Conservation, 68(1), 5A-12A. Data download URL: <a href="http://portal.landpotential.org/#/landpksmap" class="uri">http://portal.landpotential.org/#/landpksmap</a></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/landpksmap_sites.jpg" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>LandPKS sites in 2024.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.LandPKS"</span>)){</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  pks <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>            vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/LandPKS/Export_LandInfo_Data_1.csv"</span>), </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>            vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/LandPKS/Export_LandInfo_Data_2.csv"</span>))</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(pks)</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 55483 obs. of  52 variables</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(pks$BedrockDepth))</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  pks.hor <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">rock_fragments =</span> </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">c</span>(pks<span class="sc">$</span><span class="st">`</span><span class="at">RockFragments0-1cm</span><span class="st">`</span>,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">RockFragments1-10cm</span><span class="st">`</span>,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">RockFragments10-20cm</span><span class="st">`</span>,</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">RockFragments20-50cm</span><span class="st">`</span>,</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">RockFragments50-70cm</span><span class="st">`</span>,</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">RockFragments70-100cm</span><span class="st">`</span>,</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">RockFragments100-120cm</span><span class="st">`</span>), </span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tex_field =</span> </span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">c</span>(pks<span class="sc">$</span><span class="st">`</span><span class="at">Texture0-1cm</span><span class="st">`</span>, </span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">Texture1-10cm</span><span class="st">`</span>, </span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">Texture10-20cm</span><span class="st">`</span>, </span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">Texture20-50cm</span><span class="st">`</span>, </span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">Texture50-70cm</span><span class="st">`</span>, </span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">Texture70-100cm</span><span class="st">`</span>, </span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>                           pks<span class="sc">$</span><span class="st">`</span><span class="at">Texture100-120cm</span><span class="st">`</span>))</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">10</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">20</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">50</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">70</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">100</span>, <span class="fu">nrow</span>(pks)))</span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">10</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">20</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">50</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">70</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">100</span>, <span class="fu">nrow</span>(pks)), </span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rep</span>(<span class="dv">120</span>, <span class="fu">nrow</span>(pks)))</span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(pks<span class="sc">$</span>Longitude), <span class="dv">7</span>)</span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(pks<span class="sc">$</span>Latitude), <span class="dv">7</span>)</span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>depth_bedrock <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(pks<span class="sc">$</span>BedrockDepth), <span class="dv">7</span>)</span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">rep</span>(pks<span class="sc">$</span>DateCreated_GMT, <span class="dv">7</span>)</span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>site_key <span class="ot">=</span> <span class="fu">rep</span>(pks<span class="sc">$</span>ID, <span class="dv">7</span>)</span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(pks.hor$tex_field))</span></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>  tex.tr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">tex_field=</span><span class="fu">c</span>(<span class="st">"CLAY"</span>, <span class="st">"CLAY LOAM"</span>, <span class="st">"LOAM"</span>, <span class="st">"LOAMY SAND"</span>, <span class="st">"SAND"</span>, <span class="st">"SANDY CLAY"</span>, <span class="st">"SANDY CLAY LOAM"</span>, <span class="st">"SANDY LOAM"</span>, <span class="st">"SILT LOAM"</span>, <span class="st">"SILTY CLAY"</span>, <span class="st">"SILTY CLAY LOAM"</span>), </span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>                      <span class="at">clay_tot_psa=</span><span class="fu">c</span>(<span class="fl">62.4</span>, <span class="fl">34.0</span>, <span class="fl">19.0</span>, <span class="fl">5.8</span>, <span class="fl">3.3</span>, <span class="fl">41.7</span>, <span class="fl">27.0</span>, <span class="fl">10.0</span>, <span class="fl">13.1</span>, <span class="fl">46.7</span>, <span class="fl">34.0</span>), </span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>                      <span class="at">silt_tot_psa=</span><span class="fu">c</span>(<span class="fl">17.8</span>, <span class="fl">34.0</span>, <span class="fl">40.0</span>, <span class="fl">12.0</span>, <span class="fl">5.0</span>, <span class="fl">6.7</span>, <span class="fl">13.0</span>, <span class="fl">25.0</span>, <span class="fl">65.7</span>, <span class="fl">46.7</span>, <span class="fl">56.0</span>), </span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sand_tot_psa=</span><span class="fu">c</span>(<span class="fl">19.8</span>, <span class="fl">32.0</span>, <span class="fl">41.0</span>, <span class="fl">82.2</span>, <span class="fl">91.7</span>, <span class="fl">51.6</span>, <span class="fl">60.0</span>, <span class="fl">65.0</span>, <span class="fl">21.2</span>, <span class="fl">6.7</span>, <span class="fl">10.0</span>))</span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>clay_tot_psa <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(pks.hor[<span class="st">"tex_field"</span>], tex.tr)<span class="sc">$</span>clay_tot_psa</span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>silt_tot_psa <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(pks.hor[<span class="st">"tex_field"</span>], tex.tr)<span class="sc">$</span>silt_tot_psa</span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>sand_tot_psa <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(pks.hor[<span class="st">"tex_field"</span>], tex.tr)<span class="sc">$</span>sand_tot_psa</span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(pks.hor$rock_fragments))</span></span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>wpg2 <span class="ot">=</span> <span class="fu">ifelse</span>(pks.hor<span class="sc">$</span>rock_fragments<span class="sc">==</span><span class="st">"&gt;60%"</span>, <span class="dv">65</span>, <span class="fu">ifelse</span>(pks.hor<span class="sc">$</span>rock_fragments<span class="sc">==</span><span class="st">"35-60%"</span>, <span class="fl">47.5</span>, <span class="fu">ifelse</span>(pks.hor<span class="sc">$</span>rock_fragments<span class="sc">==</span><span class="st">"15-35%"</span>, <span class="dv">25</span>, <span class="fu">ifelse</span>(pks.hor<span class="sc">$</span>rock_fragments<span class="sc">==</span><span class="st">"1-15%"</span> <span class="sc">|</span> pks.hor<span class="sc">$</span>rock_fragments<span class="sc">==</span><span class="st">"0-15%"</span>, <span class="dv">5</span>, <span class="fu">ifelse</span>(pks.hor<span class="sc">$</span>rock_fragments<span class="sc">==</span><span class="st">"0-1%"</span>, <span class="fl">0.5</span>, <span class="cn">NA</span>)))))</span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#head(pks.hor)</span></span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a>  <span class="do">## very shallow or very rocky soils</span></span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a>  pks.hor<span class="sc">$</span>oc <span class="ot">=</span> <span class="fu">ifelse</span>(pks.hor<span class="sc">$</span>depth_bedrock<span class="sc">&lt;</span><span class="dv">10</span> <span class="sc">|</span> pks.hor<span class="sc">$</span>rock_fragments <span class="sc">&gt;</span> <span class="dv">60</span>, <span class="fl">0.5</span>, <span class="cn">NA</span>)</span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a>  pks.col <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>,<span class="st">"hzn_top"</span>,<span class="st">"hzn_bot"</span>,<span class="st">"hzn_desgn"</span>, <span class="st">"tex_field"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> pks.col[<span class="fu">which</span>(<span class="sc">!</span>pks.col <span class="sc">%in%</span> <span class="fu">names</span>(pks.hor))]</span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ pks.hor[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a>  chemsprops.LandPKS <span class="ot">=</span> pks.hor[,pks.col]</span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a>  chemsprops.LandPKS<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"LandPKS"</span></span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a>  chemsprops.LandPKS<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a>  chemsprops.LandPKS<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://portal.landpotential.org"</span></span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a>  chemsprops.LandPKS<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.2489/jswc.68.1.5A"</span></span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a>  chemsprops.LandPKS <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.LandPKS, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"clay_tot_psa"</span>,<span class="st">"wpg2"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>))</span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(chemsprops.LandPKS[,c("longitude_decimal_degrees","latitude_decimal_degrees")], pch="+")</span></span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.LandPKS, <span class="st">"/mnt/diskstation/data/Soil_points/INT/LandPKS/chemsprops.LandPKS.rds"</span>)</span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 23973 Columns: 52
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (52): ID, Name, RecorderName, Latitude, Longitude, DateCreated_GMT, Land...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 31510 Columns: 52
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (46): Name, RecorderName, LandUse, GrazingAnimals, Flooding, Slope, Slo...
dbl   (4): ID, Latitude, Longitude, BedrockDepth
lgl   (1): Grazed
dttm  (1): DateCreated_GMT

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: tex_field
Joining by: tex_field
Joining by: tex_field</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.LandPKS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 165044     39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 165044    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="egrpr" class="level4">
<h4 class="anchored" data-anchor-id="egrpr">EGRPR</h4>
<ul>
<li><a href="http://egrpr.esoil.ru/">Russian Federation: The Unified State Register of Soil Resources (EGRPR)</a>. Data download URL: <a href="http://egrpr.esoil.ru/content/1DB.html" class="uri">http://egrpr.esoil.ru/content/1DB.html</a></li>
</ul>
<p>Note: these are only historic data and it is not clear if the locations are synthetic or actual soil profiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.EGRPR"</span>)){</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  russ.HOR <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Russia/EGRPR/Russia_EGRPR_soil_pedons.csv"</span>)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>SOURCEID <span class="ot">=</span> <span class="fu">paste</span>(russ.HOR<span class="sc">$</span>CardID, russ.HOR<span class="sc">$</span>SOIL_ID, <span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>wpg2 <span class="ot">=</span> russ.HOR<span class="sc">$</span>TEXTSTNS</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>SNDPPT <span class="ot">&lt;-</span> russ.HOR<span class="sc">$</span>TEXTSAF <span class="sc">+</span> russ.HOR<span class="sc">$</span>TEXSCM</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>SLTPPT <span class="ot">&lt;-</span> russ.HOR<span class="sc">$</span>TEXTSIC <span class="sc">+</span> russ.HOR<span class="sc">$</span>TEXTSIM <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(russ.HOR<span class="sc">$</span>TEXTSIF), <span class="dv">0</span>, russ.HOR<span class="sc">$</span>TEXTSIF)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>CLYPPT <span class="ot">&lt;-</span> russ.HOR<span class="sc">$</span>TEXTCL <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(russ.HOR<span class="sc">$</span>TEXTSIF), <span class="dv">0</span>, russ.HOR<span class="sc">$</span>TEXTSIF)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Correct texture fractions:</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  sumTex <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(russ.HOR[,<span class="fu">c</span>(<span class="st">"SLTPPT"</span>,<span class="st">"CLYPPT"</span>,<span class="st">"SNDPPT"</span>)])</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>SNDPPT <span class="ot">&lt;-</span> russ.HOR<span class="sc">$</span>SNDPPT <span class="sc">/</span> ((sumTex <span class="sc">-</span> russ.HOR<span class="sc">$</span>CLYPPT) <span class="sc">/</span>(<span class="dv">100</span> <span class="sc">-</span> russ.HOR<span class="sc">$</span>CLYPPT))</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>SLTPPT <span class="ot">&lt;-</span> russ.HOR<span class="sc">$</span>SLTPPT <span class="sc">/</span> ((sumTex <span class="sc">-</span> russ.HOR<span class="sc">$</span>CLYPPT) <span class="sc">/</span>(<span class="dv">100</span> <span class="sc">-</span> russ.HOR<span class="sc">$</span>CLYPPT))</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Tyurin method usually</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>oc <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(<span class="fu">data.frame</span>(<span class="at">x1=</span>russ.HOR<span class="sc">$</span>CORG <span class="sc">*</span> <span class="fl">1.15</span> <span class="sc">*</span> <span class="dv">10</span>, <span class="at">x2=</span>russ.HOR<span class="sc">$</span>ORGMAT<span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> <span class="fl">1.3</span> <span class="sc">*</span> <span class="dv">10</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(russ.HOR<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> russ.HOR<span class="sc">$</span>DVOL <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(russ.HOR<span class="sc">$</span>wpg2), <span class="dv">0</span>, russ.HOR<span class="sc">$</span>wpg2))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>n_tot <span class="ot">&lt;-</span> russ.HOR<span class="sc">$</span>NTOT <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>ca_ext <span class="ot">=</span> russ.HOR<span class="sc">$</span>EXCA <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>mg_ext <span class="ot">=</span> russ.HOR<span class="sc">$</span>EXMG <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>na_ext <span class="ot">=</span> russ.HOR<span class="sc">$</span>EXNA <span class="sc">*</span> <span class="dv">230</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>k_ext <span class="ot">=</span> russ.HOR<span class="sc">$</span>EXK <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Sampling year not available but with high confidence &lt;2000</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>  russ.HOR<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="st">"1982"</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>  russ.sel.h <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SOURCEID"</span>, <span class="st">"SOIL_ID"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"LONG"</span>, <span class="st">"LAT"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"HORNMB"</span>, <span class="st">"HORTOP"</span>, <span class="st">"HORBOT"</span>, <span class="st">"HISMMN"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"CLYPPT"</span>, <span class="st">"SLTPPT"</span>, <span class="st">"SNDPPT"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"NTOT"</span>, <span class="st">"PHSLT"</span>, <span class="st">"PHH2O"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"CECST"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"DVOL"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> russ.sel.h[<span class="fu">which</span>(<span class="sc">!</span>russ.sel.h <span class="sc">%in%</span> <span class="fu">names</span>(russ.HOR))]</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ russ.HOR[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>  chemsprops.EGRPR <span class="ot">=</span> russ.HOR[,russ.sel.h]</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>  chemsprops.EGRPR<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Russia_EGRPR"</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.EGRPR<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>  chemsprops.EGRPR<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://egrpr.esoil.ru/"</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>  chemsprops.EGRPR<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.19047/0136-1694-2016-86-115-123"</span></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>  chemsprops.EGRPR <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.EGRPR, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"oc"</span>, <span class="st">"CLYPPT"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONG"</span>, <span class="st">"LAT"</span>))</span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.EGRPR, <span class="st">"/mnt/diskstation/data/Soil_points/Russia/EGRPR/chemsprops.EGRPR.rds"</span>)</span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.EGRPR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4506   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4506   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="canada-national-pedon-db" class="level4">
<h4 class="anchored" data-anchor-id="canada-national-pedon-db">Canada National Pedon DB</h4>
<ul>
<li><p><a href="https://open.canada.ca/data/en/dataset/6457fad6-b6f5-47a3-9bd1-ad14aea4b9e0">Agriculture and Agri-Food Canada National Pedon Database</a>. Data download URL: <a href="https://open.canada.ca/data/en/" class="uri">https://open.canada.ca/data/en/</a></p></li>
<li><p>9301 soil profiles in V3;</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.NPDB"</span>)){</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  NPDB.nm <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Horizons.csv"</span>, <span class="st">"Chemical.csv"</span>, <span class="st">"Physical.csv"</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  NPDB.HOR <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(plyr<span class="sc">::</span><span class="fu">join_all</span>(<span class="fu">lapply</span>(<span class="fu">paste0</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Canada/NPDB/"</span>, NPDB.nm), read.csv), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"PEDON_ID"</span>, <span class="st">"LAYER_ID"</span>), <span class="at">type =</span> <span class="st">"full"</span>), </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Canada/NPDB/Info.csv"</span>), <span class="at">by=</span><span class="st">"PEDON_ID"</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  NPDB.HOR<span class="sc">$</span>tax <span class="ot">=</span> <span class="fu">str_trim</span>(<span class="fu">tolower</span>(<span class="fu">paste</span>(NPDB.HOR<span class="sc">$</span>CSSC_SBGRP, NPDB.HOR<span class="sc">$</span>CSSC_GTGRP, NPDB.HOR<span class="sc">$</span>CSSC_ORDER, <span class="at">sep=</span><span class="st">" "</span>)))</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  NPDB.tax <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">as.factor</span>(NPDB.HOR<span class="sc">$</span>tax), <span class="at">maxsum =</span> <span class="fu">length</span>(<span class="fu">levels</span>(<span class="fu">as.factor</span>(NPDB.HOR<span class="sc">$</span>tax))))</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write.csv(as.data.frame(NPDB.tax), "npdb_tax_summary.csv")</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  can.cor <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'./correlation/soil_type_correlation_Canada_NPDB.csv'</span>)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  NPDB.HOR<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(NPDB.HOR[<span class="st">"tax"</span>], can.cor[,<span class="fu">c</span>(<span class="st">"tax"</span>,<span class="st">"SSL_classification_name"</span>)], <span class="at">by=</span><span class="st">"tax"</span>, <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>SSL_classification_name</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(NPDB.HOR$SSL_classification_name))</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  NPDB.HOR<span class="sc">$</span>HISMMN <span class="ot">=</span> <span class="fu">paste0</span>(NPDB.HOR<span class="sc">$</span>HZN_MAS, NPDB.HOR<span class="sc">$</span>HZN_SUF, NPDB.HOR<span class="sc">$</span>HZN_MOD)</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  NPDB.HOR<span class="sc">$</span>oc <span class="ot">=</span> NPDB.HOR<span class="sc">$</span>CARB_ORG <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(NPDB.HOR$BULK_DEN)</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>  NPDB.HOR<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(NPDB.HOR<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> NPDB.HOR<span class="sc">$</span>BULK_DEN <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(NPDB.HOR<span class="sc">$</span>VC_SAND), <span class="dv">0</span>, NPDB.HOR<span class="sc">$</span>VC_SAND))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  NPDB.HOR<span class="sc">$</span>ca_ext <span class="ot">=</span> NPDB.HOR<span class="sc">$</span>EXCH_CA <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  NPDB.HOR<span class="sc">$</span>mg_ext <span class="ot">=</span> NPDB.HOR<span class="sc">$</span>EXCH_MG <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>  NPDB.HOR<span class="sc">$</span>na_ext <span class="ot">=</span> NPDB.HOR<span class="sc">$</span>EXCH_NA <span class="sc">*</span> <span class="dv">230</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>  NPDB.HOR<span class="sc">$</span>k_ext <span class="ot">=</span> NPDB.HOR<span class="sc">$</span>EXCH_K <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>  npdb.sel.h <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"PEDON_ID"</span>, <span class="st">"usiteid"</span>, <span class="st">"CAL_YEAR"</span>, <span class="st">"DD_LONG_N"</span>, <span class="st">"DD_LAT_N"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"U_DEPTH"</span>, <span class="st">"L_DEPTH"</span>, <span class="st">"HISMMN"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"T_CLAY"</span>, <span class="st">"T_SILT"</span>, <span class="st">"T_SAND"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"N_TOTAL"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"PH_H2O"</span>, <span class="st">"PH_CACL2"</span>, <span class="st">"CEC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"VC_SAND"</span>, <span class="st">"BULK_DEN"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> npdb.sel.h[<span class="fu">which</span>(<span class="sc">!</span>npdb.sel.h <span class="sc">%in%</span> <span class="fu">names</span>(NPDB.HOR))]</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ NPDB.HOR[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.NPDB <span class="ot">=</span> NPDB.HOR[,npdb.sel.h]</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.NPDB<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Canada_NPDB"</span></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.NPDB<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>  chemsprops.NPDB<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://open.canada.ca/data/en/"</span></span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>  chemsprops.NPDB<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://open.canada.ca/data/en/dataset/6457fad6-b6f5-47a3-9bd1-ad14aea4b9e0"</span></span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.NPDB <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.NPDB, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"oc"</span>, <span class="st">"PH_H2O"</span>, <span class="st">"T_CLAY"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"DD_LONG_N"</span>, <span class="st">"DD_LAT_N"</span>))</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(chemsprops.NPDB$CAL_YEAR))</span></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.NPDB, <span class="st">"/mnt/diskstation/data/Soil_points/Canada/NPDB/chemsprops.NPDB.rds"</span>)</span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.NPDB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 56544    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 55809    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="canadian-upland-forest-soil-profile-and-carbon-stocks-database" class="level4">
<h4 class="anchored" data-anchor-id="canadian-upland-forest-soil-profile-and-carbon-stocks-database">Canadian upland forest soil profile and carbon stocks database</h4>
<ul>
<li>Shaw, C., Hilger, A., Filiatrault, M., &amp; Kurz, W. (2018). <a href="https://doi.org/10.1002/ecy.2159">A Canadian upland forest soil profile and carbon stocks database</a>. Ecology, 99(4), 989-989. Data download URL: <a href="https://esajournals.onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fecy.2159&amp;file=ecy2159-sup-0001-DataS1.zip" class="uri">https://esajournals.onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fecy.2159&amp;file=ecy2159-sup-0001-DataS1.zip</a></li>
</ul>
<p>*Organic horizons have negative values, the first mineral soil horizon has a value of 0 cm, and other mineral soil horizons have positive values. This needs to be corrected before the values can be bind with other international sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.CUFS"</span>)){</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Reading of the .dat file was tricky </span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  cufs.HOR <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Canada/CUFSDB/PROFILES.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>LOWER_HZN_LIMIT <span class="ot">=</span>cufs.HOR<span class="sc">$</span>UPPER_HZN_LIMIT <span class="sc">+</span> cufs.HOR<span class="sc">$</span>HZN_THICKNESS</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Correct depth (Canadian data can have negative depths for soil horizons):</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  z.min.cufs <span class="ot">&lt;-</span> <span class="fu">ddply</span>(cufs.HOR, .(LOCATION_ID), summarize, <span class="at">aggregated =</span> <span class="fu">min</span>(UPPER_HZN_LIMIT, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  z.shift.cufs <span class="ot">&lt;-</span> <span class="fu">join</span>(cufs.HOR[<span class="st">"LOCATION_ID"</span>], z.min.cufs, <span class="at">type=</span><span class="st">"left"</span>)<span class="sc">$</span>aggregated</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## fixed shift</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  z.shift.cufs <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(z.shift.cufs<span class="sc">&gt;</span><span class="dv">0</span>, <span class="dv">0</span>, z.shift.cufs)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>hzn_top <span class="ot">&lt;-</span> cufs.HOR<span class="sc">$</span>UPPER_HZN_LIMIT <span class="sc">-</span> z.shift.cufs</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>hzn_bot <span class="ot">&lt;-</span> cufs.HOR<span class="sc">$</span>LOWER_HZN_LIMIT <span class="sc">-</span> z.shift.cufs</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  cufs.SITE <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Canada/CUFSDB/SITES.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(cufs.SITE)</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>  can.tbl <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"./correlation/soil_types_correlation_table_Canada.csv"</span>)</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  cufs.SITE<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(cufs.SITE[<span class="st">"GGSG"</span>], can.tbl, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"GGSG"</span><span class="ot">=</span><span class="st">"CSSC_Class"</span>))<span class="sc">$</span>TAXOUSDA</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(cufs.HOR[<span class="st">"LOCATION_ID"</span>], cufs.SITE)<span class="sc">$</span>LONGITUDE</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(cufs.HOR[<span class="st">"LOCATION_ID"</span>], cufs.SITE)<span class="sc">$</span>LATITUDE</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>site_obsdate <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(cufs.HOR[<span class="st">"LOCATION_ID"</span>], cufs.SITE)<span class="sc">$</span>YEAR_SAMPLED</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>usiteid <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(cufs.HOR[<span class="st">"LOCATION_ID"</span>], cufs.SITE)<span class="sc">$</span>RELEASE_SOURCE_SITEID</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(cufs.HOR$ORG_CARB_PCT)</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#hist(cufs.HOR$ORG_CARB_PCT, breaks=45)</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>oc <span class="ot">=</span> cufs.HOR<span class="sc">$</span>ORG_CARB_PCT<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cufs.HOR$c_tot = cufs.HOR$oc + ifelse(is.na(cufs.HOR$CARBONATE_CARB_PCT), 0, cufs.HOR$CARBONATE_CARB_PCT*10)</span></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>n_tot <span class="ot">=</span> cufs.HOR<span class="sc">$</span>TOT_NITRO_PCT<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>ca_ext <span class="ot">=</span> cufs.HOR<span class="sc">$</span>EXCH_Ca <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>mg_ext <span class="ot">=</span> cufs.HOR<span class="sc">$</span>EXCH_Mg <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>na_ext <span class="ot">=</span> cufs.HOR<span class="sc">$</span>EXCH_Na <span class="sc">*</span> <span class="dv">230</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>k_ext <span class="ot">=</span> cufs.HOR<span class="sc">$</span>EXCH_K <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>ph_cacl2 <span class="ot">=</span> cufs.HOR<span class="sc">$</span>pH</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>ph_cacl2[<span class="sc">!</span>cufs.HOR<span class="sc">$</span>pH_H2O_CACL2<span class="sc">==</span><span class="st">"CACL2"</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>ph_h2o <span class="ot">=</span> cufs.HOR<span class="sc">$</span>pH</span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>ph_h2o[<span class="sc">!</span>cufs.HOR<span class="sc">$</span>pH_H2O_CACL2<span class="sc">==</span><span class="st">"H2O"</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(cufs.HOR$CF_VOL_PCT) ## is NA == 0??</span></span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>wpg2 <span class="ot">=</span> <span class="fu">ifelse</span>(cufs.HOR<span class="sc">$</span>CF_CORR_FACTOR<span class="sc">==</span><span class="dv">1</span>, <span class="dv">0</span>, cufs.HOR<span class="sc">$</span>CF_VOL_PCT)</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>  cufs.HOR<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(cufs.HOR<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> cufs.HOR<span class="sc">$</span>BULK_DENSITY <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(cufs.HOR<span class="sc">$</span>wpg2), <span class="dv">0</span>, cufs.HOR<span class="sc">$</span>wpg2))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>  cufs.sel.h <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"LOCATION_ID"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"HZN_SEQ_NO"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"HORIZON"</span>, <span class="st">"TEXT_CLASS"</span>, <span class="st">"texture_lab"</span>, <span class="st">"CLAY_PCT"</span>, <span class="st">"SILT_PCT"</span>, <span class="st">"SAND_PCT"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"CEC_CALCULATED"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"BULK_DENSITY"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ELEC_COND"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> cufs.sel.h[<span class="fu">which</span>(<span class="sc">!</span>cufs.sel.h <span class="sc">%in%</span> <span class="fu">names</span>(cufs.HOR))]</span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ cufs.HOR[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>  chemsprops.CUFS <span class="ot">=</span> cufs.HOR[,cufs.sel.h]</span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>  chemsprops.CUFS<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Canada_CUFS"</span></span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a>  chemsprops.CUFS<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a>  chemsprops.CUFS<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://cfs.nrcan.gc.ca/publications/centre/nofc"</span></span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a>  chemsprops.CUFS<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1002/ecy.2159"</span></span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a>  chemsprops.CUFS <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.CUFS, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"oc"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"CLAY_PCT"</span>))</span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.CUFS, <span class="st">"/mnt/diskstation/data/Soil_points/Canada/CUFSDB/chemsprops.CUFS.rds"</span>)</span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: LOCATION_ID
Joining by: LOCATION_ID
Joining by: LOCATION_ID
Joining by: LOCATION_ID
Joining by: LOCATION_ID</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.CUFS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15873    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 15873    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="permafrost-in-subarctic-canada" class="level4">
<h4 class="anchored" data-anchor-id="permafrost-in-subarctic-canada">Permafrost in subarctic Canada</h4>
<ul>
<li>Estop-Aragones, C.; Fisher, J.P.; Cooper, M.A.; Thierry, A.; Treharne, R.; Murton, J.B.; Phoenix, G.K.; Charman, D.J.; Williams, M.; Hartley, I.P. (2016). Bulk density, carbon and nitrogen content in soil profiles from permafrost in subarctic Canada. NERC Environmental Information Data Centre. <a href="https://doi.org/10.5285/efa2a84b-3505-4221-a7da-12af3cdc1952" class="uri">https://doi.org/10.5285/efa2a84b-3505-4221-a7da-12af3cdc1952</a>. Data download URL:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.CAPERM"</span>)){</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  caperm.HOR <span class="ot">=</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Canada/NorthCanada/Bulk_density_CandNcontent_profiles_all_sites.csv"</span>)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#measurements::conv_unit("-99 36 15.7", from = "deg_min_sec", to = "dec_deg")</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#caperm.HOR$longitude_decimal_degrees = as.numeric(measurements::conv_unit(paste0("-", gsub('\"W', '', gsub("'", ' ', iconv(caperm.HOR$Coordinates_West, "UTF-8", "UTF-8", sub=' ')), fixed = TRUE)), from = "deg_min_sec", to = "dec_deg"))</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  caperm.HOR<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> <span class="fu">as.numeric</span>(measurements<span class="sc">::</span><span class="fu">conv_unit</span>(<span class="fu">paste0</span>(<span class="st">"-"</span>, caperm.HOR<span class="sc">$</span>Cordinates_West), <span class="at">from =</span> <span class="st">"deg_min_sec"</span>, <span class="at">to =</span> <span class="st">"dec_deg"</span>))</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#caperm.HOR$latitude_decimal_degrees = as.numeric(measurements::conv_unit(gsub('\"N', '', gsub('o', '', gsub("'", ' ', iconv(caperm.HOR$Coordinates_North, "UTF-8", "UTF-8", sub=' '))), fixed = TRUE), from = "deg_min_sec", to = "dec_deg"))</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  caperm.HOR<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> <span class="fu">as.numeric</span>(measurements<span class="sc">::</span><span class="fu">conv_unit</span>(caperm.HOR<span class="sc">$</span>Cordinates_North, <span class="at">from =</span> <span class="st">"deg_min_sec"</span>, <span class="at">to =</span> <span class="st">"dec_deg"</span>))</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(caperm.HOR[,c("longitude_decimal_degrees","latitude_decimal_degrees")])</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  caperm.HOR<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="st">"2013"</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  caperm.HOR<span class="sc">$</span>site_key <span class="ot">=</span> <span class="fu">make.unique</span>(caperm.HOR<span class="sc">$</span>Soil.core)</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(caperm.HOR$Soil_depth_cm))</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>  caperm.HOR<span class="sc">$</span>hzn_top <span class="ot">=</span> caperm.HOR<span class="sc">$</span>Soil_depth_cm<span class="dv">-1</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  caperm.HOR<span class="sc">$</span>hzn_bot <span class="ot">=</span> caperm.HOR<span class="sc">$</span>Soil_depth_cm<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>  caperm.HOR<span class="sc">$</span>bulk_density_oven_dry <span class="ot">=</span> caperm.HOR<span class="sc">$</span>Bulk_density_gdrysoil_cm3wetsoil</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>  caperm.HOR<span class="sc">$</span>organic_carbon <span class="ot">=</span> caperm.HOR<span class="sc">$</span>Ccontent_percentage_on_drymass <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>  caperm.HOR<span class="sc">$</span>total_nitrogen_ncs <span class="ot">=</span> caperm.HOR<span class="sc">$</span>Ncontent_percentage_on_drymass <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>  caperm.HOR<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(caperm.HOR<span class="sc">$</span>organic_carbon <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> caperm.HOR<span class="sc">$</span>bulk_density_oven_dry <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">3</span>)</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> col.names[<span class="fu">which</span>(<span class="sc">!</span>col.names <span class="sc">%in%</span> <span class="fu">names</span>(caperm.HOR))]</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ caperm.HOR[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.CAPERM <span class="ot">=</span> caperm.HOR[,col.names]</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.CAPERM<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Canada_subarctic"</span></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.CAPERM<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.CAPERM<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://arp.arctic.ac.uk/projects/carbon-cycling-linkages-permafrost-systems-cyclops/"</span></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.CAPERM<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.5285/efa2a84b-3505-4221-a7da-12af3cdc1952"</span></span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>  chemsprops.CAPERM <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.CAPERM, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"organic_carbon"</span>, <span class="st">"total_nitrogen_ncs"</span>))</span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.CAPERM, <span class="st">"/mnt/diskstation/data/Soil_points/Canada/NorthCanada/chemsprops.CAPERM.rds"</span>)</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 2931 Columns: 10
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (6): Soil.core, Remarks, soil.type_Org_Min_Blend_Rock, Cordinates_North,...
dbl (4): Soil_depth_cm, Bulk_density_gdrysoil_cm3wetsoil, Ncontent_percentag...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.CAPERM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1381   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1381   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="soter-china-soil-profiles" class="level4">
<h4 class="anchored" data-anchor-id="soter-china-soil-profiles">SOTER China soil profiles</h4>
<ul>
<li>Dijkshoorn, K., van Engelen, V., &amp; Huting, J. (2008). <a href="https://isric.org/sites/default/files/isric_report_2008_06.pdf">Soil and landform properties for LADA partner countries</a>. ISRIC report 2008/06 and GLADA report 2008/03, ISRIC – World Soil Information and FAO, Wageningen. Data download URL: <a href="https://files.isric.org/public/soter/CN-SOTER.zip" class="uri">https://files.isric.org/public/soter/CN-SOTER.zip</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.CNSOTER"</span>)){</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  sot.sites <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/China/China_SOTERv1/CHINA_SOTERv1_Profile.csv"</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  st.cor <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'./correlation/soil_type_correlation_ISRIC_WISE.csv'</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  sot.sites<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> <span class="fu">paste0</span>( dplyr<span class="sc">::</span><span class="fu">left_join</span>(sot.sites[<span class="st">"CLAF"</span>], st.cor, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"CLAF"</span><span class="ot">=</span><span class="st">"FAO_90"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>Class_1, <span class="st">" / "</span>,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>                       dplyr<span class="sc">::</span><span class="fu">left_join</span>(sot.sites[<span class="st">"CLAF"</span>], st.cor, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"CLAF"</span><span class="ot">=</span><span class="st">"FAO_90"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>Class_2)           </span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(sot.sites$SSL_classification_name))</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  sot.horizons <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/China/China_SOTERv1/CHINA_SOTERv1_Horizon.csv"</span>)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  sot.HOR <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join_all</span>(<span class="fu">list</span>(sot.sites, sot.horizons), <span class="at">type =</span> <span class="st">"full"</span>)</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>  sot.HOR<span class="sc">$</span>oc <span class="ot">=</span> sot.HOR<span class="sc">$</span>SOCA <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>  sot.HOR<span class="sc">$</span>ca_ext <span class="ot">=</span> sot.HOR<span class="sc">$</span>EXCA <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>  sot.HOR<span class="sc">$</span>mg_ext <span class="ot">=</span> sot.HOR<span class="sc">$</span>EXMG <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>  sot.HOR<span class="sc">$</span>na_ext <span class="ot">=</span> sot.HOR<span class="sc">$</span>EXNA <span class="sc">*</span> <span class="dv">230</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  sot.HOR<span class="sc">$</span>k_ext <span class="ot">=</span> sot.HOR<span class="sc">$</span>EXCK <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## upper depth missing needs to be derived manually</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>  sot.HOR<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>  sot.HOR<span class="sc">$</span>hzn_top[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(sot.HOR)] <span class="ot">&lt;-</span> sot.HOR<span class="sc">$</span>HBDE[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(sot.HOR)<span class="sc">-</span><span class="dv">1</span>)]</span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>  sot.HOR<span class="sc">$</span>hzn_top <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sot.HOR<span class="sc">$</span>hzn_top <span class="sc">&gt;</span> sot.HOR<span class="sc">$</span>HBDE, <span class="dv">0</span>, sot.HOR<span class="sc">$</span>hzn_top)</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>  sot.HOR<span class="sc">$</span>hzn_top <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sot.HOR<span class="sc">$</span>HONU<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(sot.HOR<span class="sc">$</span>hzn_top), <span class="dv">0</span>, sot.HOR<span class="sc">$</span>hzn_top)</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>  sot.HOR<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(sot.HOR<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> sot.HOR<span class="sc">$</span>BULK <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(sot.HOR<span class="sc">$</span>SDVC), <span class="dv">0</span>, sot.HOR<span class="sc">$</span>SDVC))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>  sot.sel.h <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"PRID"</span>, <span class="st">"PDID"</span>, <span class="st">"SAYR"</span>, <span class="st">"LNGI"</span>, <span class="st">"LATI"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"HONU"</span>, <span class="st">"hzn_top"</span>,  <span class="st">"HBDE"</span>, <span class="st">"HODE"</span>, <span class="st">"PSCL"</span>, <span class="st">"texture_lab"</span>, <span class="st">"CLPC"</span>, <span class="st">"STPC"</span>, <span class="st">"SDTO"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"TOTC"</span>, <span class="st">"TOTN"</span>, <span class="st">"PHKC"</span>, <span class="st">"PHAQ"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"CECS"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"SDVC"</span>, <span class="st">"BULK"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> sot.sel.h[<span class="fu">which</span>(<span class="sc">!</span>sot.sel.h <span class="sc">%in%</span> <span class="fu">names</span>(sot.HOR))]</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ sot.HOR[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.CNSOT <span class="ot">=</span> sot.HOR[,sot.sel.h]</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.CNSOT<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"China_SOTER"</span></span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>  chemsprops.CNSOT<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>  chemsprops.CNSOT<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://www.isric.org/explore/soter"</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.CNSOT<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://isric.org/sites/default/files/isric_report_2008_06.pdf"</span></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>  chemsprops.CNSOT <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.CNSOT, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"TOTC"</span>, <span class="st">"PHAQ"</span>, <span class="st">"CLPC"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LNGI"</span>, <span class="st">"LATI"</span>))</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.CNSOT, <span class="st">"/mnt/diskstation/data/Soil_points/China/China_SOTERv1/chemsprops.CNSOT.rds"</span>)</span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: PRID, INFR</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.CNSOT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5115   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 5115   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sislac" class="level4">
<h4 class="anchored" data-anchor-id="sislac">SISLAC</h4>
<ul>
<li>Díaz-Guadarrama, S., Varón-Ramírez, V. M., Lizarazo, I., Guevara, M., Angelini, M., Araujo-Carrillo, G. A., … &amp; Rubiano, Y. (2024). Improving the Latin America and Caribbean Soil Information System (SISLAC) database enhances its usability and scalability. Earth System Science Data, 16(3), 1229-1246. <a href="https://doi.org/10.5194/essd-16-1229-2024" class="uri">https://doi.org/10.5194/essd-16-1229-2024</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.SISLAC"</span>)){</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  sis.hor <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/SA/SISLAC/sislac_v2.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(sis.hor)</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(sis.hor$source))</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Remove some redundant records:</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  sis.hor <span class="ot">=</span> sis.hor[<span class="sc">!</span>sis.hor<span class="sc">$</span>source <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WoSIS July 2016 Snapshot"</span>, <span class="st">"CHLSOC: the Chilean Soil Organic Carbon database"</span>, <span class="st">"Harmonized soil database of Ecuador (HESD)"</span>, <span class="st">"México Serie-2"</span>),]</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dim(sis.hor)</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 96421 rows</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SOC for Uruguay do not match the original soil profile data (see e.g. http://www.mgap.gub.uy/sites/default/files/multimedia/skmbt_c45111090914030.pdf)</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## compare with:</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#sis.hor[sis.hor$perfil_id=="23861",]</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sis.hor$organic_carbon)</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Some erratic values with SOC % &gt; 100%!</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>  sis.hor<span class="sc">$</span>oc <span class="ot">=</span> <span class="fu">ifelse</span>(sis.hor<span class="sc">$</span>organic_carbon <span class="sc">&gt;</span> <span class="dv">80</span>, <span class="cn">NA</span>, sis.hor<span class="sc">$</span>organic_carbon <span class="sc">*</span> <span class="dv">10</span>)</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggplot(sis.hor, aes(oc+1)) + geom_histogram() + scale_x_log10()</span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sis.hor$bulk_density)</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sis.hor$coarse_fragments)</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>  sis.hor<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(sis.hor<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> sis.hor<span class="sc">$</span>bulk_density <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(sis.hor<span class="sc">$</span>coarse_fragments), <span class="dv">0</span>, sis.hor<span class="sc">$</span>coarse_fragments))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sis.hor$oc_d)</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>  sis.hor<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(sis.hor<span class="sc">$</span>fecha, <span class="at">format=</span><span class="st">"%d/%m/%Y"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>  sis.hor<span class="sc">$</span>n_tot <span class="ot">=</span> sis.hor<span class="sc">$</span>n <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sis.hor$k)</span></span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>  sis.hor<span class="sc">$</span>ca_ext <span class="ot">=</span> sis.hor<span class="sc">$</span>ca <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>  sis.hor<span class="sc">$</span>mg_ext <span class="ot">=</span> sis.hor<span class="sc">$</span>mg <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>  sis.hor<span class="sc">$</span>k_ext <span class="ot">=</span> sis.hor<span class="sc">$</span>k <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(substr(sis.hor$site_obsdate, 1, 4)))</span></span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 71407 thousand with year 1900 / many with 1905? Typos?</span></span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>  sis.sel.h <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"profile_id"</span>, <span class="st">"profile_identifier"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"layer_identifier"</span>, <span class="st">"layer_id"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"top"</span>, <span class="st">"bottom"</span>, <span class="st">"designation"</span>, <span class="st">"textura"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"coarse_fragments"</span>, <span class="st">"analitico_densidad_aparente"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> sis.sel.h[<span class="fu">which</span>(<span class="sc">!</span>sis.sel.h <span class="sc">%in%</span> <span class="fu">names</span>(sis.hor))]</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ sis.hor[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>  chemsprops.SISLAC <span class="ot">=</span> sis.hor[,sis.sel.h]</span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>  chemsprops.SISLAC<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"SISLAC"</span></span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a>  chemsprops.SISLAC<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a>  chemsprops.SISLAC<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://github.com/DiazSergio/Revised-SISLAC-Database-Version1.2"</span></span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>  chemsprops.SISLAC<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.5194/essd-16-1229-2024"</span></span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a>  chemsprops.SISLAC <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.SISLAC, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"ph"</span>,<span class="st">"clay"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>))</span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.SISLAC, <span class="st">"/mnt/diskstation/data/Soil_points/SA/SISLAC/chemsprops.SISLAC.rds"</span>)</span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.SISLAC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 92121    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 92121    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="febr" class="level4">
<h4 class="anchored" data-anchor-id="febr">FEBR</h4>
<ul>
<li>Samuel-Rosa, A., Dalmolin, R. S. D., Moura-Bueno, J. M., Teixeira, W. G., &amp; Alba, J. M. F. (2020). Open legacy soil survey data in Brazil: geospatial data quality and how to improve it. Scientia Agricola, 77(1). <a href="https://doi.org/10.1590/1678-992x-2017-0430" class="uri">https://doi.org/10.1590/1678-992x-2017-0430</a></li>
<li>Free Brazilian Repository for Open Soil Data – febr. Data download URL: <a href="http://www.ufsm.br/febr/" class="uri">http://www.ufsm.br/febr/</a> and/or <a href="https://samuel-rosa.github.io/project/febr/#estou-procurando-dados" class="uri">https://samuel-rosa.github.io/project/febr/#estou-procurando-dados</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.FEBR"</span>)){</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remotes::install_github(repo = "laboratorio-de-pedometria/febr-package")</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#library(febr)</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## download up-to-date copy of data</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#febr.lab = febr::layer(dataset = "all", variable="all")</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#febr.lab = febr::observation(dataset = "all")</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#febr.md = febr::metadata(data.set = c("ctb0003", "ctb0002"))</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>  febr.hor <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="fu">gzfile</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Brasil/FEBR/febr-superconjunto.txt.gz"</span>), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, <span class="at">dec =</span> <span class="st">","</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Rows: 50470 Columns: 40</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#head(febr.hor)</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(febr.hor$coord_x)</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(febr.hor$coord_fonte))</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(febr.hor$carbono))</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(febr.hor$ph))</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(febr.hor$dsi))</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(febr.hor$dsi) ## bulk density of total soil</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>  febr.hor<span class="sc">$</span>organic_carbon <span class="ot">=</span> <span class="fu">as.numeric</span>(febr.hor<span class="sc">$</span>carbono)</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>  febr.hor<span class="sc">$</span>bulk_density_oven_dry <span class="ot">=</span> <span class="fu">as.numeric</span>(febr.hor<span class="sc">$</span>dsi)</span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>  febr.hor<span class="sc">$</span>ph_h2o <span class="ot">=</span> <span class="fu">ifelse</span>(febr.hor<span class="sc">$</span>ph<span class="sc">&lt;</span><span class="dv">30</span><span class="sc">|</span>febr.hor<span class="sc">$</span>ph<span class="sc">&gt;</span><span class="dv">90</span>, <span class="cn">NA</span>, febr.hor<span class="sc">$</span>ph<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>  febr.hor<span class="sc">$</span>clay_tot_psa <span class="ot">=</span> febr.hor<span class="sc">$</span>argila <span class="sc">/</span><span class="dv">10</span></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a>  febr.hor<span class="sc">$</span>sand_tot_psa <span class="ot">=</span> febr.hor<span class="sc">$</span>areia <span class="sc">/</span><span class="dv">10</span></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a>  febr.hor<span class="sc">$</span>silt_tot_psa <span class="ot">=</span> febr.hor<span class="sc">$</span>silte <span class="sc">/</span><span class="dv">10</span></span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a>  febr.hor<span class="sc">$</span>wpg2 <span class="ot">=</span> (<span class="dv">1000</span><span class="sc">-</span>febr.hor<span class="sc">$</span>terrafina)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>  febr.hor<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(febr.hor<span class="sc">$</span>organic_carbon <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> febr.hor<span class="sc">$</span>bulk_density_oven_dry <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(febr.hor<span class="sc">$</span>wpg2), <span class="dv">0</span>, febr.hor<span class="sc">$</span>wpg2))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(febr.hor$oc_d)</span></span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#br.sm = summary(as.factor(febr.hor$taxon_sibcs))</span></span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#br.tax = as.data.frame(br.sm)</span></span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#br.tax$levels = attr(br.sm, "names")</span></span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write.csv(br.tax, "/mnt/diskstation/data/Soil_points/Brasil/FEBR/febr_taxon_sibcs.csv")</span></span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a>  febr.tax <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"./correlation/soil_type_correlation_BR_FEBR.csv"</span>)</span>
<span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a>  febr.hor<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(febr.hor[<span class="st">"taxon_sibcs"</span>], febr.tax, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"taxon_sibcs"</span><span class="ot">=</span><span class="st">"levels"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>SSL_classification_name</span>
<span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a>  febr.hor<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(febr.hor<span class="sc">$</span>taxon_st), febr.hor<span class="sc">$</span>SSL_classification_name, febr.hor<span class="sc">$</span>taxon_st)</span>
<span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(febr.hor$SSL_classification_name))</span></span>
<span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a>  febr.sel.h <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"observacao_id"</span>, <span class="st">"usiteid"</span>, <span class="st">"observacao_data"</span>, <span class="st">"coord_x"</span>, <span class="st">"coord_y"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"sisb_id"</span>, <span class="st">"layer_key"</span>, <span class="st">"camada_id"</span>, <span class="st">"profund_sup"</span>, <span class="st">"profund_inf"</span>, <span class="st">"camada_nome"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"total_carbon_ncs"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"bulk_density_oven_dry"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)</span>
<span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> febr.sel.h[<span class="fu">which</span>(<span class="sc">!</span>febr.sel.h <span class="sc">%in%</span> <span class="fu">names</span>(febr.hor))]</span>
<span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ febr.hor[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a>  chemsprops.FEBR <span class="ot">=</span> febr.hor[,febr.sel.h]</span>
<span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a>  chemsprops.FEBR<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"FEBR"</span></span>
<span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a>  chemsprops.FEBR<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb116-40"><a href="#cb116-40" aria-hidden="true" tabindex="-1"></a>  chemsprops.FEBR<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://www.ufsm.br/febr/"</span></span>
<span id="cb116-41"><a href="#cb116-41" aria-hidden="true" tabindex="-1"></a>  chemsprops.FEBR<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1590/1678-992x-2017-0430"</span></span>
<span id="cb116-42"><a href="#cb116-42" aria-hidden="true" tabindex="-1"></a>  chemsprops.FEBR <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.FEBR, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"organic_carbon"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"bulk_density_oven_dry"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"coord_x"</span>, <span class="st">"coord_y"</span>))</span>
<span id="cb116-43"><a href="#cb116-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.FEBR, <span class="st">"/mnt/diskstation/data/Soil_points/Brasil/FEBR/chemsprops.FEBR.rds"</span>)</span>
<span id="cb116-44"><a href="#cb116-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb116-45"><a href="#cb116-45" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.FEBR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24420    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 24420    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pronasolos" class="level4">
<h4 class="anchored" data-anchor-id="pronasolos">PRONASOLOS</h4>
<ul>
<li>POLIDORO, J., COELHO, M., CARVALHO FILHO, A. D., LUMBRERAS, J., de OLIVEIRA, A. P., VASQUES, G. D. M., … &amp; BREFIN, M. (2021). <a href="https://www.infoteca.cnptia.embrapa.br/infoteca/handle/doc/1135056">Programa Nacional de Levantamento e Interpretação de Solos do Brasil (PronaSolos): diretrizes para implementação</a>. Embrapa Solos-Documentos (INFOTECA-E).<br>
</li>
<li>Download URL: <a href="http://geoinfo.cnps.embrapa.br/documents/3013/download" class="uri">http://geoinfo.cnps.embrapa.br/documents/3013/download</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.PRONASOLOS"</span>)){</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  pronas.hor <span class="ot">=</span> <span class="fu">as.data.frame</span>(sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Brasil/Pronasolos/Perfis_PronaSolos_20201202v2.shp"</span>))</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 34,464 rows</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#head(pronas.hor)</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(pronas.hor$carbono_or))</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(pronas.hor$densidade_))</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(pronas.hor$argila))</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(pronas.hor$cascalho))</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(pronas.hor$ph_h2o))</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(pronas.hor$complexo_2))</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## A lot of potential errors / typos e.g. very high values and 0 values for soil pH</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#pronas.hor$data_colet[1:50]</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>  pronas.in.name <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"sigla"</span>, <span class="st">"codigo_pon"</span>, <span class="st">"data_colet"</span>, <span class="st">"gcs_latitu"</span>, <span class="st">"gcs_longit"</span>, <span class="st">"simbolo_ho"</span>, <span class="st">"profundida"</span>, </span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"profundi_1"</span>, <span class="st">"cascalho"</span>, <span class="st">"areia_tota"</span>, <span class="st">"silte"</span>, <span class="st">"argila"</span>, <span class="st">"densidade_"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_kcl"</span>, </span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"complexo_s"</span>, <span class="st">"complexo_1"</span>, <span class="st">"complexo_2"</span>, <span class="st">"complexo_3"</span>, <span class="st">"valor_s"</span>, <span class="st">"carbono_or"</span>, <span class="st">"nitrogenio"</span>,</span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"condutivid"</span>, <span class="st">"classe_tex"</span>)</span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#pronas.in.name[which(!pronas.in.name %in% names(pronas.hor))]</span></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>  pronas.x <span class="ot">=</span> <span class="fu">as.data.frame</span>(pronas.hor[,pronas.in.name])</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>  pronas.out.name <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"usiteid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"longitude_decimal_degrees"</span>,</span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"hzn_desgn"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_top"</span>, <span class="st">"total_frag_wt_pct_gt_2_mm_ws"</span>, <span class="st">"sand_total"</span>, <span class="st">"silt_total"</span>, </span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"clay_total"</span>, <span class="st">"bulk_density_oven_dry"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ca_ext"</span>,</span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"mg_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"sum_of_cations_cec_pH_8_2"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"total_nitrogen_ncs"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"texture_description"</span>)</span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## translate values</span></span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst <span class="ot">=</span> <span class="fu">as.list</span>(<span class="fu">rep</span>(<span class="st">"as.numeric(x)*1"</span>, <span class="fu">length</span>(pronas.in.name)))</span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"sigla"</span>)]] <span class="ot">=</span> <span class="st">"paste(x)"</span></span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"codigo_pon"</span>)]] <span class="ot">=</span> <span class="st">"paste(x)"</span></span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"data_colet"</span>)]] <span class="ot">=</span> <span class="st">"paste(x)"</span></span>
<span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"simbolo_ho"</span>)]] <span class="ot">=</span> <span class="st">"paste(x)"</span></span>
<span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"classe_tex"</span>)]] <span class="ot">=</span> <span class="st">"paste(x)"</span></span>
<span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"complexo_s"</span>)]] <span class="ot">=</span> <span class="st">"as.numeric(x)*200"</span></span>
<span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"complexo_1"</span>)]] <span class="ot">=</span> <span class="st">"as.numeric(x)*121"</span></span>
<span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"complexo_2"</span>)]] <span class="ot">=</span> <span class="st">"as.numeric(x)*391"</span></span>
<span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"complexo_3"</span>)]] <span class="ot">=</span> <span class="st">"as.numeric(x)*230"</span></span>
<span id="cb119-34"><a href="#cb119-34" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"areia_tota"</span>)]] <span class="ot">=</span> <span class="st">"round(as.numeric(x)/10, 1)"</span></span>
<span id="cb119-35"><a href="#cb119-35" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"silte"</span>)]] <span class="ot">=</span> <span class="st">"round(as.numeric(x)/10, 1)"</span></span>
<span id="cb119-36"><a href="#cb119-36" aria-hidden="true" tabindex="-1"></a>  pronas.fun.lst[[<span class="fu">which</span>(pronas.in.name<span class="sc">==</span><span class="st">"argila"</span>)]] <span class="ot">=</span> <span class="st">"round(as.numeric(x)/10, 1)"</span></span>
<span id="cb119-37"><a href="#cb119-37" aria-hidden="true" tabindex="-1"></a>  <span class="do">## save translation rules:</span></span>
<span id="cb119-38"><a href="#cb119-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write.csv(data.frame(pronas.in.name, pronas.out.name, unlist(pronas.fun.lst)), "pronas_soilab_transvalues.csv")</span></span>
<span id="cb119-39"><a href="#cb119-39" aria-hidden="true" tabindex="-1"></a>  pronas.soil <span class="ot">=</span> <span class="fu">transvalues</span>(pronas.x, pronas.out.name, pronas.in.name, pronas.fun.lst)</span>
<span id="cb119-40"><a href="#cb119-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">## a lot of NA's</span></span>
<span id="cb119-41"><a href="#cb119-41" aria-hidden="true" tabindex="-1"></a>  <span class="do">## oxidation with 0.067 M K2Cr2O7, Tiurim method -&gt; Walkley-Black method</span></span>
<span id="cb119-42"><a href="#cb119-42" aria-hidden="true" tabindex="-1"></a>  pronas.soil<span class="sc">$</span>organic_carbon <span class="ot">=</span> <span class="fl">1.3</span> <span class="sc">*</span> pronas.soil<span class="sc">$</span>organic_carbon</span>
<span id="cb119-43"><a href="#cb119-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(pronas.soil$organic_carbon)</span></span>
<span id="cb119-44"><a href="#cb119-44" aria-hidden="true" tabindex="-1"></a>  pronas.soil<span class="sc">$</span>bulk_density_oven_dry <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pronas.soil<span class="sc">$</span>bulk_density_oven_dry <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="cn">NA</span>, pronas.soil<span class="sc">$</span>bulk_density_oven_dry)</span>
<span id="cb119-45"><a href="#cb119-45" aria-hidden="true" tabindex="-1"></a>  pronas.soil<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pronas.soil<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> pronas.soil<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws <span class="sc">&gt;</span> <span class="dv">100</span>, <span class="cn">NA</span>, pronas.soil<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws)</span>
<span id="cb119-46"><a href="#cb119-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(pronas.soil$bulk_density_oven_dry)</span></span>
<span id="cb119-47"><a href="#cb119-47" aria-hidden="true" tabindex="-1"></a>  pronas.soil<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(pronas.soil<span class="sc">$</span>organic_carbon <span class="sc">*</span> pronas.soil<span class="sc">$</span>bulk_density_oven_dry <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(pronas.soil<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws), <span class="dv">0</span>, pronas.soil<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb119-48"><a href="#cb119-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(pronas.soil$oc_d)</span></span>
<span id="cb119-49"><a href="#cb119-49" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> col.names[<span class="fu">which</span>(<span class="sc">!</span>col.names <span class="sc">%in%</span> <span class="fu">names</span>(pronas.soil))]</span>
<span id="cb119-50"><a href="#cb119-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ pronas.soil[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb119-51"><a href="#cb119-51" aria-hidden="true" tabindex="-1"></a>  chemsprops.PRONASOLOS <span class="ot">=</span> pronas.soil[,col.names]</span>
<span id="cb119-52"><a href="#cb119-52" aria-hidden="true" tabindex="-1"></a>  chemsprops.PRONASOLOS<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"PRONASOLOS"</span></span>
<span id="cb119-53"><a href="#cb119-53" aria-hidden="true" tabindex="-1"></a>  chemsprops.PRONASOLOS<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb119-54"><a href="#cb119-54" aria-hidden="true" tabindex="-1"></a>  chemsprops.PRONASOLOS<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://geoportal.cprm.gov.br/pronasolos/"</span></span>
<span id="cb119-55"><a href="#cb119-55" aria-hidden="true" tabindex="-1"></a>  chemsprops.PRONASOLOS<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://www.infoteca.cnptia.embrapa.br/infoteca/handle/doc/1135056"</span></span>
<span id="cb119-56"><a href="#cb119-56" aria-hidden="true" tabindex="-1"></a>  chemsprops.PRONASOLOS <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.PRONASOLOS, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"organic_carbon"</span>,<span class="st">"ph_h2o"</span>,<span class="st">"clay_total"</span>))</span>
<span id="cb119-57"><a href="#cb119-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.PRONASOLOS, <span class="st">"/mnt/diskstation/data/Soil_points/Brasil/Pronasolos/chemsprops.PRONASOLOS.rds"</span>)</span>
<span id="cb119-58"><a href="#cb119-58" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.PRONASOLOS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32708    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 32708    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="guatemala-soil-organic-carbon-database-gtmsoc" class="level4">
<h4 class="anchored" data-anchor-id="guatemala-soil-organic-carbon-database-gtmsoc">Guatemala Soil Organic Carbon Database (GTMSOC)</h4>
<ul>
<li>Vásquez-Toxcón, A.O., H. Tobías Vásquez, and M. Guevara, (2023). Guatemala Soil Organic Carbon Database (0 to 30 cm, 1965-2010). ver 1. Environmental Data Initiative. <a href="https://doi.org/10.6073/pasta/8dd15238c604c3ac75daf985548bd05c" class="uri">https://doi.org/10.6073/pasta/8dd15238c604c3ac75daf985548bd05c</a> (Accessed 2024-11-24).<br>
</li>
<li>Vásquez, A., Varón‐Ramírez, V. M., Tobías, H., &amp; Guevara, M. (2024). Guatemala soil organic carbon database (GTMSOC). European Journal of Soil Science, 75(1), e13450. <a href="https://doi.org/10.1111/ejss.13450" class="uri">https://doi.org/10.1111/ejss.13450</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.Guatemala"</span>)){</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  gua.df <span class="ot">=</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Guatemala/GTMSOCBD.csv"</span>)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Rows: 910 Columns: 12</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(gua.site)</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(gua.site$SOC_Method))</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## measured using wet-oxidation method (Walley-Black)</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>  gua.df<span class="sc">$</span>oc <span class="ot">=</span> gua.df<span class="sc">$</span>SOC <span class="sc">*</span> <span class="fl">1.3</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Values are about 50-100% higher than in other countries</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(gua.df$CF)</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>  gua.df<span class="sc">$</span>wpg2 <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(gua.df<span class="sc">$</span>CF), <span class="dv">0</span>, gua.df<span class="sc">$</span>CF)</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>  gua.df<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(gua.df<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> gua.df<span class="sc">$</span>BD <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> gua.df<span class="sc">$</span>wpg2)<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>  gua.df<span class="sc">$</span>LIMSUP <span class="ot">=</span> <span class="dv">0</span>; gua.df<span class="sc">$</span>LIMINF <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(gua.df$oc_d)</span></span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>  gua.sel.h <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"upedonid"</span>, <span class="st">"Date"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"LIMSUP"</span>, <span class="st">"LIMINF"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"texture_description"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_total"</span>, <span class="st">"silt_total"</span>, <span class="st">"sand_total"</span>,  </span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"total_carbon_ncs"</span>, <span class="st">"total_nitrogen_ncs"</span>, </span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, </span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sum_of_cations_cec_pH_8_2"</span>, <span class="st">"cec_nh4_ph_7"</span>, <span class="st">"ecec_base_plus_aluminum"</span>, </span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">"CF"</span>, <span class="st">"BD"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, </span>
<span id="cb124-19"><a href="#cb124-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)</span>
<span id="cb124-20"><a href="#cb124-20" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> gua.sel.h[<span class="fu">which</span>(<span class="sc">!</span>gua.sel.h <span class="sc">%in%</span> <span class="fu">names</span>(gua.df))]</span>
<span id="cb124-21"><a href="#cb124-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ gua.df[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb124-22"><a href="#cb124-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.Guatemala <span class="ot">=</span> gua.df[,gua.sel.h]</span>
<span id="cb124-23"><a href="#cb124-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.Guatemala<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Guatemala_GTMSOC"</span></span>
<span id="cb124-24"><a href="#cb124-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.Guatemala<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb124-25"><a href="#cb124-25" aria-hidden="true" tabindex="-1"></a>  chemsprops.Guatemala<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://doi.org/10.6073/pasta/8dd15238c604c3ac75daf985548bd05c"</span></span>
<span id="cb124-26"><a href="#cb124-26" aria-hidden="true" tabindex="-1"></a>  chemsprops.Guatemala<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1111/ejss.13450"</span></span>
<span id="cb124-27"><a href="#cb124-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.Guatemala <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.Guatemala, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"BD"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>))</span>
<span id="cb124-28"><a href="#cb124-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.Guatemala, <span class="st">"/mnt/diskstation/data/Soil_points/Guatemala/chemsprops.Guatemala.rds"</span>)</span>
<span id="cb124-29"><a href="#cb124-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 910 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (5): ID, SOC_Method, BD_Method, Data_Source, Primary_Information
dbl (6): Longitude, Latitude, SOC, BD, CF, Date
lgl (1): CF_Method

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.Guatemala)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 910  39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 910   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="harmonized-soil-database-of-ecuador" class="level4">
<h4 class="anchored" data-anchor-id="harmonized-soil-database-of-ecuador">Harmonized Soil Database of Ecuador</h4>
<ul>
<li>Armas, D.I., M. Guevara, F. Bezares, R. Vargas, P. Durante, V.H. Osorio, W.A. Jimenez, and C. Oyonarte. (2022). Harmonized Soil Database of Ecuador 2021 ver 3. Environmental Data Initiative. <a href="https://doi.org/10.6073/pasta/1560e803953c839e7aedef78ff7d3f6c" class="uri">https://doi.org/10.6073/pasta/1560e803953c839e7aedef78ff7d3f6c</a> (Accessed 2024-11-24).<br>
</li>
<li>Armas, D., Guevara, M., Bezares, F., Vargas, R., Durante, P., Osorio, V., Jiménez, W., and Oyonarte, C. (2023). Harmonized Soil Database of Ecuador (HESD): data from 2009 to 2015, Earth Syst. Sci. Data, 15, 431–445, <a href="https://doi.org/10.5194/essd-15-431-2023" class="uri">https://doi.org/10.5194/essd-15-431-2023</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.Ecuador"</span>)){</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  ecu.site <span class="ot">=</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Ecuador/Harmonized_Soil_Database_of_Ecuador_profile_v0.2EDI.csv"</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ecu.site$CORX)</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  ecu.xy <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">vect</span>(ecu.site[,<span class="fu">c</span>(<span class="st">"CORX"</span>,<span class="st">"CORY"</span>)], <span class="at">geom=</span><span class="fu">c</span>(<span class="st">"CORX"</span>, <span class="st">"CORY"</span>), <span class="at">crs=</span><span class="st">"EPSG:32717"</span>)</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  ecu.ll <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(ecu.xy, <span class="st">"EPSG:4326"</span>)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>  ecu.site<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> <span class="fu">geom</span>(ecu.ll)[,<span class="st">"x"</span>]</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  ecu.site<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> <span class="fu">geom</span>(ecu.ll)[,<span class="st">"y"</span>]</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(ecu.site[,c("longitude_decimal_degrees","latitude_decimal_degrees")], pch="+", asp=1)</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>  ecu.site<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">as.Date</span>(ecu.site<span class="sc">$</span>FEMU, <span class="at">format=</span><span class="st">"%d/%m/%y"</span>)</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>  ecu.site<span class="sc">$</span>site_obsdate[<span class="fu">nchar</span>(ecu.site<span class="sc">$</span>FEMU)<span class="sc">&gt;</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(ecu.site<span class="sc">$</span>FEMU, <span class="at">format=</span><span class="st">"%d/%m/%Y"</span>)[<span class="fu">nchar</span>(ecu.site<span class="sc">$</span>FEMU)<span class="sc">&gt;</span><span class="dv">8</span>]</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">##summary(ecu.site$site_obsdate)</span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>  ecu.hor <span class="ot">=</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Ecuador/Harmonized_Soil_Database_of_Ecuador_horizon_v0.2.csv"</span>)</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>  ecu.df <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(ecu.hor, ecu.site, <span class="at">by=</span><span class="st">"ID_PER"</span>, <span class="at">multiple=</span><span class="st">"first"</span>)</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## measured using wet-oxidation method (Walley-Black)</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>  ecu.df<span class="sc">$</span>oc <span class="ot">=</span> ecu.df<span class="sc">$</span>CO <span class="sc">*</span> <span class="fl">1.3</span></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ecu.df$oc)</span></span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ecu.df$DA)</span></span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ecu.df$KDIS) # centimolePerKilogram</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>  ecu.df<span class="sc">$</span>ca_ext <span class="ot">=</span> ecu.df<span class="sc">$</span>CADIS <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a>  ecu.df<span class="sc">$</span>mg_ext <span class="ot">=</span> ecu.df<span class="sc">$</span>MGDIS <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a>  ecu.df<span class="sc">$</span>na_ext <span class="ot">=</span> ecu.df<span class="sc">$</span>NACC <span class="sc">*</span> <span class="dv">230</span></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>  ecu.df<span class="sc">$</span>k_ext <span class="ot">=</span> ecu.df<span class="sc">$</span>KDIS <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(ecu.df$FR_CL))</span></span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>  ecu.df<span class="sc">$</span>wpg2 <span class="ot">=</span> <span class="fu">ifelse</span>(ecu.df<span class="sc">$</span>FR_CL<span class="sc">==</span><span class="st">"0-2"</span>, <span class="dv">1</span>, </span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ecu.df<span class="sc">$</span>FR_CL<span class="sc">==</span><span class="st">" 02-05"</span>, <span class="fl">3.5</span>, </span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ecu.df<span class="sc">$</span>FR_CL<span class="sc">==</span><span class="st">" 05-15"</span>, <span class="dv">10</span>, </span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ecu.df<span class="sc">$</span>FR_CL<span class="sc">==</span><span class="st">"15-40"</span>, <span class="fl">27.5</span>, </span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ecu.df<span class="sc">$</span>FR_CL<span class="sc">==</span><span class="st">"40-80"</span>, <span class="dv">60</span>, </span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ecu.df<span class="sc">$</span>FR_CL<span class="sc">==</span><span class="st">"&gt; 80"</span>, <span class="dv">90</span>, <span class="dv">0</span>))))))</span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>  ecu.df<span class="sc">$</span>wpg2 <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(ecu.df<span class="sc">$</span>wpg2), <span class="dv">0</span>, ecu.df<span class="sc">$</span>wpg2)</span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ecu.df$wpg2)</span></span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a>  ecu.df<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(ecu.df<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> ecu.df<span class="sc">$</span>DA <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> ecu.df<span class="sc">$</span>wpg2)<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ecu.df$oc_d)</span></span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>  ecu.sel.h <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ID_PER"</span>, <span class="st">"ID_NAC"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"STSG"</span>, <span class="st">"ID_HOR"</span>, <span class="st">"layer_key"</span>, <span class="st">"ORDHOR"</span>, <span class="st">"LIMSUP"</span>, <span class="st">"LIMINF"</span>, <span class="st">"HMOR"</span>, <span class="st">"texture_description"</span>, <span class="st">"texture_lab"</span>, <span class="st">"ARCILLA"</span>, <span class="st">"LIMO"</span>, <span class="st">"ARENA"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"NTOT"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"PHAQ"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"SBCC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"DA"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"CESS"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> ecu.sel.h[<span class="fu">which</span>(<span class="sc">!</span>ecu.sel.h <span class="sc">%in%</span> <span class="fu">names</span>(ecu.df))]</span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ ecu.df[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb129-37"><a href="#cb129-37" aria-hidden="true" tabindex="-1"></a>  chemsprops.Ecuador <span class="ot">=</span> ecu.df[,ecu.sel.h]</span>
<span id="cb129-38"><a href="#cb129-38" aria-hidden="true" tabindex="-1"></a>  chemsprops.Ecuador<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Ecuador_HESD"</span></span>
<span id="cb129-39"><a href="#cb129-39" aria-hidden="true" tabindex="-1"></a>  chemsprops.Ecuador<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb129-40"><a href="#cb129-40" aria-hidden="true" tabindex="-1"></a>  chemsprops.Ecuador<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://doi.org/10.6073/pasta/1560e803953c839e7aedef78ff7d3f6c"</span></span>
<span id="cb129-41"><a href="#cb129-41" aria-hidden="true" tabindex="-1"></a>  chemsprops.Ecuador<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.5194/essd-15-431-2023"</span></span>
<span id="cb129-42"><a href="#cb129-42" aria-hidden="true" tabindex="-1"></a>  chemsprops.Ecuador <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.Ecuador, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"PHAQ"</span>,<span class="st">"ARCILLA"</span>,<span class="st">"DA"</span>))</span>
<span id="cb129-43"><a href="#cb129-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.Ecuador, <span class="st">"/mnt/diskstation/data/Soil_points/Ecuador/chemsprops.Ecuador.rds"</span>)</span>
<span id="cb129-44"><a href="#cb129-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 13542 Columns: 24
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (17): ID_NAC, COLP, STSG, STGG, STOD, RTS, RHS, LITO, GEOF, TUSO, TVEG, ...
dbl  (7): ID_PER, CORX, CORY, ALT, PRES, PEND, FRGG

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 51673 Columns: 56
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): Hmor, MSHOR, SUBHOR, FR_CL
dbl (40): ID_PER, ID_HOR, CORX, CORY, ORDHOR, DISHOR, LIMSUP, LIMINF, ROOTS,...
lgl (12): pHSS, CESS, NASS, KSS, CASS, MGSS, SBSS, CARSS, SULSS, CLSS, PSI, RAS

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.Ecuador)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30188    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 30188    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mexico-inegi-series-i-and-ii" class="level4">
<h4 class="anchored" data-anchor-id="mexico-inegi-series-i-and-ii">Mexico (INEGI) series I and II</h4>
<ul>
<li>Paz-Pellat, F., &amp; Velázquez-Rodríguez, A. S. (2018). Base de datos de perfiles de suelos en México. Elementos para Políticas Públicas, 2(3), 210-235. <a href="https://www.elementospolipub.org/ojs/index.php/epp/issue/view/3" class="uri">https://www.elementospolipub.org/ojs/index.php/epp/issue/view/3</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.MexicoINEGI"</span>)){</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  mex.xy <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">vect</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Mexico/INEGI/perfiles_serieii.shp"</span>, <span class="at">crs=</span><span class="st">"EPSG:6362"</span>)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  mex.ll <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">project</span>(mex.xy, <span class="st">"EPSG:4326"</span>)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(mex.ll)</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  mex.df <span class="ot">=</span> <span class="fu">as.data.frame</span>(mex.xy)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  mex.df<span class="sc">$</span>site_key <span class="ot">=</span> <span class="fu">sapply</span>(mex.df<span class="sc">$</span>ID_PERFIL, <span class="cf">function</span>(i){<span class="fu">strsplit</span>(i, <span class="st">"-"</span>)}[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4428</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>  mex.df<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> <span class="fu">geom</span>(mex.ll)[,<span class="st">"x"</span>]</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  mex.df<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> <span class="fu">geom</span>(mex.ll)[,<span class="st">"y"</span>]</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">##summary(mex.df$CO) ## Carbono orgánico, método de Walkley y Black</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>  mex.df<span class="sc">$</span>oc <span class="ot">=</span> mex.df<span class="sc">$</span>CO <span class="sc">*</span> <span class="dv">10</span> <span class="sc">*</span> <span class="fl">1.3</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(mex.df$K)</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>  mex.df<span class="sc">$</span>ca_ext <span class="ot">=</span> mex.df<span class="sc">$</span>CA <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>  mex.df<span class="sc">$</span>mg_ext <span class="ot">=</span> mex.df<span class="sc">$</span>MG <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>  mex.df<span class="sc">$</span>na_ext <span class="ot">=</span> mex.df<span class="sc">$</span><span class="st">`</span><span class="at">NA</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">230</span></span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>  mex.df<span class="sc">$</span>k_ext <span class="ot">=</span> mex.df<span class="sc">$</span>K <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>  mex.df<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(mex.df<span class="sc">$</span>FECHA, <span class="at">format=</span><span class="st">"%d/%m/%Y"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## pH del horizonte, método del potenciómetro, relación con agua 1:1</span></span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a>  mex.sel.h <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"IDHOJA"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"ID_PERFIL"</span>, <span class="st">"layer_key"</span>, <span class="st">"horizonte"</span>, <span class="st">"LIM_SUP"</span>, <span class="st">"LIM_INF"</span>, <span class="st">"NOMEN_HTE"</span>, <span class="st">"CLAS_TEXT"</span>, <span class="st">"texture_lab"</span>, <span class="st">"R"</span>, <span class="st">"L"</span>, <span class="st">"A"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"pHKCl"</span>, <span class="st">"PH"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"CIC"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"bulk_density_oven_dry"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"CE"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> mex.sel.h[<span class="fu">which</span>(<span class="sc">!</span>mex.sel.h <span class="sc">%in%</span> <span class="fu">names</span>(mex.df))]</span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ mex.df[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.MexicoINEGI <span class="ot">=</span> mex.df[,mex.sel.h]</span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.MexicoINEGI<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"MexicoINEGI"</span></span>
<span id="cb137-24"><a href="#cb137-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.MexicoINEGI<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb137-25"><a href="#cb137-25" aria-hidden="true" tabindex="-1"></a>  chemsprops.MexicoINEGI<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://www.inegi.org.mx/"</span></span>
<span id="cb137-26"><a href="#cb137-26" aria-hidden="true" tabindex="-1"></a>  chemsprops.MexicoINEGI<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://www.elementospolipub.org/ojs/index.php/epp/article/view/16"</span></span>
<span id="cb137-27"><a href="#cb137-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.MexicoINEGI <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.MexicoINEGI, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"PH"</span>,<span class="st">"R"</span>))</span>
<span id="cb137-28"><a href="#cb137-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.MexicoINEGI, <span class="st">"/mnt/diskstation/data/Soil_points/Mexico/INEGI/chemsprops.MexicoINEGI.rds"</span>)</span>
<span id="cb137-29"><a href="#cb137-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb137-30"><a href="#cb137-30" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.MexicoINEGI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16820    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 16820    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="soil-profile-db-for-costa-rica" class="level4">
<h4 class="anchored" data-anchor-id="soil-profile-db-for-costa-rica">Soil Profile DB for Costa Rica</h4>
<ul>
<li>Mata, R., Vázquez, A., Rosales, A., &amp; Salazar, D. (2012). <a href="http://www.cia.ucr.ac.cr/?page_id=139">Mapa digital de suelos de Costa Rica</a>. Asociación Costarricense de la Ciencia del Suelo, San José, CRC. Escala, 1, 200000. Data download URL: <a href="http://www.cia.ucr.ac.cr/wp-content/recursosnaturales/Base%20perfiles%20de%20suelos%20v1.1.rar" class="uri">http://www.cia.ucr.ac.cr/wp-content/recursosnaturales/Base%20perfiles%20de%20suelos%20v1.1.rar</a></li>
<li>Mata-Chinchilla, R., &amp; Castro-Chinchilla, J. (2019). Geoportal de suelos de Costa Rica como Bien Público al servicio del país. Revista Tecnología En Marcha, 32(7), Pág. 51-56. <a href="https://doi.org/10.18845/tm.v32i7.4259" class="uri">https://doi.org/10.18845/tm.v32i7.4259</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.CostaRica"</span>)){</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  cr.hor <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Costa_Rica/Base_de_datos_version_1.2.3.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(cr.hor[,c("X","Y")], pch="+", asp=1)</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  cr.hor<span class="sc">$</span>usiteid <span class="ot">=</span> <span class="fu">paste</span>(cr.hor<span class="sc">$</span>Provincia, cr.hor<span class="sc">$</span>Cantón, cr.hor<span class="sc">$</span>Id, <span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(cr.hor$Corg.)</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  cr.hor<span class="sc">$</span>oc <span class="ot">=</span> cr.hor<span class="sc">$</span>Corg. <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  cr.hor<span class="sc">$</span>Densidad.Aparente <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(cr.hor<span class="sc">$</span>Densidad.Aparente))</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(cr.hor$K)</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  cr.hor<span class="sc">$</span>ca_ext <span class="ot">=</span> cr.hor<span class="sc">$</span>Ca <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>  cr.hor<span class="sc">$</span>mg_ext <span class="ot">=</span> cr.hor<span class="sc">$</span>Mg <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cr.hor$na_ext = cr.hor$Na * 230</span></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>  cr.hor<span class="sc">$</span>k_ext <span class="ot">=</span> cr.hor<span class="sc">$</span>K <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>  cr.hor<span class="sc">$</span>wpg2 <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>  cr.hor<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(cr.hor<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> cr.hor<span class="sc">$</span>Densidad.Aparente <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(cr.hor<span class="sc">$</span>wpg2), <span class="dv">0</span>, cr.hor<span class="sc">$</span>wpg2))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(cr.hor$oc_d)</span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>  cr.sel.h <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Id"</span>, <span class="st">"usiteid"</span>, <span class="st">"Fecha"</span>, <span class="st">"X"</span>, <span class="st">"Y"</span>, <span class="st">"Sub.Grupo"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"horizonte"</span>, <span class="st">"prof_inicio"</span>, <span class="st">"prof_final"</span>, <span class="st">"id_hz"</span>, <span class="st">"Clase.Textural"</span>, <span class="st">"texture_lab"</span>, <span class="st">"ARCILLA"</span>, <span class="st">"LIMO"</span>, <span class="st">"ARENA"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"pHKCl"</span>, <span class="st">"pH_H2O"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"Densidad.Aparente"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> cr.sel.h[<span class="fu">which</span>(<span class="sc">!</span>cr.sel.h <span class="sc">%in%</span> <span class="fu">names</span>(cr.hor))]</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ cr.hor[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.CostaRica <span class="ot">=</span> cr.hor[,cr.sel.h]</span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.CostaRica<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"CostaRica"</span></span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.CostaRica<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.CostaRica<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://www.cia.ucr.ac.cr"</span></span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.CostaRica<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.18845/tm.v32i7.42"</span></span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.CostaRica <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.CostaRica, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"pH_H2O"</span>,<span class="st">"ARCILLA"</span>,<span class="st">"Densidad.Aparente"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>))</span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.CostaRica, <span class="st">"/mnt/diskstation/data/Soil_points/Costa_Rica/chemsprops.CostaRica.rds"</span>)</span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.CostaRica)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2051   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2051   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="iran-soil-profile-db" class="level4">
<h4 class="anchored" data-anchor-id="iran-soil-profile-db">Iran soil profile DB</h4>
<ul>
<li>Dewan, M. L., &amp; Famouri, J. (1964). The soils of Iran. Food and Agriculture Organization of the United Nations.<br>
</li>
<li>Hengl, T., Toomanian, N., Reuter, H. I., &amp; Malakouti, M. J. (2007). <a href="https://doi.org/10.1016/j.geoderma.2007.04.022">Methods to interpolate soil categorical variables from profile observations: Lessons from Iran</a>. Geoderma, 140(4), 417-427.<br>
</li>
<li>Mohammad, H. B. (2000). Soil resources and use potentiality map of Iran. Soil and Water Research Institute, Teheran, Iran.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.IRANSPDB"</span>)){</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  na.s <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"?"</span>,<span class="st">""</span>,<span class="st">"?."</span>,<span class="st">"??"</span>, <span class="sc">-</span><span class="dv">2147483647</span>, <span class="sc">-</span><span class="fl">1.00e+308</span>, <span class="st">"&lt;NA&gt;"</span>)</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  iran.hor <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Iran/iran_sdbana.txt"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, <span class="at">na.strings =</span> na.s, <span class="at">header =</span> <span class="cn">FALSE</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>]</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(iran.hor) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"oc"</span>, <span class="st">"CACO"</span>, <span class="st">"PBS"</span>, <span class="st">"sand_total"</span>, <span class="st">"silt_total"</span>, <span class="st">"clay_total"</span>)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>  iran.hor<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(iran.hor<span class="sc">$</span>hzn_top) <span class="sc">&amp;</span> iran.hor<span class="sc">$</span>hzn_desgn<span class="sc">==</span><span class="st">"A"</span>, <span class="dv">0</span>, iran.hor<span class="sc">$</span>hzn_top)</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>  iran.hor2 <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Iran/iran_sdbhor.txt"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, <span class="at">na.strings =</span> na.s, <span class="at">header =</span> <span class="cn">FALSE</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(iran.hor2) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"DESI"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"M_colour"</span>, <span class="st">"texture_description"</span>, <span class="st">"hzn_desgn"</span>)</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>  iran.site <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Iran/iran_sgdb.txt"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, <span class="at">na.strings =</span> na.s, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(iran.site) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"usiteid"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"FAO"</span>, <span class="st">"Tax"</span>, <span class="st">"site_key"</span>)</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>  st.cor <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'./correlation/soil_types_correlation_full_data_FAO74_US_CPSS.csv'</span>)</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>  st.cor<span class="sc">$</span>Correlation_ <span class="ot">=</span> <span class="fu">toupper</span>(st.cor<span class="sc">$</span>Correlation)</span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>  iran.site<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(iran.site[<span class="st">"FAO"</span>], st.cor, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"FAO"</span><span class="ot">=</span><span class="st">"Correlation_"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>SoilUnitDUS</span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="fu">as.factor</span>(iran.site<span class="sc">$</span>SSL_classification_name))</span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>  iran.db <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join_all</span>(<span class="fu">list</span>(iran.site, iran.hor, iran.hor2))</span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>  iran.db<span class="sc">$</span>organic_carbon <span class="ot">=</span> iran.db<span class="sc">$</span>oc <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(iran.db$oc)</span></span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> col.names[<span class="fu">which</span>(<span class="sc">!</span>col.names <span class="sc">%in%</span> <span class="fu">names</span>(iran.db))]</span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ iran.db[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb145-19"><a href="#cb145-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.IRANSPDB <span class="ot">=</span> iran.db[,col.names]</span>
<span id="cb145-20"><a href="#cb145-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.IRANSPDB<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Iran_SPDB"</span></span>
<span id="cb145-21"><a href="#cb145-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.IRANSPDB<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb145-22"><a href="#cb145-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.IRANSPDB<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">""</span></span>
<span id="cb145-23"><a href="#cb145-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.IRANSPDB<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1016/j.geoderma.2007.04.022"</span></span>
<span id="cb145-24"><a href="#cb145-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.IRANSPDB <span class="ot">&lt;-</span> <span class="fu">complete.vars</span>(chemsprops.IRANSPDB, <span class="at">sel=</span><span class="fu">c</span>(<span class="st">"organic_carbon"</span>,<span class="st">"ph_h2o"</span>,<span class="st">"clay_total"</span>))</span>
<span id="cb145-25"><a href="#cb145-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.IRANSPDB, <span class="st">"/mnt/diskstation/data/Soil_points/Iran/chemsprops.IRANSPDB.rds"</span>)</span>
<span id="cb145-26"><a href="#cb145-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: site_key</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: site_key, hzn_desgn, hzn_top, hzn_bot</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.IRANSPDB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4941   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4941   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="northern-circumpolar-permafrost-soil-profiles" class="level4">
<h4 class="anchored" data-anchor-id="northern-circumpolar-permafrost-soil-profiles">Northern circumpolar permafrost soil profiles</h4>
<ul>
<li>Hugelius, G., Bockheim, J. G., Camill, P., Elberling, B., Grosse, G., Harden, J. W., … &amp; Michaelson, G. (2013). <a href="https://doi.org/10.5194/essd-5-393-2013">A new data set for estimating organic carbon storage to 3 m depth in soils of the northern circumpolar permafrost region</a>. Earth System Science Data (Online), 5(2). Data download URL: <a href="http://dx.doi.org/10.5879/ECDS/00000002" class="uri">http://dx.doi.org/10.5879/ECDS/00000002</a></li>
</ul>
<p>Note: this data set show extremely high SOC content (average 30%). It appears that this was a purposive survey i.e.&nbsp;surveyors were looking for peatlands and gelisols with high SOC content.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.NCSCD"</span>)){</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  ncscd.hors <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/NCSCD/Harden_etal_2012_Hugelius_etal_2013_cleaned_data.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## To translate LOI % into OC %: OC % = (−0.0013 × LOI %2 ) + (0.637 × LOI %)) was used</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for mineral soils: OC % = (−0.00005 × LOI %3 ) + (0.0059× LOI %2 ) + (0.362 × LOI %))</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  ncscd.hors<span class="sc">$</span>oc <span class="ot">=</span> <span class="fu">as.numeric</span>(ncscd.hors<span class="sc">$</span>X.C)<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## mean OC content 30%!!</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ncscd.hors$oc)</span></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#hist(ncscd.hors$Layer.thickness.cm, breaks = 45)</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>  ncscd.hors<span class="sc">$</span>Layer.thickness.cm <span class="ot">=</span> <span class="fu">ifelse</span>(ncscd.hors<span class="sc">$</span>Layer.thickness.cm<span class="sc">&lt;</span><span class="dv">0</span>, <span class="cn">NA</span>, ncscd.hors<span class="sc">$</span>Layer.thickness.cm)</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>  ncscd.hors<span class="sc">$</span>hzn_bot <span class="ot">=</span> ncscd.hors<span class="sc">$</span>Basal.Depth.cm <span class="sc">+</span> ncscd.hors<span class="sc">$</span>Layer.thickness.cm</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>  ncscd.hors<span class="sc">$</span>db_od <span class="ot">=</span> <span class="fu">as.numeric</span>(ncscd.hors<span class="sc">$</span>bulk.density.g.cm<span class="fl">.3</span>)</span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## BD &gt;2.4t/m3 -&gt; rock</span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>  ncscd.hors<span class="sc">$</span>db_od <span class="ot">=</span> <span class="fu">ifelse</span>(ncscd.hors<span class="sc">$</span>db_od<span class="sc">&gt;</span><span class="fl">2.4</span>, <span class="cn">NA</span>, ncscd.hors<span class="sc">$</span>db_od)</span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Can we assume no coarse fragments?</span></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>  ncscd.hors<span class="sc">$</span>wpg2 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>  ncscd.hors<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(ncscd.hors<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> ncscd.hors<span class="sc">$</span>db_od <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(ncscd.hors<span class="sc">$</span>wpg2), <span class="dv">0</span>, ncscd.hors<span class="sc">$</span>wpg2))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## very high values &gt;40 kg/m3</span></span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a>  ncscd.hors<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(ncscd.hors<span class="sc">$</span>Sample.date, <span class="at">format=</span><span class="st">"%d-%m-%Y"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ncscd.hors$db_od)</span></span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>  ncscd.hors<span class="sc">$</span>Great.Group <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(ncscd.hors<span class="sc">$</span>Great.Group), ncscd.hors<span class="sc">$</span>Suborder, ncscd.hors<span class="sc">$</span>Great.Group)</span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(ncscd.hors$Great.Group))</span></span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>  cor_ncsd <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"./correlation/soil_type_correlation_ncscd.csv"</span>)</span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a>  ncscd.hors<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(ncscd.hors[<span class="st">"Great.Group"</span>], cor_ncsd[,<span class="fu">c</span>(<span class="st">"Great.Group"</span>,<span class="st">"SSL_classification_name"</span>)], <span class="at">by=</span><span class="st">"Great.Group"</span>, <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>SSL_classification_name</span>
<span id="cb151-24"><a href="#cb151-24" aria-hidden="true" tabindex="-1"></a>  ncscd.col <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Profile.ID"</span>, <span class="st">"citation"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"Long"</span>, <span class="st">"Lat"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"Basal.Depth.cm"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"Horizon.type"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb151-25"><a href="#cb151-25" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> ncscd.col[<span class="fu">which</span>(<span class="sc">!</span>ncscd.col <span class="sc">%in%</span> <span class="fu">names</span>(ncscd.hors))]</span>
<span id="cb151-26"><a href="#cb151-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ ncscd.hors[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb151-27"><a href="#cb151-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSCD <span class="ot">=</span> ncscd.hors[,ncscd.col]</span>
<span id="cb151-28"><a href="#cb151-28" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSCD<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"NCSCD"</span></span>
<span id="cb151-29"><a href="#cb151-29" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSCD<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb151-30"><a href="#cb151-30" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSCD<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://bolin.su.se/data/ncscd/"</span></span>
<span id="cb151-31"><a href="#cb151-31" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSCD<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.5194/essd-5-393-2013"</span></span>
<span id="cb151-32"><a href="#cb151-32" aria-hidden="true" tabindex="-1"></a>  chemsprops.NCSCD <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.NCSCD, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"db_od"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Long"</span>, <span class="st">"Lat"</span>))</span>
<span id="cb151-33"><a href="#cb151-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(levels(as.factor(chemsprops.NCSCD$Profile.ID)))</span></span>
<span id="cb151-34"><a href="#cb151-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1476 unique sites</span></span>
<span id="cb151-35"><a href="#cb151-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># openair::scatterPlot(chemsprops.NCSCD, x = "oc", y = "db_od",</span></span>
<span id="cb151-36"><a href="#cb151-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    method = "hexbin", col = "increment",</span></span>
<span id="cb151-37"><a href="#cb151-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    log.x = TRUE, # log.y = TRUE,</span></span>
<span id="cb151-38"><a href="#cb151-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    xlab="SOC [g/kg]", ylab="Bulk density [t/m3]")</span></span>
<span id="cb151-39"><a href="#cb151-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># openair::scatterPlot(chemsprops.NCSCD, x = "oc", y = "oc_d",</span></span>
<span id="cb151-40"><a href="#cb151-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    method = "hexbin", col = "increment",</span></span>
<span id="cb151-41"><a href="#cb151-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    log.x = TRUE, log.y = TRUE,</span></span>
<span id="cb151-42"><a href="#cb151-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    xlab="SOC [g/kg]", ylab="SOC [kg/m3]")</span></span>
<span id="cb151-43"><a href="#cb151-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.NCSCD, <span class="st">"/mnt/diskstation/data/Soil_points/INT/NCSCD/chemsprops.NCSCD.rds"</span>)</span>
<span id="cb151-44"><a href="#cb151-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion
Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.NCSCD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7371   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 7371   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/fig_histogram_soc_bld_NCSCD.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption>Relationship between SOC [kg/m3] and BD for NCSCD data set.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="csiro-national-soil-site-database" class="level4">
<h4 class="anchored" data-anchor-id="csiro-national-soil-site-database">CSIRO National Soil Site Database</h4>
<ul>
<li>CSIRO (2020). CSIRO National Soil Site Database. v4. CSIRO. Data Collection. <a href="https://data.csiro.au/collections/collection/CIcsiro:7526v004" class="uri">https://data.csiro.au/collections/collection/CIcsiro:7526v004</a>. Data download URL: <a href="https://doi.org/10.25919/5eeb2a56eac12" class="uri">https://doi.org/10.25919/5eeb2a56eac12</a> (available upon request)<br>
</li>
<li>Searle, R. (2014). The Australian site data collation to support the GlobalSoilMap. GlobalSoilMap: Basis of the global spatial soil information system, 127.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.NatSoil"</span>)){</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(Hmisc) </span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  cmdb <span class="ot">&lt;-</span> <span class="fu">mdb.get</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Australia/CSIRO/NatSoil_v2_20200612.mdb"</span>)</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(cmdb$SITES)</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  au.obs <span class="ot">=</span> cmdb<span class="sc">$</span>OBSERVATIONS[,<span class="fu">c</span>(<span class="st">"s.id"</span>, <span class="st">"o.location.notes"</span>, <span class="st">"o.date.desc"</span>, <span class="st">"o.latitude.GDA94"</span>, <span class="st">"o.longitude.GDA94"</span>, <span class="st">"o.soil.taxonomy"</span>)]</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  au.obs<span class="sc">$</span>o.soil.taxonomy <span class="ot">=</span> <span class="fu">paste</span>(au.obs<span class="sc">$</span>o.soil.taxonomy)</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>  csiro.tax <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"./tabular/CSIRO_codes_taxonomy.csv"</span>)</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>  au.obs<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(au.obs[<span class="st">"o.soil.taxonomy"</span>], csiro.tax, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"o.soil.taxonomy"</span><span class="ot">=</span><span class="st">"Code"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>SSL_classification_name</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(au.obs$SSL_classification_name))</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## only about 300 profiles with USDA classification</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>  au.obs <span class="ot">=</span> au.obs[<span class="sc">!</span><span class="fu">is.na</span>(au.obs<span class="sc">$</span>o.longitude.GDA94),]</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coordinates</span>(au.obs) <span class="ot">&lt;-</span> <span class="er">~</span>o.longitude.GDA94<span class="sc">+</span>o.latitude.GDA94</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proj4string</span>(au.obs) <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">"+proj=longlat +ellps=GRS80 +no_defs"</span>)</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>  au.xy <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">spTransform</span>(au.obs, <span class="fu">CRS</span>(<span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84"</span>)))</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(au.xy[,c("coords.x1", "coords.x2")])</span></span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## all variables in one column and need to be sorted based on the lab method</span></span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(cmdb$LAB_METHODS$LABM.SHORT.NAME)</span></span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write.csv(cmdb$LAB_METHODS, "/mnt/diskstation/data/Soil_points/Australia/CSIRO/NatSoil_v2_20200612_lab_methods.csv")</span></span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>  lab.tbl <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"6_DC"</span>, <span class="st">"6A1"</span>, <span class="st">"6A1_UC"</span>, <span class="st">"6B1"</span>, <span class="st">"6B2"</span>, <span class="st">"6B2a"</span>, <span class="st">"6B2b"</span>, <span class="st">"6B3"</span>, <span class="st">"6B4"</span>, <span class="st">"6B4a"</span>, <span class="st">"6B4b"</span>, <span class="st">"6Z"</span>), <span class="co"># %</span></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"6B3a"</span>), <span class="co"># g/kg</span></span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"6H4"</span>, <span class="st">"6H4_SCaRP"</span>), <span class="co"># %</span></span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"7_C_B"</span>, <span class="st">"7_NR"</span>, <span class="st">"7A1"</span>, <span class="st">"7A2"</span>, <span class="st">"7A2a"</span>, <span class="st">"7A2b"</span>, <span class="st">"7A3"</span>, <span class="st">"7A4"</span>, <span class="st">"7A5"</span>, <span class="st">"7A6"</span>, <span class="st">"7A6a"</span>, <span class="st">"7A6b"</span>, <span class="st">"7A6b_MCLW"</span>),  <span class="co"># g/kg</span></span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"4A1"</span>, <span class="st">"4_NR"</span>, <span class="st">"4A_C_2.5"</span>, <span class="st">"4A_C_1"</span>, <span class="st">"4G1"</span>),</span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"4C_C_1"</span>, <span class="st">"4C1"</span>, <span class="st">"4C2"</span>, <span class="st">"23A"</span>),</span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"4B_C_2.5"</span>, <span class="st">"4B1"</span>, <span class="st">"4B2"</span>),</span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"P10_NR_C"</span>, <span class="st">"P10_HYD_C"</span>, <span class="st">"P10_PB_C"</span>, <span class="st">"P10_PB1_C"</span>, <span class="st">"P10_CF_C"</span>, <span class="st">"P10_I_C"</span>),</span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"P10_NR_Z"</span>, <span class="st">"P10_HYD_Z"</span>, <span class="st">"P10_PB_Z"</span>, <span class="st">"P10_PB1_Z"</span>, <span class="st">"P10_CF_Z"</span>, <span class="st">"P10_I_Z"</span>),</span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"P10_NR_S"</span>, <span class="st">"P10_HYD_S"</span>, <span class="st">"P10_PB_S"</span>, <span class="st">"P10_PB1_S"</span>, <span class="st">"P10_CF_S"</span>, <span class="st">"P10_I_S"</span>),</span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"15C1modCEC"</span>, <span class="st">"15_HSK_CEC"</span>, <span class="st">"15J_CEC"</span>),</span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"15I1"</span>, <span class="st">"15I2"</span>, <span class="st">"15I3"</span>, <span class="st">"15I4"</span>, <span class="st">"15D3_CEC"</span>),</span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"15_BASES"</span>, <span class="st">"15_NR"</span>, <span class="st">"15J_H"</span>, <span class="st">"15J1"</span>),</span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"2Z2_Grav"</span>, <span class="st">"P10_GRAV"</span>),</span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"503.08a"</span>, <span class="st">"P3A_NR"</span>, <span class="st">"P3A1"</span>, <span class="st">"P3A1_C4"</span>, <span class="st">"P3A1_CLOD"</span>, <span class="st">"P3A1_e"</span>),</span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"18F1_CA"</span>),</span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"18F1_MG"</span>),</span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"18F1_NA"</span>),</span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"18F1_K"</span>, <span class="st">"18F2"</span>, <span class="st">"18A1mod"</span>, <span class="st">"18_NR"</span>, <span class="st">"18A1"</span>, <span class="st">"18A1_NR"</span>, <span class="st">"18B1"</span>, <span class="st">"18B2"</span>),</span>
<span id="cb156-39"><a href="#cb156-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"3_C_B"</span>, <span class="st">"3_NR"</span>, <span class="st">"3A_TSS"</span>),</span>
<span id="cb156-40"><a href="#cb156-40" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"3A_C_2.5"</span>, <span class="st">"3A1"</span>)</span>
<span id="cb156-41"><a href="#cb156-41" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb156-42"><a href="#cb156-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(lab.tbl) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"oc"</span>, <span class="st">"ocP"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb156-43"><a href="#cb156-43" aria-hidden="true" tabindex="-1"></a>  val.lst <span class="ot">=</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lab.tbl), <span class="cf">function</span>(i){</span>
<span id="cb156-44"><a href="#cb156-44" aria-hidden="true" tabindex="-1"></a>       x <span class="ot">&lt;-</span> cmdb<span class="sc">$</span>LAB_RESULTS[cmdb<span class="sc">$</span>LAB_RESULTS<span class="sc">$</span>labm.code <span class="sc">%in%</span> lab.tbl[[i]], <span class="fu">c</span>(<span class="st">"agency.code"</span>, <span class="st">"proj.code"</span>, <span class="st">"labm.code"</span>, <span class="st">"s.id"</span>, <span class="st">"o.id"</span>, <span class="st">"h.no"</span>, <span class="st">"labr.value"</span>)]; </span>
<span id="cb156-45"><a href="#cb156-45" aria-hidden="true" tabindex="-1"></a>       <span class="fu">names</span>(x)[<span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="fu">names</span>(lab.tbl)[i]; <span class="fu">return</span>(x) })</span>
<span id="cb156-46"><a href="#cb156-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(val.lst) <span class="ot">=</span> <span class="fu">names</span>(lab.tbl)</span>
<span id="cb156-47"><a href="#cb156-47" aria-hidden="true" tabindex="-1"></a>  val.lst<span class="sc">$</span>oc<span class="sc">$</span>oc <span class="ot">=</span> val.lst<span class="sc">$</span>oc<span class="sc">$</span>oc <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb156-48"><a href="#cb156-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="fu">as.factor</span>(val.lst<span class="sc">$</span>oc<span class="sc">$</span>labm.code))</span>
<span id="cb156-49"><a href="#cb156-49" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 6_DC    6A1 6A1_UC    6B1    6B2   6B2b    6B3     6Z </span></span>
<span id="cb156-50"><a href="#cb156-50" aria-hidden="true" tabindex="-1"></a>  <span class="do">##  403  15403   8094    119   5447      4   5735   1899 </span></span>
<span id="cb156-51"><a href="#cb156-51" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 6_DC = Organic carbon (%) - Dry combustion</span></span>
<span id="cb156-52"><a href="#cb156-52" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 6A1_UC = Organic carbon (%) - Uncorrected Walkley and Black method</span></span>
<span id="cb156-53"><a href="#cb156-53" aria-hidden="true" tabindex="-1"></a>  val.lst<span class="sc">$</span>oc<span class="sc">$</span>oc[val.lst<span class="sc">$</span>oc<span class="sc">$</span>labm.code <span class="sc">==</span> <span class="st">"6A1_UC"</span>] <span class="ot">=</span> val.lst<span class="sc">$</span>oc<span class="sc">$</span>oc[val.lst<span class="sc">$</span>oc<span class="sc">$</span>labm.code <span class="sc">==</span> <span class="st">"6A1_UC"</span>] <span class="sc">*</span> <span class="fl">1.3</span></span>
<span id="cb156-54"><a href="#cb156-54" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(val.lst$oc$oc)</span></span>
<span id="cb156-55"><a href="#cb156-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(val.lst, max.level = 1)</span></span>
<span id="cb156-56"><a href="#cb156-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(val.lst)){ val.lst[[i]]<span class="sc">$</span>h.id <span class="ot">&lt;-</span> <span class="fu">paste</span>(val.lst[[i]]<span class="sc">$</span>agency.code, val.lst[[i]]<span class="sc">$</span>proj.code, val.lst[[i]]<span class="sc">$</span>s.id, val.lst[[i]]<span class="sc">$</span>o.id, val.lst[[i]]<span class="sc">$</span>h.no, <span class="at">sep=</span><span class="st">"_"</span>) }</span>
<span id="cb156-57"><a href="#cb156-57" aria-hidden="true" tabindex="-1"></a>  au.hor <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">join_all</span>(<span class="fu">lapply</span>(val.lst, <span class="cf">function</span>(x){x[,<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>]}), <span class="at">match=</span><span class="st">"first"</span>)</span>
<span id="cb156-58"><a href="#cb156-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(as.factor(au.hor$h.id))</span></span>
<span id="cb156-59"><a href="#cb156-59" aria-hidden="true" tabindex="-1"></a>  cmdb<span class="sc">$</span>HORIZONS<span class="sc">$</span>h.id <span class="ot">=</span> <span class="fu">paste</span>(cmdb<span class="sc">$</span>HORIZONS<span class="sc">$</span>agency.code, cmdb<span class="sc">$</span>HORIZONS<span class="sc">$</span>proj.code, cmdb<span class="sc">$</span>HORIZONS<span class="sc">$</span>s.id, cmdb<span class="sc">$</span>HORIZONS<span class="sc">$</span>o.id, cmdb<span class="sc">$</span>HORIZONS<span class="sc">$</span>h.no, <span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb156-60"><a href="#cb156-60" aria-hidden="true" tabindex="-1"></a>  cmdb<span class="sc">$</span>HORIZONS<span class="sc">$</span>hzn_desgn <span class="ot">=</span> <span class="fu">paste</span>(cmdb<span class="sc">$</span>HORIZONS<span class="sc">$</span>h.desig.master, cmdb<span class="sc">$</span>HORIZONS<span class="sc">$</span>h.desig.subdiv, cmdb<span class="sc">$</span>HORIZONS<span class="sc">$</span>h.desig.suffix, <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb156-61"><a href="#cb156-61" aria-hidden="true" tabindex="-1"></a>  au.horT <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">join_all</span>(<span class="fu">list</span>(cmdb<span class="sc">$</span>HORIZONS[,<span class="fu">c</span>(<span class="st">"h.id"</span>,<span class="st">"s.id"</span>,<span class="st">"h.no"</span>,<span class="st">"h.texture"</span>,<span class="st">"hzn_desgn"</span>,<span class="st">"h.upper.depth"</span>,<span class="st">"h.lower.depth"</span>)], au.hor, au.xy))</span>
<span id="cb156-62"><a href="#cb156-62" aria-hidden="true" tabindex="-1"></a>  au.horT<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(au.horT<span class="sc">$</span>o.date.desc, <span class="at">format=</span><span class="st">"%d%m%Y"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb156-63"><a href="#cb156-63" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.Date(au.horT$site_obsdate))</span></span>
<span id="cb156-64"><a href="#cb156-64" aria-hidden="true" tabindex="-1"></a>  au.horT<span class="sc">$</span>sand_tot_psa <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(au.horT<span class="sc">$</span>sand_tot_psa), <span class="dv">100</span><span class="sc">-</span>(au.horT<span class="sc">$</span>clay_tot_psa <span class="sc">+</span> au.horT<span class="sc">$</span>silt_tot_psa), au.horT<span class="sc">$</span>sand_tot_psa)</span>
<span id="cb156-65"><a href="#cb156-65" aria-hidden="true" tabindex="-1"></a>  au.horT<span class="sc">$</span>hzn_top <span class="ot">=</span> au.horT<span class="sc">$</span>h.upper.depth<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb156-66"><a href="#cb156-66" aria-hidden="true" tabindex="-1"></a>  au.horT<span class="sc">$</span>hzn_bot <span class="ot">=</span> au.horT<span class="sc">$</span>h.lower.depth<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb156-67"><a href="#cb156-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(au.horT$oc)</span></span>
<span id="cb156-68"><a href="#cb156-68" aria-hidden="true" tabindex="-1"></a>  au.horT<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(au.horT<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> au.horT<span class="sc">$</span>db_od <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(au.horT<span class="sc">$</span>wpg2), <span class="dv">0</span>, au.horT<span class="sc">$</span>wpg2))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb156-69"><a href="#cb156-69" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(au.horT$oc_d)</span></span>
<span id="cb156-70"><a href="#cb156-70" aria-hidden="true" tabindex="-1"></a>  au.cols.n <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"s.id"</span>, <span class="st">"o.location.notes"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"coords.x1"</span>, <span class="st">"coords.x2"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"h.id"</span>, <span class="st">"layer_key"</span>, <span class="st">"h.no"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"h.texture"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb156-71"><a href="#cb156-71" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> au.cols.n[<span class="fu">which</span>(<span class="sc">!</span>au.cols.n <span class="sc">%in%</span> <span class="fu">names</span>(au.horT))]</span>
<span id="cb156-72"><a href="#cb156-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ au.horT[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb156-73"><a href="#cb156-73" aria-hidden="true" tabindex="-1"></a>  chemsprops.NatSoil <span class="ot">=</span> au.horT[,au.cols.n]</span>
<span id="cb156-74"><a href="#cb156-74" aria-hidden="true" tabindex="-1"></a>  chemsprops.NatSoil<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"CSIRO_NatSoil"</span></span>
<span id="cb156-75"><a href="#cb156-75" aria-hidden="true" tabindex="-1"></a>  chemsprops.NatSoil<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb156-76"><a href="#cb156-76" aria-hidden="true" tabindex="-1"></a>  chemsprops.NatSoil<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://www.csiro.au/en/Do-business/Services/Enviro/Soil-archive"</span></span>
<span id="cb156-77"><a href="#cb156-77" aria-hidden="true" tabindex="-1"></a>  chemsprops.NatSoil<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.25919/5eeb2a56eac12"</span></span>
<span id="cb156-78"><a href="#cb156-78" aria-hidden="true" tabindex="-1"></a>  chemsprops.NatSoil <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.NatSoil, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"db_od"</span>,<span class="st">"clay_tot_psa"</span>,<span class="st">"ph_h2o"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"coords.x1"</span>, <span class="st">"coords.x2"</span>))</span>
<span id="cb156-79"><a href="#cb156-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.NatSoil, <span class="st">"/mnt/diskstation/data/Soil_points/Australia/CSIRO/chemsprops.NatSoil.rds"</span>)</span>
<span id="cb156-80"><a href="#cb156-80" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Hmisc'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:plyr':

    is.discrete, summarize</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:terra':

    describe, mask, units, zoom</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    src, summarize</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    format.pval, units</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>14 variables; Processing variable:1 2 3 4 5 6 7 8 9 10 11 12 13 14 
11 variables; Processing variable:1 2 3 4 5 6 7 8 9 10 11 
27 variables; Processing variable:1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 
14 variables; Processing variable:1 2 3 4 5 6 7 8 9 10 11 12 13 14 
17 variables; Processing variable:1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 
114 variables; Processing variable:1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 
11 variables; Processing variable:1 2 3 4 5 6 7 8 9 10 11 
12 variables; Processing variable:1 2 3 4 5 6 7 8 9 10 11 12 
43 variables; Processing variable:1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 
11 variables; Processing variable:1 2 3 4 5 6 7 8 9 10 11 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: h.id</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id
Joining by: h.id</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: s.id</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.NatSoil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 89754    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 89754    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="namsoter" class="level4">
<h4 class="anchored" data-anchor-id="namsoter">NAMSOTER</h4>
<ul>
<li>Coetzee, M. E. (2001). <a href="https://edepot.wur.nl/485173">NAMSOTER, a SOTER database for Namibia</a>. Agroecological Zoning, 458.</li>
<li>Coetzee, M. E. (2009). Chemical characterisation of the soils of East Central Namibia (Doctoral dissertation, Stellenbosch: University of Stellenbosch).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.NAMSOTER"</span>)){</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  nam.profs <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Namibia/NAMSOTER/Namibia_all_profiles.csv"</span>, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"-9999"</span>, <span class="st">"999"</span>, <span class="st">"9999"</span>, <span class="st">"NA"</span>))</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nam.sm = summary(as.factor(nam.profs$CLAF))</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nam.tax = as.data.frame(nam.sm)</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nam.tax$levels = attr(nam.sm, "names")</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write.csv(nam.tax, "/mnt/diskstation/data/Soil_points/Namibia/NAMSOTER/namsoter_taxon_wrb.csv")</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>  st.cor <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'./correlation/soil_type_correlation_ISRIC_WISE.csv'</span>)</span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>  st.cor<span class="sc">$</span>FAO_90_ <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"SOLS"</span>, <span class="st">"SOL"</span>, <span class="fu">toupper</span>(st.cor<span class="sc">$</span>FAO_90<span class="fl">.1</span>))</span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>  nam.profs<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> <span class="fu">paste0</span>( dplyr<span class="sc">::</span><span class="fu">left_join</span>(nam.profs[<span class="st">"CLAF"</span>], st.cor, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"CLAF"</span><span class="ot">=</span><span class="st">"FAO_90_"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>Class_1, <span class="st">" / "</span>,</span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">left_join</span>(nam.profs[<span class="st">"CLAF"</span>], st.cor, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"CLAF"</span><span class="ot">=</span><span class="st">"FAO_90_"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>Class_2)</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(nam.profs$SSL_classification_name))</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>  nam.hors <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Namibia/NAMSOTER/Namibia_all_horizons.csv"</span>, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"-9999"</span>, <span class="st">"999"</span>, <span class="st">"9999"</span>, <span class="st">"NA"</span>))</span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(nam.hors$TOTN)</span></span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(nam.hors$TOTC)</span></span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>  nam.hors<span class="sc">$</span>hzn_top <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>  nam.hors<span class="sc">$</span>hzn_top <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(nam.hors<span class="sc">$</span>HONU<span class="sc">==</span><span class="dv">1</span>, <span class="dv">0</span>, nam.hors<span class="sc">$</span>hzn_top)</span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>  h.lst <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="cf">function</span>(x){<span class="fu">which</span>(nam.hors<span class="sc">$</span>HONU<span class="sc">==</span>x)})</span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>){</span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a>    sel <span class="ot">&lt;-</span> <span class="fu">match</span>(nam.hors<span class="sc">$</span>PRID[h.lst[[i]]], nam.hors<span class="sc">$</span>PRID[h.lst[[i<span class="dv">-1</span>]]])</span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a>    nam.hors<span class="sc">$</span>hzn_top[h.lst[[i]]] <span class="ot">&lt;-</span> nam.hors<span class="sc">$</span>HBDE[h.lst[[i<span class="dv">-1</span>]]][sel]</span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb169-22"><a href="#cb169-22" aria-hidden="true" tabindex="-1"></a>  nam.hors<span class="sc">$</span>HBDE <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(nam.hors<span class="sc">$</span>HBDE), nam.hors<span class="sc">$</span>hzn_top<span class="sc">+</span><span class="dv">50</span>, nam.hors<span class="sc">$</span>HBDE)</span>
<span id="cb169-23"><a href="#cb169-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(nam.hors$HBDE)</span></span>
<span id="cb169-24"><a href="#cb169-24" aria-hidden="true" tabindex="-1"></a>  namALL <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(nam.hors, nam.profs, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"PRID"</span>))</span>
<span id="cb169-25"><a href="#cb169-25" aria-hidden="true" tabindex="-1"></a>  namALL<span class="sc">$</span>k_ext <span class="ot">=</span> namALL<span class="sc">$</span>EXCK <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb169-26"><a href="#cb169-26" aria-hidden="true" tabindex="-1"></a>  namALL<span class="sc">$</span>ca_ext <span class="ot">=</span> namALL<span class="sc">$</span>EXCA <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb169-27"><a href="#cb169-27" aria-hidden="true" tabindex="-1"></a>  namALL<span class="sc">$</span>mg_ext <span class="ot">=</span> namALL<span class="sc">$</span>EXMG <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb169-28"><a href="#cb169-28" aria-hidden="true" tabindex="-1"></a>  namALL<span class="sc">$</span>na_ext <span class="ot">=</span> namALL<span class="sc">$</span>EXNA <span class="sc">*</span> <span class="dv">230</span></span>
<span id="cb169-29"><a href="#cb169-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(namALL$MINA)</span></span>
<span id="cb169-30"><a href="#cb169-30" aria-hidden="true" tabindex="-1"></a>  namALL<span class="sc">$</span>BULK <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(namALL<span class="sc">$</span>BULK<span class="sc">&gt;</span><span class="fl">2.4</span>, <span class="cn">NA</span>, namALL<span class="sc">$</span>BULK)</span>
<span id="cb169-31"><a href="#cb169-31" aria-hidden="true" tabindex="-1"></a>  namALL<span class="sc">$</span>wpg2 <span class="ot">=</span> <span class="fu">ifelse</span>(namALL<span class="sc">$</span>MINA<span class="sc">==</span><span class="st">"D"</span>, <span class="dv">80</span>, <span class="fu">ifelse</span>(namALL<span class="sc">$</span>MINA<span class="sc">==</span><span class="st">"A"</span>, <span class="dv">60</span>, <span class="fu">ifelse</span>(namALL<span class="sc">$</span>MINA<span class="sc">==</span><span class="st">"M"</span>, <span class="dv">25</span>, <span class="fu">ifelse</span>(namALL<span class="sc">$</span>MINA<span class="sc">==</span><span class="st">"C"</span>, <span class="dv">10</span>, <span class="fu">ifelse</span>(namALL<span class="sc">$</span>MINA<span class="sc">==</span><span class="st">"V"</span>, <span class="dv">1</span>, <span class="fu">ifelse</span>(namALL<span class="sc">$</span>MINA<span class="sc">==</span><span class="st">"F"</span>, <span class="fl">2.5</span>, <span class="fu">ifelse</span>(namALL<span class="sc">$</span>MINA<span class="sc">==</span><span class="st">"M/A"</span>, <span class="dv">40</span>, <span class="fu">ifelse</span>(namALL<span class="sc">$</span>MINA<span class="sc">==</span><span class="st">"C/M"</span>, <span class="dv">15</span>, <span class="dv">0</span>))))))))</span>
<span id="cb169-32"><a href="#cb169-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#hist(namALL$wpg2)</span></span>
<span id="cb169-33"><a href="#cb169-33" aria-hidden="true" tabindex="-1"></a>  <span class="do">## TOTC: Organic Carbon (Colourimetric Walkey-Black Method) (SOP Soil-125)</span></span>
<span id="cb169-34"><a href="#cb169-34" aria-hidden="true" tabindex="-1"></a>  namALL<span class="sc">$</span>oc <span class="ot">=</span> namALL<span class="sc">$</span>TOTC <span class="sc">*</span> <span class="fl">1.3</span></span>
<span id="cb169-35"><a href="#cb169-35" aria-hidden="true" tabindex="-1"></a>  namALL<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(namALL<span class="sc">$</span>oc <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> namALL<span class="sc">$</span>BULK <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(namALL<span class="sc">$</span>wpg2), <span class="dv">0</span>, namALL<span class="sc">$</span>wpg2))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb169-36"><a href="#cb169-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(namALL$oc_d)</span></span>
<span id="cb169-37"><a href="#cb169-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(namALL$PHAQ) ## Check - high ph! mean = 7.9</span></span>
<span id="cb169-38"><a href="#cb169-38" aria-hidden="true" tabindex="-1"></a>  namALL<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="dv">2000</span></span>
<span id="cb169-39"><a href="#cb169-39" aria-hidden="true" tabindex="-1"></a>  nam.col <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"PRID"</span>, <span class="st">"SLID"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"LONG"</span>, <span class="st">"LATI"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"HONU"</span>, <span class="st">"hzn_top"</span>, <span class="st">"HBDE"</span>, <span class="st">"HODE"</span>, <span class="st">"PSCL"</span>, <span class="st">"texture_lab"</span>, <span class="st">"CLPC"</span>, <span class="st">"STPC"</span>, <span class="st">"SDTO"</span>, <span class="st">"TOTC"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"TOTN"</span>, <span class="st">"PHKC"</span>, <span class="st">"PHAQ"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"CECS"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"BULK"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ELCO"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb169-40"><a href="#cb169-40" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> nam.col[<span class="fu">which</span>(<span class="sc">!</span>nam.col <span class="sc">%in%</span> <span class="fu">names</span>(namALL))]</span>
<span id="cb169-41"><a href="#cb169-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ namALL[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb169-42"><a href="#cb169-42" aria-hidden="true" tabindex="-1"></a>  chemsprops.NAMSOTER <span class="ot">=</span> namALL[,nam.col]</span>
<span id="cb169-43"><a href="#cb169-43" aria-hidden="true" tabindex="-1"></a>  chemsprops.NAMSOTER<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"NAMSOTER"</span></span>
<span id="cb169-44"><a href="#cb169-44" aria-hidden="true" tabindex="-1"></a>  chemsprops.NAMSOTER<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb169-45"><a href="#cb169-45" aria-hidden="true" tabindex="-1"></a>  chemsprops.NAMSOTER<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">""</span></span>
<span id="cb169-46"><a href="#cb169-46" aria-hidden="true" tabindex="-1"></a>  chemsprops.NAMSOTER<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://edepot.wur.nl/485173"</span></span>
<span id="cb169-47"><a href="#cb169-47" aria-hidden="true" tabindex="-1"></a>  chemsprops.NAMSOTER <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.NAMSOTER, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"TOTC"</span>,<span class="st">"CLPC"</span>,<span class="st">"PHAQ"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONG"</span>, <span class="st">"LATI"</span>))</span>
<span id="cb169-48"><a href="#cb169-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.NAMSOTER, <span class="st">"/mnt/diskstation/data/Soil_points/Namibia/chemsprops.NAMSOTER.rds"</span>)</span>
<span id="cb169-49"><a href="#cb169-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb169-50"><a href="#cb169-50" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.NAMSOTER)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2955   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2955   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="worldwide-organic-soil-carbon-and-nitrogen-data" class="level4">
<h4 class="anchored" data-anchor-id="worldwide-organic-soil-carbon-and-nitrogen-data">Worldwide organic soil carbon and nitrogen data</h4>
<ul>
<li><p>Zinke, P. J., Millemann, R. E., &amp; Boden, T. A. (1986). <a href="https://cdiac.ess-dive.lbl.gov/ftp/ndp018/ndp018.pdf">Worldwide organic soil carbon and nitrogen data</a>. Carbon Dioxide Information Center, Environmental Sciences Division, Oak Ridge National Laboratory. Data download URL: <a href="https://dx.doi.org/10.3334/CDIAC/lue.ndp018" class="uri">https://dx.doi.org/10.3334/CDIAC/lue.ndp018</a></p></li>
<li><p>Note: poor spatial location accuracy i.e.&nbsp;&lt;10 km. Bulk density for many points has been estimated not measured. Sampling year has not been but literature indicates: 1965, 1974, 1976, 1978, 1979, 1984. Most of samples come from natural vegetation (undisturbed) areas.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.ISCND"</span>)){</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  ndp.profs <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/ISCND/ndp018.csv"</span>, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"-9999"</span>, <span class="st">"?"</span>, <span class="st">"NA"</span>), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ndp.profs) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"PROFILE"</span>, <span class="st">"CODE"</span>, <span class="st">"CARBON"</span>, <span class="st">"NITROGEN"</span>, <span class="st">"LAT"</span>, <span class="st">"LONG"</span>, <span class="st">"ELEV"</span>, <span class="st">"SOURCE"</span>, <span class="st">"HOLDRIGE"</span>, <span class="st">"OLSON"</span>, <span class="st">"PARENT"</span>)</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"CARBON"</span>,<span class="st">"NITROGEN"</span>,<span class="st">"ELEV"</span>)){  ndp.profs[,j] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ndp.profs[,j])   }</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(ndp.profs$CARBON)</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>  lat.s  <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"S"</span>, ndp.profs<span class="sc">$</span>LAT) <span class="co"># lat.n &lt;- grep("N", ndp.profs$LAT)</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>  ndp.profs<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9.-]"</span>, <span class="st">""</span>, ndp.profs<span class="sc">$</span>LAT))</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>  ndp.profs<span class="sc">$</span>latitude_decimal_degrees[lat.s] <span class="ot">=</span> ndp.profs<span class="sc">$</span>latitude_decimal_degrees[lat.s] <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>  lon.w <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"W"</span>, ndp.profs<span class="sc">$</span>LONG) <span class="co"># lon.e  &lt;- grep("E", ndp.profs$LONG, fixed = TRUE)</span></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>  ndp.profs<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9.-]"</span>, <span class="st">""</span>, ndp.profs<span class="sc">$</span>LONG))</span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>  ndp.profs<span class="sc">$</span>longitude_decimal_degrees[lon.w] <span class="ot">=</span> ndp.profs<span class="sc">$</span>longitude_decimal_degrees[lon.w] <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(ndp.profs[,c("longitude_decimal_degrees", "latitude_decimal_degrees")])</span></span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>  ndp.profs<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="dv">0</span>; ndp.profs<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Sampling years from the doc: 1965, 1974, 1976, 1978, 1979, 1984 </span></span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a>  ndp.profs<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="st">"1982"</span></span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a>  ndp.col <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"PROFILE"</span>, <span class="st">"CODE"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"CARBON"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> ndp.col[<span class="fu">which</span>(<span class="sc">!</span>ndp.col <span class="sc">%in%</span> <span class="fu">names</span>(ndp.profs))]</span>
<span id="cb172-18"><a href="#cb172-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ ndp.profs[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb172-19"><a href="#cb172-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCND <span class="ot">=</span> ndp.profs[,ndp.col]</span>
<span id="cb172-20"><a href="#cb172-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCND<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"ISCND"</span></span>
<span id="cb172-21"><a href="#cb172-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCND<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb172-22"><a href="#cb172-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCND<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://iscn.fluxdata.org/data/"</span></span>
<span id="cb172-23"><a href="#cb172-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCND<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://dx.doi.org/10.3334/CDIAC/lue.ndp018"</span></span>
<span id="cb172-24"><a href="#cb172-24" aria-hidden="true" tabindex="-1"></a>  chemsprops.ISCND <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.ISCND, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"CARBON"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>))  </span>
<span id="cb172-25"><a href="#cb172-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.ISCND, <span class="st">"/mnt/diskstation/data/Soil_points/INT/ISCND/chemsprops.ISCND.rds"</span>)</span>
<span id="cb172-26"><a href="#cb172-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.ISCND)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4114   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4114   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="interior-alaska-carbon-and-nitrogen-stocks" class="level4">
<h4 class="anchored" data-anchor-id="interior-alaska-carbon-and-nitrogen-stocks">Interior Alaska Carbon and Nitrogen stocks</h4>
<ul>
<li>Manies, K., Waldrop, M., and Harden, J. (2020): Generalized models to estimate carbon and nitrogen stocks of organic soil horizons in Interior Alaska, Earth Syst. Sci. Data, 12, 1745–1757, <a href="https://doi.org/10.5194/essd-12-1745-2020" class="uri">https://doi.org/10.5194/essd-12-1745-2020</a>, Data download URL: <a href="https://doi.org/10.5066/P960N1F9" class="uri">https://doi.org/10.5066/P960N1F9</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.Alaska"</span>)){</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  al.gps <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/USA/Alaska_Interior/Site_GPS_coordinates_v1-1.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Different datums!</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(al.gps$Datum))</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>  al.gps1 <span class="ot">=</span> al.gps[al.gps<span class="sc">$</span>Datum<span class="sc">==</span><span class="st">"NAD83"</span>,]</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coordinates</span>(al.gps1) <span class="ot">=</span> <span class="er">~</span> Longitude <span class="sc">+</span> Latitude</span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proj4string</span>(al.gps1) <span class="ot">=</span> <span class="st">"+proj=longlat +datum=NAD83"</span></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>  al.gps0 <span class="ot">=</span> <span class="fu">spTransform</span>(al.gps1, <span class="fu">CRS</span>(<span class="st">"+proj=longlat +datum=WGS84"</span>))</span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a>  al.gps[<span class="fu">which</span>(al.gps<span class="sc">$</span>Datum<span class="sc">==</span><span class="st">"NAD83"</span>),<span class="st">"Longitude"</span>] <span class="ot">=</span> al.gps0<span class="sc">@</span>coords[,<span class="dv">1</span>]</span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>  al.gps[<span class="fu">which</span>(al.gps<span class="sc">$</span>Datum<span class="sc">==</span><span class="st">"NAD83"</span>),<span class="st">"Latitude"</span>] <span class="ot">=</span> al.gps0<span class="sc">@</span>coords[,<span class="dv">2</span>]</span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a>  al.gps<span class="sc">$</span>site <span class="ot">=</span> al.gps<span class="sc">$</span>Site</span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a>  al.hor <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/USA/Alaska_Interior/Generalized_models_for_CandN_Alaska_v1-1.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a>  al.hor<span class="sc">$</span>hzn_top <span class="ot">=</span> al.hor<span class="sc">$</span>depth <span class="sc">-</span> <span class="fu">as.numeric</span>(al.hor<span class="sc">$</span>thickness)</span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a>  al.hor<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(al.hor<span class="sc">$</span>date, <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## "We analyzed soil samples for total C and N using a Carlo Erba NA1500 elemental analyzer (Fisons Instruments). </span></span>
<span id="cb177-16"><a href="#cb177-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Samples were combusted in the presence of excess oxygen."</span></span>
<span id="cb177-17"><a href="#cb177-17" aria-hidden="true" tabindex="-1"></a>  al.hor<span class="sc">$</span>oc <span class="ot">=</span> <span class="fu">as.numeric</span>(al.hor<span class="sc">$</span>carbon) <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb177-18"><a href="#cb177-18" aria-hidden="true" tabindex="-1"></a>  al.hor<span class="sc">$</span>n_tot <span class="ot">=</span> <span class="fu">as.numeric</span>(al.hor<span class="sc">$</span>nitrogen) <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb177-19"><a href="#cb177-19" aria-hidden="true" tabindex="-1"></a>  al.hor<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">as.numeric</span>(al.hor<span class="sc">$</span>Cdensity) <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb177-20"><a href="#cb177-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(al.hor$oc_d)</span></span>
<span id="cb177-21"><a href="#cb177-21" aria-hidden="true" tabindex="-1"></a>  al.horA <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(al.hor, al.gps, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"site"</span>))</span>
<span id="cb177-22"><a href="#cb177-22" aria-hidden="true" tabindex="-1"></a>  al.col <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"profile"</span>, <span class="st">"description"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"sampleID"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"depth"</span>, <span class="st">"Hcode"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"BDfine"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb177-23"><a href="#cb177-23" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> al.col[<span class="fu">which</span>(<span class="sc">!</span>al.col <span class="sc">%in%</span> <span class="fu">names</span>(al.horA))]</span>
<span id="cb177-24"><a href="#cb177-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ al.horA[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb177-25"><a href="#cb177-25" aria-hidden="true" tabindex="-1"></a>  chemsprops.Alaska <span class="ot">=</span> al.horA[,al.col]</span>
<span id="cb177-26"><a href="#cb177-26" aria-hidden="true" tabindex="-1"></a>  chemsprops.Alaska<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Alaska_interior"</span></span>
<span id="cb177-27"><a href="#cb177-27" aria-hidden="true" tabindex="-1"></a>  chemsprops.Alaska<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb177-28"><a href="#cb177-28" aria-hidden="true" tabindex="-1"></a>  chemsprops.Alaska<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://www.usgs.gov/centers/gmeg"</span></span>
<span id="cb177-29"><a href="#cb177-29" aria-hidden="true" tabindex="-1"></a>  chemsprops.Alaska<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.5194/essd-12-1745-2020"</span></span>
<span id="cb177-30"><a href="#cb177-30" aria-hidden="true" tabindex="-1"></a>  chemsprops.Alaska <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.Alaska, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"oc_d"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>))</span>
<span id="cb177-31"><a href="#cb177-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># openair::scatterPlot(chemsprops.Alaska, x = "oc", y = "oc_d",</span></span>
<span id="cb177-32"><a href="#cb177-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    method = "hexbin", col = "increment",</span></span>
<span id="cb177-33"><a href="#cb177-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    log.x = TRUE, log.y = TRUE,</span></span>
<span id="cb177-34"><a href="#cb177-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                    xlab="SOC [g/kg]", ylab="SOC [kg/m3]")</span></span>
<span id="cb177-35"><a href="#cb177-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.Alaska, <span class="st">"/mnt/diskstation/data/Soil_points/USA/Alaska_Interior/chemsprops.Alaska.rds"</span>)</span>
<span id="cb177-36"><a href="#cb177-36" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.Alaska)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4013   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4013   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/fig_histogram_soc_Alaska.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption>Relationship between SOC [kg/m3] and SOC [g/kg] for the Alaska data set.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="croatian-soil-pedon-data" class="level4">
<h4 class="anchored" data-anchor-id="croatian-soil-pedon-data">Croatian Soil Pedon data</h4>
<ul>
<li>Martinović J., (2000) <a href="https://books.google.nl/books?id=k_a2MgAACAAJ">“Tla u Hrvatskoj”</a>, Monografija, Državna uprava za zaštitu prirode i okoliša, str. 269, Zagreb. ISBN: 9536793059</li>
<li>Bašić F., (2014) <a href="https://books.google.nl/books?id=VbJEAAAAQBAJ">“The Soils of Croatia”</a>. World Soils Book Series, Springer Science &amp; Business Media, 179 pp.&nbsp;ISBN: 9400758154</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.bpht"</span>)){</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  bpht.site <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Croatia/WBSoilHR_sites_1997.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  bpht.hors <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Croatia/WBSoilHR_1997.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## filter typos</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"GOR"</span>, <span class="st">"DON"</span>, <span class="st">"MKP"</span>, <span class="st">"PH1"</span>, <span class="st">"PH2"</span>, <span class="st">"MSP"</span>, <span class="st">"MP"</span>, <span class="st">"MG"</span>, <span class="st">"HUM"</span>, <span class="st">"EXTN"</span>, <span class="st">"EXTP"</span>, <span class="st">"EXTK"</span>, <span class="st">"CAR"</span>)){</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>    bpht.hors[,j] <span class="ot">=</span> <span class="fu">as.numeric</span>(bpht.hors[,j])</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Convert to the USDA standard</span></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>  bpht.hors<span class="sc">$</span>sand_tot_psa <span class="ot">&lt;-</span> bpht.hors<span class="sc">$</span>MSP <span class="sc">*</span> <span class="fl">0.8</span> <span class="sc">+</span> bpht.hors<span class="sc">$</span>MKP</span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>  bpht.hors<span class="sc">$</span>silt_tot_psa <span class="ot">&lt;-</span> bpht.hors<span class="sc">$</span>MP <span class="sc">+</span> bpht.hors<span class="sc">$</span>MSP <span class="sc">*</span> <span class="fl">0.2</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## A critical review of the conventional SOC to SOM conversion factor</span></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## https://doi.org/10.1016/j.geoderma.2010.02.003</span></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>  bpht.hors<span class="sc">$</span>oc <span class="ot">&lt;-</span> <span class="fu">signif</span>(bpht.hors<span class="sc">$</span>HUM<span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> <span class="fl">1.3</span> <span class="sc">*</span> <span class="dv">10</span>, <span class="dv">3</span>)</span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## summary(bpht.hors$sand_tot_psa)</span></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>  bpht.s.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"UZORAK"</span>, <span class="st">"Cro16.30_X"</span>, <span class="st">"Cro16.30_Y"</span>, <span class="st">"FITOC"</span>, <span class="st">"STIJENA"</span>, <span class="st">"HID_DREN"</span>, <span class="st">"DUBINA"</span>)</span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a>  bpht.hor <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(bpht.site[,bpht.s.lst], bpht.hors)</span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>  bpht.hor<span class="sc">$</span>wpg2 <span class="ot">=</span> bpht.hor<span class="sc">$</span>STIJENA</span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>  bpht.hor<span class="sc">$</span>DON <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(bpht.hor<span class="sc">$</span>DON), bpht.hor<span class="sc">$</span>GOR<span class="sc">+</span><span class="dv">50</span>, bpht.hor<span class="sc">$</span>DON)</span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a>  bpht.hor<span class="sc">$</span>depth <span class="ot">&lt;-</span> bpht.hor<span class="sc">$</span>GOR <span class="sc">+</span> (bpht.hor<span class="sc">$</span>DON <span class="sc">-</span> bpht.hor<span class="sc">$</span>GOR)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>  bpht.hor <span class="ot">=</span> bpht.hor[<span class="sc">!</span><span class="fu">is.na</span>(bpht.hor<span class="sc">$</span>depth),]</span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a>  bpht.hor<span class="sc">$</span>wpg2[<span class="fu">which</span>(bpht.hor<span class="sc">$</span>GOR<span class="sc">&lt;</span><span class="dv">30</span>)] <span class="ot">&lt;-</span> bpht.hor<span class="sc">$</span>wpg2[<span class="fu">which</span>(bpht.hor<span class="sc">$</span>GOR<span class="sc">&lt;</span><span class="dv">30</span>)]<span class="sc">*</span>.<span class="dv">3</span></span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a>  bpht.hor<span class="sc">$</span>sample_key <span class="ot">=</span> <span class="fu">make.unique</span>(<span class="fu">paste</span>(bpht.hor<span class="sc">$</span>PEDOL_ID, bpht.hor<span class="sc">$</span>OZN, <span class="at">sep=</span><span class="st">"_"</span>))</span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a>  bpht.hor<span class="sc">$</span>sand_tot_psa[bpht.hor<span class="sc">$</span>sample_key<span class="sc">==</span><span class="st">"805_Amo"</span>] <span class="ot">&lt;-</span> bpht.hor<span class="sc">$</span>sand_tot_psa[bpht.hor<span class="sc">$</span>sample_key<span class="sc">==</span><span class="st">"805_Amo"</span>]<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## convert N, P, K</span></span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(bpht.hor$EXTK) -- measurements units?</span></span>
<span id="cb182-26"><a href="#cb182-26" aria-hidden="true" tabindex="-1"></a>  bpht.hor<span class="sc">$</span>p_ext <span class="ot">=</span> bpht.hor<span class="sc">$</span>EXTP <span class="sc">*</span> <span class="fl">4.364</span></span>
<span id="cb182-27"><a href="#cb182-27" aria-hidden="true" tabindex="-1"></a>  bpht.hor<span class="sc">$</span>k_ext <span class="ot">=</span> bpht.hor<span class="sc">$</span>EXTK <span class="sc">*</span> <span class="fl">8.3013</span></span>
<span id="cb182-28"><a href="#cb182-28" aria-hidden="true" tabindex="-1"></a>  bpht.hor <span class="ot">=</span> bpht.hor[<span class="sc">!</span><span class="fu">is.na</span>(bpht.hor<span class="sc">$</span><span class="st">`</span><span class="at">Cro16.30_X</span><span class="st">`</span>),]</span>
<span id="cb182-29"><a href="#cb182-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## coordinates:</span></span>
<span id="cb182-30"><a href="#cb182-30" aria-hidden="true" tabindex="-1"></a>  bpht.pnts <span class="ot">=</span> <span class="fu">SpatialPointsDataFrame</span>(bpht.hor[,<span class="fu">c</span>(<span class="st">"Cro16.30_X"</span>,<span class="st">"Cro16.30_Y"</span>)], bpht.hor[<span class="st">"site_key"</span>], <span class="at">proj4string =</span> <span class="fu">CRS</span>(<span class="st">"+proj=tmerc +lat_0=0 +lon_0=16.5 +k=0.9999 +x_0=2500000 +y_0=0 +ellps=bessel +towgs84=550.499,164.116,475.142,5.80967,2.07902,-11.62386,0.99999445824 +units=m"</span>))</span>
<span id="cb182-31"><a href="#cb182-31" aria-hidden="true" tabindex="-1"></a>  bpht.pnts.ll <span class="ot">&lt;-</span> <span class="fu">spTransform</span>(bpht.pnts, <span class="fu">CRS</span>(<span class="st">"+proj=longlat +datum=WGS84"</span>))</span>
<span id="cb182-32"><a href="#cb182-32" aria-hidden="true" tabindex="-1"></a>  bpht.hor<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> bpht.pnts.ll<span class="sc">@</span>coords[,<span class="dv">1</span>]</span>
<span id="cb182-33"><a href="#cb182-33" aria-hidden="true" tabindex="-1"></a>  bpht.hor<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> bpht.pnts.ll<span class="sc">@</span>coords[,<span class="dv">2</span>] </span>
<span id="cb182-34"><a href="#cb182-34" aria-hidden="true" tabindex="-1"></a>  bpht.h.lst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'site_key'</span>, <span class="st">'OZ_LIST_PROF'</span>, <span class="st">'UZORAK'</span>, <span class="st">'longitude_decimal_degrees'</span>, <span class="st">'latitude_decimal_degrees'</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">'labsampnum'</span>, <span class="st">"layer_key"</span>, <span class="st">'layer_sequence'</span>, <span class="st">'GOR'</span>, <span class="st">'DON'</span>, <span class="st">'OZN'</span>, <span class="st">'TT'</span>, <span class="st">"texture_lab"</span>, <span class="st">'MG'</span>, <span class="st">'silt_tot_psa'</span>, <span class="st">'sand_tot_psa'</span>, <span class="st">'oc'</span>, <span class="st">'oc_d'</span>, <span class="st">'c_tot'</span>, <span class="st">'EXTN'</span>, <span class="st">'PH2'</span>, <span class="st">'PH1'</span>, <span class="st">'ph_cacl2'</span>, <span class="st">'cec_sum'</span>, <span class="st">'cec_nh4'</span>, <span class="st">'ecec'</span>, <span class="st">'wpg2'</span>, <span class="st">'db_od'</span>, <span class="st">'ca_ext'</span>, <span class="st">'mg_ext'</span>, <span class="st">'na_ext'</span>, <span class="st">'k_ext'</span>, <span class="st">'ec_satp'</span>, <span class="st">'ec_12pre'</span>)</span>
<span id="cb182-35"><a href="#cb182-35" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> bpht.h.lst[<span class="fu">which</span>(<span class="sc">!</span>bpht.h.lst <span class="sc">%in%</span> <span class="fu">names</span>(bpht.hor))]</span>
<span id="cb182-36"><a href="#cb182-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ bpht.hor[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb182-37"><a href="#cb182-37" aria-hidden="true" tabindex="-1"></a>  chemsprops.bpht <span class="ot">=</span> bpht.hor[,bpht.h.lst]</span>
<span id="cb182-38"><a href="#cb182-38" aria-hidden="true" tabindex="-1"></a>  chemsprops.bpht<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Croatian_Soil_Pedon"</span></span>
<span id="cb182-39"><a href="#cb182-39" aria-hidden="true" tabindex="-1"></a>  chemsprops.bpht<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb182-40"><a href="#cb182-40" aria-hidden="true" tabindex="-1"></a>  chemsprops.bpht<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://www.haop.hr/"</span></span>
<span id="cb182-41"><a href="#cb182-41" aria-hidden="true" tabindex="-1"></a>  chemsprops.bpht<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://books.google.nl/books?id=k_a2MgAACAAJ"</span></span>
<span id="cb182-42"><a href="#cb182-42" aria-hidden="true" tabindex="-1"></a>  chemsprops.bpht <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.bpht, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>,<span class="st">"MG"</span>,<span class="st">"PH1"</span>,<span class="st">"k_ext"</span>))</span>
<span id="cb182-43"><a href="#cb182-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.bpht, <span class="st">"/mnt/diskstation/data/Soil_points/Croatia/chemsprops.bpht.rds"</span>)</span>
<span id="cb182-44"><a href="#cb182-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: site_key</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.bpht)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5757   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 5757   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remnant-native-soc-database" class="level4">
<h4 class="anchored" data-anchor-id="remnant-native-soc-database">Remnant native SOC database</h4>
<ul>
<li>Sanderman, J., (2017) “Remnant native SOC database”, Soil carbon profile data from paired land use comparisons, <a href="https://doi.org/10.7910/DVN/QQQM8V/8MSBNI" class="uri">https://doi.org/10.7910/DVN/QQQM8V/8MSBNI</a>, Harvard Dataverse, V1<br>
</li>
<li>Sanderman, J., Hengl, T., &amp; Fiske, G. J. (2017). Soil carbon debt of 12,000 years of human land use. Proceedings of the National Academy of Sciences, 114(36), 9575-9580. <a href="https://doi.org/10.1073/pnas.1706103114" class="uri">https://doi.org/10.1073/pnas.1706103114</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.RemnantSOC"</span>)){</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  rem.hor <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/WHRC_remnant_SOC/remnant+native+SOC+database+for+release.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">3</span>)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  rem.site <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/WHRC_remnant_SOC/remnant+native+SOC+database+for+release.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>  rem.ref <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/WHRC_remnant_SOC/remnant+native+SOC+database+for+release.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">4</span>)</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>  rem.site <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(rem.site, rem.ref[,<span class="fu">c</span>(<span class="st">"Source.No."</span>,<span class="st">"DOI"</span>,<span class="st">"Sample_year"</span>)], <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Source.No."</span>))</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>  rem.site<span class="sc">$</span>Site <span class="ot">=</span> rem.site<span class="sc">$</span>Site.ID</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>  rem.horA <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(rem.hor, rem.site, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Site"</span>))</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>  rem.horA<span class="sc">$</span>hzn_top <span class="ot">=</span> rem.horA<span class="sc">$</span><span class="st">'U_depth.(m)'</span><span class="sc">*</span><span class="dv">100</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>  rem.horA<span class="sc">$</span>hzn_bot <span class="ot">=</span> rem.horA<span class="sc">$</span><span class="st">'L_depth.(m)'</span><span class="sc">*</span><span class="dv">100</span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Estimated BD = bulk density estimated by simple pedotransfer function (BD = 1.5833*EXP(-0.012*OC); see SI of paper)</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>  rem.horA<span class="sc">$</span>db_od <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(rem.horA<span class="sc">$</span><span class="st">'measured.BD.(Mg/m3)'</span>)), <span class="fu">as.numeric</span>(rem.horA<span class="sc">$</span><span class="st">'estimated.BD.(Mg/m3)'</span>), <span class="fu">as.numeric</span>(rem.horA<span class="sc">$</span><span class="st">'measured.BD.(Mg/m3)'</span>))</span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>  rem.horA<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(rem.horA<span class="sc">$</span><span class="st">'OC.(g/kg)'</span> <span class="sc">*</span> rem.horA<span class="sc">$</span>db_od, <span class="dv">3</span>)</span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(rem.horA$oc_d)</span></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a>  rem.col <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Source.No."</span>, <span class="st">"Site"</span>, <span class="st">"Sample_year"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"OC.(g/kg)"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> rem.col[<span class="fu">which</span>(<span class="sc">!</span>rem.col <span class="sc">%in%</span> <span class="fu">names</span>(rem.horA))]</span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ rem.horA[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a>  chemsprops.RemnantSOC <span class="ot">=</span> rem.horA[,rem.col]</span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a>  chemsprops.RemnantSOC<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"WHRC_remnant_SOC"</span></span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.RemnantSOC<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.RemnantSOC<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://www.woodwellclimate.org/research-area/carbon/"</span></span>
<span id="cb188-21"><a href="#cb188-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.RemnantSOC<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"http://dx.doi.org/10.1073/pnas.1706103114"</span></span>
<span id="cb188-22"><a href="#cb188-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.RemnantSOC <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.RemnantSOC, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"OC.(g/kg)"</span>,<span class="st">"oc_d"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>))  </span>
<span id="cb188-23"><a href="#cb188-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.RemnantSOC, <span class="st">"/mnt/diskstation/data/Soil_points/INT/WHRC_remnant_SOC/chemsprops.RemnantSOC.rds"</span>)</span>
<span id="cb188-24"><a href="#cb188-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ifelse(is.na(as.numeric(rem.horA$"measured.BD.(Mg/m3)")),
as.numeric(rem.horA$"estimated.BD.(Mg/m3)"), : NAs introduced by coercion
Warning in ifelse(is.na(as.numeric(rem.horA$"measured.BD.(Mg/m3)")),
as.numeric(rem.horA$"estimated.BD.(Mg/m3)"), : NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.RemnantSOC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1631   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1631   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="soil-health-db" class="level4">
<h4 class="anchored" data-anchor-id="soil-health-db">Soil Health DB</h4>
<ul>
<li>Jian, J., Du, X., &amp; Stewart, R. D. (2020). A database for global soil health assessment. Scientific Data, 7(1), 1-8. <a href="https://doi.org/10.1038/s41597-020-0356-3" class="uri">https://doi.org/10.1038/s41597-020-0356-3</a>. Data download URL: <a href="https://github.com/jinshijian/SoilHealthDB" class="uri">https://github.com/jinshijian/SoilHealthDB</a></li>
</ul>
<p>Note: some information is available about column names (see: <a href="https://www.nature.com/articles/s41597-020-0356-3/tables/3" class="uri">https://www.nature.com/articles/s41597-020-0356-3/tables/3</a>) but detailed explanation is missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.SoilHealthDB"</span>)){</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>  shdb.hor <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/SoilHealthDB/SoilHealthDB_V2.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">1</span>, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">"NA"</span>, <span class="st">"NotAvailable"</span>, <span class="st">"Not-available"</span>))</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(shdb.hor$SoilFamily))</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(shdb.hor$SamplingDepth))</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>  shdb.hor<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(shdb.hor<span class="sc">$</span>SamplingDepth, <span class="cf">function</span>(i){ <span class="fu">strsplit</span>(i, <span class="st">"-to-"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>] }))</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>  shdb.hor<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(shdb.hor<span class="sc">$</span>SamplingDepth, <span class="cf">function</span>(i){ <span class="fu">strsplit</span>(i, <span class="st">"-to-"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] }))</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>  shdb.hor<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(shdb.hor<span class="sc">$</span>hzn_top), <span class="dv">0</span>, shdb.hor<span class="sc">$</span>hzn_top)</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>  shdb.hor<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(shdb.hor<span class="sc">$</span>hzn_bot), <span class="dv">15</span>, shdb.hor<span class="sc">$</span>hzn_bot)</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>  shdb.hor<span class="sc">$</span>oc <span class="ot">=</span> <span class="fu">as.numeric</span>(shdb.hor<span class="sc">$</span>BackgroundSOC) <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>  shdb.hor<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(shdb.hor<span class="sc">$</span>oc <span class="sc">*</span> shdb.hor<span class="sc">$</span>SoilBD, <span class="dv">3</span>)</span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(shdb.hor$oc_d)</span></span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"ClayPerc"</span>, <span class="st">"SiltPerc"</span>, <span class="st">"SandPerc"</span>, <span class="st">"SoilpH"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>)){   shdb.hor[,j]  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(shdb.hor[,j])   }</span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>  shdb.hor<span class="sc">$</span>ClayPerc <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(shdb.hor<span class="sc">$</span>ClayPerc), <span class="dv">100</span><span class="sc">-</span>(shdb.hor<span class="sc">$</span>SiltPerc<span class="sc">+</span>shdb.hor<span class="sc">$</span>SandPerc), shdb.hor<span class="sc">$</span>ClayPerc)</span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(shdb.hor$oc_d)</span></span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>  shdb.col <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"StudyID"</span>, <span class="st">"ExperimentID"</span>, <span class="st">"SamplingYear"</span>, <span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>, <span class="st">"SoilFamily"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"Texture"</span>, <span class="st">"texture_lab"</span>, <span class="st">"ClayPerc"</span>, <span class="st">"SiltPerc"</span>, <span class="st">"SandPerc"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"SoilpH"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"wpg2"</span>, <span class="st">"SoilBD"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> shdb.col[<span class="fu">which</span>(<span class="sc">!</span>shdb.col <span class="sc">%in%</span> <span class="fu">names</span>(shdb.hor))]</span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ shdb.hor[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoilHealthDB <span class="ot">=</span> shdb.hor[,shdb.col]</span>
<span id="cb193-19"><a href="#cb193-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoilHealthDB<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"SoilHealthDB"</span></span>
<span id="cb193-20"><a href="#cb193-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoilHealthDB<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb193-21"><a href="#cb193-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoilHealthDB<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://github.com/jinshijian/SoilHealthDB"</span></span>
<span id="cb193-22"><a href="#cb193-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoilHealthDB<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1038/s41597-020-0356-3"</span></span>
<span id="cb193-23"><a href="#cb193-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.SoilHealthDB <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.SoilHealthDB, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"ClayPerc"</span>, <span class="st">"SoilpH"</span>, <span class="st">"oc"</span>, <span class="st">"SoilFamily"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>))  </span>
<span id="cb193-24"><a href="#cb193-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.SoilHealthDB, <span class="st">"/mnt/diskstation/data/Soil_points/INT/SoilHealthDB/chemsprops.SoilHealthDB.rds"</span>)</span>
<span id="cb193-25"><a href="#cb193-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.SoilHealthDB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5050   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 5050   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="global-harmonized-dataset-of-soc-change-under-perennial-crops" class="level4">
<h4 class="anchored" data-anchor-id="global-harmonized-dataset-of-soc-change-under-perennial-crops">Global Harmonized Dataset of SOC change under perennial crops</h4>
<ul>
<li>Ledo, A., Hillier, J., Smith, P. et al.&nbsp;(2019) A global, empirical, harmonised dataset of soil organic carbon changes under perennial crops. Sci Data 6, 57. <a href="https://doi.org/10.1038/s41597-019-0062-1" class="uri">https://doi.org/10.1038/s41597-019-0062-1</a>. Data download URL: <a href="https://doi.org/10.6084/m9.figshare.7637210.v2" class="uri">https://doi.org/10.6084/m9.figshare.7637210.v2</a></li>
</ul>
<p>Note: Many missing years for PREVIOUS SOC AND SOIL CHARACTERISTICS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.SOCPDB"</span>)){</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"readxl"</span>)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>  socpdb <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"/mnt/diskstation/data/Soil_points/INT/SOCPDB/SOC_perennials_DATABASE.xls"</span>, <span class="at">skip=</span><span class="dv">1</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#names(socpdb)</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(socpdb$USDA))</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(socpdb$year_measure))</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>  socpdb<span class="sc">$</span>year_measure <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>year_measure)), <span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>yearPpub)<span class="sc">-</span><span class="dv">5</span>, <span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>year_measure))</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>  socpdb<span class="sc">$</span>year_measure <span class="ot">=</span> <span class="fu">ifelse</span>(socpdb<span class="sc">$</span>year_measure<span class="sc">&lt;</span><span class="dv">1960</span>, <span class="cn">NA</span>, socpdb<span class="sc">$</span>year_measure)</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>  socpdb<span class="sc">$</span>depth_current <span class="ot">=</span> socpdb<span class="sc">$</span>soil_to_cm_current <span class="sc">-</span> socpdb<span class="sc">$</span>soil_from_cm_current</span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>  socpdb <span class="ot">=</span> socpdb[socpdb<span class="sc">$</span>depth_current<span class="sc">&gt;</span><span class="dv">5</span>,]</span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>  socpdb<span class="sc">$</span>SOC_g_kg_current <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>SOC_g_kg_current)), <span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>SOC_Mg_ha_current) <span class="sc">/</span> (socpdb<span class="sc">$</span>depth_current<span class="sc">/</span><span class="dv">100</span> <span class="sc">*</span> <span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>bulk_density_Mg_m3_current) <span class="sc">*</span> <span class="dv">1000</span>) <span class="sc">*</span> <span class="dv">10</span>, <span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>SOC_g_kg_current))</span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>  socpdb<span class="sc">$</span>depth_previous <span class="ot">=</span> socpdb<span class="sc">$</span>soil_to_cm_previous <span class="sc">-</span> socpdb<span class="sc">$</span>soil_from_cm_previous</span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>  socpdb<span class="sc">$</span>SOC_g_kg_previous <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>SOC_g_kg_previous)), <span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>SOC_Mg_ha_previous) <span class="sc">/</span> (socpdb<span class="sc">$</span>depth_previous<span class="sc">/</span><span class="dv">100</span> <span class="sc">*</span> <span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>Bulkdensity_previous) <span class="sc">*</span> <span class="dv">1000</span>) <span class="sc">*</span> <span class="dv">10</span>, <span class="fu">as.numeric</span>(socpdb<span class="sc">$</span>SOC_g_kg_previous))</span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>  hor.b <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">names</span>(socpdb) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"plotID"</span>, <span class="st">"Longitud"</span>, <span class="st">"Latitud"</span>, <span class="st">"year_measure"</span>, <span class="st">"years_since_luc"</span>, <span class="st">"USDA"</span>, <span class="st">"original_source"</span>))</span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>  socpdb1 <span class="ot">=</span> socpdb[,<span class="fu">c</span>(hor.b, <span class="fu">grep</span>(<span class="st">"_current"</span>, <span class="fu">names</span>(socpdb)))]</span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.numeric(socpdb1$years_since_luc))</span></span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 10 yrs median</span></span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a>  socpdb1<span class="sc">$</span>site_obsdate <span class="ot">=</span> socpdb1<span class="sc">$</span>year_measure</span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a>  socpdb2 <span class="ot">=</span> socpdb[,<span class="fu">c</span>(hor.b, <span class="fu">grep</span>(<span class="st">"_previous"</span>, <span class="fu">names</span>(socpdb)))]</span>
<span id="cb198-20"><a href="#cb198-20" aria-hidden="true" tabindex="-1"></a>  socpdb2<span class="sc">$</span>site_obsdate <span class="ot">=</span> socpdb2<span class="sc">$</span>year_measure <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(socpdb2<span class="sc">$</span>years_since_luc)), <span class="dv">10</span>, <span class="fu">as.numeric</span>(socpdb2<span class="sc">$</span>years_since_luc))</span>
<span id="cb198-21"><a href="#cb198-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(socpdb2) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"_previous"</span>, <span class="st">"_current"</span>, <span class="fu">colnames</span>(socpdb2))</span>
<span id="cb198-22"><a href="#cb198-22" aria-hidden="true" tabindex="-1"></a>  nm.socpdb <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"upedonid"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"clay_total"</span>, <span class="st">"silt_total"</span>, <span class="st">"sand_total"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"bulk_density_oven_dry"</span>)</span>
<span id="cb198-23"><a href="#cb198-23" aria-hidden="true" tabindex="-1"></a>  sel.socdpb1 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"original_source"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"Longitud"</span>, <span class="st">"Latitud"</span>, <span class="st">"USDA"</span>, <span class="st">"soil_from_cm_current"</span>, <span class="st">"soil_to_cm_current"</span>, <span class="st">"%clay_current"</span>, <span class="st">"%silt_current"</span>, <span class="st">"%sand_current"</span>, <span class="st">"SOC_g_kg_current"</span>, <span class="st">"ph_current"</span>, <span class="st">"bulk_density_Mg_m3_current"</span>)</span>
<span id="cb198-24"><a href="#cb198-24" aria-hidden="true" tabindex="-1"></a>  sel.socdpb2 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"original_source"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"Longitud"</span>, <span class="st">"Latitud"</span>, <span class="st">"USDA"</span>, <span class="st">"soil_from_cm_current"</span>, <span class="st">"soil_to_cm_current"</span>, <span class="st">"%clay_current"</span>, <span class="st">"%silt_current"</span>, <span class="st">"%sand_current"</span>, <span class="st">"SOC_g_kg_current"</span>, <span class="st">"ph_current"</span>, <span class="st">"Bulkdensity_current"</span>)   </span>
<span id="cb198-25"><a href="#cb198-25" aria-hidden="true" tabindex="-1"></a>  socpdbALL <span class="ot">=</span> <span class="fu">as.data.frame</span>(dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(<span class="fu">list</span>(socpdb1[,sel.socdpb1], socpdb2[,sel.socdpb2]), <span class="cf">function</span>(i){ dplyr<span class="sc">::</span><span class="fu">mutate_all</span>(<span class="fu">setNames</span>(i, nm.socpdb), as.character) })))</span>
<span id="cb198-26"><a href="#cb198-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">which</span>(<span class="fu">names</span>(socpdbALL) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"clay_total"</span>, <span class="st">"silt_total"</span>, <span class="st">"sand_total"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"bulk_density_oven_dry"</span>))){ socpdbALL[,j] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(socpdbALL[,j]) }</span>
<span id="cb198-27"><a href="#cb198-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(socpdbALL$organic_carbon) ## mean = 15</span></span>
<span id="cb198-28"><a href="#cb198-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(socpdbALL$bulk_density_oven_dry)</span></span>
<span id="cb198-29"><a href="#cb198-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(socpdbALL$ph_h2o)</span></span>
<span id="cb198-30"><a href="#cb198-30" aria-hidden="true" tabindex="-1"></a>  socpdbALL<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(socpdbALL<span class="sc">$</span>organic_carbon <span class="sc">*</span> socpdbALL<span class="sc">$</span>bulk_density_oven_dry, <span class="dv">3</span>)</span>
<span id="cb198-31"><a href="#cb198-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(socpdbALL$oc_d)</span></span>
<span id="cb198-32"><a href="#cb198-32" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> col.names[<span class="fu">which</span>(<span class="sc">!</span>col.names <span class="sc">%in%</span> <span class="fu">names</span>(socpdbALL))]</span>
<span id="cb198-33"><a href="#cb198-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ socpdbALL[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb198-34"><a href="#cb198-34" aria-hidden="true" tabindex="-1"></a>  chemsprops.SOCPDB <span class="ot">&lt;-</span> socpdbALL[,col.names]</span>
<span id="cb198-35"><a href="#cb198-35" aria-hidden="true" tabindex="-1"></a>  chemsprops.SOCPDB<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"SOCPDB"</span></span>
<span id="cb198-36"><a href="#cb198-36" aria-hidden="true" tabindex="-1"></a>  chemsprops.SOCPDB<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb198-37"><a href="#cb198-37" aria-hidden="true" tabindex="-1"></a>  chemsprops.SOCPDB<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://africap.info/"</span></span>
<span id="cb198-38"><a href="#cb198-38" aria-hidden="true" tabindex="-1"></a>  chemsprops.SOCPDB<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1038/s41597-019-0062-1"</span></span>
<span id="cb198-39"><a href="#cb198-39" aria-hidden="true" tabindex="-1"></a>  chemsprops.SOCPDB <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.SOCPDB, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"organic_carbon"</span>,<span class="st">"ph_h2o"</span>,<span class="st">"clay_total"</span>))</span>
<span id="cb198-40"><a href="#cb198-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.SOCPDB, <span class="st">"/mnt/diskstation/data/Soil_points/INT/SOCPDB/chemsprops.SOCPDB.rds"</span>)</span>
<span id="cb198-41"><a href="#cb198-41" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in AP1137 / R1137C42: got 'YES'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in AP1138 / R1138C42: got 'YES'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in AP1139 / R1139C42: got 'YES'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in AP1140 / R1140C42: got 'YES'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in AP1141 / R1141C42: got 'YES'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in AP1142 / R1142C42: got 'YES'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in AP1143 / R1143C42: got 'YES'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in AP1144 / R1144C42: got 'YES'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1305 / R1305C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1305 / R1305C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1306 / R1306C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1306 / R1306C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1307 / R1307C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1307 / R1307C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1308 / R1308C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1308 / R1308C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1309 / R1309C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1309 / R1309C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1310 / R1310C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1310 / R1310C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1311 / R1311C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1311 / R1311C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1312 / R1312C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1312 / R1312C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1317 / R1317C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1317 / R1317C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1318 / R1318C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1318 / R1318C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1319 / R1319C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1319 / R1319C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1320 / R1320C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1320 / R1320C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1321 / R1321C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1321 / R1321C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1322 / R1322C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1322 / R1322C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1323 / R1323C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1323 / R1323C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in I1324 / R1324C9: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expecting numeric in J1324 / R1324C10: got 'NA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ifelse(is.na(as.numeric(socpdb$year_measure)),
as.numeric(socpdb$yearPpub) - : NAs introduced by coercion
Warning in ifelse(is.na(as.numeric(socpdb$year_measure)),
as.numeric(socpdb$yearPpub) - : NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ifelse(is.na(as.numeric(socpdb$SOC_g_kg_current)),
as.numeric(socpdb$SOC_Mg_ha_current)/(socpdb$depth_current/100 * : NAs
introduced by coercion
Warning in ifelse(is.na(as.numeric(socpdb$SOC_g_kg_current)),
as.numeric(socpdb$SOC_Mg_ha_current)/(socpdb$depth_current/100 * : NAs
introduced by coercion
Warning in ifelse(is.na(as.numeric(socpdb$SOC_g_kg_current)),
as.numeric(socpdb$SOC_Mg_ha_current)/(socpdb$depth_current/100 * : NAs
introduced by coercion
Warning in ifelse(is.na(as.numeric(socpdb$SOC_g_kg_current)),
as.numeric(socpdb$SOC_Mg_ha_current)/(socpdb$depth_current/100 * : NAs
introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ifelse(is.na(as.numeric(socpdb$SOC_g_kg_previous)),
as.numeric(socpdb$SOC_Mg_ha_previous)/(socpdb$depth_previous/100 * : NAs
introduced by coercion
Warning in ifelse(is.na(as.numeric(socpdb$SOC_g_kg_previous)),
as.numeric(socpdb$SOC_Mg_ha_previous)/(socpdb$depth_previous/100 * : NAs
introduced by coercion
Warning in ifelse(is.na(as.numeric(socpdb$SOC_g_kg_previous)),
as.numeric(socpdb$SOC_Mg_ha_previous)/(socpdb$depth_previous/100 * : NAs
introduced by coercion
Warning in ifelse(is.na(as.numeric(socpdb$SOC_g_kg_previous)),
as.numeric(socpdb$SOC_Mg_ha_previous)/(socpdb$depth_previous/100 * : NAs
introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ifelse(is.na(as.numeric(socpdb2$years_since_luc)), 10,
as.numeric(socpdb2$years_since_luc)): NAs introduced by coercion
Warning in ifelse(is.na(as.numeric(socpdb2$years_since_luc)), 10,
as.numeric(socpdb2$years_since_luc)): NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.SOCPDB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2416   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2416   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stocks-of-organic-carbon-in-german-agricultural-soils-bze_lw" class="level4">
<h4 class="anchored" data-anchor-id="stocks-of-organic-carbon-in-german-agricultural-soils-bze_lw">Stocks of organic carbon in German agricultural soils (BZE_LW)</h4>
<ul>
<li>Poeplau, C., Jacobs, A., Don, A., Vos, C., Schneider, F., Wittnebel, M., … &amp; Flessa, H. (2020). <a href="https://doi.org/10.1002/jpln.202000113">Stocks of organic carbon in German agricultural soils—Key results of the first comprehensive inventory</a>. Journal of Plant Nutrition and Soil Science, 183(6), 665-681. <a href="https://doi.org/10.1002/jpln.202000113" class="uri">https://doi.org/10.1002/jpln.202000113</a>. Data download URL: <a href="https://doi.org/10.3220/DATA20200203151139" class="uri">https://doi.org/10.3220/DATA20200203151139</a></li>
</ul>
<p>Note: For protection of data privacy, the coordinate was randomly generated within a radius of 4-km around the planned sampling point. This data is hence probably not suitable for spatial analysis, predictive soil mapping.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.BZE_LW"</span>)){</span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>  site.de <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Germany/SITE.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>  site.de<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">paste0</span>(<span class="st">"01-"</span>, site.de<span class="sc">$</span>Sampling_month, <span class="st">"-"</span>, site.de<span class="sc">$</span>Sampling_year), <span class="at">format=</span><span class="st">"%d-%m-%Y"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>  site.de.xy <span class="ot">=</span> site.de[,<span class="fu">c</span>(<span class="st">"PointID"</span>,<span class="st">"xcoord"</span>,<span class="st">"ycoord"</span>)]</span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3104</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>  bze.cor <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'./correlation/soil_type_correlation_BZE.csv'</span>)</span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>  site.de<span class="sc">$</span>SSL_classification_name <span class="ot">=</span> <span class="fu">paste0</span>( dplyr<span class="sc">::</span><span class="fu">left_join</span>(site.de[<span class="st">"Specific.soil.subtype"</span>], bze.cor, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Specific.soil.subtype"</span><span class="ot">=</span><span class="st">"bze_subtype"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>USDA_1, <span class="st">" / "</span>,</span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">left_join</span>(site.de[<span class="st">"Specific.soil.subtype"</span>], bze.cor, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Specific.soil.subtype"</span><span class="ot">=</span><span class="st">"bze_subtype"</span>), <span class="at">multiple =</span> <span class="st">"first"</span>)<span class="sc">$</span>USDA_2)</span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(site.de$SSL_classification_name))</span></span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coordinates</span>(site.de.xy) <span class="ot">&lt;-</span> <span class="er">~</span>xcoord<span class="sc">+</span>ycoord</span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proj4string</span>(site.de.xy) <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">"+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span>)</span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a>  site.de.ll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">spTransform</span>(site.de.xy, <span class="fu">CRS</span>(<span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84"</span>)))</span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a>  site.de<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> site.de.ll[,<span class="dv">2</span>]</span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a>  site.de<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> site.de.ll[,<span class="dv">3</span>]</span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a>  hor.de <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Germany/LABORATORY_DATA.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb247-16"><a href="#cb247-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#hor.de = plyr::join(openxlsx::read.xlsx("/mnt/diskstation/data/Soil_points/Germany/LABORATORY_DATA.xlsx", sheet = 1), openxlsx::read.xlsx("/mnt/diskstation/data/Soil_points/Germany/HORIZON_DATA.xlsx", sheet = 1), by="PointID")</span></span>
<span id="cb247-17"><a href="#cb247-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 17,189 rows</span></span>
<span id="cb247-18"><a href="#cb247-18" aria-hidden="true" tabindex="-1"></a>  horALL.de <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(hor.de, site.de, <span class="at">by=</span><span class="st">"PointID"</span>)</span>
<span id="cb247-19"><a href="#cb247-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Sand content [Mass-%]; grain size 63-2000µm (DIN ISO 11277)</span></span>
<span id="cb247-20"><a href="#cb247-20" aria-hidden="true" tabindex="-1"></a>  horALL.de<span class="sc">$</span>sand_tot_psa <span class="ot">&lt;-</span> horALL.de<span class="sc">$</span>gS <span class="sc">+</span> horALL.de<span class="sc">$</span>mS <span class="sc">+</span> horALL.de<span class="sc">$</span>fS <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> horALL.de<span class="sc">$</span>gU</span>
<span id="cb247-21"><a href="#cb247-21" aria-hidden="true" tabindex="-1"></a>  horALL.de<span class="sc">$</span>silt_tot_psa <span class="ot">&lt;-</span> horALL.de<span class="sc">$</span>fU <span class="sc">+</span> horALL.de<span class="sc">$</span>mU <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> horALL.de<span class="sc">$</span>gU</span>
<span id="cb247-22"><a href="#cb247-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Convert millisiemens/meter [mS/m] to microsiemens/centimeter [μS/cm, uS/cm]</span></span>
<span id="cb247-23"><a href="#cb247-23" aria-hidden="true" tabindex="-1"></a>  horALL.de<span class="sc">$</span>ec_satp <span class="ot">=</span> horALL.de<span class="sc">$</span>EC_H2O <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb247-24"><a href="#cb247-24" aria-hidden="true" tabindex="-1"></a>  hor.sel.de <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PointID"</span>, <span class="st">"Main.soil.type"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"Layer.upper.limit"</span>, <span class="st">"Layer.lower.limit"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"Soil.texture.class"</span>, <span class="st">"texture_lab"</span>, <span class="st">"Clay"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"TOC"</span>, <span class="st">"oc_d"</span>, <span class="st">"TC"</span>, <span class="st">"TN"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"pH_H2O"</span>, <span class="st">"pH_CaCl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"Rock.fragment.fraction"</span>, <span class="st">"BD_FS"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb247-25"><a href="#cb247-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(horALL.de$TOC) ## mean = 12.3</span></span>
<span id="cb247-26"><a href="#cb247-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(horALL.de$BD_FS) ## mean = 1.41</span></span>
<span id="cb247-27"><a href="#cb247-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(horALL.de$pH_H2O)</span></span>
<span id="cb247-28"><a href="#cb247-28" aria-hidden="true" tabindex="-1"></a>  horALL.de<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(horALL.de<span class="sc">$</span>TOC <span class="sc">*</span> horALL.de<span class="sc">$</span>BD_FS <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>horALL.de<span class="sc">$</span>Rock.fragment.fraction<span class="sc">/</span><span class="dv">100</span>), <span class="dv">3</span>)</span>
<span id="cb247-29"><a href="#cb247-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(horALL.de$oc_d)</span></span>
<span id="cb247-30"><a href="#cb247-30" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> hor.sel.de[<span class="fu">which</span>(<span class="sc">!</span>hor.sel.de <span class="sc">%in%</span> <span class="fu">names</span>(horALL.de))]</span>
<span id="cb247-31"><a href="#cb247-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ horALL.de[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb247-32"><a href="#cb247-32" aria-hidden="true" tabindex="-1"></a>  chemsprops.BZE_LW <span class="ot">&lt;-</span> horALL.de[,hor.sel.de]</span>
<span id="cb247-33"><a href="#cb247-33" aria-hidden="true" tabindex="-1"></a>  chemsprops.BZE_LW<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"BZE_LW"</span></span>
<span id="cb247-34"><a href="#cb247-34" aria-hidden="true" tabindex="-1"></a>  chemsprops.BZE_LW<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb247-35"><a href="#cb247-35" aria-hidden="true" tabindex="-1"></a>  chemsprops.BZE_LW<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://www.thuenen.de/de/ak/"</span></span>
<span id="cb247-36"><a href="#cb247-36" aria-hidden="true" tabindex="-1"></a>  chemsprops.BZE_LW<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1002/jpln.202000113"</span></span>
<span id="cb247-37"><a href="#cb247-37" aria-hidden="true" tabindex="-1"></a>  chemsprops.BZE_LW <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.BZE_LW, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"TOC"</span>, <span class="st">"pH_H2O"</span>, <span class="st">"Clay"</span>))</span>
<span id="cb247-38"><a href="#cb247-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.BZE_LW, <span class="st">"/mnt/diskstation/data/Soil_points/Germany/chemsprops.BZE_LW.rds"</span>)</span>
<span id="cb247-39"><a href="#cb247-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb247-40"><a href="#cb247-40" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.BZE_LW)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17189    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 17189    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aardewerk-vlaanderen-2010" class="level4">
<h4 class="anchored" data-anchor-id="aardewerk-vlaanderen-2010">AARDEWERK-Vlaanderen-2010</h4>
<ul>
<li>Beckers, V., Jacxsens, P., Van De Vreken, Ph., Van Meirvenne, M., Van Orshoven, J. (2011). Gebruik en installatie van de bodemdatabank AARDEWERK-Vlaanderen-2010. Spatial Applications Division Leuven, Belgium. Data download URL: <a href="https://www.dov.vlaanderen.be/geonetwork/home/api/records/78e15dd4-8070-4220-afac-258ea040fb30" class="uri">https://www.dov.vlaanderen.be/geonetwork/home/api/records/78e15dd4-8070-4220-afac-258ea040fb30</a></li>
<li>Ottoy, S., Beckers, V., Jacxsens, P., Hermy, M., &amp; Van Orshoven, J. (2015). <a href="https://doi.org/10.1016/j.geoderma.2015.04.001">Multi-level statistical soil profiles for assessing regional soil organic carbon stocks</a>. Geoderma, 253, 12-20. <a href="https://doi.org/10.1016/j.geoderma.2015.04.001" class="uri">https://doi.org/10.1016/j.geoderma.2015.04.001</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.Vlaanderen2010"</span>)){</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>  site.vl <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Belgium/Vlaanderen/Aardewerk-Vlaanderen-2010_Profiel.csv"</span>)</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>  site.vl<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(<span class="fu">sapply</span>(site.vl<span class="sc">$</span>Profilering_Datum, <span class="cf">function</span>(i){<span class="fu">strsplit</span>(i, <span class="st">" "</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]}), <span class="at">format=</span><span class="st">"%d-%m-%Y"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>  site.vl.xy <span class="ot">=</span> site.vl[,<span class="fu">c</span>(<span class="st">"ID"</span>,<span class="st">"Coordinaat_Lambert72_X"</span>,<span class="st">"Coordinaat_Lambert72_Y"</span>)]</span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 7020</span></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>  site.vl.xy <span class="ot">=</span> site.vl.xy[<span class="fu">complete.cases</span>(site.vl.xy),]</span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coordinates</span>(site.vl.xy) <span class="ot">&lt;-</span> <span class="er">~</span>Coordinaat_Lambert72_X<span class="sc">+</span>Coordinaat_Lambert72_Y</span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proj4string</span>(site.vl.xy) <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">"+init=epsg:31300"</span>)</span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a>  site.vl.ll <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">spTransform</span>(site.vl.xy, <span class="fu">CRS</span>(<span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84"</span>)))</span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a>  site.vl<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> <span class="fu">join</span>(site.vl[<span class="st">"ID"</span>], site.vl.ll, <span class="at">by=</span><span class="st">"ID"</span>)<span class="sc">$</span>coords.x1</span>
<span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a>  site.vl<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> <span class="fu">join</span>(site.vl[<span class="st">"ID"</span>], site.vl.ll, <span class="at">by=</span><span class="st">"ID"</span>)<span class="sc">$</span>coords.x2</span>
<span id="cb250-12"><a href="#cb250-12" aria-hidden="true" tabindex="-1"></a>  site.vl<span class="sc">$</span>Profiel_ID <span class="ot">=</span> site.vl<span class="sc">$</span>ID</span>
<span id="cb250-13"><a href="#cb250-13" aria-hidden="true" tabindex="-1"></a>  hor.vl <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Belgium/Vlaanderen/Aardewerk-Vlaanderen-2010_Horizont.csv"</span>)</span>
<span id="cb250-14"><a href="#cb250-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 42,529 rows</span></span>
<span id="cb250-15"><a href="#cb250-15" aria-hidden="true" tabindex="-1"></a>  horALL.vl <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(hor.vl, site.vl, <span class="at">by=</span><span class="st">"Profiel_ID"</span>)</span>
<span id="cb250-16"><a href="#cb250-16" aria-hidden="true" tabindex="-1"></a>  horALL.vl<span class="sc">$</span>oc <span class="ot">=</span> horALL.vl<span class="sc">$</span>Humus<span class="sc">*</span><span class="dv">10</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">1.3</span></span>
<span id="cb250-17"><a href="#cb250-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(horALL.vl$oc) ## mean = 7.8</span></span>
<span id="cb250-18"><a href="#cb250-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(horALL.vl$pH_H2O)</span></span>
<span id="cb250-19"><a href="#cb250-19" aria-hidden="true" tabindex="-1"></a>  horALL.vl<span class="sc">$</span>hzn_top <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(horALL.vl[,<span class="fu">c</span>(<span class="st">"Diepte_grens_boven1"</span>, <span class="st">"Diepte_grens_boven2"</span>)], <span class="at">na.rm=</span><span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb250-20"><a href="#cb250-20" aria-hidden="true" tabindex="-1"></a>  horALL.vl<span class="sc">$</span>hzn_bot <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(horALL.vl[,<span class="fu">c</span>(<span class="st">"Diepte_grens_onder1"</span>,<span class="st">"Diepte_grens_onder2"</span>)], <span class="at">na.rm=</span><span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb250-21"><a href="#cb250-21" aria-hidden="true" tabindex="-1"></a>  horALL.vl<span class="sc">$</span>sand_tot_psa <span class="ot">&lt;-</span> horALL.vl<span class="sc">$</span>T50_100 <span class="sc">+</span> horALL.vl<span class="sc">$</span>T100_200 <span class="sc">+</span> horALL.vl<span class="sc">$</span>T200_500 <span class="sc">+</span> horALL.vl<span class="sc">$</span>T500_1000 <span class="sc">+</span> horALL.vl<span class="sc">$</span>T1000_2000</span>
<span id="cb250-22"><a href="#cb250-22" aria-hidden="true" tabindex="-1"></a>  horALL.vl<span class="sc">$</span>silt_tot_psa <span class="ot">&lt;-</span> horALL.vl<span class="sc">$</span>T2_10 <span class="sc">+</span> horALL.vl<span class="sc">$</span>T10_20 <span class="sc">+</span> horALL.vl<span class="sc">$</span>T20_50</span>
<span id="cb250-23"><a href="#cb250-23" aria-hidden="true" tabindex="-1"></a>  horALL.vl<span class="sc">$</span>tex_psda <span class="ot">=</span> <span class="fu">paste0</span>(horALL.vl<span class="sc">$</span>HorizontTextuur_code1, horALL.vl<span class="sc">$</span>HorizontTextuur_code2)</span>
<span id="cb250-24"><a href="#cb250-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## some corrupt coordinates</span></span>
<span id="cb250-25"><a href="#cb250-25" aria-hidden="true" tabindex="-1"></a>  horALL.vl <span class="ot">&lt;-</span> horALL.vl[horALL.vl<span class="sc">$</span>latitude_decimal_degrees <span class="sc">&gt;</span> <span class="fl">50.6</span>,]</span>
<span id="cb250-26"><a href="#cb250-26" aria-hidden="true" tabindex="-1"></a>  hor.sel.vl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Profiel_ID"</span>, <span class="st">"Bodemgroep"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"Hor_nr"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"Naam"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"T0_2"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"pH_KCl"</span>, <span class="st">"pH_H2O"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"Sorptiecapaciteit_Totaal"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"Tgroter_dan_2000"</span>, <span class="st">"db_od"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb250-27"><a href="#cb250-27" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> hor.sel.vl[<span class="fu">which</span>(<span class="sc">!</span>hor.sel.vl <span class="sc">%in%</span> <span class="fu">names</span>(horALL.vl))]</span>
<span id="cb250-28"><a href="#cb250-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ horALL.vl[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb250-29"><a href="#cb250-29" aria-hidden="true" tabindex="-1"></a>  chemsprops.Vlaanderen <span class="ot">&lt;-</span> horALL.vl[,hor.sel.vl]</span>
<span id="cb250-30"><a href="#cb250-30" aria-hidden="true" tabindex="-1"></a>  chemsprops.Vlaanderen<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Vlaanderen"</span></span>
<span id="cb250-31"><a href="#cb250-31" aria-hidden="true" tabindex="-1"></a>  chemsprops.Vlaanderen<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb250-32"><a href="#cb250-32" aria-hidden="true" tabindex="-1"></a>  chemsprops.Vlaanderen<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://www.dov.vlaanderen.be"</span></span>
<span id="cb250-33"><a href="#cb250-33" aria-hidden="true" tabindex="-1"></a>  chemsprops.Vlaanderen<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1016/j.geoderma.2015.04.001"</span></span>
<span id="cb250-34"><a href="#cb250-34" aria-hidden="true" tabindex="-1"></a>  chemsprops.Vlaanderen <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.Vlaanderen, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>, <span class="st">"pH_H2O"</span>, <span class="st">"T0_2"</span>))</span>
<span id="cb250-35"><a href="#cb250-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.Vlaanderen, <span class="st">"/mnt/diskstation/data/Soil_points/Belgium/Vlaanderen/chemsprops.Vlaanderen.rds"</span>)</span>
<span id="cb250-36"><a href="#cb250-36" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in CPL_crs_from_input(x): GDAL Message 1: +init=epsg:XXXX syntax is
deprecated. It might return a CRS with a non-EPSG compliant axis order.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.Vlaanderen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 41364    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 41364    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="netherlands-bis-4d" class="level4">
<h4 class="anchored" data-anchor-id="netherlands-bis-4d">Netherlands BIS-4D</h4>
<ul>
<li>Helfenstein, A., Mulder, V. L., Hack-ten Broeke, M. J. D., van Doorn, M., Teuling, K., Walvoort, D. J. J., and Heuvelink, G. B. M. (2024): BIS-4D: mapping soil properties and their uncertainties at 25 m resolution in the Netherlands, Earth Syst. Sci. Data, 16, 2941–2970. <a href="https://doi.org/10.5194/essd-16-2941-2024" class="uri">https://doi.org/10.5194/essd-16-2941-2024</a></li>
</ul>
<p>Note: Data download <a href="https://doi.org/10.4121/c90215b3-bdc6-4633-b721-4c4a0259d6dc.v4" class="uri">https://doi.org/10.4121/c90215b3-bdc6-4633-b721-4c4a0259d6dc.v4</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.NLBIS"</span>)){</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Tabular datasets of each georeferenced soil property point data are provided as separate CSV files for each soil property.</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>  nlbis.lst <span class="ot">=</span> <span class="fu">list.files</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Netherlands/BIS"</span>, <span class="at">pattern=</span><span class="fu">glob2rx</span>(<span class="st">"*.csv.gz"</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>  nlbis.horA <span class="ot">=</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Netherlands/BIS/tbl_cal_SOM_per.csv.gz"</span>)</span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>  nlbis.hor <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(nlbis.horA, plyr<span class="sc">::</span><span class="fu">join_all</span>(<span class="fu">lapply</span>(nlbis.lst[<span class="sc">-</span><span class="fu">grep</span>(<span class="st">"_SOM"</span>, nlbis.lst)], <span class="cf">function</span>(i){vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="fu">gzfile</span>(i))}), <span class="at">type=</span><span class="st">"full"</span>, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"sample_id"</span>, <span class="st">"site_id"</span>, <span class="st">"hor_nr"</span>)), <span class="at">multiple =</span> <span class="st">"first"</span>)</span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(nlbis.hor)</span></span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">##855,950 × 21</span></span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## this is relatively large lab data set - it would create imbalance in the bind, so better to trim-down</span></span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## limit to measurements &gt; 1999 only</span></span>
<span id="cb255-10"><a href="#cb255-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(nlbis.hor$year))</span></span>
<span id="cb255-11"><a href="#cb255-11" aria-hidden="true" tabindex="-1"></a>  nlbis.hor <span class="ot">=</span> nlbis.hor[nlbis.hor<span class="sc">$</span>year<span class="sc">&gt;</span><span class="dv">1999</span>,]</span>
<span id="cb255-12"><a href="#cb255-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(nlbis.hor[,c("X","Y")], pch="+", asp=1)</span></span>
<span id="cb255-13"><a href="#cb255-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## LOI method - harmonization: https://doi.org/10.1111/ejss.12558</span></span>
<span id="cb255-14"><a href="#cb255-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nlbis.hor$organic_carbon = nlbis.hor$SOM_per / 1.72 * 10</span></span>
<span id="cb255-15"><a href="#cb255-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#hist(log1p(nlbis.hor$SOM_per))</span></span>
<span id="cb255-16"><a href="#cb255-16" aria-hidden="true" tabindex="-1"></a>  nlbis.hor<span class="sc">$</span>organic_carbon <span class="ot">=</span> (<span class="fl">0.513</span><span class="sc">*</span>nlbis.hor<span class="sc">$</span>SOM_per <span class="sc">-</span><span class="fl">0.047</span><span class="sc">*</span>nlbis.hor<span class="sc">$</span>clay_per <span class="sc">+</span> <span class="fl">0.00025</span><span class="sc">*</span>nlbis.hor<span class="sc">$</span>clay_per<span class="sc">^</span><span class="dv">2</span> )<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb255-17"><a href="#cb255-17" aria-hidden="true" tabindex="-1"></a>  nlbis.hor<span class="sc">$</span>organic_carbon <span class="ot">=</span> <span class="fu">ifelse</span>(nlbis.hor<span class="sc">$</span>organic_carbon <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, nlbis.hor<span class="sc">$</span>organic_carbon)</span>
<span id="cb255-18"><a href="#cb255-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(nlbis.hor$organic_carbon)</span></span>
<span id="cb255-19"><a href="#cb255-19" aria-hidden="true" tabindex="-1"></a>  nlbis.xy <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">vect</span>(nlbis.hor[,<span class="fu">c</span>(<span class="st">"X"</span>,<span class="st">"Y"</span>)], <span class="at">geom=</span><span class="fu">c</span>(<span class="st">"X"</span>,<span class="st">"Y"</span>), <span class="at">crs=</span><span class="st">"EPSG:28992"</span>)</span>
<span id="cb255-20"><a href="#cb255-20" aria-hidden="true" tabindex="-1"></a>  nlbis.ll <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">project</span>(nlbis.xy, <span class="st">"EPSG:4326"</span>)</span>
<span id="cb255-21"><a href="#cb255-21" aria-hidden="true" tabindex="-1"></a>  nlbis.hor<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> <span class="fu">geom</span>(nlbis.ll)[,<span class="st">"x"</span>]</span>
<span id="cb255-22"><a href="#cb255-22" aria-hidden="true" tabindex="-1"></a>  nlbis.hor<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> <span class="fu">geom</span>(nlbis.ll)[,<span class="st">"y"</span>]</span>
<span id="cb255-23"><a href="#cb255-23" aria-hidden="true" tabindex="-1"></a>  nlbis.hor<span class="sc">$</span>cec_nh4_ph_7 <span class="ot">=</span> nlbis.hor<span class="sc">$</span>CEC <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb255-24"><a href="#cb255-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(nlbis.hor$N_tot_mgkg)</span></span>
<span id="cb255-25"><a href="#cb255-25" aria-hidden="true" tabindex="-1"></a>  nlbis.hor<span class="sc">$</span>total_nitrogen_ncs <span class="ot">=</span> nlbis.hor<span class="sc">$</span>N_tot_mgkg<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb255-26"><a href="#cb255-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(nlbis.hor$d_upper)</span></span>
<span id="cb255-27"><a href="#cb255-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb255-28"><a href="#cb255-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">##   0.000   2.907  17.442  83.267  58.140 575.581   22417 </span></span>
<span id="cb255-29"><a href="#cb255-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(nlbis.hor$BD_gcm3)</span></span>
<span id="cb255-30"><a href="#cb255-30" aria-hidden="true" tabindex="-1"></a>  nlbis.hor<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(nlbis.hor<span class="sc">$</span>organic_carbon <span class="sc">*</span> nlbis.hor<span class="sc">$</span>BD_gcm3, <span class="dv">3</span>)</span>
<span id="cb255-31"><a href="#cb255-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(nlbis.hor$oc_d)</span></span>
<span id="cb255-32"><a href="#cb255-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span id="cb255-33"><a href="#cb255-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  0.00   10.25   15.20   21.95   30.90   63.80  215900  </span></span>
<span id="cb255-34"><a href="#cb255-34" aria-hidden="true" tabindex="-1"></a>  nlbis.name <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"site_id"</span>, <span class="st">"upedonid"</span>, <span class="st">"year"</span>, <span class="st">"longitude_decimal_degrees"</span>, </span>
<span id="cb255-35"><a href="#cb255-35" aria-hidden="true" tabindex="-1"></a>               <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"SSL_classification_name"</span>,  </span>
<span id="cb255-36"><a href="#cb255-36" aria-hidden="true" tabindex="-1"></a>               <span class="st">"sample_id"</span>, <span class="st">"layer_key"</span>, <span class="st">"hor_nr"</span>, <span class="st">"d_upper"</span>, <span class="st">"d_lower"</span>, </span>
<span id="cb255-37"><a href="#cb255-37" aria-hidden="true" tabindex="-1"></a>              <span class="st">"hor"</span>, <span class="st">"texture_description"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_per"</span>, <span class="st">"silt_per"</span>, </span>
<span id="cb255-38"><a href="#cb255-38" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sand_per"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"total_carbon_ncs"</span>, <span class="st">"total_nitrogen_ncs"</span>, </span>
<span id="cb255-39"><a href="#cb255-39" aria-hidden="true" tabindex="-1"></a>              <span class="st">"pH_KCl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, </span>
<span id="cb255-40"><a href="#cb255-40" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sum_of_cations_cec_pH_8_2"</span>, <span class="st">"cec_nh4_ph_7"</span>, <span class="st">"ecec_base_plus_aluminum"</span>, </span>
<span id="cb255-41"><a href="#cb255-41" aria-hidden="true" tabindex="-1"></a>              <span class="st">"total_frag_wt_pct_gt_2_mm_ws"</span>, <span class="st">"BD_gcm3"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, </span>
<span id="cb255-42"><a href="#cb255-42" aria-hidden="true" tabindex="-1"></a>              <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)</span>
<span id="cb255-43"><a href="#cb255-43" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> nlbis.name[<span class="fu">which</span>(<span class="sc">!</span>nlbis.name <span class="sc">%in%</span> <span class="fu">names</span>(nlbis.hor))]</span>
<span id="cb255-44"><a href="#cb255-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ nlbis.hor[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb255-45"><a href="#cb255-45" aria-hidden="true" tabindex="-1"></a>  chemsprops.NLBIS <span class="ot">=</span> nlbis.hor[,nlbis.name]</span>
<span id="cb255-46"><a href="#cb255-46" aria-hidden="true" tabindex="-1"></a>  chemsprops.NLBIS<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Netherlands.BIS"</span></span>
<span id="cb255-47"><a href="#cb255-47" aria-hidden="true" tabindex="-1"></a>  chemsprops.NLBIS<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb255-48"><a href="#cb255-48" aria-hidden="true" tabindex="-1"></a>  chemsprops.NLBIS<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://git.wageningenur.nl/helfe001/bis-4d"</span></span>
<span id="cb255-49"><a href="#cb255-49" aria-hidden="true" tabindex="-1"></a>  chemsprops.NLBIS<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.5194/essd-16-2941-2024"</span></span>
<span id="cb255-50"><a href="#cb255-50" aria-hidden="true" tabindex="-1"></a>  chemsprops.NLBIS <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.NLBIS, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"organic_carbon"</span>, <span class="st">"pH_KCl"</span>))</span>
<span id="cb255-51"><a href="#cb255-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.NLBIS, <span class="st">"/mnt/diskstation/data/Soil_points/Netherlands/chemsprops.NLBIS.rds"</span>)</span>
<span id="cb255-52"><a href="#cb255-52" aria-hidden="true" tabindex="-1"></a><span class="do">##  writeVector(terra::vect(chemsprops.NLBIS, geom=c("longitude_decimal_degrees", "latitude_decimal_degrees"), crs="EPSG:4326"), "/data/wri_soil/chemsprops.NLBIS.gpkg")</span></span>
<span id="cb255-53"><a href="#cb255-53" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 855950 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): BIS_tbl, BIS_type, hor
dbl (9): site_id, X, Y, hor_nr, d_upper, d_lower, d_mid, year, SOM_per
lgl (1): sample_id

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 15871 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): BIS_tbl, BIS_type, hor
dbl (9): site_id, X, Y, hor_nr, d_upper, d_lower, d_mid, year, BD_gcm3
lgl (1): sample_id

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 3815 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): BIS_tbl, BIS_type
dbl (8): site_id, X, Y, d_upper, d_lower, d_mid, year, CEC
lgl (3): sample_id, hor_nr, hor

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 631726 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): BIS_tbl, BIS_type, hor
dbl (9): site_id, X, Y, hor_nr, d_upper, d_lower, d_mid, year, clay_per
lgl (1): sample_id

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 5739 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): BIS_tbl, BIS_type
dbl (8): site_id, X, Y, d_upper, d_lower, d_mid, year, N_tot_mgkg
lgl (3): sample_id, hor_nr, hor

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 6084 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): BIS_tbl, BIS_type, hor
dbl (8): site_id, X, Y, d_upper, d_lower, d_mid, year, P_ox_mmolkg
lgl (2): sample_id, hor_nr

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 15248 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): BIS_tbl, BIS_type, hor
dbl (8): site_id, X, Y, d_upper, d_lower, d_mid, year, pH_KCl
lgl (2): sample_id, hor_nr

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 12918 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): BIS_tbl, BIS_type, hor
dbl (8): site_id, X, Y, d_upper, d_lower, d_mid, year, sand_per
lgl (2): sample_id, hor_nr

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 12912 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): BIS_tbl, BIS_type
dbl (8): site_id, X, Y, d_upper, d_lower, d_mid, year, silt_per
lgl (3): sample_id, hor_nr, hor

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Joining with `by = join_by(BIS_tbl, BIS_type, sample_id, site_id, X, Y, hor_nr, hor, d_upper, d_lower, d_mid, year)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.NLBIS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 116296     39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 116290     39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="chilean-soil-organic-carbon-database" class="level4">
<h4 class="anchored" data-anchor-id="chilean-soil-organic-carbon-database">Chilean Soil Organic Carbon database</h4>
<ul>
<li>Pfeiffer, M., Padarian, J., Osorio, R., Bustamante, N., Olmedo, G. F., Guevara, M., et al.&nbsp;(2020) <a href="https://doi.org/10.5194/essd-12-457-2020">CHLSOC: the Chilean Soil Organic Carbon database, a multi-institutional collaborative effort</a>. Earth Syst. Sci. Data, 12, 457–468, <a href="https://doi.org/10.5194/essd-12-457-2020" class="uri">https://doi.org/10.5194/essd-12-457-2020</a>. Data download URL: <a href="https://doi.org/10.17605/OSF.IO/NMYS3" class="uri">https://doi.org/10.17605/OSF.IO/NMYS3</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.CHLSOC"</span>)){</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>  chl.hor <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Chile/CHLSOC/CHLSOC_v1.0.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(chl.hor$oc)</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>  chl.hor<span class="sc">$</span>oc <span class="ot">=</span> chl.hor<span class="sc">$</span>oc<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(chl.hor$bd)</span></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>  chl.hor<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(chl.hor<span class="sc">$</span>oc  <span class="sc">*</span> chl.hor<span class="sc">$</span>bd <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(chl.hor<span class="sc">$</span>crf), <span class="dv">0</span>, chl.hor<span class="sc">$</span>crf))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(chl.hor$oc_d)</span></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>  chl.col <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ProfileID"</span>, <span class="st">"usiteid"</span>, <span class="st">"year"</span>, <span class="st">"long"</span>, <span class="st">"lat"</span>, <span class="st">"SSL_classification_name"</span>, <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"top"</span>, <span class="st">"bottom"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"tex_psda"</span>, <span class="st">"texture_lab"</span>, <span class="st">"clay_tot_psa"</span>, <span class="st">"silt_tot_psa"</span>, <span class="st">"sand_tot_psa"</span>, <span class="st">"oc"</span>, <span class="st">"oc_d"</span>, <span class="st">"c_tot"</span>, <span class="st">"n_tot"</span>, <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, <span class="st">"cec_sum"</span>, <span class="st">"cec_nh4"</span>, <span class="st">"ecec"</span>, <span class="st">"crf"</span>, <span class="st">"bd"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_satp"</span>, <span class="st">"ec_12pre"</span>)</span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> chl.col[<span class="fu">which</span>(<span class="sc">!</span>chl.col <span class="sc">%in%</span> <span class="fu">names</span>(chl.hor))]</span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ chl.hor[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a>  chemsprops.CHLSOC <span class="ot">=</span> chl.hor[,chl.col]</span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a>  chemsprops.CHLSOC<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Chilean_SOCDB"</span></span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a>  chemsprops.CHLSOC<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a>  chemsprops.CHLSOC<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://doi.org/10.17605/OSF.IO/NMYS3"</span></span>
<span id="cb260-15"><a href="#cb260-15" aria-hidden="true" tabindex="-1"></a>  chemsprops.CHLSOC<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.5194/essd-12-457-2020"</span></span>
<span id="cb260-16"><a href="#cb260-16" aria-hidden="true" tabindex="-1"></a>  chemsprops.CHLSOC <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.CHLSOC, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"oc"</span>, <span class="st">"bd"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>))</span>
<span id="cb260-17"><a href="#cb260-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.CHLSOC, <span class="st">"/mnt/diskstation/data/Soil_points/Chile/chemsprops.CHLSOC.rds"</span>)</span>
<span id="cb260-18"><a href="#cb260-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb260-19"><a href="#cb260-19" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.CHLSOC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16903    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 16903    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scotland-nsis_1" class="level4">
<h4 class="anchored" data-anchor-id="scotland-nsis_1">Scotland (NSIS_1)</h4>
<ul>
<li>Lilly, A., Bell, J.S., Hudson, G., Nolan, A.J. &amp; Towers. W. (Compilers) (2010). National soil inventory of Scotland (NSIS_1); site location, sampling and profile description protocols. (1978-1988). Technical Bulletin. Macaulay Institute, Aberdeen. <a href="https://doi.org/10.5281/zenodo.4650230" class="uri">https://doi.org/10.5281/zenodo.4650230</a>. Data download URL: <a href="https://www.hutton.ac.uk/learning/natural-resource-datasets/soilshutton/soils-maps-scotland/download" class="uri">https://www.hutton.ac.uk/learning/natural-resource-datasets/soilshutton/soils-maps-scotland/download</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.ScotlandNSIS1"</span>)){</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>  sco.xy <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Scotland/NSIS_10km.csv"</span>)</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coordinates</span>(sco.xy) <span class="ot">=</span> <span class="er">~</span> easting <span class="sc">+</span> northing</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proj4string</span>(sco.xy) <span class="ot">=</span> <span class="st">"EPSG:27700"</span></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>  sco.ll <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">spTransform</span>(sco.xy, <span class="fu">CRS</span>(<span class="st">"EPSG:4326"</span>)))</span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>  sco.ll<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(sco.ll<span class="sc">$</span>profile_da, <span class="cf">function</span>(x){<span class="fu">substr</span>(x, <span class="fu">nchar</span>(x)<span class="sc">-</span><span class="dv">3</span>, <span class="fu">nchar</span>(x))}))</span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#hist(sco.ll$site_obsdate[sco.ll$site_obsdate&gt;1000])</span></span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## no points after 1990!!</span></span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sco.ll$exch_k)</span></span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a>  sco.in.name <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"profile_id"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"coords.x1"</span>, <span class="st">"coords.x2"</span>, <span class="st">"horz_top"</span>, <span class="st">"horz_botto"</span>, </span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"horz_symb"</span>, <span class="st">"sample_id"</span>, <span class="st">"texture_ps"</span>,</span>
<span id="cb263-12"><a href="#cb263-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"sand_int"</span>, <span class="st">"silt_int"</span>, <span class="st">"clay"</span>, <span class="st">"carbon"</span>, <span class="st">"nitrogen"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"exch_ca"</span>, </span>
<span id="cb263-13"><a href="#cb263-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"exch_mg"</span>, <span class="st">"exch_na"</span>, <span class="st">"exch_k"</span>, <span class="st">"sum_cation"</span>)</span>
<span id="cb263-14"><a href="#cb263-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#sco.in.name[which(!sco.in.name %in% names(sco.ll))]</span></span>
<span id="cb263-15"><a href="#cb263-15" aria-hidden="true" tabindex="-1"></a>  sco.x <span class="ot">=</span> <span class="fu">as.data.frame</span>(sco.ll[,sco.in.name])</span>
<span id="cb263-16"><a href="#cb263-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#sco.x = sco.x[!sco.x$sample_id==0,]</span></span>
<span id="cb263-17"><a href="#cb263-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(sco.x$carbon)</span></span>
<span id="cb263-18"><a href="#cb263-18" aria-hidden="true" tabindex="-1"></a>  sco.out.name <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, </span>
<span id="cb263-19"><a href="#cb263-19" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"hzn_bot"</span>, <span class="st">"hzn_top"</span>, <span class="st">"hzn_desgn"</span>, <span class="st">"labsampnum"</span>, <span class="st">"tex_psda"</span>, <span class="st">"sand_total"</span>, <span class="st">"silt_total"</span>, </span>
<span id="cb263-20"><a href="#cb263-20" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"clay_total"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"total_nitrogen_ncs"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ca_ext"</span>,</span>
<span id="cb263-21"><a href="#cb263-21" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"mg_ext"</span>, <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"sum_of_cations_cec_pH_8_2"</span>)</span>
<span id="cb263-22"><a href="#cb263-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## translate values</span></span>
<span id="cb263-23"><a href="#cb263-23" aria-hidden="true" tabindex="-1"></a>  sco.fun.lst <span class="ot">=</span> <span class="fu">as.list</span>(<span class="fu">rep</span>(<span class="st">"as.numeric(x)*1"</span>, <span class="fu">length</span>(sco.in.name)))</span>
<span id="cb263-24"><a href="#cb263-24" aria-hidden="true" tabindex="-1"></a>  sco.fun.lst[[<span class="fu">which</span>(sco.in.name<span class="sc">==</span><span class="st">"profile_id"</span>)]] <span class="ot">=</span> <span class="st">"paste(x)"</span></span>
<span id="cb263-25"><a href="#cb263-25" aria-hidden="true" tabindex="-1"></a>  sco.fun.lst[[<span class="fu">which</span>(sco.in.name<span class="sc">==</span><span class="st">"exch_ca"</span>)]] <span class="ot">=</span> <span class="st">"as.numeric(x)*200"</span></span>
<span id="cb263-26"><a href="#cb263-26" aria-hidden="true" tabindex="-1"></a>  sco.fun.lst[[<span class="fu">which</span>(sco.in.name<span class="sc">==</span><span class="st">"exch_mg"</span>)]] <span class="ot">=</span> <span class="st">"as.numeric(x)*121"</span></span>
<span id="cb263-27"><a href="#cb263-27" aria-hidden="true" tabindex="-1"></a>  sco.fun.lst[[<span class="fu">which</span>(sco.in.name<span class="sc">==</span><span class="st">"exch_k"</span>)]] <span class="ot">=</span> <span class="st">"as.numeric(x)*391"</span></span>
<span id="cb263-28"><a href="#cb263-28" aria-hidden="true" tabindex="-1"></a>  sco.fun.lst[[<span class="fu">which</span>(sco.in.name<span class="sc">==</span><span class="st">"exch_na"</span>)]] <span class="ot">=</span> <span class="st">"as.numeric(x)*230"</span></span>
<span id="cb263-29"><a href="#cb263-29" aria-hidden="true" tabindex="-1"></a>  sco.fun.lst[[<span class="fu">which</span>(sco.in.name<span class="sc">==</span><span class="st">"carbon"</span>)]] <span class="ot">=</span> <span class="st">"as.numeric(x)*10"</span></span>
<span id="cb263-30"><a href="#cb263-30" aria-hidden="true" tabindex="-1"></a>  sco.fun.lst[[<span class="fu">which</span>(sco.in.name<span class="sc">==</span><span class="st">"nitrogen"</span>)]] <span class="ot">=</span> <span class="st">"as.numeric(x)*10"</span></span>
<span id="cb263-31"><a href="#cb263-31" aria-hidden="true" tabindex="-1"></a>  <span class="do">## save translation rules:</span></span>
<span id="cb263-32"><a href="#cb263-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write.csv(data.frame(sco.in.name, sco.out.name, unlist(sco.fun.lst)), "scotland_soilab_transvalues.csv")</span></span>
<span id="cb263-33"><a href="#cb263-33" aria-hidden="true" tabindex="-1"></a>  sco.soil <span class="ot">=</span> <span class="fu">transvalues</span>(sco.x, sco.out.name, sco.in.name, sco.fun.lst)</span>
<span id="cb263-34"><a href="#cb263-34" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> col.names[<span class="fu">which</span>(<span class="sc">!</span>col.names <span class="sc">%in%</span> <span class="fu">names</span>(sco.soil))]</span>
<span id="cb263-35"><a href="#cb263-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ sco.soil[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb263-36"><a href="#cb263-36" aria-hidden="true" tabindex="-1"></a>  chemsprops.ScotlandNSIS1 <span class="ot">=</span> sco.soil[,col.names]</span>
<span id="cb263-37"><a href="#cb263-37" aria-hidden="true" tabindex="-1"></a>  chemsprops.ScotlandNSIS1<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"ScotlandNSIS1"</span></span>
<span id="cb263-38"><a href="#cb263-38" aria-hidden="true" tabindex="-1"></a>  chemsprops.ScotlandNSIS1<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb263-39"><a href="#cb263-39" aria-hidden="true" tabindex="-1"></a>  chemsprops.ScotlandNSIS1<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"http://soils.environment.gov.scot/"</span></span>
<span id="cb263-40"><a href="#cb263-40" aria-hidden="true" tabindex="-1"></a>  chemsprops.ScotlandNSIS1<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.5281/zenodo.4650230"</span></span>
<span id="cb263-41"><a href="#cb263-41" aria-hidden="true" tabindex="-1"></a>  chemsprops.ScotlandNSIS1 <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.ScotlandNSIS1, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"organic_carbon"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"clay_total"</span>))</span>
<span id="cb263-42"><a href="#cb263-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.ScotlandNSIS1, <span class="st">"/mnt/diskstation/data/Soil_points/Scotland/chemsprops.ScotlandNSIS1.rds"</span>)</span>
<span id="cb263-43"><a href="#cb263-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion
Warning in eval(parse(text = fun.lst[[i]])): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.ScotlandNSIS1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3091   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3091   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ecoforest-map-of-quebec-canada" class="level4">
<h4 class="anchored" data-anchor-id="ecoforest-map-of-quebec-canada">Ecoforest map of Quebec, Canada</h4>
<ul>
<li>Duchesne, L., Ouimet, R., (2021). Digital mapping of soil texture in ecoforest polygons in Quebec, Canada. PeerJ 9:e11685 <a href="https://doi.org/10.7717/peerj.11685" class="uri">https://doi.org/10.7717/peerj.11685</a>. Data download URL: <a href="https://doi.org/10.7717/peerj.11685/supp-1" class="uri">https://doi.org/10.7717/peerj.11685/supp-1</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.QuebecTEX"</span>)){</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>  que.xy <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="fu">gzfile</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Canada/Quebec/RawData.csv.gz"</span>))</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(que.xy$Horizon))</span></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## horizon depths were not measured - we assume 15-30 and 30-80</span></span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>  que.xy<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="fu">ifelse</span>(que.xy<span class="sc">$</span>Horizon<span class="sc">==</span><span class="st">"B"</span>, <span class="dv">15</span>, <span class="dv">30</span>)</span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>  que.xy<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="fu">ifelse</span>(que.xy<span class="sc">$</span>Horizon<span class="sc">==</span><span class="st">"B"</span>, <span class="dv">30</span>, <span class="dv">80</span>)</span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a>  que.xy<span class="sc">$</span>site_key <span class="ot">=</span> que.xy<span class="sc">$</span>usiteid</span>
<span id="cb268-8"><a href="#cb268-8" aria-hidden="true" tabindex="-1"></a>  que.xy<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> que.xy<span class="sc">$</span>Latitude</span>
<span id="cb268-9"><a href="#cb268-9" aria-hidden="true" tabindex="-1"></a>  que.xy<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> que.xy<span class="sc">$</span>Longitude</span>
<span id="cb268-10"><a href="#cb268-10" aria-hidden="true" tabindex="-1"></a>  que.xy<span class="sc">$</span>hzn_desgn <span class="ot">=</span> que.xy<span class="sc">$</span>Horizon</span>
<span id="cb268-11"><a href="#cb268-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## sampling year is unknown but the paper indicates 'The data come from 3 different provincial forest inventory programs... inventoried by provincial forestry authorities since 1970'</span></span>
<span id="cb268-12"><a href="#cb268-12" aria-hidden="true" tabindex="-1"></a>  que.xy<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="dv">2000</span></span>
<span id="cb268-13"><a href="#cb268-13" aria-hidden="true" tabindex="-1"></a>  que.xy<span class="sc">$</span>sand_total <span class="ot">=</span> que.xy<span class="sc">$</span>PC_Sand</span>
<span id="cb268-14"><a href="#cb268-14" aria-hidden="true" tabindex="-1"></a>  que.xy<span class="sc">$</span>silt_total <span class="ot">=</span> que.xy<span class="sc">$</span>PC_Silt</span>
<span id="cb268-15"><a href="#cb268-15" aria-hidden="true" tabindex="-1"></a>  que.xy<span class="sc">$</span>clay_total <span class="ot">=</span> que.xy<span class="sc">$</span>PC_Clay</span>
<span id="cb268-16"><a href="#cb268-16" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> col.names[<span class="fu">which</span>(<span class="sc">!</span>col.names <span class="sc">%in%</span> <span class="fu">names</span>(que.xy))]</span>
<span id="cb268-17"><a href="#cb268-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ que.xy[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb268-18"><a href="#cb268-18" aria-hidden="true" tabindex="-1"></a>  chemsprops.QuebecTEX <span class="ot">=</span> que.xy[,col.names]</span>
<span id="cb268-19"><a href="#cb268-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.QuebecTEX<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"QuebecTEX"</span></span>
<span id="cb268-20"><a href="#cb268-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.QuebecTEX<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb268-21"><a href="#cb268-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.QuebecTEX<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">""</span></span>
<span id="cb268-22"><a href="#cb268-22" aria-hidden="true" tabindex="-1"></a>  chemsprops.QuebecTEX<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.7717/peerj.11685"</span></span>
<span id="cb268-23"><a href="#cb268-23" aria-hidden="true" tabindex="-1"></a>  chemsprops.QuebecTEX <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.QuebecTEX, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"clay_total"</span>))</span>
<span id="cb268-24"><a href="#cb268-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.QuebecTEX, <span class="st">"/mnt/diskstation/data/Soil_points/Canada/chemsprops.QuebecTEX.rds"</span>)</span>
<span id="cb268-25"><a href="#cb268-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb268-26"><a href="#cb268-26" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.QuebecTEX)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 29570    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 29570    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="slovenian-soil-profile-db" class="level4">
<h4 class="anchored" data-anchor-id="slovenian-soil-profile-db">Slovenian soil profile DB</h4>
<ul>
<li>Zorn, M., Breg Valjavec, M., Komac, B., Volk Bahun, M., &amp; Hrvatin, M. (2020). Soils of Slovenia. The Geography of Slovenia: Small But Diverse, 91-107. <a href="https://doi.org/10.1007/978-3-030-14066-3_6" class="uri">https://doi.org/10.1007/978-3-030-14066-3_6</a> Data download: <a href="https://rkg.gov.si/vstop/" class="uri">https://rkg.gov.si/vstop/</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.Slovenia"</span>)){</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>  slo.xy <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Slovenia/PedoloskiProfili.shp"</span>)</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>  slo.sf <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(slo.xy, <span class="st">"epsg:4326"</span>)</span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>  slo.df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="fu">as.data.frame</span>(slo.sf), <span class="fu">st_coordinates</span>(slo.sf)))</span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>  slo.hor <span class="ot">=</span> foreign<span class="sc">::</span><span class="fu">read.dbf</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Slovenia/Horizonti_v_PedoloskihProfilih.DBF"</span>, <span class="at">as.is=</span><span class="cn">TRUE</span>)</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>  sloALL <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(slo.hor, slo.df)</span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a>  sloALL <span class="ot">=</span> sloALL[<span class="sc">!</span><span class="fu">is.na</span>(sloALL<span class="sc">$</span>X<span class="fl">.1</span>),]</span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## [1] 11509    71</span></span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(sloALL[,c("X.1","Y.1")], pch="+")</span></span>
<span id="cb271-10"><a href="#cb271-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## year of sampling</span></span>
<span id="cb271-11"><a href="#cb271-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(sloALL$LETO))</span></span>
<span id="cb271-12"><a href="#cb271-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Walkely-Black: K2Cr2O7/H2SO4</span></span>
<span id="cb271-13"><a href="#cb271-13" aria-hidden="true" tabindex="-1"></a>  sloALL<span class="sc">$</span>organic_carbon <span class="ot">=</span> <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>OGLJ<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> (sloALL<span class="sc">$</span>PHH<span class="sc">==</span><span class="dv">0</span>), <span class="cn">NA</span>, sloALL<span class="sc">$</span>OGLJ) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">1.3</span> <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb271-14"><a href="#cb271-14" aria-hidden="true" tabindex="-1"></a>  sloALL<span class="sc">$</span>total_nitrogen_ncs <span class="ot">=</span> <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>DUSIK<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> (sloALL<span class="sc">$</span>PHH<span class="sc">==</span><span class="dv">0</span>), <span class="cn">NA</span>, sloALL<span class="sc">$</span>DUSIK) <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb271-15"><a href="#cb271-15" aria-hidden="true" tabindex="-1"></a>  sloALL<span class="sc">$</span>ph_kcl <span class="ot">=</span> <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>PHK <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">|</span> sloALL<span class="sc">$</span>PHK <span class="sc">&gt;</span> <span class="fl">9.5</span>, <span class="cn">NA</span>, sloALL<span class="sc">$</span>PHK)</span>
<span id="cb271-16"><a href="#cb271-16" aria-hidden="true" tabindex="-1"></a>  sloALL<span class="sc">$</span>ph_h2o <span class="ot">=</span> <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>PHH <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">|</span> sloALL<span class="sc">$</span>PHH <span class="sc">&gt;</span> <span class="fl">9.5</span>, <span class="cn">NA</span>, sloALL<span class="sc">$</span>PHH)</span>
<span id="cb271-17"><a href="#cb271-17" aria-hidden="true" tabindex="-1"></a>  sloALL<span class="sc">$</span>ph_cacl2 <span class="ot">=</span> <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>PHCA <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">|</span> sloALL<span class="sc">$</span>PHCA <span class="sc">&gt;</span> <span class="fl">9.5</span>, <span class="cn">NA</span>, sloALL<span class="sc">$</span>PHCA)</span>
<span id="cb271-18"><a href="#cb271-18" aria-hidden="true" tabindex="-1"></a>  sloALL<span class="sc">$</span>sum_of_cations_cec_pH_8_2 <span class="ot">=</span> <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>S<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> sloALL<span class="sc">$</span>PHH<span class="sc">==</span><span class="dv">0</span>, <span class="cn">NA</span>, sloALL<span class="sc">$</span>S)</span>
<span id="cb271-19"><a href="#cb271-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(sloALL$SKELET))</span></span>
<span id="cb271-20"><a href="#cb271-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## increadible &gt;1000 differnt ways coarse fragments were entered!</span></span>
<span id="cb271-21"><a href="#cb271-21" aria-hidden="true" tabindex="-1"></a>  sloALL<span class="sc">$</span>total_frag_wt_pct_gt_2_mm_ws <span class="ot">=</span> <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>SKELET<span class="sc">==</span><span class="st">"5%"</span>, <span class="dv">5</span>, </span>
<span id="cb271-22"><a href="#cb271-22" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>SKELET<span class="sc">==</span><span class="st">"10%"</span>, <span class="dv">10</span>,</span>
<span id="cb271-23"><a href="#cb271-23" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>SKELET<span class="sc">==</span><span class="st">"20%"</span>, <span class="dv">20</span>, </span>
<span id="cb271-24"><a href="#cb271-24" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>SKELET<span class="sc">==</span><span class="st">"30%"</span>, <span class="dv">30</span>,</span>
<span id="cb271-25"><a href="#cb271-25" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>SKELET<span class="sc">==</span><span class="st">"40%"</span>, <span class="dv">40</span>,</span>
<span id="cb271-26"><a href="#cb271-26" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>SKELET<span class="sc">==</span><span class="st">"50%"</span>, <span class="dv">50</span>,</span>
<span id="cb271-27"><a href="#cb271-27" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>SKELET<span class="sc">==</span><span class="st">"60%"</span>, <span class="dv">60</span>,</span>
<span id="cb271-28"><a href="#cb271-28" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>SKELET<span class="sc">==</span><span class="st">"70%"</span>, <span class="dv">70</span>,</span>
<span id="cb271-29"><a href="#cb271-29" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>SKELET<span class="sc">==</span><span class="st">"5-10%"</span>, <span class="fl">7.5</span>,</span>
<span id="cb271-30"><a href="#cb271-30" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(sloALL<span class="sc">$</span>SKELET<span class="sc">==</span><span class="st">"/"</span>, <span class="dv">0</span>, <span class="cn">NA</span>))))))))))</span>
<span id="cb271-31"><a href="#cb271-31" aria-hidden="true" tabindex="-1"></a>  sloALL<span class="sc">$</span>sand_total <span class="ot">&lt;-</span> sloALL<span class="sc">$</span>PES <span class="sc">*</span> <span class="fl">0.8</span> <span class="sc">+</span> sloALL<span class="sc">$</span>MELJG</span>
<span id="cb271-32"><a href="#cb271-32" aria-hidden="true" tabindex="-1"></a>  sloALL<span class="sc">$</span>silt_total <span class="ot">=</span> <span class="dv">100</span> <span class="sc">-</span> (sloALL<span class="sc">$</span>sand_total <span class="sc">+</span> sloALL<span class="sc">$</span>GLINA)</span>
<span id="cb271-33"><a href="#cb271-33" aria-hidden="true" tabindex="-1"></a>  slo.name <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ZPP"</span>, <span class="st">"SPP"</span>, <span class="st">"LETO"</span>, <span class="st">"X.1"</span>, <span class="st">"Y.1"</span>, <span class="st">"SSL_classification_name"</span>,  </span>
<span id="cb271-34"><a href="#cb271-34" aria-hidden="true" tabindex="-1"></a>               <span class="st">"LABST"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"GLZG"</span>, <span class="st">"GLSP"</span>, </span>
<span id="cb271-35"><a href="#cb271-35" aria-hidden="true" tabindex="-1"></a>              <span class="st">"HORIZ"</span>, <span class="st">"TRZ"</span>, <span class="st">"texture_lab"</span>, <span class="st">"GLINA"</span>, <span class="st">"silt_total"</span>, </span>
<span id="cb271-36"><a href="#cb271-36" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sand_total"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"total_carbon_ncs"</span>, <span class="st">"total_nitrogen_ncs"</span>, </span>
<span id="cb271-37"><a href="#cb271-37" aria-hidden="true" tabindex="-1"></a>              <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, </span>
<span id="cb271-38"><a href="#cb271-38" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sum_of_cations_cec_pH_8_2"</span>, <span class="st">"cec_nh4_ph_7"</span>, <span class="st">"ecec_base_plus_aluminum"</span>, </span>
<span id="cb271-39"><a href="#cb271-39" aria-hidden="true" tabindex="-1"></a>              <span class="st">"total_frag_wt_pct_gt_2_mm_ws"</span>, <span class="st">"bulk_density_oven_dry"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, </span>
<span id="cb271-40"><a href="#cb271-40" aria-hidden="true" tabindex="-1"></a>              <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)</span>
<span id="cb271-41"><a href="#cb271-41" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> slo.name[<span class="fu">which</span>(<span class="sc">!</span>slo.name <span class="sc">%in%</span> <span class="fu">names</span>(sloALL))]</span>
<span id="cb271-42"><a href="#cb271-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ sloALL[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb271-43"><a href="#cb271-43" aria-hidden="true" tabindex="-1"></a>  chemsprops.Slovenia <span class="ot">=</span> sloALL[,slo.name]</span>
<span id="cb271-44"><a href="#cb271-44" aria-hidden="true" tabindex="-1"></a>  chemsprops.Slovenia<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Slovenia.SPDB"</span></span>
<span id="cb271-45"><a href="#cb271-45" aria-hidden="true" tabindex="-1"></a>  chemsprops.Slovenia<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb271-46"><a href="#cb271-46" aria-hidden="true" tabindex="-1"></a>  chemsprops.Slovenia<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://rkg.gov.si/vstop/"</span></span>
<span id="cb271-47"><a href="#cb271-47" aria-hidden="true" tabindex="-1"></a>  chemsprops.Slovenia<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1007/978-3-030-14066-3_6"</span></span>
<span id="cb271-48"><a href="#cb271-48" aria-hidden="true" tabindex="-1"></a>  chemsprops.Slovenia <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.Slovenia, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"organic_carbon"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"GLINA"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"X.1"</span>, <span class="st">"Y.1"</span>))</span>
<span id="cb271-49"><a href="#cb271-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.Slovenia, <span class="st">"/mnt/diskstation/data/Soil_points/Slovenia/chemsprops.Slovenia.rds"</span>)</span>
<span id="cb271-50"><a href="#cb271-50" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Field name: 'NA' changed to: 'NA.'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(ZPP)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.Slovenia)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11509    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 11509    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="portugal-infosolo" class="level4">
<h4 class="anchored" data-anchor-id="portugal-infosolo">Portugal INFOSOLO</h4>
<ul>
<li>Ramos, T. B., Horta, A., Gonçalves, M. C., Pires, F. P., Duffy, D., &amp; Martins, J. C. (2017). The INFOSOLO database as a first step towards the development of a soil information system in Portugal. Catena, 158, 390-412. <a href="http://dx.doi.org/10.1016/j.catena.2017.07.020" class="uri">http://dx.doi.org/10.1016/j.catena.2017.07.020</a></li>
</ul>
<p>Note: INFOSOLO project <a href="https://projects.iniav.pt/infosolo/" class="uri">https://projects.iniav.pt/infosolo/</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.INFOSOLO"</span>)){</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>  port.nam <span class="ot">=</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Portugal/description.txt"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>),]</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>  port.site <span class="ot">=</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Portugal/soil.txt"</span>, <span class="at">col_names =</span> <span class="fu">make.names</span>(port.nam<span class="sc">$</span>X2[port.nam<span class="sc">$</span>X3<span class="sc">==</span><span class="st">"Soil"</span>]))</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>  hor.nm.port <span class="ot">=</span> <span class="fu">make.names</span>(port.nam<span class="sc">$</span>X2[port.nam<span class="sc">$</span>X3<span class="sc">==</span><span class="st">"Properties"</span>])</span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>  port.hor <span class="ot">=</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"/mnt/diskstation/data/Soil_points/Portugal/properties.txt"</span>, <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"ID2"</span>, <span class="st">"ID1"</span>, hor.nm.port[<span class="sc">-</span><span class="dv">1</span>]), <span class="at">na =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">N"</span>))</span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>  portALL <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(port.hor, port.site, <span class="at">by =</span> <span class="st">"ID1"</span>)</span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## [1] 9934   51</span></span>
<span id="cb277-8"><a href="#cb277-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(portALL[,c("Long","Lat")], pch="+", asp=1)</span></span>
<span id="cb277-9"><a href="#cb277-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## year of sampling</span></span>
<span id="cb277-10"><a href="#cb277-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(portALL$Year))</span></span>
<span id="cb277-11"><a href="#cb277-11" aria-hidden="true" tabindex="-1"></a>  portALL<span class="sc">$</span>organic_carbon <span class="ot">=</span> portALL<span class="sc">$</span>OC <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb277-12"><a href="#cb277-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 41 Walkley-Black</span></span>
<span id="cb277-13"><a href="#cb277-13" aria-hidden="true" tabindex="-1"></a>  portALL<span class="sc">$</span>organic_carbon[<span class="fu">which</span>(portALL<span class="sc">$</span>OC_M<span class="sc">==</span><span class="dv">41</span>)] <span class="ot">=</span> portALL<span class="sc">$</span>organic_carbon[<span class="fu">which</span>(portALL<span class="sc">$</span>OC_M<span class="sc">==</span><span class="dv">41</span>)] <span class="sc">*</span> <span class="fl">1.3</span></span>
<span id="cb277-14"><a href="#cb277-14" aria-hidden="true" tabindex="-1"></a>  portALL<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">signif</span>(portALL<span class="sc">$</span>organic_carbon <span class="sc">*</span> portALL<span class="sc">$</span>BD <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(portALL<span class="sc">$</span>Coarse), <span class="dv">0</span>, portALL<span class="sc">$</span>Coarse))<span class="sc">/</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb277-15"><a href="#cb277-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(portALL$oc_d)</span></span>
<span id="cb277-16"><a href="#cb277-16" aria-hidden="true" tabindex="-1"></a>  portALL<span class="sc">$</span>sand_total <span class="ot">&lt;-</span> portALL<span class="sc">$</span>FS <span class="sc">*</span> <span class="fl">0.8</span> <span class="sc">+</span> portALL<span class="sc">$</span>CS</span>
<span id="cb277-17"><a href="#cb277-17" aria-hidden="true" tabindex="-1"></a>  portALL<span class="sc">$</span>silt_total <span class="ot">=</span> <span class="dv">100</span> <span class="sc">-</span> (portALL<span class="sc">$</span>sand_total <span class="sc">+</span> portALL<span class="sc">$</span>C)</span>
<span id="cb277-18"><a href="#cb277-18" aria-hidden="true" tabindex="-1"></a>  portALL<span class="sc">$</span>k_ext <span class="ot">=</span> portALL<span class="sc">$</span>K...<span class="dv">28</span> <span class="sc">*</span> <span class="dv">391</span></span>
<span id="cb277-19"><a href="#cb277-19" aria-hidden="true" tabindex="-1"></a>  portALL<span class="sc">$</span>ca_ext <span class="ot">=</span> portALL<span class="sc">$</span>Ca <span class="sc">*</span> <span class="dv">200</span></span>
<span id="cb277-20"><a href="#cb277-20" aria-hidden="true" tabindex="-1"></a>  portALL<span class="sc">$</span>mg_ext <span class="ot">=</span> portALL<span class="sc">$</span>Mg <span class="sc">*</span> <span class="dv">121</span></span>
<span id="cb277-21"><a href="#cb277-21" aria-hidden="true" tabindex="-1"></a>  portALL<span class="sc">$</span>na_ext <span class="ot">=</span> portALL<span class="sc">$</span>Na <span class="sc">*</span> <span class="dv">230</span></span>
<span id="cb277-22"><a href="#cb277-22" aria-hidden="true" tabindex="-1"></a>  port.name <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Profile_ID"</span>, <span class="st">"ID1"</span>, <span class="st">"Year"</span>, <span class="st">"Long"</span>, <span class="st">"Lat"</span>, <span class="st">"SSL_classification_name"</span>,  </span>
<span id="cb277-23"><a href="#cb277-23" aria-hidden="true" tabindex="-1"></a>               <span class="st">"labsampnum"</span>, <span class="st">"layer_key"</span>, <span class="st">"layer_sequence"</span>, <span class="st">"Hor_top"</span>, <span class="st">"Hor_bot"</span>, </span>
<span id="cb277-24"><a href="#cb277-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Hor_name"</span>, <span class="st">"texture_description"</span>, <span class="st">"texture_lab"</span>, <span class="st">"C"</span>, <span class="st">"silt_total"</span>, </span>
<span id="cb277-25"><a href="#cb277-25" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sand_total"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"total_carbon_ncs"</span>, <span class="st">"N"</span>, </span>
<span id="cb277-26"><a href="#cb277-26" aria-hidden="true" tabindex="-1"></a>              <span class="st">"ph_kcl"</span>, <span class="st">"pH"</span>, <span class="st">"ph_cacl2"</span>, </span>
<span id="cb277-27"><a href="#cb277-27" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sum_of_cations_cec_pH_8_2"</span>, <span class="st">"CEC"</span>, <span class="st">"ecec_base_plus_aluminum"</span>, </span>
<span id="cb277-28"><a href="#cb277-28" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Coarse"</span>, <span class="st">"BD"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, </span>
<span id="cb277-29"><a href="#cb277-29" aria-hidden="true" tabindex="-1"></a>              <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)</span>
<span id="cb277-30"><a href="#cb277-30" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> port.name[<span class="fu">which</span>(<span class="sc">!</span>port.name <span class="sc">%in%</span> <span class="fu">names</span>(portALL))]</span>
<span id="cb277-31"><a href="#cb277-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ portALL[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb277-32"><a href="#cb277-32" aria-hidden="true" tabindex="-1"></a>  chemsprops.PT.INFOSOLO <span class="ot">=</span> portALL[,port.name]</span>
<span id="cb277-33"><a href="#cb277-33" aria-hidden="true" tabindex="-1"></a>  chemsprops.PT.INFOSOLO<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Portugal.INFOSOLO"</span></span>
<span id="cb277-34"><a href="#cb277-34" aria-hidden="true" tabindex="-1"></a>  chemsprops.PT.INFOSOLO<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb277-35"><a href="#cb277-35" aria-hidden="true" tabindex="-1"></a>  chemsprops.PT.INFOSOLO<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://projects.iniav.pt/infosolo/"</span></span>
<span id="cb277-36"><a href="#cb277-36" aria-hidden="true" tabindex="-1"></a>  chemsprops.PT.INFOSOLO<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"http://dx.doi.org/10.1016/j.catena.2017.07.020"</span></span>
<span id="cb277-37"><a href="#cb277-37" aria-hidden="true" tabindex="-1"></a>  chemsprops.PT.INFOSOLO <span class="ot">=</span> <span class="fu">complete.vars</span>(chemsprops.PT.INFOSOLO, <span class="at">sel =</span> <span class="fu">c</span>(<span class="st">"organic_carbon"</span>, <span class="st">"pH"</span>, <span class="st">"C"</span>), <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Long"</span>, <span class="st">"Lat"</span>))</span>
<span id="cb277-38"><a href="#cb277-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.PT.INFOSOLO, <span class="st">"/mnt/diskstation/data/Soil_points/Portugal/chemsprops.PT.INFOSOLO.rds"</span>)</span>
<span id="cb277-39"><a href="#cb277-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 60 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr (4): X2, X3, X4, X5
dbl (1): X1

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 3461 Columns: 16
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr (10): Profile_ID, Soil, Qualifier.2, Qualifier.3, WRB, Parent.Material, ...
dbl  (6): ID1, Long, Lat, Year, Qualifier.1, Land.Use

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
New names:
Rows: 9934 Columns: 36
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): Hor_name
dbl (35): ID2, ID1, Hor_top, Hor_bot, Coarse, CS, FS, Si, C, Texture_M, BD, ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.PT.INFOSOLO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9934   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 9934   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="multisite-soc-evaluation" class="level4">
<h4 class="anchored" data-anchor-id="multisite-soc-evaluation">Multisite SOC evaluation</h4>
<ul>
<li>Potash, E., Guan, K., Margenot, A. J., Lee, D., Boe, A., Douglass, M., … &amp; Zumpf, C. (2023). Multi-site evaluation of stratified and balanced sampling of soil organic carbon stocks in agricultural fields. Geoderma, 438, 116587. <a href="https://doi.org/10.1016/j.geoderma.2023.116587" class="uri">https://doi.org/10.1016/j.geoderma.2023.116587</a> data download: <a href="https://doi.org/10.6084/m9.figshare.23669304" class="uri">https://doi.org/10.6084/m9.figshare.23669304</a></li>
</ul>
<p>Note: This is relatively small data set focused on 8 commercial fields / farms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.Potash2023"</span>)){</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>  multisite.xy <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/USA/Multi_site_evaluation/locations.csv"</span>)</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>  multisite.lb <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"/mnt/diskstation/data/Soil_points/USA/Multi_site_evaluation/measurements.csv"</span>)</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>  multisite.lb<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(multisite.lb<span class="sc">$</span>SOCc) <span class="sc">*</span> <span class="dv">10</span> <span class="sc">*</span> multisite.lb<span class="sc">$</span>BD, <span class="dv">2</span>)</span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(multisite.lb$oc_d)</span></span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>  multisite.lb<span class="sc">$</span>organic_carbon <span class="ot">=</span> multisite.lb<span class="sc">$</span>SOCc<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>  multisite.lb<span class="sc">$</span>site_key <span class="ot">=</span> multisite.lb<span class="sc">$</span>location_id</span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a>  multisite.lb<span class="sc">$</span>bulk_density_oven_dry <span class="ot">=</span> multisite.lb<span class="sc">$</span>BD</span>
<span id="cb282-9"><a href="#cb282-9" aria-hidden="true" tabindex="-1"></a>  multisite.lb<span class="sc">$</span>site_obsdate <span class="ot">=</span> <span class="dv">2021</span></span>
<span id="cb282-10"><a href="#cb282-10" aria-hidden="true" tabindex="-1"></a>  multisite.lb<span class="sc">$</span>hzn_top <span class="ot">=</span> multisite.lb<span class="sc">$</span>sample_depth_min</span>
<span id="cb282-11"><a href="#cb282-11" aria-hidden="true" tabindex="-1"></a>  multisite.lb<span class="sc">$</span>hzn_bot <span class="ot">=</span> multisite.lb<span class="sc">$</span>sample_depth_max</span>
<span id="cb282-12"><a href="#cb282-12" aria-hidden="true" tabindex="-1"></a>  multisite.xy<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> multisite.xy<span class="sc">$</span>X</span>
<span id="cb282-13"><a href="#cb282-13" aria-hidden="true" tabindex="-1"></a>  multisite.xy<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> multisite.xy<span class="sc">$</span>Y</span>
<span id="cb282-14"><a href="#cb282-14" aria-hidden="true" tabindex="-1"></a>  multisite.lb<span class="sc">$</span>longitude_decimal_degrees <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(multisite.lb[<span class="st">"location_id"</span>], multisite.xy, <span class="at">match =</span> <span class="st">"first"</span>)<span class="sc">$</span>longitude_decimal_degrees</span>
<span id="cb282-15"><a href="#cb282-15" aria-hidden="true" tabindex="-1"></a>  multisite.lb<span class="sc">$</span>latitude_decimal_degrees <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(multisite.lb[<span class="st">"location_id"</span>], multisite.xy, <span class="at">match =</span> <span class="st">"first"</span>)<span class="sc">$</span>latitude_decimal_degrees</span>
<span id="cb282-16"><a href="#cb282-16" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> col.names[<span class="fu">which</span>(<span class="sc">!</span>col.names <span class="sc">%in%</span> <span class="fu">names</span>(multisite.lb))]</span>
<span id="cb282-17"><a href="#cb282-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ multisite.lb[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb282-18"><a href="#cb282-18" aria-hidden="true" tabindex="-1"></a>  chemsprops.Potash2023 <span class="ot">=</span> multisite.lb[,col.names]</span>
<span id="cb282-19"><a href="#cb282-19" aria-hidden="true" tabindex="-1"></a>  chemsprops.Potash2023<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"Potash_et_al_2023"</span></span>
<span id="cb282-20"><a href="#cb282-20" aria-hidden="true" tabindex="-1"></a>  chemsprops.Potash2023<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://sustainability.illinois.edu/new-method-shows-promise-for-accurate-efficient-soil-carbon-estimates/"</span></span>
<span id="cb282-21"><a href="#cb282-21" aria-hidden="true" tabindex="-1"></a>  chemsprops.Potash2023<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1016/j.geoderma.2023.116587"</span></span>
<span id="cb282-22"><a href="#cb282-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.Potash2023, <span class="st">"/mnt/diskstation/data/Soil_points/USA/Multi_site_evaluation/chemsprops.Potash2023.rds"</span>)</span>
<span id="cb282-23"><a href="#cb282-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: location_id
Joining by: location_id</code></pre>
</div>
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.Potash2023)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3977   39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3977   39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="glance-pseudo-samples" class="level4">
<h4 class="anchored" data-anchor-id="glance-pseudo-samples">GLANCE pseudo-samples</h4>
<ul>
<li>Stanimirova, R., Tarrio, K., Turlej, K., McAvoy, K., Stonebrook, S., Hu, K. T., … &amp; Friedl, M. A. (2023). A global land cover training dataset from 1984 to 2020. Scientific Data, 10(1), 879. <a href="https://doi.org/10.1038/s41597-023-02798-5" class="uri">https://doi.org/10.1038/s41597-023-02798-5</a></li>
</ul>
<p>Note: Pseudo-observations based on GLANCE points; use only class “6” which is sand surface;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"chemsprops.GLANCE"</span>)){</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 0 soil organic carbon + 99% sand content (deserts)</span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>  bare <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"/data/wri_soil/bu_glance_training_dataV1.gpkg"</span>)</span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Level 2 land cover value (integer): 1 (Water), 2 (Ice/snow), 3 (Developed), 4 (Soil), </span></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5 (Rock), 6 (Beach/sand), 7 (Deciduous), 8 (Evergreen), 9 (Mixed), 10 (Shrub), </span></span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 11 (Grassland), 12 (Agriculture), and 13 (Moss/lichen). NaN values present.</span></span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a>  bare <span class="ot">=</span> bare[(bare<span class="sc">$</span>Glance_Class_ID_level2<span class="sc">==</span><span class="dv">5</span><span class="sc">|</span>bare<span class="sc">$</span>Glance_Class_ID_level2<span class="sc">==</span><span class="dv">6</span>),]</span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dim(bare)</span></span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#[1] 13057    21</span></span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(bare$Glance_Class_ID_level2))</span></span>
<span id="cb287-11"><a href="#cb287-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    5    6 </span></span>
<span id="cb287-12"><a href="#cb287-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 9972 3085  </span></span>
<span id="cb287-13"><a href="#cb287-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#bare = bare[bare$Glance_Class_ID_level2==6,]</span></span>
<span id="cb287-14"><a href="#cb287-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Not all "Rock" classes are surface rock - needs visual check</span></span>
<span id="cb287-15"><a href="#cb287-15" aria-hidden="true" tabindex="-1"></a>  g100km <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">vect</span>(<span class="st">"/data/CCI_LandCover/tiles_GH_100km_land.gpkg"</span>)</span>
<span id="cb287-16"><a href="#cb287-16" aria-hidden="true" tabindex="-1"></a>  ov.g100km <span class="ot">=</span> <span class="fu">extract</span>(g100km, terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">vect</span>(bare), <span class="fu">crs</span>(g100km)))</span>
<span id="cb287-17"><a href="#cb287-17" aria-hidden="true" tabindex="-1"></a>  ov.g100km<span class="sc">$</span>Glance_ID <span class="ot">=</span> bare<span class="sc">$</span>Glance_ID</span>
<span id="cb287-18"><a href="#cb287-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(ov.g100km$ID))</span></span>
<span id="cb287-19"><a href="#cb287-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## randomly subset up to max 30 points per 100x100km tile</span></span>
<span id="cb287-20"><a href="#cb287-20" aria-hidden="true" tabindex="-1"></a>  ov.g100km.s <span class="ot">&lt;-</span> ov.g100km[,<span class="fu">c</span>(<span class="st">"Glance_ID"</span>, <span class="st">"ID"</span>)] <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">sample</span>(<span class="fu">n</span>(), <span class="fu">min</span>(<span class="dv">30</span>, <span class="fu">n</span>()))) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb287-21"><a href="#cb287-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 6878 points in total</span></span>
<span id="cb287-22"><a href="#cb287-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summary(as.factor(ov.g100km.s$ID))</span></span>
<span id="cb287-23"><a href="#cb287-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(bare["Dataset_Code"])</span></span>
<span id="cb287-24"><a href="#cb287-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write_sf(bare, "/data/wri_soil/bu_glance_sand_barerock_V1.gpkg")</span></span>
<span id="cb287-25"><a href="#cb287-25" aria-hidden="true" tabindex="-1"></a>  bare.s <span class="ot">=</span> bare[bare<span class="sc">$</span>Glance_ID <span class="sc">%in%</span> ov.g100km.s<span class="sc">$</span>Glance_ID,]</span>
<span id="cb287-26"><a href="#cb287-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot(bare.s["Glance_Class_ID_level2"])</span></span>
<span id="cb287-27"><a href="#cb287-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(bare.s)</span></span>
<span id="cb287-28"><a href="#cb287-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 6,878 points</span></span>
<span id="cb287-29"><a href="#cb287-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Add world peaks (http://www.peaklist.org/ultras.html)</span></span>
<span id="cb287-30"><a href="#cb287-30" aria-hidden="true" tabindex="-1"></a>  pks <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"/data/CCI_LandCover/ultrasgoogle052007.KMZ"</span>)</span>
<span id="cb287-31"><a href="#cb287-31" aria-hidden="true" tabindex="-1"></a>  pks.df <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="fu">cbind</span>(<span class="fu">as.data.frame</span>(pks), <span class="fu">st_coordinates</span>(pks)))</span>
<span id="cb287-32"><a href="#cb287-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1524 world peaks</span></span>
<span id="cb287-33"><a href="#cb287-33" aria-hidden="true" tabindex="-1"></a>  pks.df<span class="sc">$</span>Start_Year <span class="ot">=</span> <span class="dv">2000</span></span>
<span id="cb287-34"><a href="#cb287-34" aria-hidden="true" tabindex="-1"></a>  pks.df<span class="sc">$</span>End_Year <span class="ot">=</span> <span class="dv">2022</span></span>
<span id="cb287-35"><a href="#cb287-35" aria-hidden="true" tabindex="-1"></a>  pks.df<span class="sc">$</span>Glance_ID <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"ultras_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pks.df))</span>
<span id="cb287-36"><a href="#cb287-36" aria-hidden="true" tabindex="-1"></a>  pks.df<span class="sc">$</span>Lon <span class="ot">=</span> pks.df<span class="sc">$</span>X</span>
<span id="cb287-37"><a href="#cb287-37" aria-hidden="true" tabindex="-1"></a>  pks.df<span class="sc">$</span>Lat <span class="ot">=</span> pks.df<span class="sc">$</span>Y</span>
<span id="cb287-38"><a href="#cb287-38" aria-hidden="true" tabindex="-1"></a>  pks.df<span class="sc">$</span>Glance_Class_ID_level2 <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb287-39"><a href="#cb287-39" aria-hidden="true" tabindex="-1"></a>  <span class="do">## bind GLANCE and Ultras</span></span>
<span id="cb287-40"><a href="#cb287-40" aria-hidden="true" tabindex="-1"></a>  sel.glnc <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Glance_ID"</span>, <span class="st">"Lon"</span>, <span class="st">"Lat"</span>, <span class="st">"Start_Year"</span>, <span class="st">"End_Year"</span>, <span class="st">"Glance_Class_ID_level2"</span>)</span>
<span id="cb287-41"><a href="#cb287-41" aria-hidden="true" tabindex="-1"></a>  bare.df <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">as.data.frame</span>(bare.s)[,sel.glnc], <span class="fu">st_coordinates</span>(bare.s))</span>
<span id="cb287-42"><a href="#cb287-42" aria-hidden="true" tabindex="-1"></a>  bare.df <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(bare.df, <span class="fu">as.data.frame</span>(pks.df)[,<span class="fu">names</span>(bare.df)]))</span>
<span id="cb287-43"><a href="#cb287-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#View(bare.df)</span></span>
<span id="cb287-44"><a href="#cb287-44" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Extend to start end periods:</span></span>
<span id="cb287-45"><a href="#cb287-45" aria-hidden="true" tabindex="-1"></a>  bare.ex <span class="ot">=</span> <span class="fu">as.data.frame</span>(data.table<span class="sc">::</span><span class="fu">setDT</span>(bare.df)[ , <span class="fu">list</span>(<span class="at">site_key=</span>Glance_ID, <span class="at">Glance_Class_ID_level2=</span>Glance_Class_ID_level2, <span class="at">X=</span>X, <span class="at">Y=</span>Y, <span class="at">longitude_decimal_degrees=</span>Lon, <span class="at">latitude_decimal_degrees=</span>Lat, <span class="at">site_obsdate =</span> <span class="fu">seq</span>(Start_Year, End_Year)), <span class="at">by =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(bare.df)])</span>
<span id="cb287-46"><a href="#cb287-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dim(bare.ex)</span></span>
<span id="cb287-47"><a href="#cb287-47" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 151320 spacetime points!</span></span>
<span id="cb287-48"><a href="#cb287-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write.csv(bare.ex, gzfile("/data/wri_soil/bare_soil_pnts.csv.gz"))</span></span>
<span id="cb287-49"><a href="#cb287-49" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Remove all points that are NOT bare areas on the most detailed GLC (30m resolution)</span></span>
<span id="cb287-50"><a href="#cb287-50" aria-hidden="true" tabindex="-1"></a>  ov.bare.ex <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">extract</span>(</span>
<span id="cb287-51"><a href="#cb287-51" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"/data/CCI_LandCover/lc_glc.fcs30d_c_30m_s_20220101_20221231_go_epsg.4326_v20231026.tif"</span>), </span>
<span id="cb287-52"><a href="#cb287-52" aria-hidden="true" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">vect</span>(bare.ex, <span class="at">geom=</span><span class="fu">c</span>(<span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>), <span class="at">crs=</span><span class="st">"EPSG:4326"</span>))</span>
<span id="cb287-53"><a href="#cb287-53" aria-hidden="true" tabindex="-1"></a>  bare.ex <span class="ot">=</span> bare.ex[ov.bare.ex[,<span class="st">"lc_glc.fcs30d_c_30m_s_20220101_20221231_go_epsg.4326_v20231026"</span>] <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">190</span>,<span class="dv">200</span>,<span class="dv">201</span>,<span class="dv">202</span>,<span class="dv">220</span>),]</span>
<span id="cb287-54"><a href="#cb287-54" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(bare.ex)</span></span>
<span id="cb287-55"><a href="#cb287-55" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 80652 spacetime pnts </span></span>
<span id="cb287-56"><a href="#cb287-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">#str(levels(as.factor(bare.ex$site_key)))</span></span>
<span id="cb287-57"><a href="#cb287-57" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4680 unique locations</span></span>
<span id="cb287-58"><a href="#cb287-58" aria-hidden="true" tabindex="-1"></a>  <span class="do">## insert zeros for all nutrients except for the once we are not sure:</span></span>
<span id="cb287-59"><a href="#cb287-59" aria-hidden="true" tabindex="-1"></a>  <span class="do">## http://www.decodedscience.org/chemistry-sahara-sand-elements-dunes/45828</span></span>
<span id="cb287-60"><a href="#cb287-60" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>oc_d <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb287-61"><a href="#cb287-61" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>organic_carbon <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb287-62"><a href="#cb287-62" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>total_carbon_ncs <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb287-63"><a href="#cb287-63" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>total_nitrogen_ncs <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb287-64"><a href="#cb287-64" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>k_ext <span class="ot">=</span> <span class="fu">ifelse</span>(bare.ex<span class="sc">$</span>Glance_Class_ID_level2<span class="sc">==</span><span class="dv">6</span>, <span class="dv">0</span>, <span class="cn">NA</span>)</span>
<span id="cb287-65"><a href="#cb287-65" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>mg_ext <span class="ot">=</span> <span class="fu">ifelse</span>(bare.ex<span class="sc">$</span>Glance_Class_ID_level2<span class="sc">==</span><span class="dv">6</span>, <span class="dv">0</span>, <span class="cn">NA</span>)</span>
<span id="cb287-66"><a href="#cb287-66" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>clay_total <span class="ot">=</span> <span class="fu">ifelse</span>(bare.ex<span class="sc">$</span>Glance_Class_ID_level2<span class="sc">==</span><span class="dv">6</span>, <span class="dv">0</span>, <span class="cn">NA</span>)</span>
<span id="cb287-67"><a href="#cb287-67" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>sand_total <span class="ot">=</span> <span class="fu">ifelse</span>(bare.ex<span class="sc">$</span>Glance_Class_ID_level2<span class="sc">==</span><span class="dv">6</span>, <span class="dv">100</span>, <span class="cn">NA</span>)</span>
<span id="cb287-68"><a href="#cb287-68" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>silt_total <span class="ot">=</span> <span class="fu">ifelse</span>(bare.ex<span class="sc">$</span>Glance_Class_ID_level2<span class="sc">==</span><span class="dv">6</span>, <span class="dv">0</span>, <span class="cn">NA</span>)</span>
<span id="cb287-69"><a href="#cb287-69" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>bulk_density_oven_dry <span class="ot">=</span> <span class="fu">ifelse</span>(bare.ex<span class="sc">$</span>Glance_Class_ID_level2<span class="sc">==</span><span class="dv">6</span>, <span class="fl">1.6</span>, <span class="cn">NA</span>)</span>
<span id="cb287-70"><a href="#cb287-70" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"GLANCE"</span></span>
<span id="cb287-71"><a href="#cb287-71" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>hzn_top <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb287-72"><a href="#cb287-72" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>hzn_bot <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb287-73"><a href="#cb287-73" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>source_db <span class="ot">=</span> <span class="st">"GLanCE.points"</span></span>
<span id="cb287-74"><a href="#cb287-74" aria-hidden="true" tabindex="-1"></a>  bare.ex<span class="sc">$</span>confidence_degree <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb287-75"><a href="#cb287-75" aria-hidden="true" tabindex="-1"></a>  x.na <span class="ot">=</span> col.names[<span class="fu">which</span>(<span class="sc">!</span>col.names <span class="sc">%in%</span> <span class="fu">names</span>(bare.ex))]</span>
<span id="cb287-76"><a href="#cb287-76" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x.na)<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="cf">for</span>(i <span class="cf">in</span> x.na){ bare.ex[,i] <span class="ot">=</span> <span class="cn">NA</span> } }</span>
<span id="cb287-77"><a href="#cb287-77" aria-hidden="true" tabindex="-1"></a>  chemsprops.SIM <span class="ot">=</span> bare.ex[,col.names]</span>
<span id="cb287-78"><a href="#cb287-78" aria-hidden="true" tabindex="-1"></a>  chemsprops.SIM<span class="sc">$</span>project_url <span class="ot">=</span> <span class="st">"https://doi.org/10.34911/rdnt.x4xfh3"</span></span>
<span id="cb287-79"><a href="#cb287-79" aria-hidden="true" tabindex="-1"></a>  chemsprops.SIM<span class="sc">$</span>citation_url <span class="ot">=</span> <span class="st">"https://doi.org/10.1038/s41597-023-02798-5"</span></span>
<span id="cb287-80"><a href="#cb287-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS.gz</span>(chemsprops.SIM, <span class="st">"/mnt/diskstation/data/Soil_points/INT/chemsprops.SIM.rds"</span>)</span>
<span id="cb287-81"><a href="#cb287-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb287-82"><a href="#cb287-82" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(chemsprops.SIM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 80601    39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 80652    39</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Other potential large soil profile DBs of interest:</p>
<ul>
<li>Shangguan, W., Dai, Y., Liu, B., Zhu, A., Duan, Q., Wu, L., … &amp; Chen, D. (2013). <a href="https://doi.org/10.1002/jame.20026">A China data set of soil properties for land surface modeling</a>. Journal of Advances in Modeling Earth Systems, 5(2), 212-224. <a href="https://doi.org/10.1002/jame.20026" class="uri">https://doi.org/10.1002/jame.20026</a><br>
</li>
<li>Salković, E., Djurović, I., Knežević, M., Popović-Bugarin, V., &amp; Topalović, A. (2018). Digitization and mapping of national legacy soil data of Montenegro. Soil and Water Research, 13(2), 83-89. <a href="https://doi.org/10.17221/81/2017-SWR" class="uri">https://doi.org/10.17221/81/2017-SWR</a></li>
<li>Canadian Soil Organic Carbon Database (CSOCD) as described in: Bhatti, J. S., Apps, M. J., &amp; Tarnocai, C. (2002). Estimates of soil organic carbon stocks in central Canada using three different approaches. Canadian Journal of Forest Research, 32(5), 805–812. doi:10.1139/x01-122</li>
</ul>
</section>
</section>
<section id="bind-all-datasets" class="level2">
<h2 class="anchored" data-anchor-id="bind-all-datasets">Bind all datasets</h2>
<section id="bind-and-clean-up" class="level4">
<h4 class="anchored" data-anchor-id="bind-and-clean-up">Bind and clean-up</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>ds.n <span class="ot">=</span> <span class="fu">ls</span>(<span class="at">pattern=</span><span class="fu">glob2rx</span>(<span class="st">"chemsprops.*"</span>))</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 50 data sets</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>nm.l <span class="ot">=</span> <span class="fu">lapply</span>(ds.n, <span class="cf">function</span>(i){ <span class="fu">names</span>(<span class="fu">get</span>(i)) })</span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a><span class="co">#x = lapply(nm.l, length)</span></span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>nm.df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">do.call</span>(rbind, nm.l))</span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a>nm.df<span class="sc">$</span>data.set <span class="ot">=</span> ds.n</span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a><span class="co">#write.csv(nm.df, "/mnt/diskstation/data/Soil_points/chemsprops.validate_column.names.csv")</span></span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a>tot_sprops <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(ds.n, <span class="cf">function</span>(i){ <span class="fu">mutate_all</span>(<span class="fu">setNames</span>(<span class="fu">get</span>(i), col.names), as.character) }))</span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true" tabindex="-1"></a><span class="do">## convert to numeric:</span></span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"layer_sequence"</span>, </span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">"hzn_top"</span>, <span class="st">"hzn_bot"</span>, <span class="st">"clay_total"</span>, <span class="st">"silt_total"</span>, </span>
<span id="cb290-12"><a href="#cb290-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sand_total"</span>, <span class="st">"organic_carbon"</span>, <span class="st">"oc_d"</span>, <span class="st">"total_carbon_ncs"</span>, <span class="st">"total_nitrogen_ncs"</span>, </span>
<span id="cb290-13"><a href="#cb290-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">"ph_kcl"</span>, <span class="st">"ph_h2o"</span>, <span class="st">"ph_cacl2"</span>, </span>
<span id="cb290-14"><a href="#cb290-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">"sum_of_cations_cec_pH_8_2"</span>, <span class="st">"cec_nh4_ph_7"</span>, <span class="st">"ecec_base_plus_aluminum"</span>, </span>
<span id="cb290-15"><a href="#cb290-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"total_frag_wt_pct_gt_2_mm_ws"</span>, <span class="st">"bulk_density_oven_dry"</span>, <span class="st">"ca_ext"</span>, <span class="st">"mg_ext"</span>, </span>
<span id="cb290-16"><a href="#cb290-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">"na_ext"</span>, <span class="st">"k_ext"</span>, <span class="st">"ec_water_extractable"</span>, <span class="st">"ec_predict_one_to_two"</span>)){</span>
<span id="cb290-17"><a href="#cb290-17" aria-hidden="true" tabindex="-1"></a>  tot_sprops[,j] <span class="ot">=</span> <span class="fu">as.numeric</span>(tot_sprops[,j])</span>
<span id="cb290-18"><a href="#cb290-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion
Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co">#head(tot_sprops)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Clean up typos and physically impossible values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>tex.rm <span class="ot">=</span> <span class="fu">rowSums</span>(tot_sprops[,<span class="fu">c</span>(<span class="st">"clay_total"</span>, <span class="st">"silt_total"</span>, <span class="st">"sand_total"</span>)])</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tex.rm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
-2997.0   100.0   100.0   100.2   100.0  2997.0  596615 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"clay_total"</span>, <span class="st">"silt_total"</span>, <span class="st">"sand_total"</span>, <span class="st">"total_frag_wt_pct_gt_2_mm_ws"</span>)){</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>  tot_sprops[,j] <span class="ot">=</span> <span class="fu">ifelse</span>(tot_sprops[,j]<span class="sc">&gt;</span><span class="dv">100</span><span class="sc">|</span>tot_sprops[,j]<span class="sc">&lt;</span><span class="dv">0</span>, <span class="cn">NA</span>, tot_sprops[,j])</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>  tot_sprops[,j] <span class="ot">=</span> <span class="fu">ifelse</span>(tex.rm<span class="sc">&lt;</span><span class="dv">99</span><span class="sc">|</span><span class="fu">is.na</span>(tex.rm)<span class="sc">|</span>tex.rm<span class="sc">&gt;</span><span class="dv">101</span>, <span class="cn">NA</span>, tot_sprops[,j])</span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"ph_h2o"</span>,<span class="st">"ph_kcl"</span>,<span class="st">"ph_cacl2"</span>)){</span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a>  tot_sprops[,j] <span class="ot">=</span> <span class="fu">ifelse</span>(tot_sprops[,j]<span class="sc">&gt;</span><span class="dv">12</span><span class="sc">|</span>tot_sprops[,j]<span class="sc">&lt;</span><span class="dv">2</span>, <span class="cn">NA</span>, tot_sprops[,j])</span>
<span id="cb295-7"><a href="#cb295-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb295-8"><a href="#cb295-8" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(tot_sprops$bulk_density_oven_dry)</span></span>
<span id="cb295-9"><a href="#cb295-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"bulk_density_oven_dry"</span>)){</span>
<span id="cb295-10"><a href="#cb295-10" aria-hidden="true" tabindex="-1"></a>  tot_sprops[,j] <span class="ot">=</span> <span class="fu">ifelse</span>(tot_sprops[,j]<span class="sc">&gt;</span><span class="fl">2.4</span><span class="sc">|</span>tot_sprops[,j]<span class="sc">&lt;</span><span class="fl">0.03</span>, <span class="cn">NA</span>, tot_sprops[,j])</span>
<span id="cb295-11"><a href="#cb295-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb295-12"><a href="#cb295-12" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(tot_sprops$oc)</span></span>
<span id="cb295-13"><a href="#cb295-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"organic_carbon"</span>)){</span>
<span id="cb295-14"><a href="#cb295-14" aria-hidden="true" tabindex="-1"></a>  tot_sprops[,j] <span class="ot">=</span> <span class="fu">ifelse</span>(tot_sprops[,j]<span class="sc">&gt;</span><span class="dv">800</span><span class="sc">|</span>tot_sprops[,j]<span class="sc">&lt;</span><span class="dv">0</span>, <span class="cn">NA</span>, tot_sprops[,j])</span>
<span id="cb295-15"><a href="#cb295-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fill-in the missing depths:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="do">## soil layer depth (middle)</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>tot_sprops<span class="sc">$</span>hzn_depth <span class="ot">=</span> tot_sprops<span class="sc">$</span>hzn_top <span class="sc">+</span> (tot_sprops<span class="sc">$</span>hzn_bot<span class="sc">-</span>tot_sprops<span class="sc">$</span>hzn_top)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">is.na</span>(tot_sprops<span class="sc">$</span>hzn_depth))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Mode   FALSE    TRUE 
logical 1582600   41791 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 33199</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Note: large number of horizons without a depth</span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>tot_sprops <span class="ot">=</span> tot_sprops[<span class="sc">!</span><span class="fu">is.na</span>(tot_sprops<span class="sc">$</span>hzn_depth),]</span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a><span class="co">#quantile(tot_sprops$hzn_depth, c(0.01,0.99), na.rm=TRUE)</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>tot_sprops<span class="sc">$</span>hzn_depth <span class="ot">=</span> <span class="fu">ifelse</span>(tot_sprops<span class="sc">$</span>hzn_depth<span class="sc">&lt;</span><span class="dv">0</span>, <span class="dv">10</span>, <span class="fu">ifelse</span>(tot_sprops<span class="sc">$</span>hzn_depth<span class="sc">&gt;</span><span class="dv">800</span>, <span class="dv">800</span>, tot_sprops<span class="sc">$</span>hzn_depth))</span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a><span class="co">#hist(tot_sprops$hzn_depth, breaks=45)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Summary number of points per data source:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.factor</span>(tot_sprops<span class="sc">$</span>source_db))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             AfSIS1              AfSPDB     Alaska_interior              BZE_LW 
               4369               68794                4011               17189 
        Canada_CUFS         Canada_NPDB    Canada_subarctic       Chilean_SOCDB 
              15873               54512                1381               16887 
        China_SOTER               CIFOR           CostaRica Croatian_Soil_Pedon 
               5115                 577                2037                5757 
      CSIRO_NatSoil        Ecuador_HESD                FEBR                FRED 
              89645               30167               24353               12758 
         GEMAS_2009       GLanCE.points               GROOT    Guatemala_GTMSOC 
               4131               80601               16271                 910 
          Iran_SPDB                ISCN               ISCND                ISDA 
               4859               27236                4114               49225 
         ISRIC_WISE             LandPKS          LUCAS_2009          LUCAS_2015 
              37443              165044               21272               21859 
         LUCAS_2018         MangrovesDB         MexicoINEGI            NAMSOTER 
              18982                7986               16820                2943 
              NCSCD     Netherlands.BIS   Portugal.INFOSOLO   Potash_et_al_2023 
               7348              116296                9934                3977 
         PRONASOLOS           QuebecTEX        Russia_EGRPR       ScotlandNSIS1 
              32615               29570                4506                3091 
             SISLAC       Slovenia.SPDB              SOCPDB               SoDaH 
              92121               11509                2416               30559 
       SoilHealthDB                SRDB           USDA_NCSS            USGS.NGS 
               5050                3337              344756                9399 
         Vlaanderen    WHRC_remnant_SOC 
              41364                1631 </code></pre>
</div>
</div>
<p>Add unique row identifier</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>tot_sprops<span class="sc">$</span>uuid <span class="ot">=</span> openssl<span class="sc">::</span><span class="fu">md5</span>(<span class="fu">make.unique</span>(<span class="fu">paste</span>(<span class="st">"OpenLandMap"</span>, tot_sprops<span class="sc">$</span>site_key, tot_sprops<span class="sc">$</span>layer_sequence, <span class="at">sep=</span><span class="st">"_"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Add unique location based on the <a href="https://cran.r-project.org/web/packages/olctools/vignettes/Introduction_to_olctools.html">Open Location Code</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>tot_sprops<span class="sc">$</span>olc_id <span class="ot">=</span> olctools<span class="sc">::</span><span class="fu">encode_olc</span>(tot_sprops<span class="sc">$</span>latitude_decimal_degrees, tot_sprops<span class="sc">$</span>longitude_decimal_degrees, <span class="dv">11</span>)</span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">levels</span>(<span class="fu">as.factor</span>(tot_sprops<span class="sc">$</span>olc_id)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 346671</code></pre>
</div>
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 346748</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>tot_sprops.pnts <span class="ot">=</span> tot_sprops[<span class="sc">!</span><span class="fu">duplicated</span>(tot_sprops<span class="sc">$</span>olc_id),<span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"source_db"</span>, <span class="st">"longitude_decimal_degrees"</span>, <span class="st">"latitude_decimal_degrees"</span>, <span class="st">"site_obsdate"</span>, <span class="st">"olc_id"</span>, <span class="st">"project_url"</span>, <span class="st">"citation_url"</span>)]</span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(tot_sprops.pnts) <span class="ot">&lt;-</span> <span class="er">~</span> longitude_decimal_degrees <span class="sc">+</span> latitude_decimal_degrees</span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(tot_sprops.pnts) <span class="ot">&lt;-</span> <span class="st">"EPSG:4326"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Density of points per 100 x 100 km grid (IGH projection):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">vect</span>(<span class="st">"/mnt/diskstation/data/Soil_points/tiles_GH_100km_land.gpkg"</span>)</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>ov.g1 <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">extract</span>(g1[<span class="st">"ID"</span>], terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">vect</span>(tot_sprops.pnts), <span class="fu">crs</span>(g1)))</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>g1.c <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">as.factor</span>(ov.g1<span class="sc">$</span>ID), <span class="at">maxsum =</span> <span class="fu">length</span>(<span class="fu">levels</span>(<span class="fu">as.factor</span>(ov.g1<span class="sc">$</span>ID))))</span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>g1.df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">count=</span>g1.c, <span class="at">ID=</span><span class="fu">attr</span>(g1.c, <span class="st">"names"</span>))</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>g1<span class="sc">$</span>count <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">ID=</span>g1<span class="sc">$</span>ID), g1.df)<span class="sc">$</span>count </span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(g1["count"])</span></span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a><span class="co">#writeVector(g1["count"], "/data/dev/tiles_GH_100km_pnt.dens.gpkg", overwrite=TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/fig_density_training_chem.pnts.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Density of points based on 100 by 100 km blocks in IGH projection.</figcaption>
</figure>
</div>
</div>
</div>
<p>Remove points falling in the sea or similar:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mask = terra::rast("/mnt/diskstation/data/LandGIS/layers250m/lcv_landmask_esacci.lc.l4_c_250m_s0..0cm_2000..2015_v1.0.tif")</span></span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>mask <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"/data/CCI_LandCover/land.cover_copernicus_c_100m_s_20150101_20151231_go_epsg.4326_v3.0.1.tif"</span>)</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ov.sprops &lt;- terra::extract(mask, terra::vect(tot_sprops.pnts)) ## TAKES 10 secs</span></span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(as.factor(ov.sprops[,2]))</span></span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a><span class="co">#if(sum(is.na(ov.sprops[,2]) | ov.sprops[,2]==200)&gt;0){</span></span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  rem.lst = which(is.na(ov.sprops[,2]) | ov.sprops[,2]==200)</span></span>
<span id="cb307-7"><a href="#cb307-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  rem.sp = tot_sprops.pnts$site_key[rem.lst]</span></span>
<span id="cb307-8"><a href="#cb307-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  tot_sprops.pnts = tot_sprops.pnts[-rem.lst,]</span></span>
<span id="cb307-9"><a href="#cb307-9" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb307-10"><a href="#cb307-10" aria-hidden="true" tabindex="-1"></a><span class="do">## final number of unique spatial locations:</span></span>
<span id="cb307-11"><a href="#cb307-11" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(tot_sprops.pnts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 346671</code></pre>
</div>
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 346748</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="histogram-plots" class="level4">
<h4 class="anchored" data-anchor-id="histogram-plots">Histogram plots</h4>
<p>Have in mind that some datasets only represent top-soil (e.g.&nbsp;LUCAS) while other cover the whole soil depth, hence higher mean values for some regions (Europe) should be considered within the context of diverse soil depths.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tot_sprops, <span class="fu">aes</span>(<span class="at">x=</span>source_db, <span class="at">y=</span><span class="fu">log1p</span>(organic_carbon))) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 451253 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>sel.db <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ISRIC_WISE"</span>, <span class="st">"Canada_CUFS"</span>, <span class="st">"USDA_NCSS"</span>, <span class="st">"AfSPDB"</span>, <span class="st">"Canada_NPDB"</span>, <span class="st">"PRONASOLOS"</span>, <span class="st">"CSIRO_NatSoil"</span>, <span class="st">"ISCN"</span>)</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>openair<span class="sc">::</span><span class="fu">scatterPlot</span>(tot_sprops[tot_sprops<span class="sc">$</span>source_db <span class="sc">%in%</span> sel.db,], <span class="at">x =</span> <span class="st">"hzn_depth"</span>, <span class="at">y =</span> <span class="st">"organic_carbon"</span>, <span class="at">method =</span> <span class="st">"hexbin"</span>, </span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"increment"</span>, <span class="at">type =</span> <span class="st">"source_db"</span>, <span class="at">log.x =</span> <span class="cn">TRUE</span>, <span class="at">log.y=</span><span class="cn">TRUE</span>, <span class="at">ylab=</span><span class="st">"SOC [g/kg]"</span>, <span class="at">xlab=</span><span class="st">"depth in cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note: Canada dataset also shows SOC content for peatlands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tot_sprops, <span class="fu">aes</span>(<span class="at">x=</span>source_db, <span class="at">y=</span>bulk_density_oven_dry)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1299854 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>openair<span class="sc">::</span><span class="fu">scatterPlot</span>(tot_sprops[tot_sprops<span class="sc">$</span>source_db <span class="sc">%in%</span> sel.db,], <span class="at">x =</span> <span class="st">"organic_carbon"</span>, <span class="at">y =</span> <span class="st">"bulk_density_oven_dry"</span>, <span class="at">method =</span> <span class="st">"hexbin"</span>, </span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col =</span> <span class="st">"increment"</span>, <span class="at">type =</span> <span class="st">"source_db"</span>, <span class="at">log.x=</span><span class="cn">TRUE</span>, <span class="at">ylab=</span><span class="st">"Bulk density"</span>, <span class="at">xlab=</span><span class="st">"SOC [g/kg]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tot_sprops, <span class="fu">aes</span>(<span class="at">x=</span>source_db, <span class="at">y=</span><span class="fu">log1p</span>(oc_d))) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1256582 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>sel.db0 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ISRIC_WISE"</span>, <span class="st">"Canada_CUFS"</span>, <span class="st">"USDA_NCSS"</span>, <span class="st">"AfSPDB"</span>, <span class="st">"PRONASOLOS"</span>, <span class="st">"CSIRO_NatSoil"</span>)</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>openair<span class="sc">::</span><span class="fu">scatterPlot</span>(tot_sprops[tot_sprops<span class="sc">$</span>source_db <span class="sc">%in%</span> sel.db0,], <span class="at">x =</span> <span class="st">"organic_carbon"</span>, <span class="at">y =</span> <span class="st">"oc_d"</span>, <span class="at">method =</span> <span class="st">"hexbin"</span>, </span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col =</span> <span class="st">"increment"</span>, <span class="at">type =</span> <span class="st">"source_db"</span>, <span class="at">log.x=</span><span class="cn">TRUE</span>, <span class="at">log.y=</span><span class="cn">TRUE</span>, <span class="at">xlab=</span><span class="st">"SOC [g/kg]"</span>, <span class="at">ylab=</span><span class="st">"SOC [kg/m3]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note: SOC (%) and SOC density (kg/m3) are almost linear relationship (curving toward fixed value), except for organic soils (especially litter) where relationship is slightly shifted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>openair<span class="sc">::</span><span class="fu">scatterPlot</span>(tot_sprops[tot_sprops<span class="sc">$</span>source_db <span class="sc">%in%</span> sel.db0,], <span class="at">x =</span> <span class="st">"organic_carbon"</span>, </span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="st">"total_nitrogen_ncs"</span>, <span class="at">method =</span> <span class="st">"hexbin"</span>, </span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col =</span> <span class="st">"increment"</span>, <span class="at">type =</span> <span class="st">"source_db"</span>, <span class="at">log.x=</span><span class="cn">TRUE</span>, <span class="at">log.y=</span><span class="cn">TRUE</span>, </span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlab=</span><span class="st">"SOC [g/kg]"</span>, <span class="at">ylab=</span><span class="st">"N total [g/kg]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tot_sprops, <span class="fu">aes</span>(<span class="at">x=</span>source_db, <span class="at">y=</span>ph_h2o)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 760654 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>openair<span class="sc">::</span><span class="fu">scatterPlot</span>(tot_sprops[tot_sprops<span class="sc">$</span>source_db <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ISRIC_WISE"</span>, <span class="st">"USDA_NCSS"</span>, <span class="st">"AfSPDB"</span>, <span class="st">"CSIRO_NatSoil"</span>, <span class="st">"PRONASOLOS"</span>),], <span class="at">x =</span> <span class="st">"ph_kcl"</span>, <span class="at">y =</span> <span class="st">"ph_h2o"</span>, <span class="at">method =</span> <span class="st">"hexbin"</span>, </span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col =</span> <span class="st">"increment"</span>, <span class="at">type =</span> <span class="st">"source_db"</span>, <span class="at">xlab=</span><span class="st">"soil pH KCl"</span>, <span class="at">ylab=</span><span class="st">"soil pH H2O"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>openair<span class="sc">::</span><span class="fu">scatterPlot</span>(tot_sprops[tot_sprops<span class="sc">$</span>source_db <span class="sc">%in%</span> sel.db0,], <span class="at">x =</span> <span class="st">"hzn_depth"</span>, <span class="at">y =</span> <span class="st">"ph_h2o"</span>, <span class="at">method =</span> <span class="st">"hexbin"</span>, </span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col =</span> <span class="st">"increment"</span>, <span class="at">type =</span> <span class="st">"source_db"</span>, <span class="at">log.x =</span> <span class="cn">TRUE</span>, <span class="at">log.y=</span><span class="cn">TRUE</span>, <span class="at">ylab=</span><span class="st">"soil pH H2O"</span>, <span class="at">xlab=</span><span class="st">"depth in cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note: there seems to be no apparent correlation between soil pH and soil depth.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>openair<span class="sc">::</span><span class="fu">scatterPlot</span>(tot_sprops[tot_sprops<span class="sc">$</span>source_db <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ISRIC_WISE"</span>, <span class="st">"USDA_NCSS"</span>, <span class="st">"AfSPDB"</span>, <span class="st">"PRONASOLOS"</span>, <span class="st">"Canada_NPDB"</span>),], <span class="at">x =</span> <span class="st">"ph_h2o"</span>, <span class="at">y =</span> <span class="st">"sum_of_cations_cec_pH_8_2"</span>, <span class="at">method =</span> <span class="st">"hexbin"</span>, </span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col =</span> <span class="st">"increment"</span>, <span class="at">type =</span> <span class="st">"source_db"</span>, <span class="at">log.y=</span><span class="cn">TRUE</span>, <span class="at">ylab=</span><span class="st">"CEC"</span>, <span class="at">xlab=</span><span class="st">"soil pH H2O"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a>openair<span class="sc">::</span><span class="fu">scatterPlot</span>(tot_sprops[tot_sprops<span class="sc">$</span>source_db <span class="sc">%in%</span> sel.db0,], <span class="at">x =</span> <span class="st">"ph_h2o"</span>, <span class="at">y =</span> <span class="st">"organic_carbon"</span>, <span class="at">method =</span> <span class="st">"hexbin"</span>,  </span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col =</span> <span class="st">"increment"</span>, <span class="at">type =</span> <span class="st">"source_db"</span>, <span class="at">log.y=</span><span class="cn">TRUE</span>, <span class="at">ylab=</span><span class="st">"SOC [g/kg]"</span>, <span class="at">xlab=</span><span class="st">"soil pH H2O"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tot_sprops, <span class="fu">aes</span>(<span class="at">x=</span>source_db, <span class="at">y=</span>clay_total)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 606539 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>openair<span class="sc">::</span><span class="fu">scatterPlot</span>(tot_sprops[tot_sprops<span class="sc">$</span>source_db <span class="sc">%in%</span> sel.db0,], <span class="at">y =</span> <span class="st">"clay_total"</span>, <span class="at">x =</span> <span class="st">"sand_total"</span>, <span class="at">method =</span> <span class="st">"hexbin"</span>,  </span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col =</span> <span class="st">"increment"</span>, <span class="at">type =</span> <span class="st">"source_db"</span>, <span class="at">ylab=</span><span class="st">"clay %"</span>, <span class="at">xlab=</span><span class="st">"sand %"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tot_sprops, <span class="fu">aes</span>(<span class="at">x=</span>source_db, <span class="at">y=</span><span class="fu">log1p</span>(sum_of_cations_cec_pH_8_2))) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in log1p(sum_of_cations_cec_pH_8_2): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1143413 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tot_sprops, <span class="fu">aes</span>(<span class="at">x=</span>source_db, <span class="at">y=</span><span class="fu">log1p</span>(total_nitrogen_ncs))) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in log1p(total_nitrogen_ncs): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1033784 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tot_sprops, <span class="fu">aes</span>(<span class="at">x=</span>source_db, <span class="at">y=</span><span class="fu">log1p</span>(k_ext))) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in log1p(k_ext): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 930575 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tot_sprops, <span class="fu">aes</span>(<span class="at">x=</span>source_db, <span class="at">y=</span><span class="fu">log1p</span>(ec_water_extractable))) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1433483 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>sprops_yrs <span class="ot">=</span> tot_sprops[<span class="sc">!</span><span class="fu">is.na</span>(tot_sprops<span class="sc">$</span>site_obsdate),<span class="fu">c</span>(<span class="st">"site_obsdate"</span>, <span class="st">"source_db"</span>, <span class="st">"organic_carbon"</span>)]</span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a>sprops_yrs<span class="sc">$</span>year <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(<span class="at">x=</span>sprops_yrs<span class="sc">$</span>site_obsdate, <span class="dv">1</span>, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>sprops_yrs<span class="sc">$</span>year <span class="ot">=</span> <span class="fu">ifelse</span>(sprops_yrs<span class="sc">$</span>year <span class="sc">&lt;</span><span class="dv">1960</span>, <span class="cn">NA</span>, <span class="fu">ifelse</span>(sprops_yrs<span class="sc">$</span>year<span class="sc">&gt;</span><span class="dv">2024</span>, <span class="cn">NA</span>, sprops_yrs<span class="sc">$</span>year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sprops_yrs, <span class="fu">aes</span>(<span class="at">x=</span>source_db, <span class="at">y=</span>year)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 160910 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>openair<span class="sc">::</span><span class="fu">scatterPlot</span>(sprops_yrs[sprops_yrs<span class="sc">$</span>source_db <span class="sc">%in%</span> <span class="fu">c</span>(sel.db0, <span class="st">"Canada_NPDB"</span>, <span class="st">"SoDaH"</span>),], <span class="at">y =</span> <span class="st">"organic_carbon"</span>, <span class="at">x =</span> <span class="st">"year"</span>, <span class="at">method =</span> <span class="st">"hexbin"</span>,  </span>
<span id="cb345-2"><a href="#cb345-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col =</span> <span class="st">"increment"</span>, <span class="at">type =</span> <span class="st">"source_db"</span>, <span class="at">log.y=</span><span class="cn">TRUE</span>, <span class="at">ylab=</span><span class="st">"SOC [g/kg]"</span>, <span class="at">xlab=</span><span class="st">"Sampling year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="025-import_chemical_data_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="convert-to-wide-format" class="level4">
<h4 class="anchored" data-anchor-id="convert-to-wide-format">Convert to wide format</h4>
<p>Add <code>layer_sequence</code> where missing since this is needed to be able to convert to wide format:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(tot_sprops$layer_sequence)</span></span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>tot_sprops<span class="sc">$</span>dsiteid <span class="ot">=</span> <span class="fu">paste</span>(tot_sprops<span class="sc">$</span>source_db, tot_sprops<span class="sc">$</span>site_key, tot_sprops<span class="sc">$</span>site_obsdate, <span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"l.s1"</span>)){</span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Note: takes &gt;1 mins</span></span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a>  l.s1 <span class="ot">&lt;-</span> tot_sprops[,<span class="fu">c</span>(<span class="st">"dsiteid"</span>,<span class="st">"hzn_depth"</span>)] <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(dsiteid) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">layer_sequence.f =</span> data.table<span class="sc">::</span><span class="fu">frank</span>(hzn_depth, <span class="at">ties.method =</span> <span class="st">"first"</span>))</span>
<span id="cb346-7"><a href="#cb346-7" aria-hidden="true" tabindex="-1"></a>  tot_sprops<span class="sc">$</span>layer_sequence.f <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(tot_sprops<span class="sc">$</span>layer_sequence), l.s1<span class="sc">$</span>layer_sequence.f, tot_sprops<span class="sc">$</span>layer_sequence)</span>
<span id="cb346-8"><a href="#cb346-8" aria-hidden="true" tabindex="-1"></a>  tot_sprops<span class="sc">$</span>layer_sequence.f <span class="ot">=</span> <span class="fu">ifelse</span>(tot_sprops<span class="sc">$</span>layer_sequence.f<span class="sc">&gt;</span><span class="dv">6</span>, <span class="dv">6</span>, tot_sprops<span class="sc">$</span>layer_sequence.f)</span>
<span id="cb346-9"><a href="#cb346-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Convert long table to <a href="https://ncss-tech.github.io/AQP/aqp/aqp-intro.html">wide table format</a> so that each depth gets unique column (note: the most computational / time-consuming step usually):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"tot_sprops.w"</span>)){</span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(data.table)</span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a>  tot_sprops.w <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">dcast</span>( <span class="fu">as.data.table</span>(tot_sprops), </span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">formula =</span> olc_id <span class="sc">~</span> layer_sequence.f, </span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">"uuid"</span>, hor.names[<span class="sc">-</span><span class="fu">which</span>(hor.names <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"site_key"</span>, <span class="st">"layer_sequence"</span>))]), </span>
<span id="cb347-6"><a href="#cb347-6" aria-hidden="true" tabindex="-1"></a>                <span class="do">## "labsampnum", "hzn_desgn", "tex_psda" </span></span>
<span id="cb347-7"><a href="#cb347-7" aria-hidden="true" tabindex="-1"></a>                <span class="co">#fun=function(x){ mean(x, na.rm=TRUE) }, </span></span>
<span id="cb347-8"><a href="#cb347-8" aria-hidden="true" tabindex="-1"></a>                <span class="do">## Note: does not work for characters</span></span>
<span id="cb347-9"><a href="#cb347-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">fun=</span><span class="cf">function</span>(x){ x[<span class="dv">1</span>] },</span>
<span id="cb347-10"><a href="#cb347-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb347-11"><a href="#cb347-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## remove "0" layers added automatically but containing no values</span></span>
<span id="cb347-12"><a href="#cb347-12" aria-hidden="true" tabindex="-1"></a>  tot_sprops.w <span class="ot">=</span> tot_sprops.w[,<span class="fu">grep</span>(<span class="st">"*_0$"</span>, <span class="fu">colnames</span>(tot_sprops.w))<span class="sc">:</span><span class="er">=</span><span class="cn">NULL</span>]</span>
<span id="cb347-13"><a href="#cb347-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:terra':

    shift</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    between, first, last</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    transpose</code></pre>
</div>
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>tot_sprops_w.pnts <span class="ot">=</span> tot_sprops.pnts</span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a>tot_sprops_w.pnts<span class="sc">@</span>data <span class="ot">=</span> plyr<span class="sc">::</span><span class="fu">join</span>(tot_sprops.pnts<span class="sc">@</span>data, tot_sprops.w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining by: olc_id</code></pre>
</div>
</div>
<p>Write all soil profiles using a wide format:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>sel.rm.pnts  <span class="ot">&lt;-</span> tot_sprops_w.pnts<span class="sc">$</span>source_db<span class="sc">==</span><span class="st">"LUCAS_2009"</span> <span class="sc">|</span> tot_sprops_w.pnts<span class="sc">$</span>source_db<span class="sc">==</span><span class="st">"LUCAS_2015"</span> <span class="sc">|</span> tot_sprops_w.pnts<span class="sc">$</span>source_db<span class="sc">==</span><span class="st">"LUCAS_2018"</span> <span class="sc">|</span> tot_sprops_w.pnts<span class="sc">$</span>site_key <span class="sc">%in%</span> mng.rm <span class="do">## | tot_sprops_w.pnts$site_key %in% rem.sp</span></span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a>out.gpkg <span class="ot">=</span> <span class="st">"/mnt/diskstation/data/Soil_points/sol_chem.pnts_horizons.gpkg"</span></span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a><span class="co">#unlink(out.gpkg)</span></span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(out.gpkg)){</span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_write</span>(<span class="fu">st_as_sf</span>(tot_sprops_w.pnts), out.gpkg, <span class="st">"sol_chem.pnts_horizons"</span>, <span class="at">driver=</span><span class="st">"GPKG"</span>, <span class="at">append=</span><span class="cn">FALSE</span>)</span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_write</span>(<span class="fu">st_as_sf</span>(tot_sprops_w.pnts[<span class="sc">!</span>sel.rm.pnts,]), out.gpkg, <span class="st">"sol_chem.pnts_horizons"</span>, <span class="at">driver=</span><span class="st">"GPKG"</span>)</span>
<span id="cb355-7"><a href="#cb355-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="save-rds-files" class="level4">
<h4 class="anchored" data-anchor-id="save-rds-files">Save RDS files</h4>
<p>Remove points that are not allowed to be distributed publicly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>sel.rm  <span class="ot">&lt;-</span> tot_sprops<span class="sc">$</span>source_db<span class="sc">==</span><span class="st">"LUCAS_2009"</span> <span class="sc">|</span> tot_sprops<span class="sc">$</span>source_db<span class="sc">==</span><span class="st">"LUCAS_2015"</span> <span class="sc">|</span> tot_sprops<span class="sc">$</span>source_db<span class="sc">==</span><span class="st">"LUCAS_2018"</span> <span class="sc">|</span> tot_sprops<span class="sc">$</span>site_key <span class="sc">%in%</span> mng.rm <span class="co"># | tot_sprops$site_key %in% rem.sp</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>tot_sprops.s <span class="ot">=</span> tot_sprops[<span class="sc">!</span>sel.rm,] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot in Goode Homolozine projection and save final objects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb357"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"./img/sol_chem.pnts_sites.png"</span>)){</span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>  tot_sprops.pnts_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(tot_sprops.pnts[<span class="dv">1</span>], <span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_gh</span>(tot_sprops.pnts_sf, <span class="at">out.pdf=</span><span class="st">"./img/sol_chem.pnts_sites.pdf"</span>)</span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## extremely slow --- takes 15mins</span></span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system</span>(<span class="st">"pdftoppm ./img/sol_chem.pnts_sites.pdf ./img/sol_chem.pnts_sites -png -f 1 -singlefile"</span>)</span>
<span id="cb357-6"><a href="#cb357-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system</span>(<span class="st">"convert -crop 1280x575+36+114 ./img/sol_chem.pnts_sites.png ./img/sol_chem.pnts_sites.png"</span>)</span>
<span id="cb357-7"><a href="#cb357-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/sol_chem.pnts_sites.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Soil profiles and soil samples with chemical and physical properties global compilation.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="save-final-analysis-ready-objects" class="level2">
<h2 class="anchored" data-anchor-id="save-final-analysis-ready-objects">Save final analysis-ready objects:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS.gz(tot_sprops.s, "./out/rds/sol_chem.pnts_horizons.rds")</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS.gz</span>(tot_sprops, <span class="st">"/mnt/diskstation/data/Soil_points/sol_chem.pnts_horizons.rds"</span>)</span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS.gz</span>(tot_sprops.pnts, <span class="st">"/mnt/diskstation/data/Soil_points/sol_chem.pnts_sites.rds"</span>)</span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a><span class="co">#library(farff)</span></span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a><span class="co">#writeARFF(tot_sprops.s, "./out/arff/sol_chem.pnts_horizons.arff", overwrite = TRUE)</span></span>
<span id="cb358-6"><a href="#cb358-6" aria-hidden="true" tabindex="-1"></a><span class="do">## compressed CSV</span></span>
<span id="cb358-7"><a href="#cb358-7" aria-hidden="true" tabindex="-1"></a><span class="co">#write.csv(tot_sprops.s, file=gzfile("./out/csv/sol_chem.pnts_horizons.csv.gz"))</span></span>
<span id="cb358-8"><a href="#cb358-8" aria-hidden="true" tabindex="-1"></a><span class="do">## regression matrix:</span></span>
<span id="cb358-9"><a href="#cb358-9" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS.gz(rm.sol, "./out/rds/sol_chem.pnts_horizons_rm.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save temp object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image.pigz</span>(<span class="at">file=</span><span class="st">"soilchem.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2024, OpenGeoHub foundation</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/OpenGeoHub/SoilSamples/edit/main/025-import_chemical_data.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/OpenGeoHub/SoilSamples/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/OpenGeoHub/SoilSamples">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@opengeohub">
      <i class="bi bi-mastodon" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/opengeohub">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/opengeohub-foundation/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/c/OpenGeoHubFoundation">
      <i class="bi bi-youtube" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>